(()=>{var i={SCRAPE_CREATORS_API_KEY:"scrapeCreatorsApiKey",OPENROUTER_API_KEY:"openRouterApiKey",SUMMARIZER_RECOMMENDED_MODEL:"summarizerRecommendedModel",SUMMARIZER_CUSTOM_MODEL:"summarizerCustomModel",REFINER_RECOMMENDED_MODEL:"refinerRecommendedModel",REFINER_CUSTOM_MODEL:"refinerCustomModel",AUTO_GENERATE:"autoGenerate",SHOW_SUBTITLES:"showSubtitles",CAPTION_FONT_SIZE:"captionFontSize",SUMMARY_FONT_SIZE:"summaryFontSize",TARGET_LANGUAGE_RECOMMENDED:"targetLanguageRecommended",TARGET_LANGUAGE_CUSTOM:"targetLanguageCustom"},M={AUTO_GENERATION_DELAY_MS:2e3,INIT_RETRY_DELAY_MS:500,SUBTITLE_UPDATE_INTERVAL_MS:100,MAX_INIT_ATTEMPTS:5,CONTENT_SCRIPT_INIT_DELAY_MS:500,STATUS_MESSAGE_DISPLAY_MS:2e3,SUMMARY_SUCCESS_DISPLAY_MS:3e3,CAPTION_CHECK_DELAY_MS:500},de={QUOTA_BYTES:10*1024*1024,MAX_STORAGE_BYTES:9.5*1024*1024,ESTIMATED_VIDEO_SIZE_BYTES:30*1024,CLEANUP_BATCH_SIZE:10},B=[{value:"google/gemini-3-flash-preview",label:"Gemini 3 Flash"},{value:"google/gemini-3-pro-preview",label:"Gemini 3 Pro"},{value:"openai/gpt-5-mini",label:"GPT-5 Mini"},{value:"openai/gpt-5.2",label:"GPT-5.2"},{value:"x-ai/grok-4.1-fast",label:"Grok 4.1 Fast"}],Y=[{value:"google/gemini-2.5-flash-lite-preview-09-2025",label:"Gemini 2.5 Flash Lite"},{value:"x-ai/grok-4.1-fast",label:"Grok 4.1 Fast"}],w=[{value:"auto",label:"\u{1F310} Auto"},{value:"en",label:"\u{1F1FA}\u{1F1F8} English"},{value:"zh-TW",label:"\u{1F1ED}\u{1F1F0} Chinese"}],d={MODEL_SUMMARIZER:"x-ai/grok-4.1-fast",MODEL_REFINER:"google/gemini-2.5-flash-lite-preview-09-2025",AUTO_GENERATE:!1,SHOW_SUBTITLES:!0,CAPTION_FONT_SIZE:"M",SUMMARY_FONT_SIZE:"M",TARGET_LANGUAGE_RECOMMENDED:"auto",TARGET_LANGUAGE_CUSTOM:""},x={CAPTION:{S:{base:"1.4vw",max:"22px",min:"12px",fullscreen:"1.7vw",fullscreenMax:"28px"},M:{base:"1.8vw",max:"28px",min:"14px",fullscreen:"2.2vw",fullscreenMax:"36px"},L:{base:"2.2vw",max:"34px",min:"16px",fullscreen:"2.7vw",fullscreenMax:"44px"}},SUMMARY:{S:{base:"16px",h2:"22px",h3:"19px"},M:{base:"18px",h2:"26px",h3:"22px"},L:{base:"20px",h2:"30px",h3:"24px"}}};var f={FETCH_SUBTITLES:"fetchSubtitles",GENERATE_SUBTITLES:"generateSubtitles",GENERATE_SUMMARY:"generateSummary",SUBTITLES_GENERATED:"subtitlesGenerated",SUMMARY_GENERATED:"summaryGenerated",UPDATE_POPUP_STATUS:"updatePopupStatus",TOGGLE_SUBTITLES:"toggleSubtitles",GET_VIDEO_TITLE:"getVideoTitle",SHOW_ERROR:"showError",UPDATE_CAPTION_FONT_SIZE:"updateCaptionFontSize"};var D={CONTEXT_INVALIDATED:"Extension context invalidated",VIDEO_ID_REQUIRED:"Video ID is required.",NO_VIDEO_ID:"Could not extract video ID from URL.",NO_TRANSCRIPT:"No transcript available for this video",SCRAPE_KEY_MISSING:"Scrape Creators API key not found. Please set it in settings.",OPENROUTER_KEY_MISSING:"OpenRouter API key not found",NOT_YOUTUBE_PAGE:"Not a YouTube video page",SUMMARY_IN_PROGRESS:"Summary generation is already in progress for this video."};var me="Better YouTube Caption:",pe=!0,E=(...e)=>{pe&&console.log(me,...e)};function C(e){return new Promise(t=>{chrome.storage.local.get([e],o=>{t(o[e]||null)})})}function S(e){return new Promise(t=>{chrome.storage.local.get([e],o=>{t(o[e]||null)})})}function p(e,t){chrome.storage.local.set({[e]:t},()=>{chrome.runtime.lastError?console.error("Failed to save setting:",e,chrome.runtime.lastError):E("Auto-saved:",e,t)})}function U(e){return{anthropic:"images/anthropic.svg",google:"images/google.svg",openai:"images/openai.svg","x-ai":"images/xai.svg"}[e]||""}function O(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function g(e){if(!e)return"";let t=O(e);return t=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/__(.+?)__/g,"<strong>$1</strong>"),t=t.replace(/(?<!\*)\*([^*]+?)\*(?!\*)/g,"<em>$1</em>"),t=t.replace(/(?<!_)_([^_]+?)_(?!_)/g,"<em>$1</em>"),t=t.replace(/`([^`]+)`/g,"<code>$1</code>"),t}function Ee(e){if(!e||typeof e!="string")return'<div class="summary-placeholder">No summary available</div>';let t=e.split(`
`),o=[],r=!1,n=!1;for(let a=0;a<t.length;a++){let s=t[a].trim();if(!s){r&&(o.push("</ul>"),r=!1),n&&(o.push("</p>"),n=!1);continue}if(s.match(/^###\s+(.+)$/)){r&&(o.push("</ul>"),r=!1),n&&(o.push("</p>"),n=!1);let c=s.replace(/^###\s+/,"");o.push(`<h3>${O(c)}</h3>`)}else if(s.match(/^##\s+(.+)$/)){r&&(o.push("</ul>"),r=!1),n&&(o.push("</p>"),n=!1);let c=s.replace(/^##\s+/,"");o.push(`<h2>${O(c)}</h2>`)}else if(s.match(/^#\s+(.+)$/)){r&&(o.push("</ul>"),r=!1),n&&(o.push("</p>"),n=!1);let c=s.replace(/^#\s+/,"");o.push(`<h2>${O(c)}</h2>`)}else if(s.match(/^[\*\-•]\s+(.+)$/)){n&&(o.push("</p>"),n=!1),r||(o.push("<ul>"),r=!0);let c=s.replace(/^[\*\-•]\s+/,"");o.push(`<li>${g(c)}</li>`)}else r&&(o.push("</ul>"),r=!1),n?o.push("<br>"):(o.push("<p>"),n=!0),o.push(g(s))}return r&&o.push("</ul>"),n&&o.push("</p>"),o.join("")}function fe(e){if(!e)return'<div class="summary-placeholder">No summary available</div>';let{summary:t,takeaways:o,key_facts:r}=e,n='<div class="structured-analysis">';n+=`
    <div class="analysis-header-container">
    </div>
  `,t&&(n+=`
      <div class="analysis-section">
        <div class="section-header">
          <div class="section-icon summary-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
          </div>
          <h3 class="section-title">SUMMARY</h3>
        </div>
        <div class="section-content">
          <p>${g(t)}</p>
        </div>
      </div>
    `),o&&o.length>0&&(n+=`
      <div class="analysis-section">
        <div class="section-header">
          <div class="section-icon takeaways-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a4.5 4.5 0 0 0-4.5 4.5v9a4.5 4.5 0 0 0 4.5 4.5H17"></path></svg>
          </div>
          <h3 class="section-title">KEY TAKEAWAYS</h3>
        </div>
        <ul class="takeaways-list">
          ${o.map(s=>`
            <li>
              <div class="check-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
              </div>
              <span>${g(s)}</span>
            </li>
          `).join("")}
        </ul>
      </div>
    `);let a=e.chapters||r;return a&&a.length>0&&(n+=`
      <div class="analysis-section">
        <div class="section-header">
          <div class="section-icon chapters-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
          </div>
          <h3 class="section-title">VIDEO CHAPTERS</h3>
        </div>
        <ul class="chapters-list">
          ${a.map((s,c)=>{let l="";if(typeof s=="object"){let u=s.header?`<div class="chapter-heading">${g(s.header)}</div>`:"",m=s.summary?`<div class="chapter-summary">${g(s.summary)}</div>`:"",h=s.key_points&&Array.isArray(s.key_points)?`<ul class="chapter-keypoints">
                    ${s.key_points.map(N=>`<li class="chapter-keypoint">${g(N)}</li>`).join("")}
                   </ul>`:"";l=u+m+h}else if(l=g(s),l.includes(":")){let u=l.split(":");l=`<strong class="chapter-fact-label">${u[0]}:</strong>${u.slice(1).join(":")}`}return`
            <li>
              <div class="chapter-number">${c+1}</div>
              <div class="chapter-content">
                ${l}
              </div>
            </li>
          `}).join("")}
        </ul>
      </div>
    `),n+="</div>",n}function T(e,t){typeof e=="object"&&e!==null&&!Array.isArray(e)?t.innerHTML=fe(e):t.innerHTML=Ee(e)}function K(){document.querySelectorAll(".combobox[data-combobox-type]").forEach(t=>{let o=t.dataset.comboboxType,r=t.querySelector(".combobox-input"),n=t.querySelector(".combobox-arrow"),a=t.querySelector(".combobox-dropdown"),s=t.querySelector(".combobox-icon");if(!r||!n||!a||!s)return;a.innerHTML="";let c=[],l={};o==="targetLanguage"?(c=w,l={recommended:i.TARGET_LANGUAGE_RECOMMENDED,custom:i.TARGET_LANGUAGE_CUSTOM}):o==="summarizer"?(c=B,l={recommended:i.SUMMARIZER_RECOMMENDED_MODEL,custom:i.SUMMARIZER_CUSTOM_MODEL}):o==="refiner"&&(c=Y,l={recommended:i.REFINER_RECOMMENDED_MODEL,custom:i.REFINER_CUSTOM_MODEL}),c.forEach(u=>{let m=ge(u,o);a.appendChild(m)}),n.addEventListener("click",u=>{u.stopPropagation(),he(t)}),r.addEventListener("focus",()=>{t.classList.add("open"),a.classList.add("show")}),r.addEventListener("input",u=>{Se(t,u.target.value);let m=u.target.value.trim();(o==="summarizer"||o==="refiner")&&m&&P(t,m),m&&l.custom?(p(l.custom,m),l.recommended&&p(l.recommended,"")):(l.custom&&p(l.custom,""),(o==="summarizer"||o==="refiner")&&s&&(s.innerHTML=""))}),a.addEventListener("click",u=>{let m=u.target.closest(".combobox-item");if(!m)return;let h=m.dataset.value;r.value=h,o==="targetLanguage"?z(t,h):(o==="summarizer"||o==="refiner")&&P(t,h),a.querySelectorAll(".combobox-item").forEach(N=>{N.classList.remove("selected")}),m.classList.add("selected"),t.classList.remove("open"),a.classList.remove("show"),l.recommended&&p(l.recommended,h),l.custom&&p(l.custom,"")}),document.addEventListener("click",u=>{t.contains(u.target)||(t.classList.remove("open"),a.classList.remove("show"))})})}function ge(e,t){let o=document.createElement("div");o.className="combobox-item",o.dataset.value=e.value;let r=document.createElement("span");if(r.className="combobox-item-icon",t==="targetLanguage"){let a=e.label.match(/^(\p{Emoji}+)\s*(.+)$/u);a&&(r.textContent=a[1])}else if(t==="summarizer"||t==="refiner"){let a=e.value.split("/")[0],s=U(a);if(s){let c=document.createElement("img");c.src=s,c.alt=a,c.width=16,c.height=16,r.appendChild(c)}}o.appendChild(r);let n=document.createElement("span");if(n.className="combobox-item-label",t==="targetLanguage"){let a=e.label.match(/^(\p{Emoji}+)\s*(.+)$/u);a?n.textContent=a[2].trim():n.textContent=e.label}else n.textContent=e.label;return o.appendChild(n),o}function he(e){let t=e.querySelector(".combobox-dropdown"),o=e.classList.contains("open");if(document.querySelectorAll(".combobox.open").forEach(r=>{r!==e&&(r.classList.remove("open"),r.querySelector(".combobox-dropdown").classList.remove("show"))}),o)e.classList.remove("open"),t.classList.remove("show");else{e.classList.add("open"),t.classList.add("show");let r=e.querySelector(".combobox-input");r&&r.focus()}}function Se(e,t){let r=e.querySelector(".combobox-dropdown").querySelectorAll(".combobox-item"),n=t.toLowerCase().trim();r.forEach(a=>{let s=a.querySelector(".combobox-item-label").textContent.toLowerCase(),c=a.dataset.value.toLowerCase();!n||s.includes(n)||c.includes(n)?a.style.display="flex":a.style.display="none"})}function z(e,t){let o=e.querySelector(".combobox-icon");if(!o)return;let r=w.find(n=>n.value===t);if(r){let n=r.label.match(/^(\p{Emoji}+)\s*(.+)$/u);n?o.textContent=n[1]:o.textContent=""}else o.textContent=""}function P(e,t){let o=e.querySelector(".combobox-icon");if(o&&(o.innerHTML="",t)){let r=t.split("/")[0],n=U(r);if(n){let a=document.createElement("img");a.src=n,a.alt=r,a.width=16,a.height=16,o.appendChild(a)}}}function L(e,t){let o=document.querySelector(`[data-combobox-type="${e}"]`);if(!o)return;let r=o.querySelector(".combobox-input"),n=o.querySelector(".combobox-icon");if(r){r.value=t||"",e==="targetLanguage"?z(o,t):(e==="summarizer"||e==="refiner")&&P(o,t);let a=o.querySelector(".combobox-dropdown");a&&a.querySelectorAll(".combobox-item").forEach(s=>{s.classList.remove("selected"),s.dataset.value===t&&s.classList.add("selected")})}}function V(e,t){let o=x.SUMMARY[e]||x.SUMMARY.M,r=t||document.getElementById("summaryContent");r?(r.style.setProperty("--summary-font-size-base",o.base),r.style.setProperty("--summary-font-size-h2",o.h2),r.style.setProperty("--summary-font-size-h3",o.h3),E("Sidepanel: Applied summary font size:",e,o)):E("Sidepanel: summaryContent element not found for font size application")}function H(e){let t=e?.summaryContent;chrome.storage.local.get([i.CAPTION_FONT_SIZE,i.SUMMARY_FONT_SIZE],o=>{let r=o[i.CAPTION_FONT_SIZE]||d.CAPTION_FONT_SIZE,n=o[i.SUMMARY_FONT_SIZE]||d.SUMMARY_FONT_SIZE;document.querySelectorAll('.font-size-button[data-type="caption"]').forEach(a=>{a.dataset.size===r?a.classList.add("active"):a.classList.remove("active")}),document.querySelectorAll('.font-size-button[data-type="summary"]').forEach(a=>{a.dataset.size===n?a.classList.add("active"):a.classList.remove("active")}),V(n,t)}),document.querySelectorAll(".font-size-button").forEach(o=>{o.addEventListener("click",function(){let r=this.dataset.size,n=this.dataset.type;E("Sidepanel: Font size button clicked:",n,r),document.querySelectorAll(`.font-size-button[data-type="${n}"]`).forEach(s=>{s.classList.remove("active")}),this.classList.add("active");let a=n==="caption"?i.CAPTION_FONT_SIZE:i.SUMMARY_FONT_SIZE;p(a,r),n==="caption"?chrome.tabs.query({active:!0,currentWindow:!0},s=>{let c=s[0];c&&c.url&&c.url.includes("youtube.com/watch")&&chrome.tabs.sendMessage(c.id,{action:f.UPDATE_CAPTION_FONT_SIZE,fontSize:r},()=>{chrome.runtime.lastError&&E("Sidepanel: Unable to update caption font size:",chrome.runtime.lastError.message)})}):V(r,t)})})}function _(e){try{return new URL(e).searchParams.get("v")}catch(t){return console.error("Error extracting video ID:",e,t),null}}function $(e){let t=e[i.SCRAPE_CREATORS_API_KEY],o=e[i.OPENROUTER_API_KEY];return{scrapeCreatorsKey:t||null,openRouterKey:o||null,isValid:!!(t&&o),missingKeys:[!t&&"Scrape Creators API key",!o&&"OpenRouter API key"].filter(Boolean)}}var R={success:!0,totalTime:"16.1s",videoInfo:{url:"https://www.youtube.com/watch?v=P_fHJIYENdI",title:"AlphaFold - The Most Useful Thing AI Has Ever Done",thumbnail:"https://img.youtube.com/vi/P_fHJIYENdI/maxresdefault.jpg",author:"Veritasium",duration:"00:24:52",upload_date:"Feb 10, 2025",view_count:9496071,like_count:303014},transcript:"What if, all of the world's biggest problems from climate change, to curing diseases, to disposal of plastic waste, what if they all had the same solution? A solution so tiny it would be invisible. I'm inclined to believe this is possible, thanks to a recent breakthrough that solved one of the biggest problems of the last century. How to determine the structure of a protein? - It's been described to me as equivalent to Fermat's last theorem, but for biology. - Over six decades, tens of thousands[truncated for example]",analysis:{title:"The AI Revolution in Protein Folding and Beyond",summary:"The video explores the groundbreaking advancements in protein structure prediction, primarily driven by artificial intelligence. It details the historical challenges of determining protein structures, from early X-ray crystallography methods that took years to resolve a single protein, to the computational approaches that emerged. A significant portion focuses on DeepMind's AlphaFold, an AI system that dramatically accelerated protein structure prediction, achieving accuracy comparable to experimental methods. The narrative highlights the evolution of AlphaFold from its first iteration to AlphaFold 2, emphasizing the role of advanced AI algorithms, particularly the transformer architecture and the EvoFormer. The video also discusses the work of David Baker, who used generative AI to design novel proteins from scratch, opening up possibilities for new vaccines, therapies, and materials. The broader implications of these AI-driven scientific breakthroughs are explored, suggesting their potential to solve major global challenges like climate change, disease, and waste disposal by enabling rapid discovery and iteration in fields like materials science and biochemistry.",takeaways:["AI has revolutionized protein structure prediction, significantly accelerating scientific discovery in biology and related fields.","The ability to accurately predict and design protein structures has vast implications for medicine, including vaccine development, disease treatment, and the creation of new therapies.","Generative AI can design entirely new proteins with specific functions, offering solutions for challenges like venom neutralization, greenhouse gas capture, and plastic degradation.","AI-driven scientific breakthroughs, exemplified by AlphaFold and RF Diffusion, represent a 'step function change' in the pace of research, enabling discoveries previously thought impossible.","The methodologies developed for protein folding are transferable to other scientific domains, such as materials science, leading to the discovery of new stable materials."],chapters:[{header:"The Protein Folding Problem: A Historical Challenge",summary:"Proteins, fundamental to life, begin as amino acid strings that fold into complex 3D structures, which dictate their function. Determining these structures was historically a monumental challenge. Early methods, like X-ray crystallography, were time-consuming and expensive; John Kendrew's pioneering work on myoglobin took 12 years. The complexity of protein folding, with an astronomical number of possible configurations, made computational prediction seem impossible, as illustrated by Levinthal's paradox. This led to the establishment of the CASP competition in 1994 to foster computational solutions.",key_points:["Proteins are strings of amino acids that fold into specific 3D shapes, crucial for their function.","Early protein structure determination relied on X-ray crystallography, a slow and costly process.","John Kendrew spent 12 years to determine the first protein structure, myoglobin.","Levinthal's paradox highlighted the immense computational difficulty of predicting protein folding, with a short protein having an astronomical number of possible configurations.","The CASP competition was initiated in 1994 to encourage the development of computational models for protein structure prediction."]},{header:"Early Computational Approaches and Crowdsourcing",summary:"Initial computational efforts to predict protein structures, such as the Rosetta algorithm, struggled to achieve high accuracy in the CASP competition. David Baker, a key figure in this field, innovated by pooling computing power from idle computers through 'Rosetta at Home.' Recognizing the human intuition for spatial puzzles, Baker then developed 'Fold It,' a video game that allowed human players to manipulate protein structures. This crowdsourcing approach proved remarkably successful, with gamers deciphering an HIV-related enzyme structure that was later confirmed experimentally, demonstrating the potential of collective intelligence in scientific discovery.",key_points:["Early computational algorithms like Rosetta faced challenges in accurately predicting protein structures.","David Baker utilized distributed computing with 'Rosetta at Home' to increase computational power.","The 'Fold It' video game leveraged human intuition for spatial puzzles to solve protein folding problems.","Gamers successfully deciphered the structure of an HIV-related enzyme, which was confirmed by X-ray crystallography.","The success of 'Fold It' highlighted the value of crowdsourcing and human pattern recognition in scientific research."]},{header:"AlphaFold's Breakthrough: AI Revolutionizes Prediction",summary:"Demis Hassabis, inspired by his experience with Fold It, initiated DeepMind's AlphaFold project to tackle the protein folding problem using AI. AlphaFold 1, a deep neural network, used amino acid sequences and evolutionary information (co-evolution) as input to predict a 2D pair representation of the protein structure. This initial version showed promise at CASP 13 but did not meet the 90-point accuracy threshold. AlphaFold 2, under John Jumper's leadership, significantly improved accuracy by integrating advanced AI algorithms, particularly the transformer architecture (EvoFormer), and leveraging Google's immense computing power. The EvoFormer's two-tower design (biology and geometry) and iterative information exchange refined predictions, leading to a major breakthrough.",key_points:["DeepMind's AlphaFold project, led by Demis Hassabis, aimed to solve protein folding using AI.","AlphaFold 1 used deep neural networks, amino acid sequences, and evolutionary data to predict 2D protein representations.","AlphaFold 2, led by John Jumper, achieved a significant accuracy boost through advanced AI algorithms and Google's computing resources.","The EvoFormer, a transformer-based architecture, was central to AlphaFold 2's success, processing both evolutionary and geometric information.","AlphaFold 2's iterative refinement process, including triangular attention and a structure module, enabled highly accurate 3D protein predictions."]},{header:"Impact and Future of AI in Protein Science",summary:"AlphaFold 2's success at CASP 14, achieving near-perfect accuracy, marked a pivotal moment, effectively solving the long-standing protein folding problem. This breakthrough has rapidly advanced biological research, contributing to malaria vaccine development, combating antibiotic resistance, and understanding disease mechanisms. John Jumper and Demis Hassabis were awarded the Nobel Prize for their work on AlphaFold. Concurrently, David Baker's 'RF Diffusion' uses generative AI to design entirely new proteins from scratch, akin to image generation AI. This capability has led to the creation of human-compatible antibodies for snake venom neutralization and holds promise for designing proteins for vaccines, cancer therapies, autoimmune diseases, and environmental solutions like capturing greenhouse gases and breaking down plastics. The rapid iteration enabled by 'Cowboy Biochemistry' signifies a new era of accelerated scientific discovery.",key_points:["AlphaFold 2's high accuracy at CASP 14 effectively solved the protein folding problem.","The breakthrough has accelerated research in vaccine development, antibiotic resistance, and disease understanding.","John Jumper and Demis Hassabis received the Nobel Prize for AlphaFold's contributions.","David Baker's 'RF Diffusion' uses generative AI to design novel proteins with specific functions.","Designed proteins have applications in anti-venom, vaccines, cancer, autoimmune diseases, and environmental solutions.","The rapid design and testing of proteins, termed 'Cowboy Biochemistry,' signifies a new pace of scientific discovery."]},{header:"Broader Implications of AI in Scientific Discovery",summary:"The success of AI in protein science, particularly with AlphaFold and RF Diffusion, serves as a powerful indicator of its transformative potential across various scientific disciplines. AI's ability to accelerate discovery by orders of magnitude, as seen in protein folding, suggests it can unlock fundamental problems that have historically hindered human progress. For instance, DeepMind's GNoME program has already discovered millions of new crystals, including stable materials with potential applications in superconductors and batteries. This demonstrates that AI is not merely providing incremental improvements but enabling 'step function changes' in scientific understanding and technological development, opening up previously impossible opportunities for addressing global challenges.",key_points:["AI's success in protein science indicates its broad applicability across scientific fields.","AI can accelerate scientific discovery by orders of magnitude, fundamentally changing research approaches.","DeepMind's GNoME program discovered millions of new crystals, including stable materials for future technologies.","AI is enabling 'step function changes' in scientific understanding, not just incremental improvements.","The advancements open up new opportunities for solving major global challenges, such as climate change and disease."]}],keywords:["AlphaFold","protein folding","AI"],target_language:"en"},quality:{completeness:{rate:"Pass",reason:"The analysis covers all key aspects of the provided content, from historical challenges to modern AI breakthroughs and future implications."},structure:{rate:"Pass",reason:"The output perfectly adheres to the specified schema, including the correct formatting for title, summary, chapters, takeaways, and keywords. Takeaways are simple arrays as requested."},no_garbage:{rate:"Pass",reason:"No promotional or meaningless content is present in the analysis. It focuses solely on the scientific and historical aspects of protein folding and AI."},meta_language_avoidance:{rate:"Pass",reason:"The analysis successfully avoids meta-language phrases such as 'This chapter introduces' or 'This section covers', maintaining an objective, article-like tone."},useful_keywords:{rate:"Pass",reason:"The keywords 'AlphaFold', 'protein folding', and 'AI' are highly relevant and useful for highlighting the core topics of the analysis."},correct_language:{rate:"Pass",reason:"The content is entirely in English, matching the requested target language and maintaining natural fluency."}},iterationCount:1,chunksProcessed:12},We=R.videoInfo.url,Je=R.transcript,Z=R.analysis,Qe=R.quality,et=R.videoInfo;function G(e,t,o,r){return e||t?.trim()||o?.trim()||r}async function q(e=null){if(e){let r=e[i.SUMMARIZER_CUSTOM_MODEL]?.trim(),n=e[i.SUMMARIZER_RECOMMENDED_MODEL]?.trim();return r||n||d.MODEL_SUMMARIZER}let t=await S(i.SUMMARIZER_CUSTOM_MODEL),o=await S(i.SUMMARIZER_RECOMMENDED_MODEL);return G(null,t,o,d.MODEL_SUMMARIZER)}async function j(e=null){if(e){let r=e[i.REFINER_CUSTOM_MODEL]?.trim(),n=e[i.REFINER_RECOMMENDED_MODEL]?.trim();return r||n||d.MODEL_REFINER}let t=await S(i.REFINER_CUSTOM_MODEL),o=await S(i.REFINER_RECOMMENDED_MODEL);return G(null,t,o,d.MODEL_REFINER)}async function X(e=null){if(e){let r=e[i.TARGET_LANGUAGE_CUSTOM]?.trim(),n=e[i.TARGET_LANGUAGE_RECOMMENDED]?.trim();return r||n||d.TARGET_LANGUAGE_RECOMMENDED}let t=await S(i.TARGET_LANGUAGE_CUSTOM),o=await S(i.TARGET_LANGUAGE_RECOMMENDED);return G(null,t,o,d.TARGET_LANGUAGE_RECOMMENDED)}async function I(){return new Promise(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{let o=t[0];o?.url?.includes("youtube.com/watch")?e(o):e(null)})})}async function b(){let e=await I();return e?.url?_(e.url):null}function W(e){return e?{isValid:!0,error:null}:{isValid:!1,error:D.NO_VIDEO_ID}}async function v(e){if(e)try{let t=await b();if(!t){e.disabled=!0;return}let o=await C(t);e.disabled=!o||!Array.isArray(o)||o.length===0}catch(t){console.error("Error checking refined captions:",t),e.disabled=!0}}function y(e,t){e.textContent=t,e.className="status error"}function J(e,t){e.textContent=t,e.className="status"}function Q(e,t,o){let r=$(e);return r.isValid?!0:(y(t,`Please enter ${r.missingKeys[0]} in Settings`),o(),!1)}async function ee(e){let t=await I();if(!t)return y(e,"Not a YouTube video page"),null;let o=_(t.url),r=W(o);return r.isValid?{videoId:o,tabId:t.id}:(y(e,r.error),null)}function A(e,t){e.generateSummaryBtn.disabled=t,e.generateCaptionBtn.disabled=t}function ye(e){return e.generateSummaryBtn.disabled||e.generateCaptionBtn.disabled}function te(e){return ye(e)?!1:(J(e.status,""),!0)}function oe(e,t,o){J(e.status,t),A(e,!0),o&&(e.summaryContent.innerHTML=o)}function Ae(e,t){if(chrome.runtime.lastError){y(e.status,"Error: "+chrome.runtime.lastError.message),A(e,!1),e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>';return}if(t?.status==="started")e.status.textContent="Processing video transcript...";else if(t?.status==="error"){let o=t.message||"Unknown error";y(e.status,"Error: "+o),A(e,!1),o.includes("already in progress")||(e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>')}}async function re(e,t){if(!te(e))return;if(!await b()){T(Z,e.summaryContent),e.status.textContent="Not a YouTube video page. Showing example.",e.status.className="status success";return}chrome.storage.local.get([i.SCRAPE_CREATORS_API_KEY,i.OPENROUTER_API_KEY,i.SUMMARIZER_RECOMMENDED_MODEL,i.SUMMARIZER_CUSTOM_MODEL,i.TARGET_LANGUAGE_RECOMMENDED,i.TARGET_LANGUAGE_CUSTOM],async r=>{if(!Q(r,e.status,t))return;let n=e.summarizerInput?.value.trim()||await q(r),a=e.targetLanguageInput?.value.trim()||await X(r);oe(e,"Generating summary...",'<div class="summary-placeholder">Generating summary, please wait...</div>');let s=await ee(e.status);if(!s){A(e,!1);return}let{videoId:c,tabId:l}=s;chrome.tabs.sendMessage(l,{action:f.GENERATE_SUMMARY,videoId:c,scrapeCreatorsApiKey:r[i.SCRAPE_CREATORS_API_KEY],openRouterApiKey:r[i.OPENROUTER_API_KEY],modelSelection:n,targetLanguage:a},u=>Ae(e,u))})}function Te(e,t){if(chrome.runtime.lastError){y(e.status,"Error: "+chrome.runtime.lastError.message),A(e,!1);return}t?.status==="started"?e.status.textContent="Fetching and refining transcript...":t?.status==="error"&&(y(e.status,"Error: "+(t.message||"Unknown error")),A(e,!1))}async function ie(e,t){te(e)&&chrome.storage.local.get([i.SCRAPE_CREATORS_API_KEY,i.OPENROUTER_API_KEY,i.REFINER_RECOMMENDED_MODEL,i.REFINER_CUSTOM_MODEL],async o=>{if(!Q(o,e.status,t))return;let r=e.refinerInput?.value.trim()||await j(o);oe(e,"Generating refined captions...");let n=await ee(e.status);if(!n){A(e,!1);return}let{videoId:a,tabId:s}=n;chrome.tabs.sendMessage(s,{action:f.GENERATE_SUBTITLES,videoId:a,scrapeCreatorsApiKey:o[i.SCRAPE_CREATORS_API_KEY],openRouterApiKey:o[i.OPENROUTER_API_KEY],modelSelection:r,forceRegenerate:!0},c=>Te(e,c))})}async function F(e){try{let t=await I();if(!t)return;let o=_(t.url);if(!o)return;chrome.storage.local.get([`summary_${o}`],r=>{r[`summary_${o}`]&&e.summaryContent&&(E("Sidepanel: Found existing summary for video:",o),T(r[`summary_${o}`],e.summaryContent))})}catch(t){E("Sidepanel: Error loading existing summary:",t)}}function ne(e){return typeof e=="string"?e:e instanceof Error?e.message:typeof e=="object"&&e!==null?e.message?String(e.message):e.error?ne(e.error):JSON.stringify(e):String(e)}function _e(e){let t=ne(e),o=t.match(/OpenRouter API error: (.+)/);return o?o[1]:t}function k(e){let t=_e(e).toLowerCase();return t.includes("invalid model")||t.includes("not a valid model id")||t.includes("model not found")||t.includes("openrouter")}function ae(e,t){let o={},r=0;e.summarizerCustomModel?.value.trim()&&(e.summarizerCustomModel.value="",o[i.SUMMARIZER_CUSTOM_MODEL]="",r++),e.refinerCustomModel?.value.trim()&&(e.refinerCustomModel.value="",o[i.REFINER_CUSTOM_MODEL]="",r++),Object.keys(o).length>0?(chrome.storage.local.set(o,()=>{console.log("Sidepanel: Cleared invalid custom models")}),alert(`Model Error: ${t}

Invalid custom model input detected and cleared. Now using recommended models for summarizer and refiner. Please check your custom model entries if needed.`)):alert(`Model Error: ${t}

Please check your model selection in Settings and ensure it's a valid OpenRouter model ID.`)}function ve(e,t){t.status.className="status error";let o=typeof e.error=="string"?e.error:e.error?.message||JSON.stringify(e.error)||"Unknown error",r=k(e.error);r&&(t.summarizerCustomModel||t.refinerCustomModel)?ae(t,o):r?alert(`Model Error: ${o}

Please check your model selection in Settings and ensure it's a valid OpenRouter model ID.`):t.status.textContent=`Error: ${o}`}function Me(e,t){if(e.error){t.status.className="status error",t.generateSummaryBtn.disabled=!1,t.generateCaptionBtn.disabled=!1,t.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>';let o=typeof e.error=="string"?e.error:e.error?.message||JSON.stringify(e.error)||"Unknown error";k(e.error)&&(t.summarizerCustomModel||t.refinerCustomModel)?ae(t,o):t.status.textContent=e.text||`Error: ${o}`}else e.success?(t.status.className="status success",t.generateSummaryBtn.disabled=!1,t.generateCaptionBtn.disabled=!1,v(t.copyCaptionBtn)):(t.status.textContent=e.text,e.text&&(e.text.includes("ready")||e.text.includes("complete")||e.text.includes("success"))&&setTimeout(()=>{v(t.copyCaptionBtn)},M.CAPTION_CHECK_DELAY_MS))}function Re(e,t){e.summary&&(T(e.summary,t.summaryContent),t.status.textContent="Summary generated successfully!",t.status.className="status success",setTimeout(()=>{t.status.textContent="",t.status.className="status"},M.SUMMARY_SUCCESS_DISPLAY_MS)),t.generateSummaryBtn.disabled=!1,t.generateCaptionBtn.disabled=!1}function se(e){let t={[f.SHOW_ERROR]:ve,[f.UPDATE_POPUP_STATUS]:Me,[f.SUMMARY_GENERATED]:Re};chrome.runtime.onMessage.addListener(o=>{let r=t[o.action];r&&r(o,e)})}function ce(e){chrome.storage.local.get([i.SCRAPE_CREATORS_API_KEY,i.OPENROUTER_API_KEY,i.SUMMARIZER_RECOMMENDED_MODEL,i.SUMMARIZER_CUSTOM_MODEL,i.REFINER_RECOMMENDED_MODEL,i.REFINER_CUSTOM_MODEL,i.AUTO_GENERATE,i.SHOW_SUBTITLES,i.TARGET_LANGUAGE_RECOMMENDED,i.TARGET_LANGUAGE_CUSTOM],t=>{t[i.SCRAPE_CREATORS_API_KEY]&&e.scrapeApiKey&&(e.scrapeApiKey.value=t[i.SCRAPE_CREATORS_API_KEY]),t[i.OPENROUTER_API_KEY]&&e.openrouterApiKey&&(e.openrouterApiKey.value=t[i.OPENROUTER_API_KEY]),e.autoGenerateToggle&&(e.autoGenerateToggle.checked=t[i.AUTO_GENERATE]===!0);let o=t[i.SHOW_SUBTITLES]!==void 0?t[i.SHOW_SUBTITLES]:d.SHOW_SUBTITLES;e.showSubtitlesToggle&&(e.showSubtitlesToggle.checked=o===!0);let r=t[i.SUMMARIZER_CUSTOM_MODEL]?.trim(),n=t[i.SUMMARIZER_RECOMMENDED_MODEL]||d.MODEL_SUMMARIZER;L("summarizer",r||n);let s=t[i.REFINER_CUSTOM_MODEL]?.trim(),c=t[i.REFINER_RECOMMENDED_MODEL]||d.MODEL_REFINER;L("refiner",s||c);let u=t[i.TARGET_LANGUAGE_CUSTOM]?.trim(),m=t[i.TARGET_LANGUAGE_RECOMMENDED]||d.TARGET_LANGUAGE_RECOMMENDED;L("targetLanguage",u||m)})}function le(e){e.scrapeApiKey&&e.scrapeApiKey.addEventListener("input",function(){p(i.SCRAPE_CREATORS_API_KEY,this.value.trim())}),e.openrouterApiKey&&e.openrouterApiKey.addEventListener("input",function(){p(i.OPENROUTER_API_KEY,this.value.trim())}),e.autoGenerateToggle&&e.autoGenerateToggle.addEventListener("change",function(){p(i.AUTO_GENERATE,this.checked)}),e.showSubtitlesToggle&&e.showSubtitlesToggle.addEventListener("change",function(){let t=this.checked;p(i.SHOW_SUBTITLES,t),chrome.tabs.query({active:!0,currentWindow:!0},o=>{let r=o[0];r&&r.url&&r.url.includes("youtube.com/watch")&&chrome.tabs.sendMessage(r.id,{action:f.TOGGLE_SUBTITLES,showSubtitles:t,enabled:t},()=>{chrome.runtime.lastError&&E("Sidepanel: Unable to toggle subtitles:",chrome.runtime.lastError.message)})})})}function ue(){let e=document.querySelectorAll(".info-icon"),t=new Map;e.forEach(o=>{let r=o.parentElement;(!r||!r.classList.contains("info-icon-wrapper"))&&(r=document.createElement("span"),r.className="info-icon-wrapper",o.parentNode.insertBefore(r,o),r.appendChild(o));let n=document.createElement("div");n.className="info-tooltip",n.textContent=o.getAttribute("data-tooltip"),r.appendChild(n),t.set(o,{tooltip:n,hideTimeout:null}),Ie(o,t.get(o))})}function Ie(e,t){let{tooltip:o}=t;e.addEventListener("mouseenter",function(){t.hideTimeout&&(clearTimeout(t.hideTimeout),t.hideTimeout=null),o.classList.remove("hide"),o.classList.add("show")}),e.addEventListener("mouseleave",function(r){t.hideTimeout=setTimeout(()=>{o.classList.remove("show"),o.classList.add("hide"),t.hideTimeout=null},2e3)}),o.addEventListener("mouseenter",function(){t.hideTimeout&&(clearTimeout(t.hideTimeout),t.hideTimeout=null),o.classList.remove("hide"),o.classList.add("show")}),o.addEventListener("mouseleave",function(){t.hideTimeout=setTimeout(()=>{o.classList.remove("show"),o.classList.add("hide"),t.hideTimeout=null},500)})}document.addEventListener("DOMContentLoaded",function(){let e={mainView:document.getElementById("mainView"),settingsView:document.getElementById("settingsView"),settingsBtn:document.getElementById("settingsBtn"),backBtn:document.getElementById("backBtn"),generateSummaryBtn:document.getElementById("generateSummaryBtn"),generateCaptionBtn:document.getElementById("generateCaptionBtn"),copyCaptionBtn:document.getElementById("copyCaptionBtn"),summaryContent:document.getElementById("summaryContent"),status:document.getElementById("status"),scrapeApiKey:document.getElementById("scrapeApiKey"),openrouterApiKey:document.getElementById("openrouterApiKey"),summarizerInput:document.getElementById("summarizerInput"),refinerInput:document.getElementById("refinerInput"),autoGenerateToggle:document.getElementById("autoGenerateToggle"),showSubtitlesToggle:document.getElementById("showSubtitlesToggle"),targetLanguageInput:document.getElementById("targetLanguageInput")};function t(){e.mainView.classList.add("active"),e.settingsView.classList.remove("active")}function o(){e.mainView.classList.remove("active"),e.settingsView.classList.add("active")}e.settingsBtn&&e.settingsBtn.addEventListener("click",o),e.backBtn&&e.backBtn.addEventListener("click",t);async function r(){if(!e.copyCaptionBtn?.disabled)try{let a=await b();if(!a){e.status.textContent="Not a YouTube video page",e.status.className="status error";return}let s=await C(a);if(!s||!Array.isArray(s)||s.length===0){e.status.textContent="No refined captions available",e.status.className="status error";return}let c=s.map(l=>(l.text||"").replace(/\n/g," ").trim()).filter(l=>l.length>0).join(" ");await navigator.clipboard.writeText(c),e.status.textContent="Refined caption copied to clipboard!",e.status.className="status success",setTimeout(()=>{e.status.textContent="",e.status.className="status"},M.STATUS_MESSAGE_DISPLAY_MS)}catch(a){console.error("Error copying refined caption:",a),e.status.textContent="Failed to copy caption",e.status.className="status error"}}K(),ce(e),le(e),H(e),ue(),se(e),F(e),v(e.copyCaptionBtn),e.generateSummaryBtn&&e.generateSummaryBtn.addEventListener("click",()=>{re(e,o)}),e.generateCaptionBtn&&e.generateCaptionBtn.addEventListener("click",()=>{ie(e,o)}),e.copyCaptionBtn&&e.copyCaptionBtn.addEventListener("click",r);function n(){e.status&&(e.status.textContent="",e.status.className="status"),e.summaryContent&&(e.summaryContent.innerHTML='<div class="summary-placeholder">Click "Generate Summary" to create a summary for this video</div>'),v(e.copyCaptionBtn),F(e)}chrome.tabs.onActivated.addListener(n),chrome.tabs.onUpdated.addListener((a,s,c)=>{s.status==="complete"&&c.active&&n()})});})();
//# sourceMappingURL=sidepanel.bundle.js.map
