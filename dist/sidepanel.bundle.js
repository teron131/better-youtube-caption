(()=>{var n={SCRAPE_CREATORS_API_KEY:"scrapeCreatorsApiKey",OPENROUTER_API_KEY:"openRouterApiKey",SUMMARIZER_RECOMMENDED_MODEL:"summarizerRecommendedModel",SUMMARIZER_CUSTOM_MODEL:"summarizerCustomModel",REFINER_RECOMMENDED_MODEL:"refinerRecommendedModel",REFINER_CUSTOM_MODEL:"refinerCustomModel",AUTO_GENERATE:"autoGenerate",SHOW_SUBTITLES:"showSubtitles",CAPTION_FONT_SIZE:"captionFontSize",SUMMARY_FONT_SIZE:"summaryFontSize",TARGET_LANGUAGE_RECOMMENDED:"targetLanguageRecommended",TARGET_LANGUAGE_CUSTOM:"targetLanguageCustom"},R={AUTO_GENERATION_DELAY_MS:2e3,INIT_RETRY_DELAY_MS:500,SUBTITLE_UPDATE_INTERVAL_MS:100,MAX_INIT_ATTEMPTS:5,CONTENT_SCRIPT_INIT_DELAY_MS:500,STATUS_MESSAGE_DISPLAY_MS:2e3,SUMMARY_SUCCESS_DISPLAY_MS:3e3,CAPTION_CHECK_DELAY_MS:500},ue={QUOTA_BYTES:10*1024*1024,MAX_STORAGE_BYTES:9.5*1024*1024,ESTIMATED_VIDEO_SIZE_BYTES:30*1024,CLEANUP_BATCH_SIZE:10},P=[{value:"x-ai/grok-4.1-fast",label:"Grok 4.1 Fast"},{value:"x-ai/grok-4",label:"Grok 4"},{value:"google/gemini-2.5-flash",label:"Gemini 2.5 Flash"},{value:"google/gemini-3-pro-preview",label:"Gemini 3 Pro"},{value:"openai/gpt-5-mini",label:"GPT-5 Mini"},{value:"openai/gpt-5.1",label:"GPT-5.1"},{value:"anthropic/claude-haiku-4.5",label:"Claude Haiku 4.5"},{value:"anthropic/claude-sonnet-4.5",label:"Claude Sonnet 4.5"}],B=[{value:"google/gemini-2.5-flash-lite-preview-09-2025",label:"Gemini 2.5 Flash Lite"},{value:"x-ai/grok-4.1-fast",label:"Grok 4.1 Fast"}],N=[{value:"auto",label:"\u{1F310} Auto"},{value:"en",label:"\u{1F1FA}\u{1F1F8} English"},{value:"zh-TW",label:"\u{1F1ED}\u{1F1F0} Chinese"}],l={MODEL_SUMMARIZER:"x-ai/grok-4.1-fast",MODEL_REFINER:"google/gemini-2.5-flash-lite-preview-09-2025",AUTO_GENERATE:!1,SHOW_SUBTITLES:!0,CAPTION_FONT_SIZE:"M",SUMMARY_FONT_SIZE:"M",TARGET_LANGUAGE_RECOMMENDED:"auto",TARGET_LANGUAGE_CUSTOM:""},v={CAPTION:{S:{base:"1.4vw",max:"22px",min:"12px",fullscreen:"1.7vw",fullscreenMax:"28px"},M:{base:"1.8vw",max:"28px",min:"14px",fullscreen:"2.2vw",fullscreenMax:"36px"},L:{base:"2.2vw",max:"34px",min:"16px",fullscreen:"2.7vw",fullscreenMax:"44px"}},SUMMARY:{S:{base:"13px",h2:"17px",h3:"15px"},M:{base:"15px",h2:"20px",h3:"17px"},L:{base:"17px",h2:"23px",h3:"19px"}}};var p={FETCH_SUBTITLES:"fetchSubtitles",GENERATE_SUBTITLES:"generateSubtitles",GENERATE_SUMMARY:"generateSummary",SUBTITLES_GENERATED:"subtitlesGenerated",SUMMARY_GENERATED:"summaryGenerated",UPDATE_POPUP_STATUS:"updatePopupStatus",TOGGLE_SUBTITLES:"toggleSubtitles",GET_VIDEO_TITLE:"getVideoTitle",SHOW_ERROR:"showError",UPDATE_CAPTION_FONT_SIZE:"updateCaptionFontSize"};var U={CONTEXT_INVALIDATED:"Extension context invalidated",VIDEO_ID_REQUIRED:"Video ID is required.",NO_VIDEO_ID:"Could not extract video ID from URL.",NO_TRANSCRIPT:"No transcript available for this video",SCRAPE_KEY_MISSING:"Scrape Creators API key not found. Please set it in settings.",OPENROUTER_KEY_MISSING:"OpenRouter API key not found",NOT_YOUTUBE_PAGE:"Not a YouTube video page",SUMMARY_IN_PROGRESS:"Summary generation is already in progress for this video."};var le="Better YouTube Caption:",Ee=!0,f=(...e)=>{Ee&&console.log(le,...e)};function C(e){return new Promise(t=>{chrome.storage.local.get([e],o=>{t(o[e]||null)})})}function S(e){return new Promise(t=>{chrome.storage.local.get([e],o=>{t(o[e]||null)})})}function E(e,t){chrome.storage.local.set({[e]:t},()=>{chrome.runtime.lastError?console.error("Failed to save setting:",e,chrome.runtime.lastError):f("Auto-saved:",e,t)})}function x(e){return{anthropic:"images/anthropic.svg",google:"images/google.svg",openai:"images/openai.svg","x-ai":"images/xai.svg"}[e]||""}function I(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function F(e){if(!e)return"";let t=I(e);return t=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/__(.+?)__/g,"<strong>$1</strong>"),t=t.replace(/(?<!\*)\*([^*]+?)\*(?!\*)/g,"<em>$1</em>"),t=t.replace(/(?<!_)_([^_]+?)_(?!_)/g,"<em>$1</em>"),t=t.replace(/`([^`]+)`/g,"<code>$1</code>"),t}function me(e){if(!e||typeof e!="string")return'<div class="summary-placeholder">No summary available</div>';let t=e.split(`
`),o=[],r=!1,a=!1;for(let i=0;i<t.length;i++){let s=t[i].trim();if(!s){r&&(o.push("</ul>"),r=!1),a&&(o.push("</p>"),a=!1);continue}if(s.match(/^###\s+(.+)$/)){r&&(o.push("</ul>"),r=!1),a&&(o.push("</p>"),a=!1);let c=s.replace(/^###\s+/,"");o.push(`<h3>${I(c)}</h3>`)}else if(s.match(/^##\s+(.+)$/)){r&&(o.push("</ul>"),r=!1),a&&(o.push("</p>"),a=!1);let c=s.replace(/^##\s+/,"");o.push(`<h2>${I(c)}</h2>`)}else if(s.match(/^#\s+(.+)$/)){r&&(o.push("</ul>"),r=!1),a&&(o.push("</p>"),a=!1);let c=s.replace(/^#\s+/,"");o.push(`<h2>${I(c)}</h2>`)}else if(s.match(/^[\*\-•]\s+(.+)$/)){a&&(o.push("</p>"),a=!1),r||(o.push("<ul>"),r=!0);let c=s.replace(/^[\*\-•]\s+/,"");o.push(`<li>${F(c)}</li>`)}else r&&(o.push("</ul>"),r=!1),a?o.push("<br>"):(o.push("<p>"),a=!0),o.push(F(s))}return r&&o.push("</ul>"),a&&o.push("</p>"),o.join("")}function h(e,t){t.innerHTML=me(e)}function K(){document.querySelectorAll(".combobox[data-combobox-type]").forEach(t=>{let o=t.dataset.comboboxType,r=t.querySelector(".combobox-input"),a=t.querySelector(".combobox-arrow"),i=t.querySelector(".combobox-dropdown"),s=t.querySelector(".combobox-icon");if(!r||!a||!i||!s)return;i.innerHTML="";let c=[],u={};o==="targetLanguage"?(c=N,u={recommended:n.TARGET_LANGUAGE_RECOMMENDED,custom:n.TARGET_LANGUAGE_CUSTOM}):o==="summarizer"?(c=P,u={recommended:n.SUMMARIZER_RECOMMENDED_MODEL,custom:n.SUMMARIZER_CUSTOM_MODEL}):o==="refiner"&&(c=B,u={recommended:n.REFINER_RECOMMENDED_MODEL,custom:n.REFINER_CUSTOM_MODEL}),c.forEach(m=>{let d=de(m,o);i.appendChild(d)}),a.addEventListener("click",m=>{m.stopPropagation(),pe(t)}),r.addEventListener("focus",()=>{t.classList.add("open"),i.classList.add("show")}),r.addEventListener("input",m=>{fe(t,m.target.value);let d=m.target.value.trim();(o==="summarizer"||o==="refiner")&&d&&b(t,d),d&&u.custom?(E(u.custom,d),u.recommended&&E(u.recommended,"")):(u.custom&&E(u.custom,""),(o==="summarizer"||o==="refiner")&&s&&(s.innerHTML=""))}),i.addEventListener("click",m=>{let d=m.target.closest(".combobox-item");if(!d)return;let M=d.dataset.value;r.value=M,o==="targetLanguage"?Y(t,M):(o==="summarizer"||o==="refiner")&&b(t,M),i.querySelectorAll(".combobox-item").forEach(ce=>{ce.classList.remove("selected")}),d.classList.add("selected"),t.classList.remove("open"),i.classList.remove("show"),u.recommended&&E(u.recommended,M),u.custom&&E(u.custom,"")}),document.addEventListener("click",m=>{t.contains(m.target)||(t.classList.remove("open"),i.classList.remove("show"))})})}function de(e,t){let o=document.createElement("div");o.className="combobox-item",o.dataset.value=e.value;let r=document.createElement("span");if(r.className="combobox-item-icon",t==="targetLanguage"){let i=e.label.match(/^(\p{Emoji}+)\s*(.+)$/u);i&&(r.textContent=i[1])}else if(t==="summarizer"||t==="refiner"){let i=e.value.split("/")[0],s=x(i);if(s){let c=document.createElement("img");c.src=s,c.alt=i,c.width=16,c.height=16,r.appendChild(c)}}o.appendChild(r);let a=document.createElement("span");if(a.className="combobox-item-label",t==="targetLanguage"){let i=e.label.match(/^(\p{Emoji}+)\s*(.+)$/u);i?a.textContent=i[2].trim():a.textContent=e.label}else a.textContent=e.label;return o.appendChild(a),o}function pe(e){let t=e.querySelector(".combobox-dropdown"),o=e.classList.contains("open");if(document.querySelectorAll(".combobox.open").forEach(r=>{r!==e&&(r.classList.remove("open"),r.querySelector(".combobox-dropdown").classList.remove("show"))}),o)e.classList.remove("open"),t.classList.remove("show");else{e.classList.add("open"),t.classList.add("show");let r=e.querySelector(".combobox-input");r&&r.focus()}}function fe(e,t){let r=e.querySelector(".combobox-dropdown").querySelectorAll(".combobox-item"),a=t.toLowerCase().trim();r.forEach(i=>{let s=i.querySelector(".combobox-item-label").textContent.toLowerCase(),c=i.dataset.value.toLowerCase();!a||s.includes(a)||c.includes(a)?i.style.display="flex":i.style.display="none"})}function Y(e,t){let o=e.querySelector(".combobox-icon");if(!o)return;let r=N.find(a=>a.value===t);if(r){let a=r.label.match(/^(\p{Emoji}+)\s*(.+)$/u);a?o.textContent=a[1]:o.textContent=""}else o.textContent=""}function b(e,t){let o=e.querySelector(".combobox-icon");if(o&&(o.innerHTML="",t)){let r=t.split("/")[0],a=x(r);if(a){let i=document.createElement("img");i.src=a,i.alt=r,i.width=16,i.height=16,o.appendChild(i)}}}function y(e,t){let o=document.querySelector(`[data-combobox-type="${e}"]`);if(!o)return;let r=o.querySelector(".combobox-input"),a=o.querySelector(".combobox-icon");if(r){r.value=t||"",e==="targetLanguage"?Y(o,t):(e==="summarizer"||e==="refiner")&&b(o,t);let i=o.querySelector(".combobox-dropdown");i&&i.querySelectorAll(".combobox-item").forEach(s=>{s.classList.remove("selected"),s.dataset.value===t&&s.classList.add("selected")})}}function V(e){let t=v.SUMMARY[e]||v.SUMMARY.M,o=document.getElementById("summaryContent");o&&(o.style.setProperty("--summary-font-size-base",t.base),o.style.setProperty("--summary-font-size-h2",t.h2),o.style.setProperty("--summary-font-size-h3",t.h3))}function z(){chrome.storage.local.get([n.CAPTION_FONT_SIZE,n.SUMMARY_FONT_SIZE],e=>{let t=e[n.CAPTION_FONT_SIZE]||l.CAPTION_FONT_SIZE,o=e[n.SUMMARY_FONT_SIZE]||l.SUMMARY_FONT_SIZE;document.querySelectorAll('.font-size-button[data-type="caption"]').forEach(r=>{r.dataset.size===t?r.classList.add("active"):r.classList.remove("active")}),document.querySelectorAll('.font-size-button[data-type="summary"]').forEach(r=>{r.dataset.size===o?r.classList.add("active"):r.classList.remove("active")}),V(o)}),document.querySelectorAll(".font-size-button").forEach(e=>{e.addEventListener("click",function(){let t=this.dataset.size,o=this.dataset.type;document.querySelectorAll(`.font-size-button[data-type="${o}"]`).forEach(a=>{a.classList.remove("active")}),this.classList.add("active");let r=o==="caption"?n.CAPTION_FONT_SIZE:n.SUMMARY_FONT_SIZE;E(r,t),o==="caption"?chrome.tabs.query({active:!0,currentWindow:!0},a=>{let i=a[0];i&&i.url&&i.url.includes("youtube.com/watch")&&chrome.tabs.sendMessage(i.id,{action:p.UPDATE_CAPTION_FONT_SIZE,fontSize:t},()=>{chrome.runtime.lastError&&f("Sidepanel: Unable to update caption font size:",chrome.runtime.lastError.message)})}):V(t)})})}function T(e){try{return new URL(e).searchParams.get("v")}catch(t){return console.error("Error extracting video ID:",e,t),null}}function Z(e){let t=e[n.SCRAPE_CREATORS_API_KEY],o=e[n.OPENROUTER_API_KEY];return{scrapeCreatorsKey:t||null,openRouterKey:o||null,isValid:!!(t&&o),missingKeys:[!t&&"Scrape Creators API key",!o&&"OpenRouter API key"].filter(Boolean)}}function D(e,t,o,r){return e||t?.trim()||o?.trim()||r}async function k(e=null){if(e){let r=e[n.SUMMARIZER_CUSTOM_MODEL]?.trim(),a=e[n.SUMMARIZER_RECOMMENDED_MODEL]?.trim();return r||a||l.MODEL_SUMMARIZER}let t=await S(n.SUMMARIZER_CUSTOM_MODEL),o=await S(n.SUMMARIZER_RECOMMENDED_MODEL);return D(null,t,o,l.MODEL_SUMMARIZER)}async function $(e=null){if(e){let r=e[n.REFINER_CUSTOM_MODEL]?.trim(),a=e[n.REFINER_RECOMMENDED_MODEL]?.trim();return r||a||l.MODEL_REFINER}let t=await S(n.REFINER_CUSTOM_MODEL),o=await S(n.REFINER_RECOMMENDED_MODEL);return D(null,t,o,l.MODEL_REFINER)}async function H(e=null){if(e){let r=e[n.TARGET_LANGUAGE_CUSTOM]?.trim(),a=e[n.TARGET_LANGUAGE_RECOMMENDED]?.trim();return r||a||l.TARGET_LANGUAGE_RECOMMENDED}let t=await S(n.TARGET_LANGUAGE_CUSTOM),o=await S(n.TARGET_LANGUAGE_RECOMMENDED);return D(null,t,o,l.TARGET_LANGUAGE_RECOMMENDED)}async function O(){return new Promise(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{let o=t[0];o?.url?.includes("youtube.com/watch")?e(o):e(null)})})}async function L(){let e=await O();return e?.url?T(e.url):null}function q(e){return e?{isValid:!0,error:null}:{isValid:!1,error:U.NO_VIDEO_ID}}async function A(e){if(e)try{let t=await L();if(!t){e.disabled=!0;return}let o=await C(t);e.disabled=!o||!Array.isArray(o)||o.length===0}catch(t){console.error("Error checking refined captions:",t),e.disabled=!0}}function g(e,t){e.textContent=t,e.className="status error"}function W(e,t){e.textContent=t,e.className="status"}function j(e,t,o){let r=Z(e);return r.isValid?!0:(g(t,`Please enter ${r.missingKeys[0]} in Settings`),o(),!1)}async function X(e){let t=await O();if(!t)return g(e,"Not a YouTube video page"),null;let o=T(t.url),r=q(o);return r.isValid?{videoId:o,tabId:t.id}:(g(e,r.error),null)}function _(e,t){e.generateSummaryBtn.disabled=t,e.generateCaptionBtn.disabled=t}function Se(e){return e.generateSummaryBtn.disabled||e.generateCaptionBtn.disabled}function Q(e){return Se(e)?!1:(W(e.status,""),!0)}function J(e,t,o){W(e.status,t),_(e,!0),o&&(e.summaryContent.innerHTML=o)}function ge(e,t){if(chrome.runtime.lastError){g(e.status,"Error: "+chrome.runtime.lastError.message),_(e,!1),e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>';return}if(t?.status==="started")e.status.textContent="Processing video transcript...";else if(t?.status==="error"){let o=t.message||"Unknown error";g(e.status,"Error: "+o),_(e,!1),o.includes("already in progress")||(e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>')}}async function ee(e,t){Q(e)&&chrome.storage.local.get([n.SCRAPE_CREATORS_API_KEY,n.OPENROUTER_API_KEY,n.SUMMARIZER_RECOMMENDED_MODEL,n.SUMMARIZER_CUSTOM_MODEL,n.TARGET_LANGUAGE_RECOMMENDED,n.TARGET_LANGUAGE_CUSTOM],async o=>{if(!j(o,e.status,t))return;let r=e.summarizerInput?.value.trim()||await k(o),a=e.targetLanguageInput?.value.trim()||await H(o);J(e,"Generating summary...",'<div class="summary-placeholder">Generating summary, please wait...</div>');let i=await X(e.status);if(!i){_(e,!1);return}let{videoId:s,tabId:c}=i;chrome.tabs.sendMessage(c,{action:p.GENERATE_SUMMARY,videoId:s,scrapeCreatorsApiKey:o[n.SCRAPE_CREATORS_API_KEY],openRouterApiKey:o[n.OPENROUTER_API_KEY],modelSelection:r,targetLanguage:a},u=>ge(e,u))})}function _e(e,t){if(chrome.runtime.lastError){g(e.status,"Error: "+chrome.runtime.lastError.message),_(e,!1);return}t?.status==="started"?e.status.textContent="Fetching and refining transcript...":t?.status==="error"&&(g(e.status,"Error: "+(t.message||"Unknown error")),_(e,!1))}async function te(e,t){Q(e)&&chrome.storage.local.get([n.SCRAPE_CREATORS_API_KEY,n.OPENROUTER_API_KEY,n.REFINER_RECOMMENDED_MODEL,n.REFINER_CUSTOM_MODEL],async o=>{if(!j(o,e.status,t))return;let r=e.refinerInput?.value.trim()||await $(o);J(e,"Generating refined captions...");let a=await X(e.status);if(!a){_(e,!1);return}let{videoId:i,tabId:s}=a;chrome.tabs.sendMessage(s,{action:p.GENERATE_SUBTITLES,videoId:i,scrapeCreatorsApiKey:o[n.SCRAPE_CREATORS_API_KEY],openRouterApiKey:o[n.OPENROUTER_API_KEY],modelSelection:r,forceRegenerate:!0},c=>_e(e,c))})}async function G(e){try{let t=await O();if(!t)return;let o=T(t.url);if(!o)return;chrome.storage.local.get([`summary_${o}`],r=>{r[`summary_${o}`]&&e.summaryContent&&(f("Sidepanel: Found existing summary for video:",o),h(r[`summary_${o}`],e.summaryContent))})}catch(t){f("Sidepanel: Error loading existing summary:",t)}}function oe(e){return typeof e=="string"?e:e instanceof Error?e.message:typeof e=="object"&&e!==null?e.message?String(e.message):e.error?oe(e.error):JSON.stringify(e):String(e)}function Te(e){let t=oe(e),o=t.match(/OpenRouter API error: (.+)/);return o?o[1]:t}function w(e){let t=Te(e).toLowerCase();return t.includes("invalid model")||t.includes("not a valid model id")||t.includes("model not found")||t.includes("openrouter")}function re(e,t){let o={},r=0;e.summarizerCustomModel?.value.trim()&&(e.summarizerCustomModel.value="",o[n.SUMMARIZER_CUSTOM_MODEL]="",r++),e.refinerCustomModel?.value.trim()&&(e.refinerCustomModel.value="",o[n.REFINER_CUSTOM_MODEL]="",r++),Object.keys(o).length>0?(chrome.storage.local.set(o,()=>{console.log("Sidepanel: Cleared invalid custom models")}),alert(`Model Error: ${t}

Invalid custom model input detected and cleared. Now using recommended models for summarizer and refiner. Please check your custom model entries if needed.`)):alert(`Model Error: ${t}

Please check your model selection in Settings and ensure it's a valid OpenRouter model ID.`)}function Ae(e,t){t.status.className="status error";let o=typeof e.error=="string"?e.error:e.error?.message||JSON.stringify(e.error)||"Unknown error",r=w(e.error);r&&(t.summarizerCustomModel||t.refinerCustomModel)?re(t,o):r?alert(`Model Error: ${o}

Please check your model selection in Settings and ensure it's a valid OpenRouter model ID.`):t.status.textContent=`Error: ${o}`}function Me(e,t){if(e.error){t.status.className="status error",t.generateSummaryBtn.disabled=!1,t.generateCaptionBtn.disabled=!1,t.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>';let o=typeof e.error=="string"?e.error:e.error?.message||JSON.stringify(e.error)||"Unknown error";w(e.error)&&(t.summarizerCustomModel||t.refinerCustomModel)?re(t,o):t.status.textContent=e.text||`Error: ${o}`}else e.success?(t.status.className="status success",t.generateSummaryBtn.disabled=!1,t.generateCaptionBtn.disabled=!1,A(t.copyCaptionBtn)):(t.status.textContent=e.text,e.text&&(e.text.includes("ready")||e.text.includes("complete")||e.text.includes("success"))&&setTimeout(()=>{A(t.copyCaptionBtn)},R.CAPTION_CHECK_DELAY_MS))}function Re(e,t){e.summary&&(h(e.summary,t.summaryContent),t.status.textContent="Summary generated successfully!",t.status.className="status success",setTimeout(()=>{t.status.textContent="",t.status.className="status"},R.SUMMARY_SUCCESS_DISPLAY_MS)),t.generateSummaryBtn.disabled=!1,t.generateCaptionBtn.disabled=!1}function ne(e){let t={[p.SHOW_ERROR]:Ae,[p.UPDATE_POPUP_STATUS]:Me,[p.SUMMARY_GENERATED]:Re};chrome.runtime.onMessage.addListener(o=>{let r=t[o.action];r&&r(o,e)})}function ae(e){chrome.storage.local.get([n.SCRAPE_CREATORS_API_KEY,n.OPENROUTER_API_KEY,n.SUMMARIZER_RECOMMENDED_MODEL,n.SUMMARIZER_CUSTOM_MODEL,n.REFINER_RECOMMENDED_MODEL,n.REFINER_CUSTOM_MODEL,n.AUTO_GENERATE,n.SHOW_SUBTITLES,n.TARGET_LANGUAGE_RECOMMENDED,n.TARGET_LANGUAGE_CUSTOM],t=>{t[n.SCRAPE_CREATORS_API_KEY]&&e.scrapeApiKey&&(e.scrapeApiKey.value=t[n.SCRAPE_CREATORS_API_KEY]),t[n.OPENROUTER_API_KEY]&&e.openrouterApiKey&&(e.openrouterApiKey.value=t[n.OPENROUTER_API_KEY]),e.autoGenerateToggle&&(e.autoGenerateToggle.checked=t[n.AUTO_GENERATE]===!0);let o=t[n.SHOW_SUBTITLES]!==void 0?t[n.SHOW_SUBTITLES]:l.SHOW_SUBTITLES;e.showSubtitlesToggle&&(e.showSubtitlesToggle.checked=o===!0);let r=t[n.SUMMARIZER_CUSTOM_MODEL]?.trim(),a=t[n.SUMMARIZER_RECOMMENDED_MODEL]||l.MODEL_SUMMARIZER;y("summarizer",r||a);let s=t[n.REFINER_CUSTOM_MODEL]?.trim(),c=t[n.REFINER_RECOMMENDED_MODEL]||l.MODEL_REFINER;y("refiner",s||c);let m=t[n.TARGET_LANGUAGE_CUSTOM]?.trim(),d=t[n.TARGET_LANGUAGE_RECOMMENDED]||l.TARGET_LANGUAGE_RECOMMENDED;y("targetLanguage",m||d)})}function ie(e){e.scrapeApiKey&&e.scrapeApiKey.addEventListener("input",function(){E(n.SCRAPE_CREATORS_API_KEY,this.value.trim())}),e.openrouterApiKey&&e.openrouterApiKey.addEventListener("input",function(){E(n.OPENROUTER_API_KEY,this.value.trim())}),e.autoGenerateToggle&&e.autoGenerateToggle.addEventListener("change",function(){E(n.AUTO_GENERATE,this.checked)}),e.showSubtitlesToggle&&e.showSubtitlesToggle.addEventListener("change",function(){let t=this.checked;E(n.SHOW_SUBTITLES,t),chrome.tabs.query({active:!0,currentWindow:!0},o=>{let r=o[0];r&&r.url&&r.url.includes("youtube.com/watch")&&chrome.tabs.sendMessage(r.id,{action:p.TOGGLE_SUBTITLES,showSubtitles:t,enabled:t},()=>{chrome.runtime.lastError&&f("Sidepanel: Unable to toggle subtitles:",chrome.runtime.lastError.message)})})})}function se(){let e=document.querySelectorAll(".info-icon"),t=new Map;e.forEach(o=>{let r=o.parentElement;(!r||!r.classList.contains("info-icon-wrapper"))&&(r=document.createElement("span"),r.className="info-icon-wrapper",o.parentNode.insertBefore(r,o),r.appendChild(o));let a=document.createElement("div");a.className="info-tooltip",a.textContent=o.getAttribute("data-tooltip"),r.appendChild(a),t.set(o,{tooltip:a,hideTimeout:null}),Oe(o,t.get(o))})}function Oe(e,t){let{tooltip:o}=t;e.addEventListener("mouseenter",function(){t.hideTimeout&&(clearTimeout(t.hideTimeout),t.hideTimeout=null),o.classList.remove("hide"),o.classList.add("show")}),e.addEventListener("mouseleave",function(r){t.hideTimeout=setTimeout(()=>{o.classList.remove("show"),o.classList.add("hide"),t.hideTimeout=null},2e3)}),o.addEventListener("mouseenter",function(){t.hideTimeout&&(clearTimeout(t.hideTimeout),t.hideTimeout=null),o.classList.remove("hide"),o.classList.add("show")}),o.addEventListener("mouseleave",function(){t.hideTimeout=setTimeout(()=>{o.classList.remove("show"),o.classList.add("hide"),t.hideTimeout=null},500)})}document.addEventListener("DOMContentLoaded",function(){let e={mainView:document.getElementById("mainView"),settingsView:document.getElementById("settingsView"),settingsBtn:document.getElementById("settingsBtn"),backBtn:document.getElementById("backBtn"),generateSummaryBtn:document.getElementById("generateSummaryBtn"),generateCaptionBtn:document.getElementById("generateCaptionBtn"),copyCaptionBtn:document.getElementById("copyCaptionBtn"),summaryContent:document.getElementById("summaryContent"),status:document.getElementById("status"),scrapeApiKey:document.getElementById("scrapeApiKey"),openrouterApiKey:document.getElementById("openrouterApiKey"),summarizerInput:document.getElementById("summarizerInput"),refinerInput:document.getElementById("refinerInput"),autoGenerateToggle:document.getElementById("autoGenerateToggle"),showSubtitlesToggle:document.getElementById("showSubtitlesToggle"),targetLanguageInput:document.getElementById("targetLanguageInput")};function t(){e.mainView.classList.add("active"),e.settingsView.classList.remove("active")}function o(){e.mainView.classList.remove("active"),e.settingsView.classList.add("active")}e.settingsBtn&&e.settingsBtn.addEventListener("click",o),e.backBtn&&e.backBtn.addEventListener("click",t);async function r(){if(!e.copyCaptionBtn?.disabled)try{let i=await L();if(!i){e.status.textContent="Not a YouTube video page",e.status.className="status error";return}let s=await C(i);if(!s||!Array.isArray(s)||s.length===0){e.status.textContent="No refined captions available",e.status.className="status error";return}let c=s.map(u=>(u.text||"").replace(/\n/g," ").trim()).filter(u=>u.length>0).join(" ");await navigator.clipboard.writeText(c),e.status.textContent="Refined caption copied to clipboard!",e.status.className="status success",setTimeout(()=>{e.status.textContent="",e.status.className="status"},R.STATUS_MESSAGE_DISPLAY_MS)}catch(i){console.error("Error copying refined caption:",i),e.status.textContent="Failed to copy caption",e.status.className="status error"}}K(),ae(e),ie(e),z(e),se(),ne(e),G(e),A(e.copyCaptionBtn),e.generateSummaryBtn&&e.generateSummaryBtn.addEventListener("click",()=>{ee(e,o)}),e.generateCaptionBtn&&e.generateCaptionBtn.addEventListener("click",()=>{te(e,o)}),e.copyCaptionBtn&&e.copyCaptionBtn.addEventListener("click",r);function a(){e.status&&(e.status.textContent="",e.status.className="status"),e.summaryContent&&(e.summaryContent.innerHTML='<div class="summary-placeholder">Click "Generate Summary" to create a summary for this video</div>'),A(e.copyCaptionBtn),G(e)}chrome.tabs.onActivated.addListener(a),chrome.tabs.onUpdated.addListener((i,s,c)=>{s.status==="complete"&&c.active&&a()})});})();
//# sourceMappingURL=sidepanel.bundle.js.map
