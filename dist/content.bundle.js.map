{
  "version": 3,
  "sources": ["../src/constants.js", "../src/url.js", "../src/utils/logger.js", "../src/content.js"],
  "sourcesContent": ["// Constants for Better YouTube Caption Extension\n\n// Storage keys\nexport const STORAGE_KEYS = {\n  SCRAPE_CREATORS_API_KEY: \"scrapeCreatorsApiKey\",\n  OPENROUTER_API_KEY: \"openRouterApiKey\",\n  SUMMARIZER_RECOMMENDED_MODEL: \"summarizerRecommendedModel\",\n  SUMMARIZER_CUSTOM_MODEL: \"summarizerCustomModel\",\n  REFINER_RECOMMENDED_MODEL: \"refinerRecommendedModel\",\n  REFINER_CUSTOM_MODEL: \"refinerCustomModel\",\n  AUTO_GENERATE: \"autoGenerate\",\n  SHOW_SUBTITLES: \"showSubtitles\",\n  CAPTION_FONT_SIZE: \"captionFontSize\",\n  SUMMARY_FONT_SIZE: \"summaryFontSize\",\n  TARGET_LANGUAGE_RECOMMENDED: \"targetLanguageRecommended\",\n  TARGET_LANGUAGE_CUSTOM: \"targetLanguageCustom\",\n};\n\n// Timing constants\nexport const TIMING = {\n  AUTO_GENERATION_DELAY_MS: 2000, // 2 seconds delay before auto-generation\n  INIT_RETRY_DELAY_MS: 500, // Delay between initialization retries\n  SUBTITLE_UPDATE_INTERVAL_MS: 100, // How often to update subtitle display\n  MAX_INIT_ATTEMPTS: 5, // Maximum retry attempts for finding video elements\n};\n\n// Storage constants\nexport const STORAGE = {\n  QUOTA_BYTES: 10 * 1024 * 1024, // 10MB Chrome storage limit\n  MAX_STORAGE_BYTES: 9.5 * 1024 * 1024, // 9.5MB - leave 0.5MB buffer\n  ESTIMATED_VIDEO_SIZE_BYTES: 30 * 1024, // Estimated ~30KB per video transcript\n  CLEANUP_BATCH_SIZE: 10, // Number of videos to remove during cleanup\n};\n\n// New separate lists for summarizer and refiner\nexport const RECOMMENDED_SUMMARIZER_MODELS = [\n  { value: \"x-ai/grok-4.1-fast\", label: \"Grok 4.1 Fast\" },\n  { value: \"x-ai/grok-4\", label: \"Grok 4\" },\n  { value: \"google/gemini-2.5-flash\", label: \"Gemini 2.5 Flash\" },\n  { value: \"google/gemini-3-pro-preview\", label: \"Gemini 3 Pro\" },\n  { value: \"openai/gpt-5-mini\", label: \"GPT-5 Mini\" },\n  { value: \"openai/gpt-5.1\", label: \"GPT-5.1\" },\n  { value: \"anthropic/claude-haiku-4.5\", label: \"Claude Haiku 4.5\" },\n  { value: \"anthropic/claude-sonnet-4.5\", label: \"Claude Sonnet 4.5\" },\n];\n\nexport const RECOMMENDED_REFINER_MODELS = [\n  { value: \"google/gemini-2.5-flash-lite-preview-09-2025\", label: \"Gemini 2.5 Flash Lite\" },\n  { value: \"x-ai/grok-4.1-fast\", label: \"Grok 4.1 Fast\" },\n];\n\n// Target language options for summarization\nexport const TARGET_LANGUAGES = [\n  { value: \"auto\", label: \"\uD83C\uDF10 Auto\" },\n  { value: \"en\", label: \"\uD83C\uDDFA\uD83C\uDDF8 English\" },\n  { value: \"zh-TW\", label: \"\uD83C\uDDED\uD83C\uDDF0 Chinese\" },\n];\n\n// Default values\nexport const DEFAULTS = {\n  MODEL_SUMMARIZER: \"x-ai/grok-4.1-fast\",\n  MODEL_REFINER: \"google/gemini-2.5-flash-lite-preview-09-2025\",\n  AUTO_GENERATE: false,\n  SHOW_SUBTITLES: true, // Subtitles shown by default\n  CAPTION_FONT_SIZE: \"M\", // Medium\n  SUMMARY_FONT_SIZE: \"M\", // Medium\n  TARGET_LANGUAGE_RECOMMENDED: \"auto\", // Auto-detect language\n  TARGET_LANGUAGE_CUSTOM: \"\", // Custom language code\n};\n\n// Font size mappings\nexport const FONT_SIZES = {\n  CAPTION: {\n    S: { base: \"1.4vw\", max: \"22px\", min: \"12px\", fullscreen: \"1.7vw\", fullscreenMax: \"28px\" },\n    M: { base: \"1.8vw\", max: \"28px\", min: \"14px\", fullscreen: \"2.2vw\", fullscreenMax: \"36px\" },\n    L: { base: \"2.2vw\", max: \"34px\", min: \"16px\", fullscreen: \"2.7vw\", fullscreenMax: \"44px\" },\n  },\n  SUMMARY: {\n    S: { base: \"13px\", h2: \"17px\", h3: \"15px\" },\n    M: { base: \"15px\", h2: \"20px\", h3: \"17px\" },\n    L: { base: \"17px\", h2: \"23px\", h3: \"19px\" },\n  },\n};\n\n// API endpoints\nexport const API_ENDPOINTS = {\n  SCRAPE_CREATORS: \"https://api.scrapecreators.com/v1/youtube/video\",\n  OPENROUTER: \"https://openrouter.ai/api/v1/chat/completions\",\n};\n\n// YouTube-specific constants\nexport const YOUTUBE = {\n  VIDEO_ID_LENGTH: 11, // Standard YouTube video ID length\n  SELECTORS: {\n    VIDEO_PLAYER: \"video.html5-main-video\",\n    MOVIE_PLAYER: \"#movie_player\",\n    VIDEO_CONTAINER: \".html5-video-container\",\n  },\n};\n\n// Message actions\nexport const MESSAGE_ACTIONS = {\n  FETCH_SUBTITLES: \"fetchSubtitles\",\n  GENERATE_SUBTITLES: \"generateSubtitles\",\n  GENERATE_SUMMARY: \"generateSummary\",\n  SUBTITLES_GENERATED: \"subtitlesGenerated\",\n  SUMMARY_GENERATED: \"summaryGenerated\",\n  UPDATE_POPUP_STATUS: \"updatePopupStatus\",\n  TOGGLE_SUBTITLES: \"toggleSubtitles\",\n  GET_VIDEO_TITLE: \"getVideoTitle\",\n  SHOW_ERROR: \"showError\",\n  UPDATE_CAPTION_FONT_SIZE: \"updateCaptionFontSize\",\n};\n\n// Element IDs\nexport const ELEMENT_IDS = {\n  SUBTITLE_CONTAINER: \"youtube-gemini-subtitles-container\",\n  SUBTITLE_TEXT: \"youtube-gemini-subtitles-text\",\n};\n", "/**\n * URL Utility Functions\n */\n\n/**\n * Clean YouTube URL to extract only video ID and essential parameters\n */\nexport function cleanYouTubeUrl(originalUrl) {\n  try {\n    const url = new URL(originalUrl);\n    const videoId = url.searchParams.get(\"v\");\n    if (videoId) {\n      return `${url.protocol}//${url.hostname}${url.pathname}?v=${videoId}`;\n    }\n  } catch (e) {\n    console.error(\"Error parsing URL:\", originalUrl, e);\n  }\n  return originalUrl;\n}\n\n/**\n * Extract video ID from YouTube URL\n */\nexport function extractVideoId(url) {\n  try {\n    const urlObj = new URL(url);\n    return urlObj.searchParams.get(\"v\");\n  } catch (e) {\n    console.error(\"Error extracting video ID:\", url, e);\n    return null;\n  }\n}\n", "/**\n * Lightweight logger shared by content/popup/background.\n * Prefixes logs and can be toggled via DEBUG flag.\n */\n\nconst PREFIX = 'Better YouTube Caption:';\nlet DEBUG = true;\n\nexport const log = (...args) => {\n  if (!DEBUG) return;\n  console.log(PREFIX, ...args);\n};\n\nexport const info = (...args) => {\n  if (!DEBUG) return;\n  console.info(PREFIX, ...args);\n};\n\nexport const warn = (...args) => {\n  if (!DEBUG) return;\n  console.warn(PREFIX, ...args);\n};\n\nexport const error = (...args) => {\n  console.error(PREFIX, ...args);\n};\n\nexport const setDebug = (enabled) => {\n  DEBUG = !!enabled;\n};\n\nexport const getDebugEnabled = () => DEBUG;\n\nconst logger = { log, info, warn, error, setDebug, get debugEnabled() { return DEBUG; } };\nexport default logger;\n", "/**\n * Content Script for Better YouTube Caption Extension\n * Handles subtitle display, auto-generation, and communication with background script\n */\n\nimport {\n  DEFAULTS,\n  ELEMENT_IDS,\n  FONT_SIZES,\n  MESSAGE_ACTIONS,\n  STORAGE_KEYS,\n  TIMING,\n  YOUTUBE,\n} from \"./constants.js\";\nimport { extractVideoId } from \"./url.js\";\nimport { log as debugLog, error as logError, warn as logWarn } from \"./utils/logger.js\";\n\n// Global state\nlet currentSubtitles = [];\nlet subtitleContainer = null;\nlet subtitleText = null;\nlet videoPlayer = null;\nlet videoContainer = null;\nlet checkInterval = null;\nlet initAttempts = 0;\nlet currentUrl = window.location.href;\nlet autoGenerationTriggered = new Set(); // Track which videos have had auto-generation triggered\nlet showSubtitlesEnabled = true; // Whether subtitles should be displayed\nlet urlMonitorInterval = null; // Polling-based URL monitor as fallback for SPA navigation\nlet urlObserver = null; // MutationObserver for URL changes\n\n/**\n * Check if extension context is valid\n * @returns {boolean} True if context is valid\n */\nfunction isExtensionContextValid() {\n  return (\n    typeof chrome !== \"undefined\" &&\n    !!chrome.runtime &&\n    typeof chrome.runtime.id === \"string\" &&\n    !!chrome.storage &&\n    !!chrome.storage.local\n  );\n}\n\n/**\n * Get refiner model selection from storage result\n * Priority: custom model > recommended model > default\n * @param {Object} result - Storage result object\n * @returns {string} Selected model\n */\nfunction getRefinerModelSelection(result) {\n  const customModel = result[STORAGE_KEYS.REFINER_CUSTOM_MODEL]?.trim();\n  const recommendedModel = result[STORAGE_KEYS.REFINER_RECOMMENDED_MODEL]?.trim();\n  return (\n    (customModel && customModel.length > 0 ? customModel : null) ||\n    (recommendedModel && recommendedModel.length > 0 ? recommendedModel : null) ||\n    DEFAULTS.MODEL_REFINER\n  );\n}\n\n/**\n * Check if auto-generation should be triggered and trigger it if conditions are met\n * @param {string} videoId - Video ID\n * @param {Object} storageResult - Storage result with API keys and settings\n * @param {boolean} checkCaptionsEnabled - Whether to check if captions are enabled\n * @param {boolean} withDelay - Whether to add a delay before triggering (for initial page load)\n */\nfunction checkAndTriggerAutoGeneration(videoId, storageResult, checkCaptionsEnabled = true, withDelay = false) {\n  // Check if auto-generation is enabled\n  if (storageResult[STORAGE_KEYS.AUTO_GENERATE] !== true) {\n    debugLog(\"Auto-gen skipped: setting disabled\");\n    return false;\n  }\n\n  // Check if captions are enabled (if required)\n  if (checkCaptionsEnabled && !showSubtitlesEnabled) {\n    debugLog(\"Auto-gen skipped: captions disabled\");\n    return false;\n  }\n\n  // Check if API key is available\n  if (!storageResult[STORAGE_KEYS.SCRAPE_CREATORS_API_KEY]) {\n    debugLog(\"Auto-gen skipped: missing Scrape Creators key\");\n    return false;\n  }\n\n  // Check if already triggered for this video\n  if (autoGenerationTriggered.has(videoId)) {\n    debugLog(\"Auto-gen skipped: already triggered for video\", videoId);\n    return false;\n  }\n\n  // Mark as triggered\n  autoGenerationTriggered.add(videoId);\n  debugLog(\n    \"Auto-gen enabled,\",\n    withDelay ? \"waiting for page to load...\" : \"triggering immediately...\",\n    \"videoId:\",\n    videoId\n  );\n\n  const trigger = () => {\n    const executeTrigger = () => {\n      // Double-check video ID hasn't changed\n      const currentVideoId = extractVideoId(window.location.href);\n      if (currentVideoId !== videoId) {\n        debugLog(\"Auto-gen cancel: video ID changed\", videoId, \"->\", currentVideoId);\n        autoGenerationTriggered.delete(videoId);\n        return;\n      }\n\n      const modelSelection = getRefinerModelSelection(storageResult);\n      triggerAutoGeneration(\n        videoId,\n        storageResult[STORAGE_KEYS.SCRAPE_CREATORS_API_KEY],\n        storageResult[STORAGE_KEYS.OPENROUTER_API_KEY],\n        modelSelection\n      );\n    };\n\n    // Double-check captions are still enabled if required\n    if (checkCaptionsEnabled) {\n      chrome.storage.local.get([STORAGE_KEYS.SHOW_SUBTITLES], (checkResult) => {\n        const captionsStillEnabled = checkResult[STORAGE_KEYS.SHOW_SUBTITLES] !== false;\n\n        if (!captionsStillEnabled) {\n          debugLog(\"Auto-gen cancel: captions disabled\");\n          autoGenerationTriggered.delete(videoId);\n          return;\n        }\n\n        executeTrigger();\n      });\n    } else {\n      // No caption check needed, trigger directly\n      executeTrigger();\n    }\n  };\n\n  if (withDelay) {\n    setTimeout(() => {\n      if (!isExtensionContextValid()) {\n        debugLog(\"Context invalidated before auto-generation, aborting.\");\n        autoGenerationTriggered.delete(videoId);\n        return;\n      }\n      debugLog(\"Auto-gen delay elapsed; triggering now for\", videoId);\n      trigger();\n    }, TIMING.AUTO_GENERATION_DELAY_MS);\n  } else {\n    trigger();\n  }\n\n  return true;\n}\n\n/**\n * Load stored subtitles for the current video from local storage\n * Also checks for auto-generation setting and triggers generation if enabled\n */\nfunction loadStoredSubtitles() {\n  try {\n    if (!isExtensionContextValid()) {\n      logWarn(\"Extension context invalidated, skipping subtitle load.\");\n      return;\n    }\n\n    // Only proceed if we're on a YouTube video page\n    if (!window.location.href.includes(\"youtube.com/watch\")) {\n      debugLog(\"Not on a video page, skipping subtitle load.\");\n      return;\n    }\n\n    const videoId = extractVideoId(window.location.href);\n    if (!videoId) {\n      logWarn(\"Could not extract video ID, skipping subtitle load.\");\n      return;\n    }\n\n    const keysToFetch = [\n      videoId,\n      STORAGE_KEYS.AUTO_GENERATE,\n      STORAGE_KEYS.SCRAPE_CREATORS_API_KEY,\n      STORAGE_KEYS.OPENROUTER_API_KEY,\n      STORAGE_KEYS.REFINER_RECOMMENDED_MODEL,\n      STORAGE_KEYS.REFINER_CUSTOM_MODEL,\n      STORAGE_KEYS.SHOW_SUBTITLES,\n    ];\n\n    chrome.storage.local.get(keysToFetch, (result) => {\n      try {\n        if (chrome.runtime.lastError) {\n          if (\n            chrome.runtime.lastError.message &&\n            chrome.runtime.lastError.message.includes(\"Extension context invalidated\")\n          ) {\n            debugLog(\"Subtitle load aborted - extension context invalidated.\");\n            return;\n          }\n          logError(\"Error loading subtitles from storage:\", chrome.runtime.lastError.message);\n          return;\n        }\n\n        // Update show subtitles setting\n        showSubtitlesEnabled = result[STORAGE_KEYS.SHOW_SUBTITLES] !== false;\n\n        if (result && result[videoId]) {\n          debugLog(\"Found stored subtitles for this video.\");\n          currentSubtitles = result[videoId];\n          if (showSubtitlesEnabled) {\n            startSubtitleDisplay();\n          }\n        } else {\n          debugLog(\"No stored subtitles found for this video.\");\n          // Try to trigger auto-generation if conditions are met\n          checkAndTriggerAutoGeneration(videoId, result, true, true);\n        }\n      } catch (error) {\n        logError(\"Error processing stored subtitles:\", error);\n      }\n    });\n  } catch (error) {\n    if (error && error.message && error.message.includes(\"Extension context invalidated\")) {\n      debugLog(\"Subtitle load aborted - extension context invalidated (outer).\");\n      return;\n    }\n    logError(\"Error in loadStoredSubtitles:\", error);\n  }\n}\n\n/**\n * Trigger automatic subtitle generation\n * @param {string} videoId - Video ID\n * @param {string} scrapeCreatorsApiKey - Scrape Creators API key\n * @param {string} openRouterApiKey - OpenRouter API key\n * @param {string} modelSelection - Model selection\n */\nfunction triggerAutoGeneration(videoId, scrapeCreatorsApiKey, openRouterApiKey, modelSelection) {\n  clearSubtitles();\n\n  debugLog(\"Sending fetchSubtitles message to background...\", {\n    action: MESSAGE_ACTIONS.FETCH_SUBTITLES,\n    videoId: videoId,\n    hasScrapeKey: !!scrapeCreatorsApiKey,\n    hasOpenRouterKey: !!openRouterApiKey,\n    modelSelection: modelSelection,\n  });\n\n  chrome.runtime.sendMessage(\n    {\n      action: MESSAGE_ACTIONS.FETCH_SUBTITLES,\n      videoId: videoId,\n      scrapeCreatorsApiKey: scrapeCreatorsApiKey,\n      openRouterApiKey: openRouterApiKey,\n      modelSelection: modelSelection,\n    },\n    (response) => {\n      if (chrome.runtime.lastError) {\n        logError(\"Error triggering auto-generation:\", chrome.runtime.lastError.message);\n        autoGenerationTriggered.delete(videoId);\n      } else {\n        debugLog(\"Auto-generation triggered successfully, response:\", response);\n      }\n    }\n  );\n}\n\n/**\n * Monitor URL changes on YouTube (SPA behavior)\n */\nfunction monitorUrlChanges() {\n  // Disconnect existing observer if any\n  if (urlObserver) {\n    urlObserver.disconnect();\n    urlObserver = null;\n  }\n\n  urlObserver = new MutationObserver(() => {\n    // Stop monitoring if extension context is invalidated\n    if (!isExtensionContextValid()) {\n      if (urlObserver) {\n        urlObserver.disconnect();\n        urlObserver = null;\n      }\n      return;\n    }\n\n    if (currentUrl !== window.location.href) {\n      debugLog(\"URL changed (mutation).\");\n      const oldVideoId = extractVideoId(currentUrl);\n      currentUrl = window.location.href;\n      const newVideoId = extractVideoId(currentUrl);\n\n      // If video ID changed, clear the auto-generation tracking for the old video\n      if (oldVideoId !== newVideoId) {\n        autoGenerationTriggered.delete(oldVideoId);\n      }\n\n      onUrlChange();\n    }\n  });\n\n  urlObserver.observe(document.body, { childList: true, subtree: true });\n}\n\n/**\n * Handle actions when the URL changes\n */\nfunction onUrlChange() {\n  debugLog(\"Reinitializing for new video...\");\n  clearSubtitles();\n  initAttempts = 0;\n  initialize();\n}\n\n/**\n * Find video elements on the YouTube page\n * @returns {boolean} True if video elements found\n */\nfunction findVideoElements() {\n  videoPlayer = document.querySelector(YOUTUBE.SELECTORS.VIDEO_PLAYER);\n  if (!videoPlayer) return false;\n\n  // Try finding a standard container, fallback to player's parent\n  videoContainer =\n    document.querySelector(YOUTUBE.SELECTORS.MOVIE_PLAYER) ||\n    document.querySelector(YOUTUBE.SELECTORS.VIDEO_CONTAINER) ||\n    videoPlayer.parentElement;\n\n  return !!videoContainer;\n}\n\n/**\n * Initialize the content script\n */\nfunction initialize() {\n  debugLog(\"Initializing content script...\");\n\n  // Only initialize on YouTube video pages\n  if (!window.location.href.includes(\"youtube.com/watch\")) {\n    debugLog(\"Not on a video page, skipping initialization.\");\n    return;\n  }\n\n  if (!findVideoElements()) {\n    initAttempts++;\n    if (initAttempts < TIMING.MAX_INIT_ATTEMPTS) {\n      debugLog(`Video player not found, retrying (${initAttempts}/${TIMING.MAX_INIT_ATTEMPTS})...`);\n      setTimeout(initialize, TIMING.INIT_RETRY_DELAY_MS);\n    } else {\n      logError(\"Video player or container not found after multiple attempts.\");\n    }\n    return;\n  }\n\n  debugLog(\"Video player found.\", videoPlayer);\n  debugLog(\"Video container found.\", videoContainer);\n\n  createSubtitleElements();\n  loadStoredSubtitles();\n  loadCaptionFontSize();\n  setupMessageListener();\n}\n\n/**\n * Setup message listener for content script\n */\nfunction setupMessageListener() {\n  chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n    if (message.action === MESSAGE_ACTIONS.GET_VIDEO_TITLE) {\n      const titleElement = document.querySelector(\"h1.ytd-watch-metadata yt-formatted-string\");\n      const title = titleElement ? titleElement.textContent : null;\n      sendResponse({ title: title });\n      return true;\n    } else if (message.action === MESSAGE_ACTIONS.GENERATE_SUMMARY) {\n      handleGenerateSummary(message, sendResponse);\n      return true;\n    } else if (message.action === MESSAGE_ACTIONS.GENERATE_SUBTITLES) {\n      handleGenerateSubtitles(message, sendResponse);\n      return true;\n    } else if (message.action === MESSAGE_ACTIONS.SUBTITLES_GENERATED) {\n      handleSubtitlesGenerated(message, sendResponse);\n      return true;\n    } else if (message.action === MESSAGE_ACTIONS.TOGGLE_SUBTITLES) {\n      handleToggleSubtitles(message, sendResponse);\n      return true;\n    } else if (message.action === MESSAGE_ACTIONS.UPDATE_CAPTION_FONT_SIZE) {\n      handleUpdateCaptionFontSize(message, sendResponse);\n      return true;\n    }\n  });\n}\n\n/**\n * Handle generate summary request\n * @param {Object} message - Message object\n * @param {Function} sendResponse - Response callback\n */\nfunction handleGenerateSummary(message, sendResponse) {\n  debugLog(\"Received generateSummary request\");\n\n  const videoId = message.videoId || extractVideoId(window.location.href);\n\n  if (!videoId) {\n    sendResponse({\n      status: \"error\",\n      message: \"Could not extract video ID from URL.\",\n    });\n    return;\n  }\n\n  debugLog(\"Requesting summary from background for video:\", videoId);\n\n  chrome.runtime.sendMessage(\n    {\n      action: MESSAGE_ACTIONS.GENERATE_SUMMARY,\n      videoId: videoId,\n      scrapeCreatorsApiKey: message.scrapeCreatorsApiKey,\n      openRouterApiKey: message.openRouterApiKey,\n      modelSelection: message.modelSelection,\n      targetLanguage: message.targetLanguage,\n    },\n    (response) => {\n      if (chrome.runtime.lastError) {\n        logError(\"Error sending message to background:\", chrome.runtime.lastError);\n        sendResponse({\n          status: \"error\",\n          message: \"Could not communicate with background script.\",\n        });\n      } else {\n        debugLog(\"Summary request sent to background, response:\", response);\n      }\n    }\n  );\n\n  sendResponse({ status: \"started\" });\n}\n\n/**\n * Handle generate subtitles request\n * @param {Object} message - Message object\n * @param {Function} sendResponse - Response callback\n */\nfunction handleGenerateSubtitles(message, sendResponse) {\n  debugLog(\"Received generateSubtitles request\");\n\n  const videoId = message.videoId || extractVideoId(window.location.href);\n\n  if (!videoId) {\n    sendResponse({\n      status: \"error\",\n      message: \"Could not extract video ID from URL.\",\n    });\n    return;\n  }\n\n  debugLog(\"Sending video ID to background:\", videoId);\n\n  clearSubtitles();\n\n  chrome.runtime.sendMessage(\n    {\n      action: MESSAGE_ACTIONS.FETCH_SUBTITLES,\n      videoId: videoId,\n      scrapeCreatorsApiKey: message.scrapeCreatorsApiKey,\n      openRouterApiKey: message.openRouterApiKey,\n      modelSelection: message.modelSelection,\n      forceRegenerate: message.forceRegenerate === true,\n    },\n    (response) => {\n      if (chrome.runtime.lastError) {\n        logError(\"Error sending message to background:\", chrome.runtime.lastError);\n        sendResponse({\n          status: \"error\",\n          message: \"Could not communicate with background script.\",\n        });\n      } else {\n        debugLog(\"Message sent to background, response:\", response);\n        if (response?.status === \"error\") {\n          autoGenerationTriggered.delete(videoId);\n        }\n      }\n    }\n  );\n\n  sendResponse({ status: \"started\" });\n}\n\n/**\n * Handle subtitles generated message\n * @param {Object} message - Message object\n * @param {Function} sendResponse - Response callback\n */\nfunction handleSubtitlesGenerated(message, sendResponse) {\n  debugLog(\"Received subtitlesGenerated request\");\n  currentSubtitles = message.subtitles || [];\n  debugLog(`Received ${currentSubtitles.length} subtitle entries.`);\n\n  if (currentSubtitles.length > 0) {\n    if (showSubtitlesEnabled) {\n      startSubtitleDisplay();\n    }\n\n    // Store the subtitles locally\n    const videoId = message.videoId || extractVideoId(window.location.href);\n\n    if (videoId) {\n      chrome.storage.local.set({ [videoId]: currentSubtitles }, () => {\n        if (chrome.runtime.lastError) {\n          if (chrome.runtime.lastError.message && chrome.runtime.lastError.message.includes(\"QUOTA\")) {\n            logWarn(\"Storage quota exceeded. Transcript will not be saved, but subtitles will still display.\");\n          } else {\n            logError(\"Error saving subtitles:\", chrome.runtime.lastError.message);\n          }\n        } else {\n          debugLog(\"Subtitles saved to local storage for video ID:\", videoId);\n        }\n      });\n    } else {\n      logWarn(\"Could not extract video ID, subtitles not saved.\");\n    }\n\n    sendResponse({ status: \"success\" });\n  } else {\n    logWarn(\"Received empty subtitles array.\");\n    clearSubtitles();\n    sendResponse({ status: \"no_subtitles_found\" });\n  }\n}\n\n/**\n * Load and apply caption font size from storage\n */\nfunction loadCaptionFontSize() {\n  try {\n    if (!isExtensionContextValid()) {\n      debugLog(\"Context invalidated, skipping font size load.\");\n      return;\n    }\n\n    chrome.storage.local.get([STORAGE_KEYS.CAPTION_FONT_SIZE], (result) => {\n      try {\n        if (chrome.runtime.lastError) {\n          const errorMsg = chrome.runtime.lastError.message || \"\";\n          if (errorMsg.includes(\"Extension context invalidated\")) {\n            debugLog(\"Font size load aborted - extension context invalidated.\");\n            return;\n          }\n          logWarn(\"Error loading caption font size:\", errorMsg);\n          return;\n        }\n\n        const fontSize = result?.[STORAGE_KEYS.CAPTION_FONT_SIZE] || DEFAULTS.CAPTION_FONT_SIZE;\n        applyCaptionFontSize(fontSize);\n      } catch (error) {\n        if (error?.message?.includes(\"Extension context invalidated\")) {\n          debugLog(\"Font size load aborted (callback) - extension context invalidated.\");\n          return;\n        }\n        logError(\"Error applying caption font size:\", error);\n      }\n    });\n  } catch (error) {\n    if (error?.message?.includes(\"Extension context invalidated\")) {\n      debugLog(\"Font size load aborted (outer) - extension context invalidated.\");\n      return;\n    }\n    logError(\"Error in loadCaptionFontSize:\", error);\n  }\n}\n\n/**\n * Apply caption font size\n * @param {string} size - Size key (S, M, L)\n */\nfunction applyCaptionFontSize(size) {\n  const sizeConfig = FONT_SIZES.CAPTION[size] || FONT_SIZES.CAPTION.M;\n  \n  // Update CSS custom properties for consistency\n  document.documentElement.style.setProperty(\"--caption-font-size-base\", sizeConfig.base);\n  document.documentElement.style.setProperty(\"--caption-font-size-max\", sizeConfig.max);\n  document.documentElement.style.setProperty(\"--caption-font-size-min\", sizeConfig.min);\n  document.documentElement.style.setProperty(\"--caption-font-size-fullscreen\", sizeConfig.fullscreen);\n  document.documentElement.style.setProperty(\"--caption-font-size-fullscreen-max\", sizeConfig.fullscreenMax);\n\n  // Apply to element directly if it exists, using clamp for responsiveness\n  if (subtitleText) {\n    subtitleText.style.fontSize = `clamp(${sizeConfig.min}, ${sizeConfig.base}, ${sizeConfig.max})`;\n  }\n}\n\n/**\n * Handle update caption font size message\n * @param {Object} message - Message object\n * @param {Function} sendResponse - Response callback\n */\nfunction handleUpdateCaptionFontSize(message, sendResponse) {\n  const fontSize = message.fontSize || DEFAULTS.CAPTION_FONT_SIZE;\n  applyCaptionFontSize(fontSize);\n  sendResponse({ status: \"success\" });\n}\n\n/**\n * Handle toggle subtitles message\n * @param {Object} message - Message object\n * @param {Function} sendResponse - Response callback\n */\nfunction handleToggleSubtitles(message, sendResponse) {\n  debugLog(\"Received toggleSubtitles request\");\n  const hasShowSubtitles = Object.prototype.hasOwnProperty.call(message, \"showSubtitles\");\n  const hasEnabled = Object.prototype.hasOwnProperty.call(message, \"enabled\");\n  const nextState = hasShowSubtitles\n    ? message.showSubtitles !== false\n    : hasEnabled\n    ? message.enabled !== false\n    : true;\n  const wasEnabled = showSubtitlesEnabled;\n  showSubtitlesEnabled = nextState;\n  chrome.storage.local.set({ [STORAGE_KEYS.SHOW_SUBTITLES]: showSubtitlesEnabled });\n\n  if (showSubtitlesEnabled && currentSubtitles.length > 0) {\n    startSubtitleDisplay();\n  } else {\n    stopSubtitleDisplay();\n    hideCurrentSubtitle();\n  }\n\n  // If captions were just turned on and there are no subtitles, check for auto-generation\n  if (showSubtitlesEnabled && !wasEnabled && currentSubtitles.length === 0) {\n    const videoId = extractVideoId(window.location.href);\n    if (videoId) {\n      chrome.storage.local.get(\n        [\n          videoId,\n          STORAGE_KEYS.AUTO_GENERATE,\n          STORAGE_KEYS.SCRAPE_CREATORS_API_KEY,\n          STORAGE_KEYS.OPENROUTER_API_KEY,\n          STORAGE_KEYS.REFINER_RECOMMENDED_MODEL,\n          STORAGE_KEYS.REFINER_CUSTOM_MODEL,\n        ],\n        (result) => {\n          // Check if subtitles already exist for this video\n          if (result[videoId] && result[videoId].length > 0) {\n            debugLog(\"Subtitles already exist for this video, loading them...\");\n            currentSubtitles = result[videoId];\n            startSubtitleDisplay();\n            return;\n          }\n\n          // Try to trigger auto-generation (no delay, captions already enabled)\n          checkAndTriggerAutoGeneration(videoId, result, false, false);\n        }\n      );\n    }\n  }\n\n  sendResponse({ status: \"success\" });\n}\n\n/**\n * Create subtitle elements and append them to the video container\n */\nfunction createSubtitleElements() {\n  if (document.getElementById(ELEMENT_IDS.SUBTITLE_CONTAINER)) return;\n\n  subtitleContainer = document.createElement(\"div\");\n  subtitleContainer.id = ELEMENT_IDS.SUBTITLE_CONTAINER;\n  subtitleContainer.style.position = \"absolute\";\n  subtitleContainer.style.zIndex = \"9999\";\n  subtitleContainer.style.pointerEvents = \"none\";\n  subtitleContainer.style.display = \"none\";\n\n  subtitleText = document.createElement(\"div\");\n  subtitleText.id = ELEMENT_IDS.SUBTITLE_TEXT;\n  subtitleContainer.appendChild(subtitleText);\n\n  if (videoContainer) {\n    if (getComputedStyle(videoContainer).position === \"static\") {\n      videoContainer.style.position = \"relative\";\n    }\n    videoContainer.appendChild(subtitleContainer);\n    debugLog(\"Subtitle container added to video container.\");\n  } else {\n    logError(\"Cannot add subtitle container, video container not found.\");\n  }\n}\n\n/**\n * Start displaying subtitles\n */\nfunction startSubtitleDisplay() {\n  if (!videoPlayer || !subtitleContainer) {\n    logWarn(\"Cannot start subtitle display: Player or container missing.\");\n    return;\n  }\n\n  stopSubtitleDisplay();\n\n  debugLog(\"Starting subtitle display interval.\");\n  checkInterval = setInterval(updateSubtitles, TIMING.SUBTITLE_UPDATE_INTERVAL_MS);\n\n  videoPlayer.addEventListener(\"play\", updateSubtitles);\n  videoPlayer.addEventListener(\"seeked\", updateSubtitles);\n}\n\n/**\n * Stop displaying subtitles\n */\nfunction stopSubtitleDisplay() {\n  if (checkInterval) {\n    clearInterval(checkInterval);\n    checkInterval = null;\n    debugLog(\"Stopped subtitle display interval.\");\n  }\n  if (videoPlayer) {\n    videoPlayer.removeEventListener(\"play\", updateSubtitles);\n    videoPlayer.removeEventListener(\"seeked\", updateSubtitles);\n  }\n}\n\n/**\n * Clear subtitles and stop display\n */\nfunction clearSubtitles() {\n  currentSubtitles = [];\n  stopSubtitleDisplay();\n  hideCurrentSubtitle();\n  debugLog(\"Subtitles cleared.\");\n}\n\n/**\n * Hide the current subtitle\n */\nfunction hideCurrentSubtitle() {\n  if (subtitleContainer) {\n    subtitleContainer.style.display = \"none\";\n  }\n  if (subtitleText) {\n    subtitleText.textContent = \"\";\n  }\n}\n\n/**\n * Update subtitles based on the current video time\n */\nfunction updateSubtitles() {\n  if (!videoPlayer || !subtitleText || !subtitleContainer) {\n    return;\n  }\n\n  if (isNaN(videoPlayer.currentTime)) return;\n\n  const currentTime = videoPlayer.currentTime * 1000; // Convert to ms\n  let foundSubtitle = null;\n\n  for (const subtitle of currentSubtitles) {\n    if (currentTime >= subtitle.startTime && currentTime <= subtitle.endTime) {\n      foundSubtitle = subtitle;\n      break;\n    }\n  }\n\n  if (foundSubtitle) {\n    if (subtitleText.textContent !== foundSubtitle.text) {\n      subtitleText.textContent = foundSubtitle.text;\n    }\n    subtitleContainer.style.display = \"block\";\n  } else {\n    hideCurrentSubtitle();\n  }\n}\n\n// Initialize immediately since we're using document_end in manifest\n(function() {\n  debugLog(\"Content script loaded, readyState:\", document.readyState);\n  \n  const startInitialization = () => {\n    initialize();\n    monitorUrlChanges();\n  };\n  \n  if (document.readyState === \"loading\") {\n    document.addEventListener(\"DOMContentLoaded\", startInitialization);\n  } else {\n    // Give YouTube a moment to render if we're already loaded\n    setTimeout(startInitialization, 500);\n  }\n})();\n\n"],
  "mappings": "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",
  "names": ["STORAGE_KEYS", "TIMING", "STORAGE", "DEFAULTS", "FONT_SIZES", "YOUTUBE", "MESSAGE_ACTIONS", "ELEMENT_IDS", "extractVideoId", "url", "e", "PREFIX", "DEBUG", "log", "args", "warn", "args", "DEBUG", "PREFIX", "error", "currentSubtitles", "subtitleContainer", "subtitleText", "videoPlayer", "videoContainer", "checkInterval", "initAttempts", "currentUrl", "autoGenerationTriggered", "showSubtitlesEnabled", "urlObserver", "isExtensionContextValid", "getRefinerModelSelection", "result", "customModel", "STORAGE_KEYS", "recommendedModel", "DEFAULTS", "checkAndTriggerAutoGeneration", "videoId", "storageResult", "checkCaptionsEnabled", "withDelay", "log", "showSubtitlesEnabled", "autoGenerationTriggered", "trigger", "executeTrigger", "currentVideoId", "extractVideoId", "modelSelection", "triggerAutoGeneration", "checkResult", "TIMING", "loadStoredSubtitles", "warn", "keysToFetch", "error", "currentSubtitles", "startSubtitleDisplay", "scrapeCreatorsApiKey", "openRouterApiKey", "clearSubtitles", "MESSAGE_ACTIONS", "response", "monitorUrlChanges", "currentUrl", "oldVideoId", "newVideoId", "onUrlChange", "initAttempts", "initialize", "findVideoElements", "videoPlayer", "YOUTUBE", "videoContainer", "createSubtitleElements", "loadCaptionFontSize", "setupMessageListener", "message", "sender", "sendResponse", "titleElement", "title", "handleGenerateSummary", "handleGenerateSubtitles", "handleSubtitlesGenerated", "handleToggleSubtitles", "handleUpdateCaptionFontSize", "errorMsg", "fontSize", "applyCaptionFontSize", "size", "sizeConfig", "FONT_SIZES", "subtitleText", "hasShowSubtitles", "hasEnabled", "nextState", "wasEnabled", "stopSubtitleDisplay", "hideCurrentSubtitle", "ELEMENT_IDS", "subtitleContainer", "checkInterval", "updateSubtitles", "currentTime", "foundSubtitle", "subtitle", "startInitialization"]
}
