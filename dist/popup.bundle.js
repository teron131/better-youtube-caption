(()=>{var a={SCRAPE_CREATORS_API_KEY:"scrapeCreatorsApiKey",OPENROUTER_API_KEY:"openRouterApiKey",SUMMARIZER_RECOMMENDED_MODEL:"summarizerRecommendedModel",SUMMARIZER_CUSTOM_MODEL:"summarizerCustomModel",REFINER_RECOMMENDED_MODEL:"refinerRecommendedModel",REFINER_CUSTOM_MODEL:"refinerCustomModel",AUTO_GENERATE:"autoGenerate",SHOW_SUBTITLES:"showSubtitles",CAPTION_FONT_SIZE:"captionFontSize",SUMMARY_FONT_SIZE:"summaryFontSize",TARGET_LANGUAGE_RECOMMENDED:"targetLanguageRecommended",TARGET_LANGUAGE_CUSTOM:"targetLanguageCustom"};var j={QUOTA_BYTES:10*1024*1024,MAX_STORAGE_BYTES:9.5*1024*1024,ESTIMATED_VIDEO_SIZE_BYTES:30*1024,CLEANUP_BATCH_SIZE:10},N=[{value:"x-ai/grok-4.1-fast",label:"Grok 4.1 Fast"},{value:"x-ai/grok-4",label:"Grok 4"},{value:"google/gemini-2.5-flash",label:"Gemini 2.5 Flash"},{value:"google/gemini-3-pro-preview",label:"Gemini 3 Pro"},{value:"openai/gpt-5-mini",label:"GPT-5 Mini"},{value:"openai/gpt-5.1",label:"GPT-5.1"},{value:"anthropic/claude-haiku-4.5",label:"Claude Haiku 4.5"},{value:"anthropic/claude-sonnet-4.5",label:"Claude Sonnet 4.5"}],b=[{value:"google/gemini-2.5-flash-lite-preview-09-2025",label:"Gemini 2.5 Flash Lite"},{value:"x-ai/grok-4.1-fast",label:"Grok 4.1 Fast"}],h=[{value:"auto",label:"\u{1F310} Auto"},{value:"en",label:"\u{1F1FA}\u{1F1F8} English"},{value:"zh-TW",label:"\u{1F1ED}\u{1F1F0} Chinese"}],m={MODEL_SUMMARIZER:"x-ai/grok-4.1-fast",MODEL_REFINER:"google/gemini-2.5-flash-lite-preview-09-2025",AUTO_GENERATE:!1,SHOW_SUBTITLES:!0,CAPTION_FONT_SIZE:"M",SUMMARY_FONT_SIZE:"M",TARGET_LANGUAGE_RECOMMENDED:"auto",TARGET_LANGUAGE_CUSTOM:""},y={CAPTION:{S:{base:"1.4vw",max:"22px",min:"12px",fullscreen:"1.7vw",fullscreenMax:"28px"},M:{base:"1.8vw",max:"28px",min:"14px",fullscreen:"2.2vw",fullscreenMax:"36px"},L:{base:"2.2vw",max:"34px",min:"16px",fullscreen:"2.7vw",fullscreenMax:"44px"}},SUMMARY:{S:{base:"13px",h2:"17px",h3:"15px"},M:{base:"15px",h2:"20px",h3:"17px"},L:{base:"17px",h2:"23px",h3:"19px"}}};var p={FETCH_SUBTITLES:"fetchSubtitles",GENERATE_SUBTITLES:"generateSubtitles",GENERATE_SUMMARY:"generateSummary",SUBTITLES_GENERATED:"subtitlesGenerated",SUMMARY_GENERATED:"summaryGenerated",UPDATE_POPUP_STATUS:"updatePopupStatus",TOGGLE_SUBTITLES:"toggleSubtitles",GET_VIDEO_TITLE:"getVideoTitle",SHOW_ERROR:"showError",UPDATE_CAPTION_FONT_SIZE:"updateCaptionFontSize"};var X="Better YouTube Caption:",Q=!0,f=(...e)=>{Q&&console.log(X,...e)};function M(e){return new Promise(t=>{chrome.storage.local.get([e],r=>{t(r[e]||null)})})}function E(e,t){let r={[e]:t};chrome.storage.local.set(r,()=>{f("Auto-saved:",e,t)})}function g(e){try{return new URL(e).searchParams.get("v")}catch(t){return console.error("Error extracting video ID:",e,t),null}}function O(e){return{anthropic:"images/anthropic.svg",google:"images/google.svg",openai:"images/openai.svg","x-ai":"images/xai.svg"}[e]||""}function A(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function v(e){return e=e.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/__(.+?)__/g,"<strong>$1</strong>"),e=e.replace(/(?<!\*)\*([^*]+?)\*(?!\*)/g,"<em>$1</em>"),e=e.replace(/(?<!_)_([^_]+?)_(?!_)/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e.split(/(<[^>]+>)/g).map((o,n)=>n%2===1?o:A(o)).join("")}function J(e){if(!e||typeof e!="string")return'<div class="summary-placeholder">No summary available</div>';let t=e.split(`
`),r=[],o=!1,n=!1;for(let s=0;s<t.length;s++){let i=t[s].trim();if(!i){o&&(r.push("</ul>"),o=!1),n&&(r.push("</p>"),n=!1);continue}if(i.match(/^###\s+(.+)$/)){o&&(r.push("</ul>"),o=!1),n&&(r.push("</p>"),n=!1);let c=i.replace(/^###\s+/,"");r.push(`<h3>${A(c)}</h3>`)}else if(i.match(/^##\s+(.+)$/)){o&&(r.push("</ul>"),o=!1),n&&(r.push("</p>"),n=!1);let c=i.replace(/^##\s+/,"");r.push(`<h2>${A(c)}</h2>`)}else if(i.match(/^#\s+(.+)$/)){o&&(r.push("</ul>"),o=!1),n&&(r.push("</p>"),n=!1);let c=i.replace(/^#\s+/,"");r.push(`<h2>${A(c)}</h2>`)}else if(i.match(/^[\*\-•]\s+(.+)$/)){n&&(r.push("</p>"),n=!1),o||(r.push("<ul>"),o=!0);let c=i.replace(/^[\*\-•]\s+/,"");r.push(`<li>${v(c)}</li>`)}else o&&(r.push("</ul>"),o=!1),n?r.push("<br>"):(r.push("<p>"),n=!0),r.push(v(i))}return o&&r.push("</ul>"),n&&r.push("</p>"),r.join("")}function R(e,t){t.innerHTML=J(e)}function x(){document.querySelectorAll(".combobox[data-combobox-type]").forEach(t=>{let r=t.dataset.comboboxType,o=t.querySelector(".combobox-input"),n=t.querySelector(".combobox-arrow"),s=t.querySelector(".combobox-dropdown"),i=t.querySelector(".combobox-icon");if(!o||!n||!s||!i)return;s.innerHTML="";let c=[],u={};r==="targetLanguage"?(c=h,u={recommended:a.TARGET_LANGUAGE_RECOMMENDED,custom:a.TARGET_LANGUAGE_CUSTOM}):r==="summarizer"?(c=N,u={recommended:a.SUMMARIZER_RECOMMENDED_MODEL,custom:a.SUMMARIZER_CUSTOM_MODEL}):r==="refiner"&&(c=b,u={recommended:a.REFINER_RECOMMENDED_MODEL,custom:a.REFINER_CUSTOM_MODEL}),c.forEach(l=>{let d=ee(l,r);s.appendChild(d)}),n.addEventListener("click",l=>{l.stopPropagation(),te(t)}),o.addEventListener("focus",()=>{t.classList.add("open"),s.classList.add("show")}),o.addEventListener("input",l=>{re(t,l.target.value);let d=l.target.value.trim();(r==="summarizer"||r==="refiner")&&d&&L(t,d),d&&u.custom?(E(u.custom,d),u.recommended&&E(u.recommended,"")):(u.custom&&E(u.custom,""),(r==="summarizer"||r==="refiner")&&i&&(i.innerHTML=""))}),s.addEventListener("click",l=>{let d=l.target.closest(".combobox-item");if(!d)return;let S=d.dataset.value;o.value=S,r==="targetLanguage"?U(t,S):(r==="summarizer"||r==="refiner")&&L(t,S),s.querySelectorAll(".combobox-item").forEach(W=>{W.classList.remove("selected")}),d.classList.add("selected"),t.classList.remove("open"),s.classList.remove("show"),u.recommended&&E(u.recommended,S),u.custom&&E(u.custom,"")}),document.addEventListener("click",l=>{t.contains(l.target)||(t.classList.remove("open"),s.classList.remove("show"))})})}function ee(e,t){let r=document.createElement("div");r.className="combobox-item",r.dataset.value=e.value;let o=document.createElement("span");if(o.className="combobox-item-icon",t==="targetLanguage"){let s=e.label.match(/^(\p{Emoji}+)\s*(.+)$/u);s&&(o.textContent=s[1])}else if(t==="summarizer"||t==="refiner"){let s=e.value.split("/")[0],i=O(s);if(i){let c=document.createElement("img");c.src=i,c.alt=s,c.width=16,c.height=16,o.appendChild(c)}}r.appendChild(o);let n=document.createElement("span");if(n.className="combobox-item-label",t==="targetLanguage"){let s=e.label.match(/^(\p{Emoji}+)\s*(.+)$/u);s?n.textContent=s[2].trim():n.textContent=e.label}else n.textContent=e.label;return r.appendChild(n),r}function te(e){let t=e.querySelector(".combobox-dropdown"),r=e.classList.contains("open");if(document.querySelectorAll(".combobox.open").forEach(o=>{o!==e&&(o.classList.remove("open"),o.querySelector(".combobox-dropdown").classList.remove("show"))}),r)e.classList.remove("open"),t.classList.remove("show");else{e.classList.add("open"),t.classList.add("show");let o=e.querySelector(".combobox-input");o&&o.focus()}}function re(e,t){let o=e.querySelector(".combobox-dropdown").querySelectorAll(".combobox-item"),n=t.toLowerCase().trim();o.forEach(s=>{let i=s.querySelector(".combobox-item-label").textContent.toLowerCase(),c=s.dataset.value.toLowerCase();!n||i.includes(n)||c.includes(n)?s.style.display="flex":s.style.display="none"})}function U(e,t){let r=e.querySelector(".combobox-icon");if(!r)return;let o=h.find(n=>n.value===t);if(o){let n=o.label.match(/^(\p{Emoji}+)\s*(.+)$/u);n?r.textContent=n[1]:r.textContent=""}else r.textContent=""}function L(e,t){let r=e.querySelector(".combobox-icon");if(r&&(r.innerHTML="",t)){let o=t.split("/")[0],n=O(o);if(n){let s=document.createElement("img");s.src=n,s.alt=o,s.width=16,s.height=16,r.appendChild(s)}}}function C(e,t){let r=document.querySelector(`[data-combobox-type="${e}"]`);if(!r)return;let o=r.querySelector(".combobox-input"),n=r.querySelector(".combobox-icon");if(o){o.value=t||"",e==="targetLanguage"?U(r,t):(e==="summarizer"||e==="refiner")&&L(r,t);let s=r.querySelector(".combobox-dropdown");s&&s.querySelectorAll(".combobox-item").forEach(i=>{i.classList.remove("selected"),i.dataset.value===t&&i.classList.add("selected")})}}function D(e){let t=y.SUMMARY[e]||y.SUMMARY.M,r=document.getElementById("summaryContent");r&&(r.style.setProperty("--summary-font-size-base",t.base),r.style.setProperty("--summary-font-size-h2",t.h2),r.style.setProperty("--summary-font-size-h3",t.h3))}function G(){chrome.storage.local.get([a.CAPTION_FONT_SIZE,a.SUMMARY_FONT_SIZE],e=>{let t=e[a.CAPTION_FONT_SIZE]||m.CAPTION_FONT_SIZE,r=e[a.SUMMARY_FONT_SIZE]||m.SUMMARY_FONT_SIZE;document.querySelectorAll('.font-size-button[data-type="caption"]').forEach(o=>{o.dataset.size===t?o.classList.add("active"):o.classList.remove("active")}),document.querySelectorAll('.font-size-button[data-type="summary"]').forEach(o=>{o.dataset.size===r?o.classList.add("active"):o.classList.remove("active")}),D(r)}),document.querySelectorAll(".font-size-button").forEach(e=>{e.addEventListener("click",function(){let t=this.dataset.size,r=this.dataset.type;document.querySelectorAll(`.font-size-button[data-type="${r}"]`).forEach(n=>{n.classList.remove("active")}),this.classList.add("active");let o=r==="caption"?a.CAPTION_FONT_SIZE:a.SUMMARY_FONT_SIZE;E(o,t),r==="caption"?chrome.tabs.query({active:!0,currentWindow:!0},n=>{let s=n[0];s&&s.url&&s.url.includes("youtube.com/watch")&&chrome.tabs.sendMessage(s.id,{action:p.UPDATE_CAPTION_FONT_SIZE,fontSize:t},()=>{chrome.runtime.lastError&&f("Popup: Unable to update caption font size:",chrome.runtime.lastError.message)})}):D(t)})})}function w(e){chrome.storage.local.get([a.SCRAPE_CREATORS_API_KEY,a.OPENROUTER_API_KEY,a.SUMMARIZER_RECOMMENDED_MODEL,a.SUMMARIZER_CUSTOM_MODEL,a.REFINER_RECOMMENDED_MODEL,a.REFINER_CUSTOM_MODEL,a.AUTO_GENERATE,a.SHOW_SUBTITLES,a.TARGET_LANGUAGE_RECOMMENDED,a.TARGET_LANGUAGE_CUSTOM],t=>{t[a.SCRAPE_CREATORS_API_KEY]&&e.scrapeApiKey&&(e.scrapeApiKey.value=t[a.SCRAPE_CREATORS_API_KEY]),t[a.OPENROUTER_API_KEY]&&e.openrouterApiKey&&(e.openrouterApiKey.value=t[a.OPENROUTER_API_KEY]),e.autoGenerateToggle&&(e.autoGenerateToggle.checked=t[a.AUTO_GENERATE]===!0);let r=t[a.SHOW_SUBTITLES]!==void 0?t[a.SHOW_SUBTITLES]:m.SHOW_SUBTITLES;e.showSubtitlesToggle&&(e.showSubtitlesToggle.checked=r===!0);let o=t[a.SUMMARIZER_CUSTOM_MODEL]?.trim(),n=t[a.SUMMARIZER_RECOMMENDED_MODEL]||m.MODEL_SUMMARIZER;C("summarizer",o||n);let i=t[a.REFINER_CUSTOM_MODEL]?.trim(),c=t[a.REFINER_RECOMMENDED_MODEL]||m.MODEL_REFINER;C("refiner",i||c);let l=t[a.TARGET_LANGUAGE_CUSTOM]?.trim(),d=t[a.TARGET_LANGUAGE_RECOMMENDED]||m.TARGET_LANGUAGE_RECOMMENDED;C("targetLanguage",l||d)})}function P(e){e.scrapeApiKey&&e.scrapeApiKey.addEventListener("input",function(){E(a.SCRAPE_CREATORS_API_KEY,this.value.trim())}),e.openrouterApiKey&&e.openrouterApiKey.addEventListener("input",function(){E(a.OPENROUTER_API_KEY,this.value.trim())}),e.autoGenerateToggle&&e.autoGenerateToggle.addEventListener("change",function(){E(a.AUTO_GENERATE,this.checked)}),e.showSubtitlesToggle&&e.showSubtitlesToggle.addEventListener("change",function(){let t=this.checked;E(a.SHOW_SUBTITLES,t),chrome.tabs.query({active:!0,currentWindow:!0},r=>{let o=r[0];o&&o.url&&o.url.includes("youtube.com/watch")&&chrome.tabs.sendMessage(o.id,{action:p.TOGGLE_SUBTITLES,showSubtitles:t,enabled:t},()=>{chrome.runtime.lastError&&f("Popup: Unable to toggle subtitles:",chrome.runtime.lastError.message)})})})}function B(e){let t=e[a.SUMMARIZER_CUSTOM_MODEL]?.trim(),r=e[a.SUMMARIZER_RECOMMENDED_MODEL]?.trim();return t||r||m.MODEL_SUMMARIZER}function I(e){let t=e[a.REFINER_CUSTOM_MODEL]?.trim(),r=e[a.REFINER_RECOMMENDED_MODEL]?.trim();return t||r||m.MODEL_REFINER}function F(e){let t=e[a.TARGET_LANGUAGE_CUSTOM]?.trim(),r=e[a.TARGET_LANGUAGE_RECOMMENDED]?.trim();return t||r||m.TARGET_LANGUAGE_RECOMMENDED}async function T(){return new Promise(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{let r=t[0];r&&r.url&&r.url.includes("youtube.com/watch")?e(r):e(null)})})}async function _(e){if(e)try{let t=await T();if(!t){e.disabled=!0;return}let r=g(t.url);if(!r){e.disabled=!0;return}let o=await M(r);e.disabled=!o||!Array.isArray(o)||o.length===0}catch(t){console.error("Error checking refined captions:",t),e.disabled=!0}}function Y(e,t,r){let o=e[a.SCRAPE_CREATORS_API_KEY],n=e[a.OPENROUTER_API_KEY];return o?n?!0:(t.textContent="Please enter OpenRouter API key in Settings",t.className="status error",r(),!1):(t.textContent="Please enter Scrape Creators API key in Settings",t.className="status error",r(),!1)}async function K(e,t){e.generateSummaryBtn.disabled||e.generateCaptionBtn.disabled||(e.status.textContent="",e.status.className="status",chrome.storage.local.get([a.SCRAPE_CREATORS_API_KEY,a.OPENROUTER_API_KEY,a.SUMMARIZER_RECOMMENDED_MODEL,a.SUMMARIZER_CUSTOM_MODEL,a.REFINER_RECOMMENDED_MODEL,a.REFINER_CUSTOM_MODEL,a.TARGET_LANGUAGE_RECOMMENDED,a.TARGET_LANGUAGE_CUSTOM],async r=>{if(!Y(r,e.status,t))return;let o=e.summarizerInput?.value.trim()||B(r),n=e.refinerInput?.value.trim()||I(r),s=e.targetLanguageInput?.value.trim()||F(r);e.status.textContent="Generating summary...",e.generateSummaryBtn.disabled=!0,e.generateCaptionBtn.disabled=!0,e.summaryContent.innerHTML='<div class="summary-placeholder">Generating summary, please wait...</div>';let i=await T();if(!i){e.status.textContent="Not a YouTube video page",e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1;return}let c=g(i.url);if(!c){e.status.textContent="Could not extract video ID",e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1;return}chrome.tabs.sendMessage(i.id,{action:p.GENERATE_SUMMARY,videoId:c,scrapeCreatorsApiKey:r[a.SCRAPE_CREATORS_API_KEY],openRouterApiKey:r[a.OPENROUTER_API_KEY],modelSelection:o,targetLanguage:s},u=>{if(chrome.runtime.lastError)e.status.textContent="Error: "+chrome.runtime.lastError.message,e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1,e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>';else if(u&&u.status==="started")e.status.textContent="Processing video transcript...";else if(u&&u.status==="error"){let l=u.message||"Unknown error";e.status.textContent="Error: "+l,e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1,l.includes("already in progress")||(e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>')}})}))}async function z(e,t){e.generateSummaryBtn.disabled||e.generateCaptionBtn.disabled||(e.status.textContent="",e.status.className="status",chrome.storage.local.get([a.SCRAPE_CREATORS_API_KEY,a.OPENROUTER_API_KEY,a.REFINER_RECOMMENDED_MODEL,a.REFINER_CUSTOM_MODEL],async r=>{if(!Y(r,e.status,t))return;let o=e.refinerInput?.value.trim()||I(r);e.status.textContent="Generating refined captions...",e.generateCaptionBtn.disabled=!0,e.generateSummaryBtn.disabled=!0;let n=await T();if(!n){e.status.textContent="Not a YouTube video page",e.status.className="status error",e.generateCaptionBtn.disabled=!1,e.generateSummaryBtn.disabled=!1;return}let s=g(n.url);if(!s){e.status.textContent="Could not extract video ID",e.status.className="status error",e.generateCaptionBtn.disabled=!1,e.generateSummaryBtn.disabled=!1;return}chrome.tabs.sendMessage(n.id,{action:p.GENERATE_SUBTITLES,videoId:s,scrapeCreatorsApiKey:r[a.SCRAPE_CREATORS_API_KEY],openRouterApiKey:r[a.OPENROUTER_API_KEY],modelSelection:o,forceRegenerate:!0},i=>{chrome.runtime.lastError?(e.status.textContent="Error: "+chrome.runtime.lastError.message,e.status.className="status error",e.generateCaptionBtn.disabled=!1,e.generateSummaryBtn.disabled=!1):i&&i.status==="started"?e.status.textContent="Fetching and refining transcript...":i&&i.status==="error"&&(e.status.textContent="Error: "+(i.message||"Unknown error"),e.status.className="status error",e.generateCaptionBtn.disabled=!1,e.generateSummaryBtn.disabled=!1)})}))}async function k(e){try{let t=await T();if(!t)return;let r=g(t.url);if(!r)return;chrome.storage.local.get([`summary_${r}`],o=>{o[`summary_${r}`]&&e.summaryContent&&(f("Popup: Found existing summary for video:",r),R(o[`summary_${r}`],e.summaryContent))})}catch(t){f("Popup: Error loading existing summary:",t)}}function Z(e,t){let r={},o=0;e.summarizerCustomModel&&e.summarizerCustomModel.value.trim()&&(e.summarizerCustomModel.value="",r[a.SUMMARIZER_CUSTOM_MODEL]="",o++),e.refinerCustomModel&&e.refinerCustomModel.value.trim()&&(e.refinerCustomModel.value="",r[a.REFINER_CUSTOM_MODEL]="",o++),Object.keys(r).length>0?(chrome.storage.local.set(r,()=>{console.log("Popup: Cleared invalid custom models")}),alert(`Model Error: ${t}

Invalid custom model input detected and cleared. Now using recommended models for summarizer and refiner. Please check your custom model entries if needed.`)):alert(`Model Error: ${t}

Please check your model selection in Settings and ensure it's a valid OpenRouter model ID.`)}function $(e){return typeof e=="string"?e.toLowerCase():e instanceof Error?e.message.toLowerCase():typeof e=="object"&&e!==null?e.message?String(e.message).toLowerCase():e.error?$(e.error):JSON.stringify(e).toLowerCase():String(e).toLowerCase()}function V(e){let t=$(e);return t.includes("invalid model")||t.includes("not a valid model id")||t.includes("model not found")||t.includes("openrouter")}function q(e){chrome.runtime.onMessage.addListener((t,r,o)=>{if(t.action===p.SHOW_ERROR){e.status.className="status error";let n=typeof t.error=="string"?t.error:t.error?.message||JSON.stringify(t.error)||"Unknown error",s=V(t.error);s&&(e.summarizerCustomModel||e.refinerCustomModel)?Z(e,n):s?alert(`Model Error: ${n}

Please check your model selection in Settings and ensure it's a valid OpenRouter model ID.`):e.status.textContent=`Error: ${n}`}else if(t.action===p.UPDATE_POPUP_STATUS)if(t.error){e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1,e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>';let n=typeof t.error=="string"?t.error:t.error?.message||JSON.stringify(t.error)||"Unknown error";V(t.error)&&(e.summarizerCustomModel||e.refinerCustomModel)?Z(e,n):e.status.textContent=t.text||`Error: ${n}`}else t.success?(e.status.className="status success",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1,_(e.copyCaptionBtn)):(e.status.textContent=t.text,t.text&&(t.text.includes("ready")||t.text.includes("complete")||t.text.includes("success"))&&setTimeout(()=>{_(e.copyCaptionBtn)},500));else t.action==="SUMMARY_GENERATED"&&(t.summary&&(R(t.summary,e.summaryContent),e.status.textContent="Summary generated successfully!",e.status.className="status success",setTimeout(()=>{e.status.textContent="",e.status.className="status"},3e3)),e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1)})}function H(){let e=document.querySelectorAll(".info-icon"),t=new Map;e.forEach(r=>{let o=r.parentElement;(!o||!o.classList.contains("info-icon-wrapper"))&&(o=document.createElement("span"),o.className="info-icon-wrapper",r.parentNode.insertBefore(o,r),o.appendChild(r));let n=document.createElement("div");n.className="info-tooltip",n.textContent=r.getAttribute("data-tooltip"),o.appendChild(n),t.set(r,{tooltip:n,hideTimeout:null}),oe(r,t.get(r))})}function oe(e,t){let{tooltip:r}=t;e.addEventListener("mouseenter",function(){t.hideTimeout&&(clearTimeout(t.hideTimeout),t.hideTimeout=null),r.classList.remove("hide"),r.classList.add("show")}),e.addEventListener("mouseleave",function(o){t.hideTimeout=setTimeout(()=>{r.classList.remove("show"),r.classList.add("hide"),t.hideTimeout=null},2e3)}),r.addEventListener("mouseenter",function(){t.hideTimeout&&(clearTimeout(t.hideTimeout),t.hideTimeout=null),r.classList.remove("hide"),r.classList.add("show")}),r.addEventListener("mouseleave",function(){t.hideTimeout=setTimeout(()=>{r.classList.remove("show"),r.classList.add("hide"),t.hideTimeout=null},500)})}document.addEventListener("DOMContentLoaded",function(){let e={mainView:document.getElementById("mainView"),settingsView:document.getElementById("settingsView"),settingsBtn:document.getElementById("settingsBtn"),backBtn:document.getElementById("backBtn"),generateSummaryBtn:document.getElementById("generateSummaryBtn"),generateCaptionBtn:document.getElementById("generateCaptionBtn"),copyCaptionBtn:document.getElementById("copyCaptionBtn"),summaryContent:document.getElementById("summaryContent"),status:document.getElementById("status"),scrapeApiKey:document.getElementById("scrapeApiKey"),openrouterApiKey:document.getElementById("openrouterApiKey"),summarizerInput:document.getElementById("summarizerInput"),refinerInput:document.getElementById("refinerInput"),autoGenerateToggle:document.getElementById("autoGenerateToggle"),showSubtitlesToggle:document.getElementById("showSubtitlesToggle"),targetLanguageInput:document.getElementById("targetLanguageInput")};function t(){e.mainView.classList.add("active"),e.settingsView.classList.remove("active")}function r(){e.mainView.classList.remove("active"),e.settingsView.classList.add("active")}e.settingsBtn&&e.settingsBtn.addEventListener("click",r),e.backBtn&&e.backBtn.addEventListener("click",t);async function o(){if(!e.copyCaptionBtn?.disabled)try{let n=await new Promise(u=>{chrome.tabs.query({active:!0,currentWindow:!0},l=>{u(l[0])})});if(!n||!n.url||!n.url.includes("youtube.com/watch")){e.status.textContent="Not a YouTube video page",e.status.className="status error";return}let s=g(n.url);if(!s){e.status.textContent="Could not extract video ID",e.status.className="status error";return}let i=await M(s);if(!i||!Array.isArray(i)||i.length===0){e.status.textContent="No refined captions available",e.status.className="status error";return}let c=i.map(u=>(u.text||"").replace(/\n/g," ").trim()).filter(u=>u.length>0).join(" ");await navigator.clipboard.writeText(c),e.status.textContent="Refined caption copied to clipboard!",e.status.className="status success",setTimeout(()=>{e.status.textContent="",e.status.className="status"},2e3)}catch(n){console.error("Error copying refined caption:",n),e.status.textContent="Failed to copy caption",e.status.className="status error"}}x(),w(e),P(e),G(e),H(),q(e),k(e),_(e.copyCaptionBtn),e.generateSummaryBtn&&e.generateSummaryBtn.addEventListener("click",()=>{K(e,r)}),e.generateCaptionBtn&&e.generateCaptionBtn.addEventListener("click",()=>{z(e,r)}),e.copyCaptionBtn&&e.copyCaptionBtn.addEventListener("click",o)});})();
//# sourceMappingURL=popup.bundle.js.map
