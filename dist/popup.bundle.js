(()=>{var a={SCRAPE_CREATORS_API_KEY:"scrapeCreatorsApiKey",OPENROUTER_API_KEY:"openRouterApiKey",SUMMARIZER_RECOMMENDED_MODEL:"summarizerRecommendedModel",SUMMARIZER_CUSTOM_MODEL:"summarizerCustomModel",REFINER_RECOMMENDED_MODEL:"refinerRecommendedModel",REFINER_CUSTOM_MODEL:"refinerCustomModel",AUTO_GENERATE:"autoGenerate",SHOW_SUBTITLES:"showSubtitles",CAPTION_FONT_SIZE:"captionFontSize",SUMMARY_FONT_SIZE:"summaryFontSize",TARGET_LANGUAGE_RECOMMENDED:"targetLanguageRecommended",TARGET_LANGUAGE_CUSTOM:"targetLanguageCustom"};var ee={QUOTA_BYTES:10*1024*1024,MAX_STORAGE_BYTES:9.5*1024*1024,ESTIMATED_VIDEO_SIZE_BYTES:30*1024,CLEANUP_BATCH_SIZE:10},R=[{value:"x-ai/grok-4.1-fast",label:"Grok 4.1 Fast"},{value:"x-ai/grok-4",label:"Grok 4"},{value:"google/gemini-2.5-flash",label:"Gemini 2.5 Flash"},{value:"google/gemini-3-pro-preview",label:"Gemini 3 Pro"},{value:"openai/gpt-5-mini",label:"GPT-5 Mini"},{value:"openai/gpt-5.1",label:"GPT-5.1"},{value:"anthropic/claude-haiku-4.5",label:"Claude Haiku 4.5"},{value:"anthropic/claude-sonnet-4.5",label:"Claude Sonnet 4.5"}],C=[{value:"google/gemini-2.5-flash-lite-preview-09-2025",label:"Gemini 2.5 Flash Lite"},{value:"x-ai/grok-4.1-fast",label:"Grok 4.1 Fast"}],M=[{value:"auto",label:"\u{1F310} Auto"},{value:"en",label:"\u{1F1FA}\u{1F1F8} English"},{value:"zh-TW",label:"\u{1F1ED}\u{1F1F0} Chinese"}],d={MODEL_SUMMARIZER:"x-ai/grok-4.1-fast",MODEL_REFINER:"google/gemini-2.5-flash-lite-preview-09-2025",AUTO_GENERATE:!1,SHOW_SUBTITLES:!0,CAPTION_FONT_SIZE:"M",SUMMARY_FONT_SIZE:"M",TARGET_LANGUAGE_RECOMMENDED:"auto",TARGET_LANGUAGE_CUSTOM:""},v={CAPTION:{S:{base:"1.4vw",max:"22px",min:"12px",fullscreen:"1.7vw",fullscreenMax:"28px"},M:{base:"1.8vw",max:"28px",min:"14px",fullscreen:"2.2vw",fullscreenMax:"36px"},L:{base:"2.2vw",max:"34px",min:"16px",fullscreen:"2.7vw",fullscreenMax:"44px"}},SUMMARY:{S:{base:"13px",h2:"17px",h3:"15px"},M:{base:"15px",h2:"20px",h3:"17px"},L:{base:"17px",h2:"23px",h3:"19px"}}};var f={FETCH_SUBTITLES:"fetchSubtitles",GENERATE_SUBTITLES:"generateSubtitles",GENERATE_SUMMARY:"generateSummary",SUBTITLES_GENERATED:"subtitlesGenerated",SUMMARY_GENERATED:"summaryGenerated",UPDATE_POPUP_STATUS:"updatePopupStatus",TOGGLE_SUBTITLES:"toggleSubtitles",GET_VIDEO_TITLE:"getVideoTitle",SHOW_ERROR:"showError",UPDATE_CAPTION_FONT_SIZE:"updateCaptionFontSize"};var te="Better YouTube Caption:",oe=!0,g=(...e)=>{oe&&console.log(te,...e)};function L(e){return new Promise(t=>{chrome.storage.local.get([e],o=>{t(o[e]||null)})})}function E(e,t){let o={[e]:t};chrome.storage.local.set(o,()=>{g("Auto-saved:",e,t)})}function S(e){try{return new URL(e).searchParams.get("v")}catch(t){return console.error("Error extracting video ID:",e,t),null}}function T(e){return{anthropic:"images/anthropic.svg",google:"images/google.svg",openai:"images/openai.svg","x-ai":"images/xai.svg"}[e]||""}function I(e,t){let o=document.createElement("div");o.className="select-item",o.dataset.value=e.value;let r=document.createElement("span");if(r.className="item-icon",t==="targetLanguage"){let i=(e.label||e.value).match(/^(\p{Emoji}+)\s*(.+)$/u);if(i){let c=i[1];r.textContent=c,r.style.fontSize="16px",r.style.lineHeight="16px",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center"}}else{let s=e.value.split("/")[0],i=T(s);if(i){let c=document.createElement("img");c.src=i,c.alt=s,c.width=16,c.height=16,r.appendChild(c)}}o.appendChild(r);let n=document.createElement("span");if(n.className="item-label",t==="targetLanguage"){let s=e.label||e.value,i=s.match(/^(\p{Emoji}+)\s*(.+)$/u);n.textContent=i?i[2].trim():s}else n.textContent=e.label||e.value;return o.appendChild(n),o}function O(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function D(e){return e=e.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/__(.+?)__/g,"<strong>$1</strong>"),e=e.replace(/(?<!\*)\*([^*]+?)\*(?!\*)/g,"<em>$1</em>"),e=e.replace(/(?<!_)_([^_]+?)_(?!_)/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e.split(/(<[^>]+>)/g).map((r,n)=>n%2===1?r:O(r)).join("")}function x(e){if(!e||typeof e!="string")return'<div class="summary-placeholder">No summary available</div>';let t=e.split(`
`),o=[],r=!1,n=!1;for(let s=0;s<t.length;s++){let i=t[s].trim();if(!i){r&&(o.push("</ul>"),r=!1),n&&(o.push("</p>"),n=!1);continue}if(i.match(/^###\s+(.+)$/)){r&&(o.push("</ul>"),r=!1),n&&(o.push("</p>"),n=!1);let c=i.replace(/^###\s+/,"");o.push(`<h3>${O(c)}</h3>`)}else if(i.match(/^##\s+(.+)$/)){r&&(o.push("</ul>"),r=!1),n&&(o.push("</p>"),n=!1);let c=i.replace(/^##\s+/,"");o.push(`<h2>${O(c)}</h2>`)}else if(i.match(/^#\s+(.+)$/)){r&&(o.push("</ul>"),r=!1),n&&(o.push("</p>"),n=!1);let c=i.replace(/^#\s+/,"");o.push(`<h2>${O(c)}</h2>`)}else if(i.match(/^[\*\-•]\s+(.+)$/)){n&&(o.push("</p>"),n=!1),r||(o.push("<ul>"),r=!0);let c=i.replace(/^[\*\-•]\s+/,"");o.push(`<li>${D(c)}</li>`)}else r&&(o.push("</ul>"),r=!1),n?o.push("<br>"):(o.push("<p>"),n=!0),o.push(D(i))}return r&&o.push("</ul>"),n&&o.push("</p>"),o.join("")}function G(e,t){t.innerHTML=x(e)}function w(){document.querySelectorAll(".combobox[data-combobox-type]").forEach(t=>{let o=t.dataset.comboboxType,r=t.querySelector(".combobox-input"),n=t.querySelector(".combobox-arrow"),s=t.querySelector(".combobox-dropdown"),i=t.querySelector(".combobox-icon");if(!r||!n||!s||!i)return;s.innerHTML="";let c=[],l={};o==="targetLanguage"?(c=M,l={recommended:a.TARGET_LANGUAGE_RECOMMENDED,custom:a.TARGET_LANGUAGE_CUSTOM}):o==="summarizer"?(c=R,l={recommended:a.SUMMARIZER_RECOMMENDED_MODEL,custom:a.SUMMARIZER_CUSTOM_MODEL}):o==="refiner"&&(c=C,l={recommended:a.REFINER_RECOMMENDED_MODEL,custom:a.REFINER_CUSTOM_MODEL}),c.forEach(u=>{let m=re(u,o);s.appendChild(m)}),n.addEventListener("click",u=>{u.stopPropagation(),ne(t)}),r.addEventListener("focus",()=>{t.classList.add("open"),s.classList.add("show")}),r.addEventListener("input",u=>{se(t,u.target.value);let m=u.target.value.trim();(o==="summarizer"||o==="refiner")&&m&&N(t,m),m&&l.custom?(E(l.custom,m),l.recommended&&E(l.recommended,"")):(l.custom&&E(l.custom,""),(o==="summarizer"||o==="refiner")&&i&&(i.innerHTML=""))}),s.addEventListener("click",u=>{let m=u.target.closest(".combobox-item");if(!m)return;let p=m.dataset.value;r.value=p,o==="targetLanguage"?P(t,p):(o==="summarizer"||o==="refiner")&&N(t,p),s.querySelectorAll(".combobox-item").forEach(h=>{h.classList.remove("selected")}),m.classList.add("selected"),t.classList.remove("open"),s.classList.remove("show"),l.recommended&&E(l.recommended,p),l.custom&&E(l.custom,"")}),document.addEventListener("click",u=>{t.contains(u.target)||(t.classList.remove("open"),s.classList.remove("show"))})})}function re(e,t){let o=document.createElement("div");o.className="combobox-item",o.dataset.value=e.value;let r=document.createElement("span");if(r.className="combobox-item-icon",t==="targetLanguage"){let s=e.label.match(/^(\p{Emoji}+)\s*(.+)$/u);s&&(r.textContent=s[1])}else if(t==="summarizer"||t==="refiner"){let s=e.value.split("/")[0],i=T(s);if(i){let c=document.createElement("img");c.src=i,c.alt=s,c.width=16,c.height=16,r.appendChild(c)}}o.appendChild(r);let n=document.createElement("span");if(n.className="combobox-item-label",t==="targetLanguage"){let s=e.label.match(/^(\p{Emoji}+)\s*(.+)$/u);s?n.textContent=s[2].trim():n.textContent=e.label}else n.textContent=e.label;return o.appendChild(n),o}function ne(e){let t=e.querySelector(".combobox-dropdown"),o=e.classList.contains("open");if(document.querySelectorAll(".combobox.open").forEach(r=>{r!==e&&(r.classList.remove("open"),r.querySelector(".combobox-dropdown").classList.remove("show"))}),o)e.classList.remove("open"),t.classList.remove("show");else{e.classList.add("open"),t.classList.add("show");let r=e.querySelector(".combobox-input");r&&r.focus()}}function se(e,t){let r=e.querySelector(".combobox-dropdown").querySelectorAll(".combobox-item"),n=t.toLowerCase().trim();r.forEach(s=>{let i=s.querySelector(".combobox-item-label").textContent.toLowerCase(),c=s.dataset.value.toLowerCase();!n||i.includes(n)||c.includes(n)?s.style.display="flex":s.style.display="none"})}function P(e,t){let o=e.querySelector(".combobox-icon");if(!o)return;let r=M.find(n=>n.value===t);if(r){let n=r.label.match(/^(\p{Emoji}+)\s*(.+)$/u);n?o.textContent=n[1]:o.textContent=""}else o.textContent=""}function N(e,t){let o=e.querySelector(".combobox-icon");if(o&&(o.innerHTML="",t)){let r=t.split("/")[0],n=T(r);if(n){let s=document.createElement("img");s.src=n,s.alt=r,s.width=16,s.height=16,o.appendChild(s)}}}function b(e,t){let o=document.querySelector(`[data-combobox-type="${e}"]`);if(!o)return;let r=o.querySelector(".combobox-input"),n=o.querySelector(".combobox-icon");if(r){r.value=t||"",e==="targetLanguage"?P(o,t):(e==="summarizer"||e==="refiner")&&N(o,t);let s=o.querySelector(".combobox-dropdown");s&&s.querySelectorAll(".combobox-item").forEach(i=>{i.classList.remove("selected"),i.dataset.value===t&&i.classList.add("selected")})}}function B(e){let t=v.SUMMARY[e]||v.SUMMARY.M,o=document.getElementById("summaryContent");o&&(o.style.setProperty("--summary-font-size-base",t.base),o.style.setProperty("--summary-font-size-h2",t.h2),o.style.setProperty("--summary-font-size-h3",t.h3))}function q(){chrome.storage.local.get([a.CAPTION_FONT_SIZE,a.SUMMARY_FONT_SIZE],e=>{let t=e[a.CAPTION_FONT_SIZE]||d.CAPTION_FONT_SIZE,o=e[a.SUMMARY_FONT_SIZE]||d.SUMMARY_FONT_SIZE;document.querySelectorAll('.font-size-button[data-type="caption"]').forEach(r=>{r.dataset.size===t?r.classList.add("active"):r.classList.remove("active")}),document.querySelectorAll('.font-size-button[data-type="summary"]').forEach(r=>{r.dataset.size===o?r.classList.add("active"):r.classList.remove("active")}),B(o)}),document.querySelectorAll(".font-size-button").forEach(e=>{e.addEventListener("click",function(){let t=this.dataset.size,o=this.dataset.type;document.querySelectorAll(`.font-size-button[data-type="${o}"]`).forEach(n=>{n.classList.remove("active")}),this.classList.add("active");let r=o==="caption"?a.CAPTION_FONT_SIZE:a.SUMMARY_FONT_SIZE;E(r,t),o==="caption"?chrome.tabs.query({active:!0,currentWindow:!0},n=>{let s=n[0];s&&s.url&&s.url.includes("youtube.com/watch")&&chrome.tabs.sendMessage(s.id,{action:f.UPDATE_CAPTION_FONT_SIZE,fontSize:t},()=>{chrome.runtime.lastError&&g("Popup: Unable to update caption font size:",chrome.runtime.lastError.message)})}):B(t)})})}function F(e){chrome.storage.local.get([a.SCRAPE_CREATORS_API_KEY,a.OPENROUTER_API_KEY,a.SUMMARIZER_RECOMMENDED_MODEL,a.SUMMARIZER_CUSTOM_MODEL,a.REFINER_RECOMMENDED_MODEL,a.REFINER_CUSTOM_MODEL,a.AUTO_GENERATE,a.SHOW_SUBTITLES,a.TARGET_LANGUAGE_RECOMMENDED,a.TARGET_LANGUAGE_CUSTOM],t=>{t[a.SCRAPE_CREATORS_API_KEY]&&e.scrapeApiKey&&(e.scrapeApiKey.value=t[a.SCRAPE_CREATORS_API_KEY]),t[a.OPENROUTER_API_KEY]&&e.openrouterApiKey&&(e.openrouterApiKey.value=t[a.OPENROUTER_API_KEY]),e.autoGenerateToggle&&(e.autoGenerateToggle.checked=t[a.AUTO_GENERATE]===!0);let o=t[a.SHOW_SUBTITLES]!==void 0?t[a.SHOW_SUBTITLES]:d.SHOW_SUBTITLES;e.showSubtitlesToggle&&(e.showSubtitlesToggle.checked=o===!0);let r=t[a.SUMMARIZER_CUSTOM_MODEL]?.trim(),n=t[a.SUMMARIZER_RECOMMENDED_MODEL]||d.MODEL_SUMMARIZER;b("summarizer",r||n);let i=t[a.REFINER_CUSTOM_MODEL]?.trim(),c=t[a.REFINER_RECOMMENDED_MODEL]||d.MODEL_REFINER;b("refiner",i||c);let u=t[a.TARGET_LANGUAGE_CUSTOM]?.trim(),m=t[a.TARGET_LANGUAGE_RECOMMENDED]||d.TARGET_LANGUAGE_RECOMMENDED;b("targetLanguage",u||m)})}function z(e){e.scrapeApiKey&&e.scrapeApiKey.addEventListener("input",function(){E(a.SCRAPE_CREATORS_API_KEY,this.value.trim())}),e.openrouterApiKey&&e.openrouterApiKey.addEventListener("input",function(){E(a.OPENROUTER_API_KEY,this.value.trim())}),e.autoGenerateToggle&&e.autoGenerateToggle.addEventListener("change",function(){E(a.AUTO_GENERATE,this.checked)}),e.showSubtitlesToggle&&e.showSubtitlesToggle.addEventListener("change",function(){let t=this.checked;E(a.SHOW_SUBTITLES,t),chrome.tabs.query({active:!0,currentWindow:!0},o=>{let r=o[0];r&&r.url&&r.url.includes("youtube.com/watch")&&chrome.tabs.sendMessage(r.id,{action:f.TOGGLE_SUBTITLES,showSubtitles:t,enabled:t},()=>{chrome.runtime.lastError&&g("Popup: Unable to toggle subtitles:",chrome.runtime.lastError.message)})})})}function Y(e){let t=e[a.SUMMARIZER_CUSTOM_MODEL]?.trim(),o=e[a.SUMMARIZER_RECOMMENDED_MODEL]?.trim();return t||o||d.MODEL_SUMMARIZER}function U(e){let t=e[a.REFINER_CUSTOM_MODEL]?.trim(),o=e[a.REFINER_RECOMMENDED_MODEL]?.trim();return t||o||d.MODEL_REFINER}function K(e){let t=e[a.TARGET_LANGUAGE_CUSTOM]?.trim(),o=e[a.TARGET_LANGUAGE_RECOMMENDED]?.trim();return t||o||d.TARGET_LANGUAGE_RECOMMENDED}async function A(){return new Promise(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{let o=t[0];o&&o.url&&o.url.includes("youtube.com/watch")?e(o):e(null)})})}async function y(e){if(e)try{let t=await A();if(!t){e.disabled=!0;return}let o=S(t.url);if(!o){e.disabled=!0;return}let r=await L(o);e.disabled=!r||!Array.isArray(r)||r.length===0}catch(t){console.error("Error checking refined captions:",t),e.disabled=!0}}function k(e,t,o){let r=e[a.SCRAPE_CREATORS_API_KEY],n=e[a.OPENROUTER_API_KEY];return r?n?!0:(t.textContent="Please enter OpenRouter API key in Settings",t.className="status error",o(),!1):(t.textContent="Please enter Scrape Creators API key in Settings",t.className="status error",o(),!1)}async function Z(e,t){e.generateSummaryBtn.disabled||e.generateCaptionBtn.disabled||(e.status.textContent="",e.status.className="status",chrome.storage.local.get([a.SCRAPE_CREATORS_API_KEY,a.OPENROUTER_API_KEY,a.SUMMARIZER_RECOMMENDED_MODEL,a.SUMMARIZER_CUSTOM_MODEL,a.REFINER_RECOMMENDED_MODEL,a.REFINER_CUSTOM_MODEL,a.TARGET_LANGUAGE_RECOMMENDED,a.TARGET_LANGUAGE_CUSTOM],async o=>{if(!k(o,e.status,t))return;let r=e.summarizerInput?.value.trim()||Y(o),n=e.refinerInput?.value.trim()||U(o),s=e.targetLanguageInput?.value.trim()||K(o);e.status.textContent="Generating summary...",e.generateSummaryBtn.disabled=!0,e.generateCaptionBtn.disabled=!0,e.summaryContent.innerHTML='<div class="summary-placeholder">Generating summary, please wait...</div>';let i=await A();if(!i){e.status.textContent="Not a YouTube video page",e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1;return}let c=S(i.url);if(!c){e.status.textContent="Could not extract video ID",e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1;return}chrome.tabs.sendMessage(i.id,{action:f.GENERATE_SUMMARY,videoId:c,scrapeCreatorsApiKey:o[a.SCRAPE_CREATORS_API_KEY],openRouterApiKey:o[a.OPENROUTER_API_KEY],modelSelection:r,targetLanguage:s},l=>{if(chrome.runtime.lastError)e.status.textContent="Error: "+chrome.runtime.lastError.message,e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1,e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>';else if(l&&l.status==="started")e.status.textContent="Processing video transcript...";else if(l&&l.status==="error"){let u=l.message||"Unknown error";e.status.textContent="Error: "+u,e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1,u.includes("already in progress")||(e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>')}})}))}async function $(e,t){e.generateSummaryBtn.disabled||e.generateCaptionBtn.disabled||(e.status.textContent="",e.status.className="status",chrome.storage.local.get([a.SCRAPE_CREATORS_API_KEY,a.OPENROUTER_API_KEY,a.REFINER_RECOMMENDED_MODEL,a.REFINER_CUSTOM_MODEL],async o=>{if(!k(o,e.status,t))return;let r=e.refinerInput?.value.trim()||U(o);e.status.textContent="Generating refined captions...",e.generateCaptionBtn.disabled=!0,e.generateSummaryBtn.disabled=!0;let n=await A();if(!n){e.status.textContent="Not a YouTube video page",e.status.className="status error",e.generateCaptionBtn.disabled=!1,e.generateSummaryBtn.disabled=!1;return}let s=S(n.url);if(!s){e.status.textContent="Could not extract video ID",e.status.className="status error",e.generateCaptionBtn.disabled=!1,e.generateSummaryBtn.disabled=!1;return}chrome.tabs.sendMessage(n.id,{action:f.GENERATE_SUBTITLES,videoId:s,scrapeCreatorsApiKey:o[a.SCRAPE_CREATORS_API_KEY],openRouterApiKey:o[a.OPENROUTER_API_KEY],modelSelection:r,forceRegenerate:!0},i=>{chrome.runtime.lastError?(e.status.textContent="Error: "+chrome.runtime.lastError.message,e.status.className="status error",e.generateCaptionBtn.disabled=!1,e.generateSummaryBtn.disabled=!1):i&&i.status==="started"?e.status.textContent="Fetching and refining transcript...":i&&i.status==="error"&&(e.status.textContent="Error: "+(i.message||"Unknown error"),e.status.className="status error",e.generateCaptionBtn.disabled=!1,e.generateSummaryBtn.disabled=!1)})}))}async function H(e){try{let t=await A();if(!t)return;let o=S(t.url);if(!o)return;chrome.storage.local.get([`summary_${o}`],r=>{r[`summary_${o}`]&&e.summaryContent&&(g("Popup: Found existing summary for video:",o),G(r[`summary_${o}`],e.summaryContent))})}catch(t){g("Popup: Error loading existing summary:",t)}}function V(e,t){let o={},r=0;e.summarizerCustomModel&&e.summarizerCustomModel.value.trim()&&(e.summarizerCustomModel.value="",o[a.SUMMARIZER_CUSTOM_MODEL]="",r++),e.refinerCustomModel&&e.refinerCustomModel.value.trim()&&(e.refinerCustomModel.value="",o[a.REFINER_CUSTOM_MODEL]="",r++),Object.keys(o).length>0?(chrome.storage.local.set(o,()=>{console.log("Popup: Cleared invalid custom models")}),alert(`Model Error: ${t}

Invalid custom model input detected and cleared. Now using recommended models for summarizer and refiner. Please check your custom model entries if needed.`)):alert(`Model Error: ${t}

Please check your model selection in Settings and ensure it's a valid OpenRouter model ID.`)}function W(e){return typeof e=="string"?e.toLowerCase():e instanceof Error?e.message.toLowerCase():typeof e=="object"&&e!==null?e.message?String(e.message).toLowerCase():e.error?W(e.error):JSON.stringify(e).toLowerCase():String(e).toLowerCase()}function j(e){let t=W(e);return t.includes("invalid model")||t.includes("not a valid model id")||t.includes("model not found")||t.includes("openrouter")}function X(e){chrome.runtime.onMessage.addListener((t,o,r)=>{if(t.action===f.SHOW_ERROR){e.status.className="status error";let n=typeof t.error=="string"?t.error:t.error?.message||JSON.stringify(t.error)||"Unknown error",s=j(t.error);s&&(e.summarizerCustomModel||e.refinerCustomModel)?V(e,n):s?alert(`Model Error: ${n}

Please check your model selection in Settings and ensure it's a valid OpenRouter model ID.`):e.status.textContent=`Error: ${n}`}else if(t.action===f.UPDATE_POPUP_STATUS)if(t.error){e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1,e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>';let n=typeof t.error=="string"?t.error:t.error?.message||JSON.stringify(t.error)||"Unknown error";j(t.error)&&(e.summarizerCustomModel||e.refinerCustomModel)?V(e,n):e.status.textContent=t.text||`Error: ${n}`}else t.success?(e.status.className="status success",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1,y(e.copyCaptionBtn)):(e.status.textContent=t.text,t.text&&(t.text.includes("ready")||t.text.includes("complete")||t.text.includes("success"))&&setTimeout(()=>{y(e.copyCaptionBtn)},500));else t.action==="SUMMARY_GENERATED"&&(t.summary&&(ae(t.summary,e.summaryContent),e.status.textContent="Summary generated successfully!",e.status.className="status success",setTimeout(()=>{e.status.textContent="",e.status.className="status"},3e3)),e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1)})}function ae(e,t){t.innerHTML=x(e)}function Q(){document.querySelectorAll(".custom-select").forEach(t=>{let o=t.dataset.modelType,r=t.querySelector(".select-items"),n=t.querySelector('input[type="hidden"]');if(!r||!n)return;let s,i;if(o==="summarizer")s=R,i=d.MODEL_SUMMARIZER;else if(o==="refiner")s=C,i=d.MODEL_REFINER;else if(o==="targetLanguage")s=M,i=d.TARGET_LANGUAGE_RECOMMENDED;else return;if(r.innerHTML="",Array.isArray(s)&&s.length>0&&s.forEach(c=>{let l=I(c,o);r.appendChild(l)}),i&&!s.some(c=>c.value===i)){let l=I({value:i,label:i},o);r.appendChild(l)}ie(t,n)}),document.addEventListener("click",t=>{t.target.closest(".custom-select")||(document.querySelectorAll(".custom-select.open").forEach(o=>{o.classList.remove("open")}),document.querySelectorAll(".select-items.show").forEach(o=>{o.classList.remove("show")}))})}function ie(e,t){let o=e.querySelector(".select-selected"),r=e.querySelector(".select-items");!o||!r||(o.addEventListener("click",n=>{n.stopPropagation();let s=e.classList.contains("open");document.querySelectorAll(".custom-select.open").forEach(i=>{i.classList.remove("open")}),document.querySelectorAll(".select-items.show").forEach(i=>{i.classList.remove("show")}),s||(e.classList.add("open"),r.classList.add("show"))}),r.addEventListener("click",n=>{let s=n.target.closest(".select-item");if(!s)return;let i=s.dataset.value,c=s.querySelector(".item-label").textContent,l=e.dataset.modelType,u=o.querySelector(".select-icon");if(u.innerHTML="",l==="targetLanguage"){let p=s.querySelector(".item-icon");p&&p.textContent&&(u.textContent=p.textContent,u.style.fontSize="16px",u.style.lineHeight="16px",u.style.display="flex",u.style.alignItems="center",u.style.justifyContent="center")}else{let p=i.split("/")[0],h=T(p);if(h){let _=document.createElement("img");_.src=h,_.alt=p,_.width=16,_.height=16,u.appendChild(_)}}let m=o.querySelector(".select-label");m&&(m.textContent=c),e.classList.remove("open"),r.classList.remove("show"),r.querySelectorAll(".select-item").forEach(p=>{p.classList.remove("selected")}),s.classList.add("selected"),t.value=i,E(t.id,i)}))}function J(){let e=document.querySelectorAll(".info-icon"),t=new Map;e.forEach(o=>{let r=o.parentElement;(!r||!r.classList.contains("info-icon-wrapper"))&&(r=document.createElement("span"),r.className="info-icon-wrapper",o.parentNode.insertBefore(r,o),r.appendChild(o));let n=document.createElement("div");n.className="info-tooltip",n.textContent=o.getAttribute("data-tooltip"),r.appendChild(n),t.set(o,{tooltip:n,hideTimeout:null}),ce(o,t.get(o))})}function ce(e,t){let{tooltip:o,hideTimeout:r}=t;e.addEventListener("mouseenter",function(){t.hideTimeout&&(clearTimeout(t.hideTimeout),t.hideTimeout=null),o.classList.remove("hide"),o.classList.add("show")}),e.addEventListener("mouseleave",function(n){t.hideTimeout=setTimeout(()=>{o.classList.remove("show"),o.classList.add("hide"),t.hideTimeout=null},2e3)}),o.addEventListener("mouseenter",function(){t.hideTimeout&&(clearTimeout(t.hideTimeout),t.hideTimeout=null),o.classList.remove("hide"),o.classList.add("show")}),o.addEventListener("mouseleave",function(){t.hideTimeout=setTimeout(()=>{o.classList.remove("show"),o.classList.add("hide"),t.hideTimeout=null},500)})}document.addEventListener("DOMContentLoaded",function(){let e={mainView:document.getElementById("mainView"),settingsView:document.getElementById("settingsView"),settingsBtn:document.getElementById("settingsBtn"),backBtn:document.getElementById("backBtn"),generateSummaryBtn:document.getElementById("generateSummaryBtn"),generateCaptionBtn:document.getElementById("generateCaptionBtn"),copyCaptionBtn:document.getElementById("copyCaptionBtn"),summaryContent:document.getElementById("summaryContent"),status:document.getElementById("status"),scrapeApiKey:document.getElementById("scrapeApiKey"),openrouterApiKey:document.getElementById("openrouterApiKey"),summarizerInput:document.getElementById("summarizerInput"),refinerInput:document.getElementById("refinerInput"),autoGenerateToggle:document.getElementById("autoGenerateToggle"),showSubtitlesToggle:document.getElementById("showSubtitlesToggle"),targetLanguageInput:document.getElementById("targetLanguageInput")};function t(){e.mainView.classList.add("active"),e.settingsView.classList.remove("active")}function o(){e.mainView.classList.remove("active"),e.settingsView.classList.add("active")}e.settingsBtn&&e.settingsBtn.addEventListener("click",o),e.backBtn&&e.backBtn.addEventListener("click",t);async function r(){if(!e.copyCaptionBtn?.disabled)try{let n=await new Promise(l=>{chrome.tabs.query({active:!0,currentWindow:!0},u=>{l(u[0])})});if(!n||!n.url||!n.url.includes("youtube.com/watch")){e.status.textContent="Not a YouTube video page",e.status.className="status error";return}let s=S(n.url);if(!s){e.status.textContent="Could not extract video ID",e.status.className="status error";return}let i=await L(s);if(!i||!Array.isArray(i)||i.length===0){e.status.textContent="No refined captions available",e.status.className="status error";return}let c=i.map(l=>(l.text||"").replace(/\n/g," ").trim()).filter(l=>l.length>0).join(" ");await navigator.clipboard.writeText(c),e.status.textContent="Refined caption copied to clipboard!",e.status.className="status success",setTimeout(()=>{e.status.textContent="",e.status.className="status"},2e3)}catch(n){console.error("Error copying refined caption:",n),e.status.textContent="Failed to copy caption",e.status.className="status error"}}Q(),w(),F(e),z(e),q(e),J(),X(e),H(e),y(e.copyCaptionBtn),e.generateSummaryBtn&&e.generateSummaryBtn.addEventListener("click",()=>{Z(e,o)}),e.generateCaptionBtn&&e.generateCaptionBtn.addEventListener("click",()=>{$(e,o)}),e.copyCaptionBtn&&e.copyCaptionBtn.addEventListener("click",r)});})();
//# sourceMappingURL=popup.bundle.js.map
