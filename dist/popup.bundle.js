(()=>{var n={SCRAPE_CREATORS_API_KEY:"scrapeCreatorsApiKey",OPENROUTER_API_KEY:"openRouterApiKey",SUMMARIZER_RECOMMENDED_MODEL:"summarizerRecommendedModel",SUMMARIZER_CUSTOM_MODEL:"summarizerCustomModel",REFINER_RECOMMENDED_MODEL:"refinerRecommendedModel",REFINER_CUSTOM_MODEL:"refinerCustomModel",AUTO_GENERATE:"autoGenerate",SHOW_SUBTITLES:"showSubtitles",CAPTION_FONT_SIZE:"captionFontSize",SUMMARY_FONT_SIZE:"summaryFontSize",TARGET_LANGUAGE_RECOMMENDED:"targetLanguageRecommended",TARGET_LANGUAGE_CUSTOM:"targetLanguageCustom"};var X={QUOTA_BYTES:10*1024*1024,MAX_STORAGE_BYTES:9.5*1024*1024,ESTIMATED_VIDEO_SIZE_BYTES:30*1024,CLEANUP_BATCH_SIZE:10},v=[{value:"x-ai/grok-4.1-fast",label:"Grok 4.1 Fast"},{value:"x-ai/grok-4",label:"Grok 4"},{value:"google/gemini-2.5-flash",label:"Gemini 2.5 Flash"},{value:"google/gemini-3-pro-preview",label:"Gemini 3 Pro"},{value:"openai/gpt-5-mini",label:"GPT-5 Mini"},{value:"openai/gpt-5.1",label:"GPT-5.1"},{value:"anthropic/claude-haiku-4.5",label:"Claude Haiku 4.5"},{value:"anthropic/claude-sonnet-4.5",label:"Claude Sonnet 4.5"}],I=[{value:"google/gemini-2.5-flash-lite-preview-09-2025",label:"Gemini 2.5 Flash Lite"},{value:"x-ai/grok-4.1-fast",label:"Grok 4.1 Fast"}],C=[{value:"auto",label:"\u{1F310} Auto"},{value:"en",label:"\u{1F1FA}\u{1F1F8} English"},{value:"zh-TW",label:"\u{1F1ED}\u{1F1F0} Chinese"}],m={MODEL_SUMMARIZER:"x-ai/grok-4.1-fast",MODEL_REFINER:"google/gemini-2.5-flash-lite-preview-09-2025",AUTO_GENERATE:!1,SHOW_SUBTITLES:!0,CAPTION_FONT_SIZE:"M",SUMMARY_FONT_SIZE:"M",TARGET_LANGUAGE_RECOMMENDED:"auto",TARGET_LANGUAGE_CUSTOM:""},h={CAPTION:{S:{base:"1.4vw",max:"22px",min:"12px",fullscreen:"1.7vw",fullscreenMax:"28px"},M:{base:"1.8vw",max:"28px",min:"14px",fullscreen:"2.2vw",fullscreenMax:"36px"},L:{base:"2.2vw",max:"34px",min:"16px",fullscreen:"2.7vw",fullscreenMax:"44px"}},SUMMARY:{S:{base:"13px",h2:"17px",h3:"15px"},M:{base:"15px",h2:"20px",h3:"17px"},L:{base:"17px",h2:"23px",h3:"19px"}}};var p={FETCH_SUBTITLES:"fetchSubtitles",GENERATE_SUBTITLES:"generateSubtitles",GENERATE_SUMMARY:"generateSummary",SUBTITLES_GENERATED:"subtitlesGenerated",SUMMARY_GENERATED:"summaryGenerated",UPDATE_POPUP_STATUS:"updatePopupStatus",TOGGLE_SUBTITLES:"toggleSubtitles",GET_VIDEO_TITLE:"getVideoTitle",SHOW_ERROR:"showError",UPDATE_CAPTION_FONT_SIZE:"updateCaptionFontSize"};var Q="Better YouTube Caption:",J=!0,f=(...e)=>{J&&console.log(Q,...e)};function M(e){return new Promise(t=>{chrome.storage.local.get([e],o=>{t(o[e]||null)})})}function d(e,t){let o={[e]:t};chrome.storage.local.set(o,()=>{f("Auto-saved:",e,t)})}function g(e){try{return new URL(e).searchParams.get("v")}catch(t){return console.error("Error extracting video ID:",e,t),null}}function y(e){return{anthropic:"images/anthropic.svg",google:"images/google.svg",openai:"images/openai.svg","x-ai":"images/xai.svg"}[e]||""}function A(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}function N(e){return e=e.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/__(.+?)__/g,"<strong>$1</strong>"),e=e.replace(/(?<!\*)\*([^*]+?)\*(?!\*)/g,"<em>$1</em>"),e=e.replace(/(?<!_)_([^_]+?)_(?!_)/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e.split(/(<[^>]+>)/g).map((r,a)=>a%2===1?r:A(r)).join("")}function O(e){if(!e||typeof e!="string")return'<div class="summary-placeholder">No summary available</div>';let t=e.split(`
`),o=[],r=!1,a=!1;for(let s=0;s<t.length;s++){let i=t[s].trim();if(!i){r&&(o.push("</ul>"),r=!1),a&&(o.push("</p>"),a=!1);continue}if(i.match(/^###\s+(.+)$/)){r&&(o.push("</ul>"),r=!1),a&&(o.push("</p>"),a=!1);let c=i.replace(/^###\s+/,"");o.push(`<h3>${A(c)}</h3>`)}else if(i.match(/^##\s+(.+)$/)){r&&(o.push("</ul>"),r=!1),a&&(o.push("</p>"),a=!1);let c=i.replace(/^##\s+/,"");o.push(`<h2>${A(c)}</h2>`)}else if(i.match(/^#\s+(.+)$/)){r&&(o.push("</ul>"),r=!1),a&&(o.push("</p>"),a=!1);let c=i.replace(/^#\s+/,"");o.push(`<h2>${A(c)}</h2>`)}else if(i.match(/^[\*\-•]\s+(.+)$/)){a&&(o.push("</p>"),a=!1),r||(o.push("<ul>"),r=!0);let c=i.replace(/^[\*\-•]\s+/,"");o.push(`<li>${N(c)}</li>`)}else r&&(o.push("</ul>"),r=!1),a?o.push("<br>"):(o.push("<p>"),a=!0),o.push(N(i))}return r&&o.push("</ul>"),a&&o.push("</p>"),o.join("")}function x(e,t){t.innerHTML=O(e)}function U(){document.querySelectorAll(".combobox[data-combobox-type]").forEach(t=>{let o=t.dataset.comboboxType,r=t.querySelector(".combobox-input"),a=t.querySelector(".combobox-arrow"),s=t.querySelector(".combobox-dropdown"),i=t.querySelector(".combobox-icon");if(!r||!a||!s||!i)return;s.innerHTML="";let c=[],u={};o==="targetLanguage"?(c=C,u={recommended:n.TARGET_LANGUAGE_RECOMMENDED,custom:n.TARGET_LANGUAGE_CUSTOM}):o==="summarizer"?(c=v,u={recommended:n.SUMMARIZER_RECOMMENDED_MODEL,custom:n.SUMMARIZER_CUSTOM_MODEL}):o==="refiner"&&(c=I,u={recommended:n.REFINER_RECOMMENDED_MODEL,custom:n.REFINER_CUSTOM_MODEL}),c.forEach(l=>{let E=ee(l,o);s.appendChild(E)}),a.addEventListener("click",l=>{l.stopPropagation(),te(t)}),r.addEventListener("focus",()=>{t.classList.add("open"),s.classList.add("show")}),r.addEventListener("input",l=>{oe(t,l.target.value);let E=l.target.value.trim();(o==="summarizer"||o==="refiner")&&E&&L(t,E),E&&u.custom?(d(u.custom,E),u.recommended&&d(u.recommended,"")):(u.custom&&d(u.custom,""),(o==="summarizer"||o==="refiner")&&i&&(i.innerHTML=""))}),s.addEventListener("click",l=>{let E=l.target.closest(".combobox-item");if(!E)return;let S=E.dataset.value;r.value=S,o==="targetLanguage"?D(t,S):(o==="summarizer"||o==="refiner")&&L(t,S),s.querySelectorAll(".combobox-item").forEach(W=>{W.classList.remove("selected")}),E.classList.add("selected"),t.classList.remove("open"),s.classList.remove("show"),u.recommended&&d(u.recommended,S),u.custom&&d(u.custom,"")}),document.addEventListener("click",l=>{t.contains(l.target)||(t.classList.remove("open"),s.classList.remove("show"))})})}function ee(e,t){let o=document.createElement("div");o.className="combobox-item",o.dataset.value=e.value;let r=document.createElement("span");if(r.className="combobox-item-icon",t==="targetLanguage"){let s=e.label.match(/^(\p{Emoji}+)\s*(.+)$/u);s&&(r.textContent=s[1])}else if(t==="summarizer"||t==="refiner"){let s=e.value.split("/")[0],i=y(s);if(i){let c=document.createElement("img");c.src=i,c.alt=s,c.width=16,c.height=16,r.appendChild(c)}}o.appendChild(r);let a=document.createElement("span");if(a.className="combobox-item-label",t==="targetLanguage"){let s=e.label.match(/^(\p{Emoji}+)\s*(.+)$/u);s?a.textContent=s[2].trim():a.textContent=e.label}else a.textContent=e.label;return o.appendChild(a),o}function te(e){let t=e.querySelector(".combobox-dropdown"),o=e.classList.contains("open");if(document.querySelectorAll(".combobox.open").forEach(r=>{r!==e&&(r.classList.remove("open"),r.querySelector(".combobox-dropdown").classList.remove("show"))}),o)e.classList.remove("open"),t.classList.remove("show");else{e.classList.add("open"),t.classList.add("show");let r=e.querySelector(".combobox-input");r&&r.focus()}}function oe(e,t){let r=e.querySelector(".combobox-dropdown").querySelectorAll(".combobox-item"),a=t.toLowerCase().trim();r.forEach(s=>{let i=s.querySelector(".combobox-item-label").textContent.toLowerCase(),c=s.dataset.value.toLowerCase();!a||i.includes(a)||c.includes(a)?s.style.display="flex":s.style.display="none"})}function D(e,t){let o=e.querySelector(".combobox-icon");if(!o)return;let r=C.find(a=>a.value===t);if(r){let a=r.label.match(/^(\p{Emoji}+)\s*(.+)$/u);a?o.textContent=a[1]:o.textContent=""}else o.textContent=""}function L(e,t){let o=e.querySelector(".combobox-icon");if(o&&(o.innerHTML="",t)){let r=t.split("/")[0],a=y(r);if(a){let s=document.createElement("img");s.src=a,s.alt=r,s.width=16,s.height=16,o.appendChild(s)}}}function R(e,t){let o=document.querySelector(`[data-combobox-type="${e}"]`);if(!o)return;let r=o.querySelector(".combobox-input"),a=o.querySelector(".combobox-icon");if(r){r.value=t||"",e==="targetLanguage"?D(o,t):(e==="summarizer"||e==="refiner")&&L(o,t);let s=o.querySelector(".combobox-dropdown");s&&s.querySelectorAll(".combobox-item").forEach(i=>{i.classList.remove("selected"),i.dataset.value===t&&i.classList.add("selected")})}}function G(e){let t=h.SUMMARY[e]||h.SUMMARY.M,o=document.getElementById("summaryContent");o&&(o.style.setProperty("--summary-font-size-base",t.base),o.style.setProperty("--summary-font-size-h2",t.h2),o.style.setProperty("--summary-font-size-h3",t.h3))}function w(){chrome.storage.local.get([n.CAPTION_FONT_SIZE,n.SUMMARY_FONT_SIZE],e=>{let t=e[n.CAPTION_FONT_SIZE]||m.CAPTION_FONT_SIZE,o=e[n.SUMMARY_FONT_SIZE]||m.SUMMARY_FONT_SIZE;document.querySelectorAll('.font-size-button[data-type="caption"]').forEach(r=>{r.dataset.size===t?r.classList.add("active"):r.classList.remove("active")}),document.querySelectorAll('.font-size-button[data-type="summary"]').forEach(r=>{r.dataset.size===o?r.classList.add("active"):r.classList.remove("active")}),G(o)}),document.querySelectorAll(".font-size-button").forEach(e=>{e.addEventListener("click",function(){let t=this.dataset.size,o=this.dataset.type;document.querySelectorAll(`.font-size-button[data-type="${o}"]`).forEach(a=>{a.classList.remove("active")}),this.classList.add("active");let r=o==="caption"?n.CAPTION_FONT_SIZE:n.SUMMARY_FONT_SIZE;d(r,t),o==="caption"?chrome.tabs.query({active:!0,currentWindow:!0},a=>{let s=a[0];s&&s.url&&s.url.includes("youtube.com/watch")&&chrome.tabs.sendMessage(s.id,{action:p.UPDATE_CAPTION_FONT_SIZE,fontSize:t},()=>{chrome.runtime.lastError&&f("Popup: Unable to update caption font size:",chrome.runtime.lastError.message)})}):G(t)})})}function P(e){chrome.storage.local.get([n.SCRAPE_CREATORS_API_KEY,n.OPENROUTER_API_KEY,n.SUMMARIZER_RECOMMENDED_MODEL,n.SUMMARIZER_CUSTOM_MODEL,n.REFINER_RECOMMENDED_MODEL,n.REFINER_CUSTOM_MODEL,n.AUTO_GENERATE,n.SHOW_SUBTITLES,n.TARGET_LANGUAGE_RECOMMENDED,n.TARGET_LANGUAGE_CUSTOM],t=>{t[n.SCRAPE_CREATORS_API_KEY]&&e.scrapeApiKey&&(e.scrapeApiKey.value=t[n.SCRAPE_CREATORS_API_KEY]),t[n.OPENROUTER_API_KEY]&&e.openrouterApiKey&&(e.openrouterApiKey.value=t[n.OPENROUTER_API_KEY]),e.autoGenerateToggle&&(e.autoGenerateToggle.checked=t[n.AUTO_GENERATE]===!0);let o=t[n.SHOW_SUBTITLES]!==void 0?t[n.SHOW_SUBTITLES]:m.SHOW_SUBTITLES;e.showSubtitlesToggle&&(e.showSubtitlesToggle.checked=o===!0);let r=t[n.SUMMARIZER_CUSTOM_MODEL]?.trim(),a=t[n.SUMMARIZER_RECOMMENDED_MODEL]||m.MODEL_SUMMARIZER;R("summarizer",r||a);let i=t[n.REFINER_CUSTOM_MODEL]?.trim(),c=t[n.REFINER_RECOMMENDED_MODEL]||m.MODEL_REFINER;R("refiner",i||c);let l=t[n.TARGET_LANGUAGE_CUSTOM]?.trim(),E=t[n.TARGET_LANGUAGE_RECOMMENDED]||m.TARGET_LANGUAGE_RECOMMENDED;R("targetLanguage",l||E)})}function B(e){e.scrapeApiKey&&e.scrapeApiKey.addEventListener("input",function(){d(n.SCRAPE_CREATORS_API_KEY,this.value.trim())}),e.openrouterApiKey&&e.openrouterApiKey.addEventListener("input",function(){d(n.OPENROUTER_API_KEY,this.value.trim())}),e.autoGenerateToggle&&e.autoGenerateToggle.addEventListener("change",function(){d(n.AUTO_GENERATE,this.checked)}),e.showSubtitlesToggle&&e.showSubtitlesToggle.addEventListener("change",function(){let t=this.checked;d(n.SHOW_SUBTITLES,t),chrome.tabs.query({active:!0,currentWindow:!0},o=>{let r=o[0];r&&r.url&&r.url.includes("youtube.com/watch")&&chrome.tabs.sendMessage(r.id,{action:p.TOGGLE_SUBTITLES,showSubtitles:t,enabled:t},()=>{chrome.runtime.lastError&&f("Popup: Unable to toggle subtitles:",chrome.runtime.lastError.message)})})})}function F(e){let t=e[n.SUMMARIZER_CUSTOM_MODEL]?.trim(),o=e[n.SUMMARIZER_RECOMMENDED_MODEL]?.trim();return t||o||m.MODEL_SUMMARIZER}function b(e){let t=e[n.REFINER_CUSTOM_MODEL]?.trim(),o=e[n.REFINER_RECOMMENDED_MODEL]?.trim();return t||o||m.MODEL_REFINER}function Y(e){let t=e[n.TARGET_LANGUAGE_CUSTOM]?.trim(),o=e[n.TARGET_LANGUAGE_RECOMMENDED]?.trim();return t||o||m.TARGET_LANGUAGE_RECOMMENDED}async function T(){return new Promise(e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{let o=t[0];o&&o.url&&o.url.includes("youtube.com/watch")?e(o):e(null)})})}async function _(e){if(e)try{let t=await T();if(!t){e.disabled=!0;return}let o=g(t.url);if(!o){e.disabled=!0;return}let r=await M(o);e.disabled=!r||!Array.isArray(r)||r.length===0}catch(t){console.error("Error checking refined captions:",t),e.disabled=!0}}function z(e,t,o){let r=e[n.SCRAPE_CREATORS_API_KEY],a=e[n.OPENROUTER_API_KEY];return r?a?!0:(t.textContent="Please enter OpenRouter API key in Settings",t.className="status error",o(),!1):(t.textContent="Please enter Scrape Creators API key in Settings",t.className="status error",o(),!1)}async function K(e,t){e.generateSummaryBtn.disabled||e.generateCaptionBtn.disabled||(e.status.textContent="",e.status.className="status",chrome.storage.local.get([n.SCRAPE_CREATORS_API_KEY,n.OPENROUTER_API_KEY,n.SUMMARIZER_RECOMMENDED_MODEL,n.SUMMARIZER_CUSTOM_MODEL,n.REFINER_RECOMMENDED_MODEL,n.REFINER_CUSTOM_MODEL,n.TARGET_LANGUAGE_RECOMMENDED,n.TARGET_LANGUAGE_CUSTOM],async o=>{if(!z(o,e.status,t))return;let r=e.summarizerInput?.value.trim()||F(o),a=e.refinerInput?.value.trim()||b(o),s=e.targetLanguageInput?.value.trim()||Y(o);e.status.textContent="Generating summary...",e.generateSummaryBtn.disabled=!0,e.generateCaptionBtn.disabled=!0,e.summaryContent.innerHTML='<div class="summary-placeholder">Generating summary, please wait...</div>';let i=await T();if(!i){e.status.textContent="Not a YouTube video page",e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1;return}let c=g(i.url);if(!c){e.status.textContent="Could not extract video ID",e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1;return}chrome.tabs.sendMessage(i.id,{action:p.GENERATE_SUMMARY,videoId:c,scrapeCreatorsApiKey:o[n.SCRAPE_CREATORS_API_KEY],openRouterApiKey:o[n.OPENROUTER_API_KEY],modelSelection:r,targetLanguage:s},u=>{if(chrome.runtime.lastError)e.status.textContent="Error: "+chrome.runtime.lastError.message,e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1,e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>';else if(u&&u.status==="started")e.status.textContent="Processing video transcript...";else if(u&&u.status==="error"){let l=u.message||"Unknown error";e.status.textContent="Error: "+l,e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1,l.includes("already in progress")||(e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>')}})}))}async function k(e,t){e.generateSummaryBtn.disabled||e.generateCaptionBtn.disabled||(e.status.textContent="",e.status.className="status",chrome.storage.local.get([n.SCRAPE_CREATORS_API_KEY,n.OPENROUTER_API_KEY,n.REFINER_RECOMMENDED_MODEL,n.REFINER_CUSTOM_MODEL],async o=>{if(!z(o,e.status,t))return;let r=e.refinerInput?.value.trim()||b(o);e.status.textContent="Generating refined captions...",e.generateCaptionBtn.disabled=!0,e.generateSummaryBtn.disabled=!0;let a=await T();if(!a){e.status.textContent="Not a YouTube video page",e.status.className="status error",e.generateCaptionBtn.disabled=!1,e.generateSummaryBtn.disabled=!1;return}let s=g(a.url);if(!s){e.status.textContent="Could not extract video ID",e.status.className="status error",e.generateCaptionBtn.disabled=!1,e.generateSummaryBtn.disabled=!1;return}chrome.tabs.sendMessage(a.id,{action:p.GENERATE_SUBTITLES,videoId:s,scrapeCreatorsApiKey:o[n.SCRAPE_CREATORS_API_KEY],openRouterApiKey:o[n.OPENROUTER_API_KEY],modelSelection:r,forceRegenerate:!0},i=>{chrome.runtime.lastError?(e.status.textContent="Error: "+chrome.runtime.lastError.message,e.status.className="status error",e.generateCaptionBtn.disabled=!1,e.generateSummaryBtn.disabled=!1):i&&i.status==="started"?e.status.textContent="Fetching and refining transcript...":i&&i.status==="error"&&(e.status.textContent="Error: "+(i.message||"Unknown error"),e.status.className="status error",e.generateCaptionBtn.disabled=!1,e.generateSummaryBtn.disabled=!1)})}))}async function q(e){try{let t=await T();if(!t)return;let o=g(t.url);if(!o)return;chrome.storage.local.get([`summary_${o}`],r=>{r[`summary_${o}`]&&e.summaryContent&&(f("Popup: Found existing summary for video:",o),x(r[`summary_${o}`],e.summaryContent))})}catch(t){f("Popup: Error loading existing summary:",t)}}function Z(e,t){let o={},r=0;e.summarizerCustomModel&&e.summarizerCustomModel.value.trim()&&(e.summarizerCustomModel.value="",o[n.SUMMARIZER_CUSTOM_MODEL]="",r++),e.refinerCustomModel&&e.refinerCustomModel.value.trim()&&(e.refinerCustomModel.value="",o[n.REFINER_CUSTOM_MODEL]="",r++),Object.keys(o).length>0?(chrome.storage.local.set(o,()=>{console.log("Popup: Cleared invalid custom models")}),alert(`Model Error: ${t}

Invalid custom model input detected and cleared. Now using recommended models for summarizer and refiner. Please check your custom model entries if needed.`)):alert(`Model Error: ${t}

Please check your model selection in Settings and ensure it's a valid OpenRouter model ID.`)}function V(e){return typeof e=="string"?e.toLowerCase():e instanceof Error?e.message.toLowerCase():typeof e=="object"&&e!==null?e.message?String(e.message).toLowerCase():e.error?V(e.error):JSON.stringify(e).toLowerCase():String(e).toLowerCase()}function $(e){let t=V(e);return t.includes("invalid model")||t.includes("not a valid model id")||t.includes("model not found")||t.includes("openrouter")}function H(e){chrome.runtime.onMessage.addListener((t,o,r)=>{if(t.action===p.SHOW_ERROR){e.status.className="status error";let a=typeof t.error=="string"?t.error:t.error?.message||JSON.stringify(t.error)||"Unknown error",s=$(t.error);s&&(e.summarizerCustomModel||e.refinerCustomModel)?Z(e,a):s?alert(`Model Error: ${a}

Please check your model selection in Settings and ensure it's a valid OpenRouter model ID.`):e.status.textContent=`Error: ${a}`}else if(t.action===p.UPDATE_POPUP_STATUS)if(t.error){e.status.className="status error",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1,e.summaryContent.innerHTML='<div class="summary-placeholder">Failed to generate summary. Please try again.</div>';let a=typeof t.error=="string"?t.error:t.error?.message||JSON.stringify(t.error)||"Unknown error";$(t.error)&&(e.summarizerCustomModel||e.refinerCustomModel)?Z(e,a):e.status.textContent=t.text||`Error: ${a}`}else t.success?(e.status.className="status success",e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1,_(e.copyCaptionBtn)):(e.status.textContent=t.text,t.text&&(t.text.includes("ready")||t.text.includes("complete")||t.text.includes("success"))&&setTimeout(()=>{_(e.copyCaptionBtn)},500));else t.action==="SUMMARY_GENERATED"&&(t.summary&&(re(t.summary,e.summaryContent),e.status.textContent="Summary generated successfully!",e.status.className="status success",setTimeout(()=>{e.status.textContent="",e.status.className="status"},3e3)),e.generateSummaryBtn.disabled=!1,e.generateCaptionBtn.disabled=!1)})}function re(e,t){t.innerHTML=O(e)}function j(){let e=document.querySelectorAll(".info-icon"),t=new Map;e.forEach(o=>{let r=o.parentElement;(!r||!r.classList.contains("info-icon-wrapper"))&&(r=document.createElement("span"),r.className="info-icon-wrapper",o.parentNode.insertBefore(r,o),r.appendChild(o));let a=document.createElement("div");a.className="info-tooltip",a.textContent=o.getAttribute("data-tooltip"),r.appendChild(a),t.set(o,{tooltip:a,hideTimeout:null}),ne(o,t.get(o))})}function ne(e,t){let{tooltip:o}=t;e.addEventListener("mouseenter",function(){t.hideTimeout&&(clearTimeout(t.hideTimeout),t.hideTimeout=null),o.classList.remove("hide"),o.classList.add("show")}),e.addEventListener("mouseleave",function(r){t.hideTimeout=setTimeout(()=>{o.classList.remove("show"),o.classList.add("hide"),t.hideTimeout=null},2e3)}),o.addEventListener("mouseenter",function(){t.hideTimeout&&(clearTimeout(t.hideTimeout),t.hideTimeout=null),o.classList.remove("hide"),o.classList.add("show")}),o.addEventListener("mouseleave",function(){t.hideTimeout=setTimeout(()=>{o.classList.remove("show"),o.classList.add("hide"),t.hideTimeout=null},500)})}document.addEventListener("DOMContentLoaded",function(){let e={mainView:document.getElementById("mainView"),settingsView:document.getElementById("settingsView"),settingsBtn:document.getElementById("settingsBtn"),backBtn:document.getElementById("backBtn"),generateSummaryBtn:document.getElementById("generateSummaryBtn"),generateCaptionBtn:document.getElementById("generateCaptionBtn"),copyCaptionBtn:document.getElementById("copyCaptionBtn"),summaryContent:document.getElementById("summaryContent"),status:document.getElementById("status"),scrapeApiKey:document.getElementById("scrapeApiKey"),openrouterApiKey:document.getElementById("openrouterApiKey"),summarizerInput:document.getElementById("summarizerInput"),refinerInput:document.getElementById("refinerInput"),autoGenerateToggle:document.getElementById("autoGenerateToggle"),showSubtitlesToggle:document.getElementById("showSubtitlesToggle"),targetLanguageInput:document.getElementById("targetLanguageInput")};function t(){e.mainView.classList.add("active"),e.settingsView.classList.remove("active")}function o(){e.mainView.classList.remove("active"),e.settingsView.classList.add("active")}e.settingsBtn&&e.settingsBtn.addEventListener("click",o),e.backBtn&&e.backBtn.addEventListener("click",t);async function r(){if(!e.copyCaptionBtn?.disabled)try{let a=await new Promise(u=>{chrome.tabs.query({active:!0,currentWindow:!0},l=>{u(l[0])})});if(!a||!a.url||!a.url.includes("youtube.com/watch")){e.status.textContent="Not a YouTube video page",e.status.className="status error";return}let s=g(a.url);if(!s){e.status.textContent="Could not extract video ID",e.status.className="status error";return}let i=await M(s);if(!i||!Array.isArray(i)||i.length===0){e.status.textContent="No refined captions available",e.status.className="status error";return}let c=i.map(u=>(u.text||"").replace(/\n/g," ").trim()).filter(u=>u.length>0).join(" ");await navigator.clipboard.writeText(c),e.status.textContent="Refined caption copied to clipboard!",e.status.className="status success",setTimeout(()=>{e.status.textContent="",e.status.className="status"},2e3)}catch(a){console.error("Error copying refined caption:",a),e.status.textContent="Failed to copy caption",e.status.className="status error"}}U(),P(e),B(e),w(e),j(),H(e),q(e),_(e.copyCaptionBtn),e.generateSummaryBtn&&e.generateSummaryBtn.addEventListener("click",()=>{K(e,o)}),e.generateCaptionBtn&&e.generateCaptionBtn.addEventListener("click",()=>{k(e,o)}),e.copyCaptionBtn&&e.copyCaptionBtn.addEventListener("click",r)});})();
//# sourceMappingURL=popup.bundle.js.map
