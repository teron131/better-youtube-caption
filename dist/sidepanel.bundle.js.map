{
  "version": 3,
  "sources": ["../src/constants.js", "../src/utils/logger.js", "../src/storage.js", "../src/utils/ui.js", "../src/utils/combobox.js", "../src/utils/fontSize.js", "../src/url.js", "../src/utils/apiValidation.js", "../src/utils/modelSelection.js", "../src/utils/videoUtils.js", "../src/utils/generation.js", "../src/utils/loadSummary.js", "../src/utils/errorHandling.js", "../src/utils/messageHandler.js", "../src/utils/sidepanelSettings.js", "../src/utils/tooltip.js", "../src/sidepanel.js"],
  "sourcesContent": ["// Constants for Better YouTube Caption Extension\n\n// Storage keys\nexport const STORAGE_KEYS = {\n  SCRAPE_CREATORS_API_KEY: \"scrapeCreatorsApiKey\",\n  OPENROUTER_API_KEY: \"openRouterApiKey\",\n  SUMMARIZER_RECOMMENDED_MODEL: \"summarizerRecommendedModel\",\n  SUMMARIZER_CUSTOM_MODEL: \"summarizerCustomModel\",\n  REFINER_RECOMMENDED_MODEL: \"refinerRecommendedModel\",\n  REFINER_CUSTOM_MODEL: \"refinerCustomModel\",\n  AUTO_GENERATE: \"autoGenerate\",\n  SHOW_SUBTITLES: \"showSubtitles\",\n  CAPTION_FONT_SIZE: \"captionFontSize\",\n  SUMMARY_FONT_SIZE: \"summaryFontSize\",\n  TARGET_LANGUAGE_RECOMMENDED: \"targetLanguageRecommended\",\n  TARGET_LANGUAGE_CUSTOM: \"targetLanguageCustom\",\n};\n\n// Timing constants\nexport const TIMING = {\n  AUTO_GENERATION_DELAY_MS: 2000, // 2 seconds delay before auto-generation\n  INIT_RETRY_DELAY_MS: 500, // Delay between initialization retries\n  SUBTITLE_UPDATE_INTERVAL_MS: 100, // How often to update subtitle display\n  MAX_INIT_ATTEMPTS: 5, // Maximum retry attempts for finding video elements\n  CONTENT_SCRIPT_INIT_DELAY_MS: 500, // Delay for content script initialization\n  STATUS_MESSAGE_DISPLAY_MS: 2000, // How long to display status messages\n  SUMMARY_SUCCESS_DISPLAY_MS: 3000, // How long to display summary success message\n  CAPTION_CHECK_DELAY_MS: 500, // Delay before checking caption availability\n};\n\n// Storage constants\nexport const STORAGE = {\n  QUOTA_BYTES: 10 * 1024 * 1024, // 10MB Chrome storage limit\n  MAX_STORAGE_BYTES: 9.5 * 1024 * 1024, // 9.5MB - leave 0.5MB buffer\n  ESTIMATED_VIDEO_SIZE_BYTES: 30 * 1024, // Estimated ~30KB per video transcript\n  CLEANUP_BATCH_SIZE: 10, // Number of videos to remove during cleanup\n};\n\n// New separate lists for summarizer and refiner\nexport const RECOMMENDED_SUMMARIZER_MODELS = [\n  { value: \"x-ai/grok-4.1-fast\", label: \"Grok 4.1 Fast\" },\n  { value: \"x-ai/grok-4\", label: \"Grok 4\" },\n  { value: \"google/gemini-2.5-flash\", label: \"Gemini 2.5 Flash\" },\n  { value: \"google/gemini-3-pro-preview\", label: \"Gemini 3 Pro\" },\n  { value: \"openai/gpt-5-mini\", label: \"GPT-5 Mini\" },\n  { value: \"openai/gpt-5.1\", label: \"GPT-5.1\" },\n  { value: \"anthropic/claude-haiku-4.5\", label: \"Claude Haiku 4.5\" },\n  { value: \"anthropic/claude-sonnet-4.5\", label: \"Claude Sonnet 4.5\" },\n];\n\nexport const RECOMMENDED_REFINER_MODELS = [\n  { value: \"google/gemini-2.5-flash-lite-preview-09-2025\", label: \"Gemini 2.5 Flash Lite\" },\n  { value: \"x-ai/grok-4.1-fast\", label: \"Grok 4.1 Fast\" },\n];\n\n// Target language options for summarization\nexport const TARGET_LANGUAGES = [\n  { value: \"auto\", label: \"\uD83C\uDF10 Auto\" },\n  { value: \"en\", label: \"\uD83C\uDDFA\uD83C\uDDF8 English\" },\n  { value: \"zh-TW\", label: \"\uD83C\uDDED\uD83C\uDDF0 Chinese\" },\n];\n\n// Default values\nexport const DEFAULTS = {\n  MODEL_SUMMARIZER: \"x-ai/grok-4.1-fast\",\n  MODEL_REFINER: \"google/gemini-2.5-flash-lite-preview-09-2025\",\n  AUTO_GENERATE: false,\n  SHOW_SUBTITLES: true, // Subtitles shown by default\n  CAPTION_FONT_SIZE: \"M\", // Medium\n  SUMMARY_FONT_SIZE: \"M\", // Medium\n  TARGET_LANGUAGE_RECOMMENDED: \"auto\", // Auto-detect language\n  TARGET_LANGUAGE_CUSTOM: \"\", // Custom language code\n};\n\n// Font size mappings\nexport const FONT_SIZES = {\n  CAPTION: {\n    S: { base: \"1.4vw\", max: \"22px\", min: \"12px\", fullscreen: \"1.7vw\", fullscreenMax: \"28px\" },\n    M: { base: \"1.8vw\", max: \"28px\", min: \"14px\", fullscreen: \"2.2vw\", fullscreenMax: \"36px\" },\n    L: { base: \"2.2vw\", max: \"34px\", min: \"16px\", fullscreen: \"2.7vw\", fullscreenMax: \"44px\" },\n  },\n  SUMMARY: {\n    S: { base: \"13px\", h2: \"17px\", h3: \"15px\" },\n    M: { base: \"15px\", h2: \"20px\", h3: \"17px\" },\n    L: { base: \"17px\", h2: \"23px\", h3: \"19px\" },\n  },\n};\n\n// API endpoints\nexport const API_ENDPOINTS = {\n  SCRAPE_CREATORS: \"https://api.scrapecreators.com/v1/youtube/video\",\n  OPENROUTER: \"https://openrouter.ai/api/v1/chat/completions\",\n};\n\n// YouTube-specific constants\nexport const YOUTUBE = {\n  VIDEO_ID_LENGTH: 11, // Standard YouTube video ID length\n  SELECTORS: {\n    VIDEO_PLAYER: \"video.html5-main-video\",\n    MOVIE_PLAYER: \"#movie_player\",\n    VIDEO_CONTAINER: \".html5-video-container\",\n  },\n};\n\n// Message actions\nexport const MESSAGE_ACTIONS = {\n  FETCH_SUBTITLES: \"fetchSubtitles\",\n  GENERATE_SUBTITLES: \"generateSubtitles\",\n  GENERATE_SUMMARY: \"generateSummary\",\n  SUBTITLES_GENERATED: \"subtitlesGenerated\",\n  SUMMARY_GENERATED: \"summaryGenerated\",\n  UPDATE_POPUP_STATUS: \"updatePopupStatus\",\n  TOGGLE_SUBTITLES: \"toggleSubtitles\",\n  GET_VIDEO_TITLE: \"getVideoTitle\",\n  SHOW_ERROR: \"showError\",\n  UPDATE_CAPTION_FONT_SIZE: \"updateCaptionFontSize\",\n};\n\n// Element IDs\nexport const ELEMENT_IDS = {\n  SUBTITLE_CONTAINER: \"youtube-gemini-subtitles-container\",\n  SUBTITLE_TEXT: \"youtube-gemini-subtitles-text\",\n};\n\nexport const REFINER_CONFIG = {\n  MAX_SEGMENTS_PER_CHUNK: 30,\n  CHUNK_SENTINEL: \"<<<__CHUNK_END__>>>\",\n};\n\n// Error messages\nexport const ERROR_MESSAGES = {\n  CONTEXT_INVALIDATED: \"Extension context invalidated\",\n  VIDEO_ID_REQUIRED: \"Video ID is required.\",\n  NO_VIDEO_ID: \"Could not extract video ID from URL.\",\n  NO_TRANSCRIPT: \"No transcript available for this video\",\n  SCRAPE_KEY_MISSING: \"Scrape Creators API key not found. Please set it in settings.\",\n  OPENROUTER_KEY_MISSING: \"OpenRouter API key not found\",\n  NOT_YOUTUBE_PAGE: \"Not a YouTube video page\",\n  SUMMARY_IN_PROGRESS: \"Summary generation is already in progress for this video.\",\n};\n\n// Segment parser configuration\nexport const SEGMENT_PARSER_CONFIG = {\n  GAP_PENALTY: -0.30,\n  TAIL_GUARD_SIZE: 5,\n  LENGTH_TOLERANCE: 0.10,\n};\n\n// Storage cleanup configuration\nexport const STORAGE_CLEANUP = {\n  MIN_VIDEOS_TO_KEEP: 5,\n  DEFAULT_BATCH_SIZE: 10,\n};\n", "/**\n * Lightweight logger shared by content/sidepanel/background.\n * Prefixes logs and can be toggled via DEBUG flag.\n */\n\nconst PREFIX = 'Better YouTube Caption:';\nlet DEBUG = true;\n\nexport const log = (...args) => {\n  if (!DEBUG) return;\n  console.log(PREFIX, ...args);\n};\n\nexport const warn = (...args) => {\n  if (!DEBUG) return;\n  console.warn(PREFIX, ...args);\n};\n\nexport const error = (...args) => {\n  console.error(PREFIX, ...args);\n};\n\nexport const setDebug = (enabled) => {\n  DEBUG = !!enabled;\n};\n", "/**\n * Chrome storage management for subtitles and settings\n */\n\nimport { STORAGE, YOUTUBE, STORAGE_CLEANUP } from \"./constants.js\";\nimport { log } from \"./utils/logger.js\";\n\n/**\n * Get subtitles for a video from local storage\n */\nexport function getStoredSubtitles(videoId) {\n  return new Promise((resolve) => {\n    chrome.storage.local.get([videoId], (result) => {\n      resolve(result[videoId] || null);\n    });\n  });\n}\n\n/**\n * Save subtitles for a video to local storage\n * Automatically handles quota exceeded by cleaning old entries\n */\nexport async function saveSubtitles(videoId, subtitles) {\n  try {\n    await chromeStorageSet({ [videoId]: subtitles });\n    console.log(\"Subtitles saved to local storage for video ID:\", videoId);\n  } catch (error) {\n    if (error.message?.includes(\"QUOTA\")) {\n      console.warn(\"Storage quota exceeded, attempting cleanup...\");\n      await cleanupOldSubtitles(STORAGE.CLEANUP_BATCH_SIZE);\n      await chromeStorageSet({ [videoId]: subtitles });\n      console.log(\"Subtitles saved after cleanup for video:\", videoId);\n    } else {\n      throw error;\n    }\n  }\n}\n\n/**\n * Wrapper for chrome.storage.local.set with promise interface\n */\nfunction chromeStorageSet(items) {\n  return new Promise((resolve, reject) => {\n    chrome.storage.local.set(items, () => {\n      if (chrome.runtime.lastError) {\n        reject(new Error(chrome.runtime.lastError.message));\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\n/**\n * Get storage usage information\n */\nexport function getStorageUsage() {\n  return new Promise((resolve) => {\n    chrome.storage.local.getBytesInUse(null, (bytesInUse) => {\n      resolve({\n        bytesUsed: bytesInUse || 0,\n        bytesAvailable: STORAGE.QUOTA_BYTES - (bytesInUse || 0),\n        percentageUsed: ((bytesInUse || 0) / STORAGE.QUOTA_BYTES) * 100,\n      });\n    });\n  });\n}\n\n/**\n * Clean up old subtitles when storage is full\n * Removes oldest videos while keeping a minimum number\n */\nexport async function cleanupOldSubtitles(countToRemove = 10) {\n  return new Promise((resolve, reject) => {\n    chrome.storage.local.get(null, (allItems) => {\n      if (chrome.runtime.lastError) {\n        reject(new Error(chrome.runtime.lastError.message));\n        return;\n      }\n\n      const videoKeys = getVideoKeys(allItems);\n      const keysToRemove = selectKeysToRemove(videoKeys, countToRemove);\n\n      chrome.storage.local.remove(keysToRemove, () => {\n        if (chrome.runtime.lastError) {\n          reject(new Error(chrome.runtime.lastError.message));\n        } else {\n          console.log(`Removed ${keysToRemove.length} old video transcripts`);\n          resolve();\n        }\n      });\n    });\n  });\n}\n\n/**\n * Get all video keys from storage items\n */\nfunction getVideoKeys(allItems) {\n  return Object.keys(allItems).filter(\n    key => key.length === YOUTUBE.VIDEO_ID_LENGTH && Array.isArray(allItems[key])\n  );\n}\n\n/**\n * Select which keys to remove during cleanup\n */\nfunction selectKeysToRemove(videoKeys, countToRemove) {\n  const removeCount = videoKeys.length <= countToRemove\n    ? Math.max(1, videoKeys.length - STORAGE_CLEANUP.MIN_VIDEOS_TO_KEEP)\n    : countToRemove;\n\n  return videoKeys.slice(0, removeCount);\n}\n\n/**\n * Proactively check and clean storage if nearing limit\n */\nexport async function ensureStorageSpace() {\n  const usage = await getStorageUsage();\n\n  if (usage.bytesUsed > STORAGE.MAX_STORAGE_BYTES) {\n    console.log(`Storage usage at ${usage.percentageUsed.toFixed(1)}%, cleaning up...`);\n    const videosToRemove = Math.ceil(\n      (usage.bytesUsed - STORAGE.MAX_STORAGE_BYTES) / STORAGE.ESTIMATED_VIDEO_SIZE_BYTES\n    );\n    await cleanupOldSubtitles(videosToRemove);\n  }\n}\n\n/**\n * Get value from storage\n */\nexport function getStorageValue(keyName) {\n  return new Promise((resolve) => {\n    chrome.storage.local.get([keyName], (result) => {\n      resolve(result[keyName] || null);\n    });\n  });\n}\n\n/**\n * Get API key from storage\n */\nexport const getApiKeyFromStorage = getStorageValue;\n\n/**\n * Save value to storage\n */\nexport function setStorageValue(key, value) {\n  return new Promise((resolve, reject) => {\n    chrome.storage.local.set({ [key]: value }, () => {\n      if (chrome.runtime.lastError) {\n        reject(new Error(chrome.runtime.lastError.message));\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\n/**\n * Save setting to storage (synchronous callback-based)\n */\nexport function saveSetting(key, value) {\n  chrome.storage.local.set({ [key]: value }, () => {\n    if (chrome.runtime.lastError) {\n      console.error('Failed to save setting:', key, chrome.runtime.lastError);\n    } else {\n      log('Auto-saved:', key, value);\n    }\n  });\n}\n", "/**\n * UI Utility Functions\n * Provides common UI manipulation helpers\n */\n\n/**\n * Create provider icon element\n * @param {string} provider - Provider name (e.g., 'google', 'openai')\n * @returns {string} Icon path or empty string\n */\nexport function getProviderIcon(provider) {\n  const icons = {\n    anthropic: 'images/anthropic.svg',\n    google: 'images/google.svg',\n    openai: 'images/openai.svg',\n    'x-ai': 'images/xai.svg',\n  };\n  return icons[provider] || '';\n}\n\n/**\n * Escape HTML to prevent XSS\n * @param {string} text - Text to escape\n * @returns {string} Escaped HTML\n */\nexport function escapeHTML(text) {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Format inline markdown (bold, italic, code)\n * SAFE: Escapes HTML first, then applies markdown formatting\n * @param {string} text - Text with markdown\n * @returns {string} HTML formatted text\n */\nexport function formatInlineMarkdown(text) {\n  if (!text) return '';\n  \n  // 1. Escape HTML first to prevent XSS\n  let result = escapeHTML(text);\n  \n  // 2. Apply markdown replacements\n  // Bold (**text** or __text__)\n  result = result.replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>');\n  result = result.replace(/__(.+?)__/g, '<strong>$1</strong>');\n  \n  // Italic (*text* or _text_) - only match if not part of bold\n  result = result.replace(/(?<!\\*)\\*([^*]+?)\\*(?!\\*)/g, '<em>$1</em>');\n  result = result.replace(/(?<!_)_([^_]+?)_(?!_)/g, '<em>$1</em>');\n  \n  // Code (`text`)\n  result = result.replace(/`([^`]+)`/g, '<code>$1</code>');\n  \n  return result;\n}\n\n/**\n * Convert markdown to HTML\n * @param {string} markdown - Markdown text\n * @returns {string} HTML string\n */\nexport function convertMarkdownToHTML(markdown) {\n  if (!markdown || typeof markdown !== 'string') {\n    return '<div class=\"summary-placeholder\">No summary available</div>';\n  }\n\n  const lines = markdown.split('\\n');\n  const result = [];\n  let inList = false;\n  let inParagraph = false;\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i].trim();\n    \n    // Skip empty lines\n    if (!line) {\n      if (inList) {\n        result.push('</ul>');\n        inList = false;\n      }\n      if (inParagraph) {\n        result.push('</p>');\n        inParagraph = false;\n      }\n      continue;\n    }\n\n    // Headers\n    if (line.match(/^###\\s+(.+)$/)) {\n      if (inList) {\n        result.push('</ul>');\n        inList = false;\n      }\n      if (inParagraph) {\n        result.push('</p>');\n        inParagraph = false;\n      }\n      const headerText = line.replace(/^###\\s+/, '');\n      result.push(`<h3>${escapeHTML(headerText)}</h3>`);\n    } else if (line.match(/^##\\s+(.+)$/)) {\n      if (inList) {\n        result.push('</ul>');\n        inList = false;\n      }\n      if (inParagraph) {\n        result.push('</p>');\n        inParagraph = false;\n      }\n      const headerText = line.replace(/^##\\s+/, '');\n      result.push(`<h2>${escapeHTML(headerText)}</h2>`);\n    } else if (line.match(/^#\\s+(.+)$/)) {\n      if (inList) {\n        result.push('</ul>');\n        inList = false;\n      }\n      if (inParagraph) {\n        result.push('</p>');\n        inParagraph = false;\n      }\n      const headerText = line.replace(/^#\\s+/, '');\n      result.push(`<h2>${escapeHTML(headerText)}</h2>`);\n    }\n    // Bullet lists\n    else if (line.match(/^[\\*\\-\u2022]\\s+(.+)$/)) {\n      if (inParagraph) {\n        result.push('</p>');\n        inParagraph = false;\n      }\n      if (!inList) {\n        result.push('<ul>');\n        inList = true;\n      }\n      const listItemText = line.replace(/^[\\*\\-\u2022]\\s+/, '');\n      result.push(`<li>${formatInlineMarkdown(listItemText)}</li>`);\n    }\n    // Regular paragraph text\n    else {\n      if (inList) {\n        result.push('</ul>');\n        inList = false;\n      }\n      if (!inParagraph) {\n        result.push('<p>');\n        inParagraph = true;\n      } else {\n        result.push('<br>');\n      }\n      result.push(formatInlineMarkdown(line));\n    }\n  }\n\n  // Close any open tags\n  if (inList) {\n    result.push('</ul>');\n  }\n  if (inParagraph) {\n    result.push('</p>');\n  }\n\n  return result.join('');\n}\n\n/**\n * Display summary in the UI\n * @param {string} summaryText - Summary text (markdown)\n * @param {HTMLElement} summaryElement - Summary content element\n */\nexport function displaySummary(summaryText, summaryElement) {\n  summaryElement.innerHTML = convertMarkdownToHTML(summaryText);\n}\n", "/**\n * Combobox Component\n * Combines text input with dropdown for selecting or typing values\n */\n\nimport { RECOMMENDED_REFINER_MODELS, RECOMMENDED_SUMMARIZER_MODELS, STORAGE_KEYS, TARGET_LANGUAGES } from \"../constants.js\";\nimport { saveSetting } from \"../storage.js\";\nimport { getProviderIcon } from \"./ui.js\";\n\n/**\n * Initialize comboboxes\n */\nexport function initializeComboboxes() {\n  const comboboxes = document.querySelectorAll('.combobox[data-combobox-type]');\n  \n  comboboxes.forEach(combobox => {\n    const comboboxType = combobox.dataset.comboboxType;\n    const input = combobox.querySelector('.combobox-input');\n    const arrow = combobox.querySelector('.combobox-arrow');\n    const dropdown = combobox.querySelector('.combobox-dropdown');\n    const icon = combobox.querySelector('.combobox-icon');\n    \n    if (!input || !arrow || !dropdown || !icon) return;\n    \n    // Populate dropdown based on type\n    dropdown.innerHTML = '';\n    let options = [];\n    let storageKeys = {};\n    \n    if (comboboxType === 'targetLanguage') {\n      options = TARGET_LANGUAGES;\n      storageKeys = {\n        recommended: STORAGE_KEYS.TARGET_LANGUAGE_RECOMMENDED,\n        custom: STORAGE_KEYS.TARGET_LANGUAGE_CUSTOM\n      };\n    } else if (comboboxType === 'summarizer') {\n      options = RECOMMENDED_SUMMARIZER_MODELS;\n      storageKeys = {\n        recommended: STORAGE_KEYS.SUMMARIZER_RECOMMENDED_MODEL,\n        custom: STORAGE_KEYS.SUMMARIZER_CUSTOM_MODEL\n      };\n    } else if (comboboxType === 'refiner') {\n      options = RECOMMENDED_REFINER_MODELS;\n      storageKeys = {\n        recommended: STORAGE_KEYS.REFINER_RECOMMENDED_MODEL,\n        custom: STORAGE_KEYS.REFINER_CUSTOM_MODEL\n      };\n    }\n    \n    // Populate dropdown\n    options.forEach(option => {\n      const item = createComboboxItem(option, comboboxType);\n      dropdown.appendChild(item);\n    });\n    \n    // Initial value will be set by loadSettings via setComboboxValue\n    \n    // Arrow click - toggle dropdown\n    arrow.addEventListener('click', (e) => {\n      e.stopPropagation();\n      toggleCombobox(combobox);\n    });\n    \n    // Input focus - show dropdown\n    input.addEventListener('focus', () => {\n      combobox.classList.add('open');\n      dropdown.classList.add('show');\n    });\n    \n    // Input typing - filter dropdown\n    input.addEventListener('input', (e) => {\n      filterComboboxDropdown(combobox, e.target.value);\n      // Save the value as custom\n      const value = e.target.value.trim();\n      \n      // Update icon for models when typing\n      if ((comboboxType === 'summarizer' || comboboxType === 'refiner') && value) {\n        updateComboboxModelIcon(combobox, value);\n      }\n      \n      if (value && storageKeys.custom) {\n        saveSetting(storageKeys.custom, value);\n        // Clear recommended if custom is set\n        if (storageKeys.recommended) {\n          saveSetting(storageKeys.recommended, '');\n        }\n      } else {\n        // Clear custom if empty\n        if (storageKeys.custom) {\n          saveSetting(storageKeys.custom, '');\n        }\n        // Clear icon if empty\n        if ((comboboxType === 'summarizer' || comboboxType === 'refiner') && icon) {\n          icon.innerHTML = '';\n        }\n      }\n    });\n    \n    // Dropdown item click\n    dropdown.addEventListener('click', (e) => {\n      const item = e.target.closest('.combobox-item');\n      if (!item) return;\n      \n      const value = item.dataset.value;\n      \n      // Set input value\n      input.value = value;\n      \n      // Update icon\n      if (comboboxType === 'targetLanguage') {\n        updateComboboxIcon(combobox, value);\n      } else if (comboboxType === 'summarizer' || comboboxType === 'refiner') {\n        updateComboboxModelIcon(combobox, value);\n      }\n      \n      // Update selected state in dropdown\n      dropdown.querySelectorAll('.combobox-item').forEach(i => {\n        i.classList.remove('selected');\n      });\n      item.classList.add('selected');\n      \n      // Close dropdown\n      combobox.classList.remove('open');\n      dropdown.classList.remove('show');\n      \n      // Save as recommended (clear custom)\n      if (storageKeys.recommended) {\n        saveSetting(storageKeys.recommended, value);\n      }\n      if (storageKeys.custom) {\n        saveSetting(storageKeys.custom, '');\n      }\n    });\n    \n    // Close dropdown on outside click\n    document.addEventListener('click', (e) => {\n      if (!combobox.contains(e.target)) {\n        combobox.classList.remove('open');\n        dropdown.classList.remove('show');\n      }\n    });\n  });\n}\n\n/**\n * Create combobox item element\n */\nfunction createComboboxItem(option, comboboxType) {\n  const item = document.createElement('div');\n  item.className = 'combobox-item';\n  item.dataset.value = option.value;\n  \n  const icon = document.createElement('span');\n  icon.className = 'combobox-item-icon';\n  \n  if (comboboxType === 'targetLanguage') {\n    // Extract emoji from label (only for targetLanguage)\n    const emojiMatch = option.label.match(/^(\\p{Emoji}+)\\s*(.+)$/u);\n    if (emojiMatch) {\n      icon.textContent = emojiMatch[1];\n    }\n  } else if (comboboxType === 'summarizer' || comboboxType === 'refiner') {\n    // For model selects, show provider icon\n    const provider = option.value.split('/')[0];\n    const iconSrc = getProviderIcon(provider);\n    if (iconSrc) {\n      const img = document.createElement('img');\n      img.src = iconSrc;\n      img.alt = provider;\n      img.width = 16;\n      img.height = 16;\n      icon.appendChild(img);\n    }\n  }\n  item.appendChild(icon);\n  \n  const label = document.createElement('span');\n  label.className = 'combobox-item-label';\n  \n  // Remove emoji from label text (only for targetLanguage)\n  if (comboboxType === 'targetLanguage') {\n    const emojiMatch = option.label.match(/^(\\p{Emoji}+)\\s*(.+)$/u);\n    if (emojiMatch) {\n      label.textContent = emojiMatch[2].trim();\n    } else {\n      label.textContent = option.label;\n    }\n  } else {\n    label.textContent = option.label;\n  }\n  item.appendChild(label);\n  \n  return item;\n}\n\n/**\n * Toggle combobox dropdown\n */\nfunction toggleCombobox(combobox) {\n  const dropdown = combobox.querySelector('.combobox-dropdown');\n  const isOpen = combobox.classList.contains('open');\n  \n  // Close all other comboboxes\n  document.querySelectorAll('.combobox.open').forEach(cb => {\n    if (cb !== combobox) {\n      cb.classList.remove('open');\n      cb.querySelector('.combobox-dropdown').classList.remove('show');\n    }\n  });\n  \n  if (isOpen) {\n    combobox.classList.remove('open');\n    dropdown.classList.remove('show');\n  } else {\n    combobox.classList.add('open');\n    dropdown.classList.add('show');\n    // Focus input\n    const input = combobox.querySelector('.combobox-input');\n    if (input) input.focus();\n  }\n}\n\n/**\n * Filter combobox dropdown based on input\n */\nfunction filterComboboxDropdown(combobox, filterText) {\n  const dropdown = combobox.querySelector('.combobox-dropdown');\n  const items = dropdown.querySelectorAll('.combobox-item');\n  const filterLower = filterText.toLowerCase().trim();\n  \n  items.forEach(item => {\n    const label = item.querySelector('.combobox-item-label').textContent.toLowerCase();\n    const value = item.dataset.value.toLowerCase();\n    \n    if (!filterLower || label.includes(filterLower) || value.includes(filterLower)) {\n      item.style.display = 'flex';\n    } else {\n      item.style.display = 'none';\n    }\n  });\n}\n\n/**\n * Update combobox icon based on value (for targetLanguage)\n */\nfunction updateComboboxIcon(combobox, value) {\n  const icon = combobox.querySelector('.combobox-icon');\n  if (!icon) return;\n  \n  const langOption = TARGET_LANGUAGES.find(l => l.value === value);\n  if (langOption) {\n    const emojiMatch = langOption.label.match(/^(\\p{Emoji}+)\\s*(.+)$/u);\n    if (emojiMatch) {\n      icon.textContent = emojiMatch[1];\n    } else {\n      icon.textContent = '';\n    }\n  } else {\n    icon.textContent = '';\n  }\n}\n\n/**\n * Update combobox icon for model (shows provider icon)\n */\nfunction updateComboboxModelIcon(combobox, value) {\n  const icon = combobox.querySelector('.combobox-icon');\n  if (!icon) return;\n  \n  icon.innerHTML = '';\n  if (value) {\n    const provider = value.split('/')[0];\n    const iconSrc = getProviderIcon(provider);\n    if (iconSrc) {\n      const img = document.createElement('img');\n      img.src = iconSrc;\n      img.alt = provider;\n      img.width = 16;\n      img.height = 16;\n      icon.appendChild(img);\n    }\n  }\n}\n\n/**\n * Set combobox value programmatically\n */\nexport function setComboboxValue(comboboxType, value) {\n  const combobox = document.querySelector(`[data-combobox-type=\"${comboboxType}\"]`);\n  if (!combobox) return;\n  \n  const input = combobox.querySelector('.combobox-input');\n  const icon = combobox.querySelector('.combobox-icon');\n  if (input) {\n    input.value = value || '';\n    \n    // Update icon\n    if (comboboxType === 'targetLanguage') {\n      updateComboboxIcon(combobox, value);\n    } else if (comboboxType === 'summarizer' || comboboxType === 'refiner') {\n      updateComboboxModelIcon(combobox, value);\n    }\n    \n    // Mark selected item\n    const dropdown = combobox.querySelector('.combobox-dropdown');\n    if (dropdown) {\n      dropdown.querySelectorAll('.combobox-item').forEach(item => {\n        item.classList.remove('selected');\n        if (item.dataset.value === value) {\n          item.classList.add('selected');\n        }\n      });\n    }\n  }\n}\n", "/**\n * Font Size Management\n * Handles font size settings for captions and summary\n */\n\nimport { DEFAULTS, FONT_SIZES, MESSAGE_ACTIONS, STORAGE_KEYS } from \"../constants.js\";\nimport { saveSetting } from \"../storage.js\";\nimport { log as logDebug } from \"./logger.js\";\n\n/**\n * Apply summary font size to summary content\n * @param {string} size - Size key (S, M, L)\n */\nfunction applySummaryFontSize(size) {\n  const sizeConfig = FONT_SIZES.SUMMARY[size] || FONT_SIZES.SUMMARY.M;\n  const summaryContent = document.getElementById('summaryContent');\n  \n  if (summaryContent) {\n    summaryContent.style.setProperty('--summary-font-size-base', sizeConfig.base);\n    summaryContent.style.setProperty('--summary-font-size-h2', sizeConfig.h2);\n    summaryContent.style.setProperty('--summary-font-size-h3', sizeConfig.h3);\n  }\n}\n\n/**\n * Initialize font size selectors\n */\nexport function initializeFontSizeSelectors() {\n  // Load saved font sizes\n  chrome.storage.local.get(\n    [STORAGE_KEYS.CAPTION_FONT_SIZE, STORAGE_KEYS.SUMMARY_FONT_SIZE],\n    (result) => {\n      const captionSize = result[STORAGE_KEYS.CAPTION_FONT_SIZE] || DEFAULTS.CAPTION_FONT_SIZE;\n      const summarySize = result[STORAGE_KEYS.SUMMARY_FONT_SIZE] || DEFAULTS.SUMMARY_FONT_SIZE;\n      \n      // Set active buttons\n      document.querySelectorAll('.font-size-button[data-type=\"caption\"]').forEach(btn => {\n        if (btn.dataset.size === captionSize) {\n          btn.classList.add('active');\n        } else {\n          btn.classList.remove('active');\n        }\n      });\n      \n      document.querySelectorAll('.font-size-button[data-type=\"summary\"]').forEach(btn => {\n        if (btn.dataset.size === summarySize) {\n          btn.classList.add('active');\n        } else {\n          btn.classList.remove('active');\n        }\n      });\n      \n      // Apply font sizes\n      applySummaryFontSize(summarySize);\n    }\n  );\n  \n  // Setup click handlers\n  document.querySelectorAll('.font-size-button').forEach(button => {\n    button.addEventListener('click', function() {\n      const size = this.dataset.size;\n      const type = this.dataset.type;\n      \n      // Update active state\n      document.querySelectorAll(`.font-size-button[data-type=\"${type}\"]`).forEach(btn => {\n        btn.classList.remove('active');\n      });\n      this.classList.add('active');\n      \n      // Save setting\n      const storageKey = type === 'caption' \n        ? STORAGE_KEYS.CAPTION_FONT_SIZE \n        : STORAGE_KEYS.SUMMARY_FONT_SIZE;\n      saveSetting(storageKey, size);\n      \n      // Apply font size\n      if (type === 'caption') {\n        // Notify content script to update caption font size\n        chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\n          const currentTab = tabs[0];\n          if (currentTab && currentTab.url && currentTab.url.includes('youtube.com/watch')) {\n            chrome.tabs.sendMessage(currentTab.id, {\n              action: MESSAGE_ACTIONS.UPDATE_CAPTION_FONT_SIZE,\n              fontSize: size,\n            }, () => {\n              if (chrome.runtime.lastError) {\n                logDebug('Sidepanel: Unable to update caption font size:', chrome.runtime.lastError.message);\n              }\n            });\n          }\n        });\n      } else {\n        applySummaryFontSize(size);\n      }\n    });\n  });\n}\n", "/**\n * URL Utility Functions\n */\n\n/**\n * Extract video ID from YouTube URL\n * @param {string} url - YouTube URL\n * @returns {string|null} Video ID or null\n */\nexport function extractVideoId(url) {\n  try {\n    const urlObj = new URL(url);\n    return urlObj.searchParams.get(\"v\");\n  } catch (e) {\n    console.error(\"Error extracting video ID:\", url, e);\n    return null;\n  }\n}\n\n/**\n * Clean YouTube URL to extract only video ID and essential parameters\n * @param {string} originalUrl - Original YouTube URL\n * @returns {string} Cleaned URL\n */\nexport function cleanYouTubeUrl(originalUrl) {\n  try {\n    const url = new URL(originalUrl);\n    const videoId = url.searchParams.get(\"v\");\n    if (videoId) {\n      return `${url.protocol}//${url.hostname}${url.pathname}?v=${videoId}`;\n    }\n  } catch (e) {\n    console.error(\"Error parsing URL:\", originalUrl, e);\n  }\n  return originalUrl;\n}\n", "/**\n * API Validation Utilities\n * Centralized API key validation and retrieval\n */\n\nimport { getConfig } from \"../config.js\";\nimport { STORAGE_KEYS } from \"../constants.js\";\nimport { getApiKeyFromStorage } from \"../storage.js\";\n\n/**\n * Get API key with fallback to test config\n * @param {string} keyName - Key name (e.g., 'scrapeCreatorsApiKey', 'openRouterApiKey')\n * @returns {Promise<string>} API key\n */\nexport async function getApiKeyWithFallback(keyName) {\n  const testConfig = getConfig();\n\n  if (testConfig.useTestConfig && testConfig[keyName]) {\n    console.log(`Using test config for ${keyName}`);\n    return testConfig[keyName];\n  }\n\n  return await getApiKeyFromStorage(keyName);\n}\n\n/**\n * Validate API keys from storage result\n * @param {Object} storageResult - Storage result object\n * @returns {Object} Validation result with keys and isValid flag\n */\nexport function validateApiKeys(storageResult) {\n  const scrapeKey = storageResult[STORAGE_KEYS.SCRAPE_CREATORS_API_KEY];\n  const openRouterKey = storageResult[STORAGE_KEYS.OPENROUTER_API_KEY];\n\n  return {\n    scrapeCreatorsKey: scrapeKey || null,\n    openRouterKey: openRouterKey || null,\n    isValid: !!(scrapeKey && openRouterKey),\n    missingKeys: [\n      !scrapeKey && \"Scrape Creators API key\",\n      !openRouterKey && \"OpenRouter API key\",\n    ].filter(Boolean),\n  };\n}\n\n/**\n * Get API keys with fallback priority: message > storage > test config\n * @param {string} messageScrapeKey - Scrape Creators key from message\n * @param {string} messageOpenRouterKey - OpenRouter key from message\n * @returns {Promise<Object>} Object with scrapeCreatorsKey and openRouterKey\n */\nexport async function getApiKeys(messageScrapeKey, messageOpenRouterKey) {\n  const scrapeKey = messageScrapeKey || (await getApiKeyWithFallback(\"scrapeCreatorsApiKey\"));\n  const openRouterKey = messageOpenRouterKey || (await getApiKeyWithFallback(\"openRouterApiKey\"));\n\n  return {\n    scrapeCreatorsKey: scrapeKey,\n    openRouterKey: openRouterKey,\n  };\n}\n\n", "/**\n * Model Selection Utilities\n * Centralized logic for selecting models with priority: custom > recommended > default\n */\n\nimport { DEFAULTS, STORAGE_KEYS } from \"../constants.js\";\nimport { getStorageValue } from \"../storage.js\";\n\n/**\n * Get model selection with fallback priority\n * Priority: message > custom > recommended > default\n * @param {string} messageModelSelection - Model from message (highest priority)\n * @param {string} customModel - Custom model from storage\n * @param {string} recommendedModel - Recommended model from storage\n * @param {string} defaultModel - Default model\n * @returns {string} Selected model\n */\nexport function getModelSelection(messageModelSelection, customModel, recommendedModel, defaultModel) {\n  return (\n    messageModelSelection ||\n    customModel?.trim() ||\n    recommendedModel?.trim() ||\n    defaultModel\n  );\n}\n\n/**\n * Get summarizer model from storage\n * @param {Object} storageResult - Storage result object\n * @returns {Promise<string>} Selected model\n */\nexport async function getSummarizerModelFromStorage(storageResult = null) {\n  if (storageResult) {\n    const customModel = storageResult[STORAGE_KEYS.SUMMARIZER_CUSTOM_MODEL]?.trim();\n    const recommendedModel = storageResult[STORAGE_KEYS.SUMMARIZER_RECOMMENDED_MODEL]?.trim();\n    return customModel || recommendedModel || DEFAULTS.MODEL_SUMMARIZER;\n  }\n\n  const customModel = await getStorageValue(STORAGE_KEYS.SUMMARIZER_CUSTOM_MODEL);\n  const recommendedModel = await getStorageValue(STORAGE_KEYS.SUMMARIZER_RECOMMENDED_MODEL);\n  return getModelSelection(null, customModel, recommendedModel, DEFAULTS.MODEL_SUMMARIZER);\n}\n\n/**\n * Get refiner model from storage\n * @param {Object} storageResult - Storage result object\n * @returns {Promise<string>} Selected model\n */\nexport async function getRefinerModelFromStorage(storageResult = null) {\n  if (storageResult) {\n    const customModel = storageResult[STORAGE_KEYS.REFINER_CUSTOM_MODEL]?.trim();\n    const recommendedModel = storageResult[STORAGE_KEYS.REFINER_RECOMMENDED_MODEL]?.trim();\n    return customModel || recommendedModel || DEFAULTS.MODEL_REFINER;\n  }\n\n  const customModel = await getStorageValue(STORAGE_KEYS.REFINER_CUSTOM_MODEL);\n  const recommendedModel = await getStorageValue(STORAGE_KEYS.REFINER_RECOMMENDED_MODEL);\n  return getModelSelection(null, customModel, recommendedModel, DEFAULTS.MODEL_REFINER);\n}\n\n/**\n * Get target language from storage\n * @param {Object} storageResult - Storage result object\n * @returns {Promise<string>} Selected target language\n */\nexport async function getTargetLanguageFromStorage(storageResult = null) {\n  if (storageResult) {\n    const customLanguage = storageResult[STORAGE_KEYS.TARGET_LANGUAGE_CUSTOM]?.trim();\n    const recommendedLanguage = storageResult[STORAGE_KEYS.TARGET_LANGUAGE_RECOMMENDED]?.trim();\n    return customLanguage || recommendedLanguage || DEFAULTS.TARGET_LANGUAGE_RECOMMENDED;\n  }\n\n  const customLanguage = await getStorageValue(STORAGE_KEYS.TARGET_LANGUAGE_CUSTOM);\n  const recommendedLanguage = await getStorageValue(STORAGE_KEYS.TARGET_LANGUAGE_RECOMMENDED);\n  return getModelSelection(null, customLanguage, recommendedLanguage, DEFAULTS.TARGET_LANGUAGE_RECOMMENDED);\n}\n\n", "/**\n * Video Utilities\n * Centralized video ID extraction and validation\n */\n\nimport { extractVideoId } from \"../url.js\";\nimport { ERROR_MESSAGES } from \"../constants.js\";\n\n/**\n * Get current YouTube video tab\n * @returns {Promise<chrome.tabs.Tab|null>} Current tab or null\n */\nexport async function getCurrentVideoTab() {\n  return new Promise((resolve) => {\n    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\n      const currentTab = tabs[0];\n      if (currentTab?.url?.includes(\"youtube.com/watch\")) {\n        resolve(currentTab);\n      } else {\n        resolve(null);\n      }\n    });\n  });\n}\n\n/**\n * Get video ID from current tab\n * @returns {Promise<string|null>} Video ID or null\n */\nexport async function getVideoIdFromCurrentTab() {\n  const tab = await getCurrentVideoTab();\n  if (!tab?.url) return null;\n  return extractVideoId(tab.url);\n}\n\n/**\n * Validate video ID and return error message if invalid\n * @param {string} videoId - Video ID to validate\n * @returns {Object} Validation result with isValid flag and error message\n */\nexport function validateVideoId(videoId) {\n  if (!videoId) {\n    return {\n      isValid: false,\n      error: ERROR_MESSAGES.NO_VIDEO_ID,\n    };\n  }\n  return { isValid: true, error: null };\n}\n\n/**\n * Get video ID from URL with validation\n * @param {string} url - URL to extract video ID from\n * @returns {Object} Result with videoId and error\n */\nexport function getVideoIdFromUrl(url) {\n  const videoId = extractVideoId(url);\n  const validation = validateVideoId(videoId);\n  return {\n    videoId,\n    ...validation,\n  };\n}\n\n", "/**\n * Generation Actions\n * Handles summary and caption generation requests\n */\n\nimport { MESSAGE_ACTIONS, STORAGE_KEYS } from \"../constants.js\";\nimport { getStoredSubtitles } from \"../storage.js\";\nimport { extractVideoId } from \"../url.js\";\nimport { validateApiKeys } from \"./apiValidation.js\";\nimport { getRefinerModelFromStorage, getSummarizerModelFromStorage, getTargetLanguageFromStorage } from \"./modelSelection.js\";\nimport { getCurrentVideoTab, getVideoIdFromCurrentTab, validateVideoId } from \"./videoUtils.js\";\n\n/**\n * Check if refined captions exist for current video and update copy button state\n * @param {HTMLElement} copyCaptionBtn - Copy button element\n */\nexport async function checkRefinedCaptionsAvailability(copyCaptionBtn) {\n  if (!copyCaptionBtn) return;\n\n  try {\n    const videoId = await getVideoIdFromCurrentTab();\n    if (!videoId) {\n      copyCaptionBtn.disabled = true;\n      return;\n    }\n\n    const subtitles = await getStoredSubtitles(videoId);\n    copyCaptionBtn.disabled = !subtitles || !Array.isArray(subtitles) || subtitles.length === 0;\n  } catch (error) {\n    console.error(\"Error checking refined captions:\", error);\n    copyCaptionBtn.disabled = true;\n  }\n}\n\n/**\n * Show error in status element\n */\nfunction showError(statusElement, message) {\n  statusElement.textContent = message;\n  statusElement.className = \"status error\";\n}\n\nfunction setStatus(statusElement, message) {\n  statusElement.textContent = message;\n  statusElement.className = \"status\";\n}\n\n/**\n * Validate API keys and show error if missing\n * @param {Object} result - Storage result\n * @param {HTMLElement} statusElement - Status element to show errors\n * @param {Function} showSettingsView - Function to show settings view\n * @returns {boolean} True if valid\n */\nfunction validateApiKeysForGeneration(result, statusElement, showSettingsView) {\n  const validation = validateApiKeys(result);\n  if (!validation.isValid) {\n    showError(statusElement, `Please enter ${validation.missingKeys[0]} in Settings`);\n    showSettingsView();\n    return false;\n  }\n  return true;\n}\n\n/**\n * Get video ID from current tab with validation\n * @param {HTMLElement} statusElement - Status element to show errors\n * @returns {Promise<Object|null>} {videoId, tabId} or null\n */\nasync function getValidatedVideoId(statusElement) {\n  const currentTab = await getCurrentVideoTab();\n  if (!currentTab) {\n    showError(statusElement, \"Not a YouTube video page\");\n    return null;\n  }\n\n  const videoId = extractVideoId(currentTab.url);\n  const validation = validateVideoId(videoId);\n  if (!validation.isValid) {\n    showError(statusElement, validation.error);\n    return null;\n  }\n\n  return { videoId, tabId: currentTab.id };\n}\n\n/**\n * Set loading state for generation buttons\n * @param {Object} elements - DOM elements\n * @param {boolean} isLoading - Whether buttons should be disabled\n */\nfunction setGenerationLoadingState(elements, isLoading) {\n  elements.generateSummaryBtn.disabled = isLoading;\n  elements.generateCaptionBtn.disabled = isLoading;\n}\n\nfunction isGenerationBusy(elements) {\n  return elements.generateSummaryBtn.disabled || elements.generateCaptionBtn.disabled;\n}\n\nfunction initGeneration(elements) {\n  if (isGenerationBusy(elements)) {\n    return false;\n  }\n  setStatus(elements.status, \"\");\n  return true;\n}\n\nfunction startGeneration(elements, statusText, placeholderHtml) {\n  setStatus(elements.status, statusText);\n  setGenerationLoadingState(elements, true);\n  if (placeholderHtml) {\n    elements.summaryContent.innerHTML = placeholderHtml;\n  }\n}\n\n/**\n * Handle summary generation response\n */\nfunction handleSummaryResponse(elements, response) {\n  if (chrome.runtime.lastError) {\n    showError(elements.status, \"Error: \" + chrome.runtime.lastError.message);\n    setGenerationLoadingState(elements, false);\n    elements.summaryContent.innerHTML = '<div class=\"summary-placeholder\">Failed to generate summary. Please try again.</div>';\n    return;\n  }\n\n  if (response?.status === \"started\") {\n    elements.status.textContent = \"Processing video transcript...\";\n  } else if (response?.status === \"error\") {\n    const errorMsg = response.message || \"Unknown error\";\n    showError(elements.status, \"Error: \" + errorMsg);\n    setGenerationLoadingState(elements, false);\n    // Don't clear summary content if it's just a \"already running\" error\n    if (!errorMsg.includes(\"already in progress\")) {\n      elements.summaryContent.innerHTML = '<div class=\"summary-placeholder\">Failed to generate summary. Please try again.</div>';\n    }\n  }\n}\n\n/**\n * Generate summary for current video\n * @param {Object} elements - DOM elements\n * @param {Function} showSettingsView - Function to show settings view\n */\nexport async function generateSummary(elements, showSettingsView) {\n  if (!initGeneration(elements)) {\n    return;\n  }\n\n  chrome.storage.local.get(\n    [\n      STORAGE_KEYS.SCRAPE_CREATORS_API_KEY,\n      STORAGE_KEYS.OPENROUTER_API_KEY,\n      STORAGE_KEYS.SUMMARIZER_RECOMMENDED_MODEL,\n      STORAGE_KEYS.SUMMARIZER_CUSTOM_MODEL,\n      STORAGE_KEYS.TARGET_LANGUAGE_RECOMMENDED,\n      STORAGE_KEYS.TARGET_LANGUAGE_CUSTOM,\n    ],\n    async (result) => {\n      if (!validateApiKeysForGeneration(result, elements.status, showSettingsView)) {\n        return;\n      }\n\n      // Get models and target language from UI or storage\n      const summarizerModel = elements.summarizerInput?.value.trim() || (await getSummarizerModelFromStorage(result));\n      const targetLanguage = elements.targetLanguageInput?.value.trim() || (await getTargetLanguageFromStorage(result));\n\n      startGeneration(\n        elements,\n        \"Generating summary...\",\n        '<div class=\"summary-placeholder\">Generating summary, please wait...</div>'\n      );\n\n      // Get and validate video ID\n      const videoInfo = await getValidatedVideoId(elements.status);\n      if (!videoInfo) {\n        setGenerationLoadingState(elements, false);\n        return;\n      }\n\n      const { videoId, tabId } = videoInfo;\n\n      // Send generation request\n      chrome.tabs.sendMessage(\n        tabId,\n        {\n          action: MESSAGE_ACTIONS.GENERATE_SUMMARY,\n          videoId,\n          scrapeCreatorsApiKey: result[STORAGE_KEYS.SCRAPE_CREATORS_API_KEY],\n          openRouterApiKey: result[STORAGE_KEYS.OPENROUTER_API_KEY],\n          modelSelection: summarizerModel,\n          targetLanguage,\n        },\n        (response) => handleSummaryResponse(elements, response)\n      );\n    }\n  );\n}\n\n/**\n * Handle caption generation response\n */\nfunction handleCaptionResponse(elements, response) {\n  if (chrome.runtime.lastError) {\n    showError(elements.status, \"Error: \" + chrome.runtime.lastError.message);\n    setGenerationLoadingState(elements, false);\n    return;\n  }\n\n  if (response?.status === \"started\") {\n    elements.status.textContent = \"Fetching and refining transcript...\";\n  } else if (response?.status === \"error\") {\n    showError(elements.status, \"Error: \" + (response.message || \"Unknown error\"));\n    setGenerationLoadingState(elements, false);\n  }\n}\n\n/**\n * Generate captions for current video\n * @param {Object} elements - DOM elements\n * @param {Function} showSettingsView - Function to show settings view\n */\nexport async function generateCaptions(elements, showSettingsView) {\n  if (!initGeneration(elements)) {\n    return;\n  }\n\n  chrome.storage.local.get(\n    [\n      STORAGE_KEYS.SCRAPE_CREATORS_API_KEY,\n      STORAGE_KEYS.OPENROUTER_API_KEY,\n      STORAGE_KEYS.REFINER_RECOMMENDED_MODEL,\n      STORAGE_KEYS.REFINER_CUSTOM_MODEL,\n    ],\n    async (result) => {\n      if (!validateApiKeysForGeneration(result, elements.status, showSettingsView)) {\n        return;\n      }\n\n      const refinerModel = elements.refinerInput?.value.trim() || (await getRefinerModelFromStorage(result));\n\n      startGeneration(elements, \"Generating refined captions...\");\n\n      // Get and validate video ID\n      const videoInfo = await getValidatedVideoId(elements.status);\n      if (!videoInfo) {\n        setGenerationLoadingState(elements, false);\n        return;\n      }\n\n      const { videoId, tabId } = videoInfo;\n\n      // Send generation request\n      chrome.tabs.sendMessage(\n        tabId,\n        {\n          action: MESSAGE_ACTIONS.GENERATE_SUBTITLES,\n          videoId,\n          scrapeCreatorsApiKey: result[STORAGE_KEYS.SCRAPE_CREATORS_API_KEY],\n          openRouterApiKey: result[STORAGE_KEYS.OPENROUTER_API_KEY],\n          modelSelection: refinerModel,\n          forceRegenerate: true,\n        },\n        (response) => handleCaptionResponse(elements, response)\n      );\n    }\n  );\n}\n", "/**\n * Load existing summary for current video\n * Checks storage and displays summary if found\n */\n\nimport { extractVideoId } from \"../url.js\";\nimport { getCurrentVideoTab } from \"./videoUtils.js\";\nimport { log as logDebug } from \"./logger.js\";\nimport { displaySummary } from \"./ui.js\";\n\n/**\n * Load and display summary for current video\n * @param {Object} elements - DOM elements\n */\nexport async function loadExistingSummary(elements) {\n  try {\n    // Get current tab\n    const currentTab = await getCurrentVideoTab();\n    if (!currentTab) {\n      return;\n    }\n\n    const videoId = extractVideoId(currentTab.url);\n    if (!videoId) {\n      return;\n    }\n\n    // Check for existing summary\n    chrome.storage.local.get([`summary_${videoId}`], (result) => {\n      if (result[`summary_${videoId}`] && elements.summaryContent) {\n        logDebug('Sidepanel: Found existing summary for video:', videoId);\n        displaySummary(result[`summary_${videoId}`], elements.summaryContent);\n      }\n    });\n  } catch (error) {\n    logDebug('Sidepanel: Error loading existing summary:', error);\n  }\n}\n", "/**\n * Error Handling Utilities\n * Centralized error extraction and formatting\n */\n\nimport { ERROR_MESSAGES } from \"../constants.js\";\n\n/**\n * Convert error to string message\n * @param {*} error - Error (can be Error, string, object, etc.)\n * @returns {string} Error message\n */\nfunction errorToMessage(error) {\n  if (typeof error === \"string\") return error;\n  if (error instanceof Error) return error.message;\n  if (typeof error === \"object\" && error !== null) {\n    if (error.message) return String(error.message);\n    if (error.error) return errorToMessage(error.error);\n    return JSON.stringify(error);\n  }\n  return String(error);\n}\n\n/**\n * Extract and format error message from various error types\n * @param {Error|Object|string} error - Error object\n * @returns {string} Formatted error message\n */\nexport function extractErrorMessage(error) {\n  const msg = errorToMessage(error);\n  // Extract cleaner message for OpenRouter API errors\n  const match = msg.match(/OpenRouter API error: (.+)/);\n  return match ? match[1] : msg;\n}\n\n/**\n * Check if error is related to extension context invalidation\n * @param {Error|Object|string} error - Error to check\n * @returns {boolean} True if context invalidated error\n */\nexport function isContextInvalidatedError(error) {\n  return extractErrorMessage(error).toLowerCase().includes(ERROR_MESSAGES.CONTEXT_INVALIDATED.toLowerCase());\n}\n\n/**\n * Check if error is a model-related error\n * @param {*} error - Error message (can be string, object, etc.)\n * @returns {boolean} True if model error\n */\nexport function isModelError(error) {\n  const lowerError = extractErrorMessage(error).toLowerCase();\n  return (\n    lowerError.includes(\"invalid model\") ||\n    lowerError.includes(\"not a valid model id\") ||\n    lowerError.includes(\"model not found\") ||\n    lowerError.includes(\"openrouter\")\n  );\n}\n\n", "/**\n * Message Handler for Side Panel\n * Handles messages from background and content scripts\n */\n\nimport { MESSAGE_ACTIONS, STORAGE_KEYS, TIMING } from \"../constants.js\";\nimport { isModelError } from \"./errorHandling.js\";\nimport { checkRefinedCaptionsAvailability } from \"./generation.js\";\nimport { displaySummary } from \"./ui.js\";\n\n/**\n * Handle model error by clearing invalid custom models\n * @param {Object} elements - DOM elements\n * @param {string} errorMessage - Error message\n */\nfunction handleModelError(elements, errorMessage) {\n  const clears = {};\n  let clearedCount = 0;\n\n  if (elements.summarizerCustomModel?.value.trim()) {\n    elements.summarizerCustomModel.value = \"\";\n    clears[STORAGE_KEYS.SUMMARIZER_CUSTOM_MODEL] = \"\";\n    clearedCount++;\n  }\n\n  if (elements.refinerCustomModel?.value.trim()) {\n    elements.refinerCustomModel.value = \"\";\n    clears[STORAGE_KEYS.REFINER_CUSTOM_MODEL] = \"\";\n    clearedCount++;\n  }\n\n  if (Object.keys(clears).length > 0) {\n    chrome.storage.local.set(clears, () => {\n      console.log(\"Sidepanel: Cleared invalid custom models\");\n    });\n\n    alert(\n      `Model Error: ${errorMessage}\\n\\n` +\n        `Invalid custom model input detected and cleared. ` +\n        `Now using recommended models for summarizer and refiner. ` +\n        `Please check your custom model entries if needed.`\n    );\n  } else {\n    alert(\n      `Model Error: ${errorMessage}\\n\\n` +\n        `Please check your model selection in Settings and ensure it's a valid OpenRouter model ID.`\n    );\n  }\n}\n\n/**\n * Handle error message\n * @param {Object} message - Message object\n * @param {Object} elements - DOM elements\n */\nfunction handleErrorMessage(message, elements) {\n  elements.status.className = \"status error\";\n\n  const errorString =\n    typeof message.error === \"string\"\n      ? message.error\n      : message.error?.message || JSON.stringify(message.error) || \"Unknown error\";\n  const isModel = isModelError(message.error);\n\n  if (isModel && (elements.summarizerCustomModel || elements.refinerCustomModel)) {\n    handleModelError(elements, errorString);\n  } else if (isModel) {\n    alert(\n      `Model Error: ${errorString}\\n\\n` +\n        `Please check your model selection in Settings and ensure it's a valid OpenRouter model ID.`\n    );\n  } else {\n    elements.status.textContent = `Error: ${errorString}`;\n  }\n}\n\n/**\n * Handle status update message\n * @param {Object} message - Message object\n * @param {Object} elements - DOM elements\n */\nfunction handleStatusUpdate(message, elements) {\n  if (message.error) {\n    elements.status.className = \"status error\";\n    elements.generateSummaryBtn.disabled = false;\n    elements.generateCaptionBtn.disabled = false;\n    elements.summaryContent.innerHTML = '<div class=\"summary-placeholder\">Failed to generate summary. Please try again.</div>';\n\n    const errorString =\n      typeof message.error === \"string\"\n        ? message.error\n        : message.error?.message || JSON.stringify(message.error) || \"Unknown error\";\n    const isModel = isModelError(message.error);\n\n    if (isModel && (elements.summarizerCustomModel || elements.refinerCustomModel)) {\n      handleModelError(elements, errorString);\n    } else {\n      elements.status.textContent = message.text || `Error: ${errorString}`;\n    }\n  } else if (message.success) {\n    elements.status.className = \"status success\";\n    elements.generateSummaryBtn.disabled = false;\n    elements.generateCaptionBtn.disabled = false;\n    // Check if refined captions are now available (for copy button)\n    checkRefinedCaptionsAvailability(elements.copyCaptionBtn);\n  } else {\n    elements.status.textContent = message.text;\n    // Also check when status updates (captions might have been generated)\n    if (message.text && (message.text.includes(\"ready\") || message.text.includes(\"complete\") || message.text.includes(\"success\"))) {\n      // Small delay to ensure storage is updated\n      setTimeout(() => {\n        checkRefinedCaptionsAvailability(elements.copyCaptionBtn);\n      }, TIMING.CAPTION_CHECK_DELAY_MS);\n    }\n  }\n}\n\n/**\n * Handle summary generated message\n * @param {Object} message - Message object\n * @param {Object} elements - DOM elements\n */\nfunction handleSummaryGenerated(message, elements) {\n  if (message.summary) {\n    displaySummary(message.summary, elements.summaryContent);\n    elements.status.textContent = \"Summary generated successfully!\";\n    elements.status.className = \"status success\";\n\n    setTimeout(() => {\n      elements.status.textContent = \"\";\n      elements.status.className = \"status\";\n    }, TIMING.SUMMARY_SUCCESS_DISPLAY_MS);\n  }\n  elements.generateSummaryBtn.disabled = false;\n  elements.generateCaptionBtn.disabled = false;\n}\n\n/**\n * Setup message listener for side panel\n * @param {Object} elements - DOM elements\n */\nexport function setupMessageListener(elements) {\n  const handlers = {\n    [MESSAGE_ACTIONS.SHOW_ERROR]: handleErrorMessage,\n    [MESSAGE_ACTIONS.UPDATE_POPUP_STATUS]: handleStatusUpdate,\n    [MESSAGE_ACTIONS.SUMMARY_GENERATED]: handleSummaryGenerated,\n  };\n\n  chrome.runtime.onMessage.addListener((message) => {\n    const handler = handlers[message.action];\n    if (!handler) {\n      return;\n    }\n    handler(message, elements);\n  });\n}\n", "/**\n * Side Panel Settings Management\n * Handles loading and saving settings in the side panel UI\n */\n\nimport { DEFAULTS, MESSAGE_ACTIONS, STORAGE_KEYS } from \"../constants.js\";\nimport { saveSetting } from \"../storage.js\";\nimport { setComboboxValue } from \"./combobox.js\";\nimport { log as logDebug } from \"./logger.js\";\n\n/**\n * Load all settings and populate UI\n * @param {Object} elements - DOM elements for settings inputs\n */\nexport function loadSettings(elements) {\n  chrome.storage.local.get(\n    [\n      STORAGE_KEYS.SCRAPE_CREATORS_API_KEY,\n      STORAGE_KEYS.OPENROUTER_API_KEY,\n      STORAGE_KEYS.SUMMARIZER_RECOMMENDED_MODEL,\n      STORAGE_KEYS.SUMMARIZER_CUSTOM_MODEL,\n      STORAGE_KEYS.REFINER_RECOMMENDED_MODEL,\n      STORAGE_KEYS.REFINER_CUSTOM_MODEL,\n      STORAGE_KEYS.AUTO_GENERATE,\n      STORAGE_KEYS.SHOW_SUBTITLES,\n      STORAGE_KEYS.TARGET_LANGUAGE_RECOMMENDED,\n      STORAGE_KEYS.TARGET_LANGUAGE_CUSTOM,\n    ],\n    (result) => {\n      // API Keys\n      if (result[STORAGE_KEYS.SCRAPE_CREATORS_API_KEY] && elements.scrapeApiKey) {\n        elements.scrapeApiKey.value = result[STORAGE_KEYS.SCRAPE_CREATORS_API_KEY];\n      }\n      if (result[STORAGE_KEYS.OPENROUTER_API_KEY] && elements.openrouterApiKey) {\n        elements.openrouterApiKey.value = result[STORAGE_KEYS.OPENROUTER_API_KEY];\n      }\n\n      // Toggles\n      if (elements.autoGenerateToggle) {\n        elements.autoGenerateToggle.checked = result[STORAGE_KEYS.AUTO_GENERATE] === true;\n      }\n      \n      const showSubtitlesValue = result[STORAGE_KEYS.SHOW_SUBTITLES] !== undefined\n        ? result[STORAGE_KEYS.SHOW_SUBTITLES]\n        : DEFAULTS.SHOW_SUBTITLES;\n      if (elements.showSubtitlesToggle) {\n        elements.showSubtitlesToggle.checked = showSubtitlesValue === true;\n      }\n\n      // Update comboboxes (custom takes priority over recommended)\n      // Summarizer\n      const summarizerCustom = result[STORAGE_KEYS.SUMMARIZER_CUSTOM_MODEL]?.trim();\n      const summarizerRecommended = result[STORAGE_KEYS.SUMMARIZER_RECOMMENDED_MODEL] || DEFAULTS.MODEL_SUMMARIZER;\n      const summarizerValue = summarizerCustom || summarizerRecommended;\n      setComboboxValue('summarizer', summarizerValue);\n\n      // Refiner\n      const refinerCustom = result[STORAGE_KEYS.REFINER_CUSTOM_MODEL]?.trim();\n      const refinerRecommended = result[STORAGE_KEYS.REFINER_RECOMMENDED_MODEL] || DEFAULTS.MODEL_REFINER;\n      const refinerValue = refinerCustom || refinerRecommended;\n      setComboboxValue('refiner', refinerValue);\n      \n      // Target Language\n      const customLanguage = result[STORAGE_KEYS.TARGET_LANGUAGE_CUSTOM]?.trim();\n      const recommendedLanguage = result[STORAGE_KEYS.TARGET_LANGUAGE_RECOMMENDED] || DEFAULTS.TARGET_LANGUAGE_RECOMMENDED;\n      const targetLanguageValue = customLanguage || recommendedLanguage;\n      setComboboxValue('targetLanguage', targetLanguageValue);\n    }\n  );\n}\n\n/**\n * Setup settings event listeners\n * @param {Object} elements - DOM elements for settings inputs\n */\nexport function setupSettingsListeners(elements) {\n  // API Keys\n  if (elements.scrapeApiKey) {\n    elements.scrapeApiKey.addEventListener('input', function() {\n      saveSetting(STORAGE_KEYS.SCRAPE_CREATORS_API_KEY, this.value.trim());\n    });\n  }\n\n  if (elements.openrouterApiKey) {\n    elements.openrouterApiKey.addEventListener('input', function() {\n      saveSetting(STORAGE_KEYS.OPENROUTER_API_KEY, this.value.trim());\n    });\n  }\n\n  // Model comboboxes are handled by combobox.js\n\n  // Toggles\n  if (elements.autoGenerateToggle) {\n    elements.autoGenerateToggle.addEventListener('change', function() {\n      saveSetting(STORAGE_KEYS.AUTO_GENERATE, this.checked);\n    });\n  }\n\n  // Show subtitles toggle (special handling for content script communication)\n  if (elements.showSubtitlesToggle) {\n    elements.showSubtitlesToggle.addEventListener('change', function() {\n      const enabled = this.checked;\n      saveSetting(STORAGE_KEYS.SHOW_SUBTITLES, enabled);\n      \n      // Send message to content script to toggle subtitles\n      chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\n        const currentTab = tabs[0];\n        if (currentTab && currentTab.url && currentTab.url.includes('youtube.com/watch')) {\n          chrome.tabs.sendMessage(\n            currentTab.id,\n            {\n              action: MESSAGE_ACTIONS.TOGGLE_SUBTITLES,\n              showSubtitles: enabled,\n              enabled: enabled,\n            },\n            () => {\n              if (chrome.runtime.lastError) {\n                logDebug('Sidepanel: Unable to toggle subtitles:', chrome.runtime.lastError.message);\n              }\n            }\n          );\n        }\n      });\n    });\n  }\n\n  // Target Language is handled by combobox.js\n}\n\n", "/**\n * Tooltip Management\n * Handles info icon tooltips with delay functionality\n */\n\n/**\n * Initialize tooltips for all info icons\n */\nexport function initializeTooltips() {\n  const infoIcons = document.querySelectorAll('.info-icon');\n  const iconTooltips = new Map(); // Track icon -> tooltip element\n  \n  infoIcons.forEach(icon => {\n    // Wrap icon if not already wrapped\n    let wrapper = icon.parentElement;\n    if (!wrapper || !wrapper.classList.contains('info-icon-wrapper')) {\n      wrapper = document.createElement('span');\n      wrapper.className = 'info-icon-wrapper';\n      icon.parentNode.insertBefore(wrapper, icon);\n      wrapper.appendChild(icon);\n    }\n    \n    // Create tooltip element and append to wrapper\n    const tooltip = document.createElement('div');\n    tooltip.className = 'info-tooltip';\n    tooltip.textContent = icon.getAttribute('data-tooltip');\n    wrapper.appendChild(tooltip);\n    \n    // Store reference\n    iconTooltips.set(icon, { tooltip: tooltip, hideTimeout: null });\n\n    // Setup event listeners\n    setupTooltipListeners(icon, iconTooltips.get(icon));\n  });\n}\n\n/**\n * Setup event listeners for a tooltip\n * @param {HTMLElement} icon - Info icon element\n * @param {Object} state - Tooltip state object\n */\nfunction setupTooltipListeners(icon, state) {\n  const { tooltip } = state;\n\n  icon.addEventListener('mouseenter', function() {\n    // Clear any pending hide timeout\n    if (state.hideTimeout) {\n      clearTimeout(state.hideTimeout);\n      state.hideTimeout = null;\n    }\n    \n    // Show tooltip\n    tooltip.classList.remove('hide');\n    tooltip.classList.add('show');\n  });\n\n  icon.addEventListener('mouseleave', function(e) {\n    // Start delay - will be cancelled if mouse enters tooltip\n    state.hideTimeout = setTimeout(() => {\n      tooltip.classList.remove('show');\n      tooltip.classList.add('hide');\n      state.hideTimeout = null;\n    }, 2000);\n  });\n\n  // Keep tooltip visible when hovering over it\n  tooltip.addEventListener('mouseenter', function() {\n    if (state.hideTimeout) {\n      clearTimeout(state.hideTimeout);\n      state.hideTimeout = null;\n    }\n    tooltip.classList.remove('hide');\n    tooltip.classList.add('show');\n  });\n\n  tooltip.addEventListener('mouseleave', function() {\n    // Delay before hiding\n    state.hideTimeout = setTimeout(() => {\n      tooltip.classList.remove('show');\n      tooltip.classList.add('hide');\n      state.hideTimeout = null;\n    }, 500);\n  });\n}\n", "/**\n * Side Panel Script for Better YouTube Caption Extension\n * Main entry point for side panel UI\n */\n\nimport { TIMING } from \"./constants.js\";\nimport { getStoredSubtitles } from \"./storage.js\";\nimport { initializeComboboxes } from \"./utils/combobox.js\";\nimport { initializeFontSizeSelectors } from \"./utils/fontSize.js\";\nimport { checkRefinedCaptionsAvailability, generateCaptions, generateSummary } from \"./utils/generation.js\";\nimport { loadExistingSummary } from \"./utils/loadSummary.js\";\nimport { setupMessageListener } from \"./utils/messageHandler.js\";\nimport { loadSettings, setupSettingsListeners } from \"./utils/sidepanelSettings.js\";\nimport { initializeTooltips } from \"./utils/tooltip.js\";\nimport { getVideoIdFromCurrentTab } from \"./utils/videoUtils.js\";\n\ndocument.addEventListener('DOMContentLoaded', function() {\n  // DOM Elements\n  const elements = {\n    // Views\n    mainView: document.getElementById('mainView'),\n    settingsView: document.getElementById('settingsView'),\n    \n    // Buttons\n    settingsBtn: document.getElementById('settingsBtn'),\n    backBtn: document.getElementById('backBtn'),\n    generateSummaryBtn: document.getElementById('generateSummaryBtn'),\n    generateCaptionBtn: document.getElementById('generateCaptionBtn'),\n    copyCaptionBtn: document.getElementById('copyCaptionBtn'),\n    \n    // Content\n    summaryContent: document.getElementById('summaryContent'),\n    status: document.getElementById('status'),\n    \n    // Form inputs\n    scrapeApiKey: document.getElementById('scrapeApiKey'),\n    openrouterApiKey: document.getElementById('openrouterApiKey'),\n    summarizerInput: document.getElementById('summarizerInput'),\n    refinerInput: document.getElementById('refinerInput'),\n    autoGenerateToggle: document.getElementById('autoGenerateToggle'),\n    showSubtitlesToggle: document.getElementById('showSubtitlesToggle'),\n    targetLanguageInput: document.getElementById('targetLanguageInput'),\n  };\n\n  // View Management\n  function showMainView() {\n    elements.mainView.classList.add('active');\n    elements.settingsView.classList.remove('active');\n  }\n\n  function showSettingsView() {\n    elements.mainView.classList.remove('active');\n    elements.settingsView.classList.add('active');\n  }\n\n  // Setup navigation\n  if (elements.settingsBtn) {\n    elements.settingsBtn.addEventListener('click', showSettingsView);\n  }\n  if (elements.backBtn) {\n    elements.backBtn.addEventListener('click', showMainView);\n  }\n\n  /**\n   * Copy refined caption to clipboard\n   */\n  async function copyRefinedCaption() {\n    if (elements.copyCaptionBtn?.disabled) {\n      return;\n    }\n\n    try {\n      const videoId = await getVideoIdFromCurrentTab();\n      if (!videoId) {\n        elements.status.textContent = \"Not a YouTube video page\";\n        elements.status.className = \"status error\";\n        return;\n      }\n\n      const subtitles = await getStoredSubtitles(videoId);\n      if (!subtitles || !Array.isArray(subtitles) || subtitles.length === 0) {\n        elements.status.textContent = 'No refined captions available';\n        elements.status.className = 'status error';\n        return;\n      }\n\n      // Join all segment texts with spaces (replacing newlines)\n      const captionText = subtitles\n        .map((segment) => (segment.text || '').replace(/\\n/g, ' ').trim())\n        .filter((text) => text.length > 0)\n        .join(' ');\n\n      // Copy to clipboard\n      await navigator.clipboard.writeText(captionText);\n      \n      // Show success message\n      elements.status.textContent = 'Refined caption copied to clipboard!';\n      elements.status.className = 'status success';\n      \n      setTimeout(() => {\n        elements.status.textContent = \"\";\n        elements.status.className = \"status\";\n      }, TIMING.STATUS_MESSAGE_DISPLAY_MS);\n    } catch (error) {\n      console.error('Error copying refined caption:', error);\n      elements.status.textContent = 'Failed to copy caption';\n      elements.status.className = 'status error';\n    }\n  }\n\n  // Initialize components\n  initializeComboboxes();\n  loadSettings(elements);\n  setupSettingsListeners(elements);\n  initializeFontSizeSelectors(elements);\n  initializeTooltips();\n  setupMessageListener(elements);\n  loadExistingSummary(elements);\n  checkRefinedCaptionsAvailability(elements.copyCaptionBtn);\n\n  // Setup generation buttons\n  if (elements.generateSummaryBtn) {\n    elements.generateSummaryBtn.addEventListener('click', () => {\n      generateSummary(elements, showSettingsView);\n    });\n  }\n\n  if (elements.generateCaptionBtn) {\n    elements.generateCaptionBtn.addEventListener('click', () => {\n      generateCaptions(elements, showSettingsView);\n    });\n  }\n\n  // Setup copy button\n  if (elements.copyCaptionBtn) {\n    elements.copyCaptionBtn.addEventListener('click', copyRefinedCaption);\n  }\n\n  // Handle tab context changes for Side Panel\n  function updateContext() {\n    // Clear status\n    if (elements.status) {\n      elements.status.textContent = '';\n      elements.status.className = 'status';\n    }\n\n    // Reset summary to placeholder\n    if (elements.summaryContent) {\n       elements.summaryContent.innerHTML = '<div class=\"summary-placeholder\">Click \"Generate Summary\" to create a summary for this video</div>';\n    }\n    \n    // Re-check availability and summary\n    checkRefinedCaptionsAvailability(elements.copyCaptionBtn);\n    loadExistingSummary(elements);\n  }\n\n  // Update when active tab changes\n  chrome.tabs.onActivated.addListener(updateContext);\n\n  // Update when current tab URL changes\n  chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {\n    if (changeInfo.status === 'complete' && tab.active) {\n      updateContext();\n    }\n  });\n});\n\n"],
  "mappings": "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",
  "names": ["STORAGE_KEYS", "TIMING", "STORAGE", "RECOMMENDED_SUMMARIZER_MODELS", "RECOMMENDED_REFINER_MODELS", "TARGET_LANGUAGES", "DEFAULTS", "FONT_SIZES", "MESSAGE_ACTIONS", "ERROR_MESSAGES", "PREFIX", "DEBUG", "log", "args", "getStoredSubtitles", "videoId", "resolve", "result", "getStorageValue", "keyName", "resolve", "result", "saveSetting", "key", "value", "log", "getProviderIcon", "provider", "escapeHTML", "text", "div", "formatInlineMarkdown", "result", "convertMarkdownToHTML", "markdown", "lines", "inList", "inParagraph", "line", "headerText", "listItemText", "displaySummary", "summaryText", "summaryElement", "initializeComboboxes", "combobox", "comboboxType", "input", "arrow", "dropdown", "icon", "options", "storageKeys", "TARGET_LANGUAGES", "STORAGE_KEYS", "RECOMMENDED_SUMMARIZER_MODELS", "RECOMMENDED_REFINER_MODELS", "option", "item", "createComboboxItem", "e", "toggleCombobox", "filterComboboxDropdown", "value", "updateComboboxModelIcon", "saveSetting", "updateComboboxIcon", "i", "emojiMatch", "provider", "iconSrc", "getProviderIcon", "img", "label", "isOpen", "cb", "filterText", "items", "filterLower", "langOption", "l", "setComboboxValue", "applySummaryFontSize", "size", "sizeConfig", "FONT_SIZES", "summaryContent", "initializeFontSizeSelectors", "STORAGE_KEYS", "result", "captionSize", "DEFAULTS", "summarySize", "btn", "button", "type", "storageKey", "saveSetting", "tabs", "currentTab", "MESSAGE_ACTIONS", "log", "extractVideoId", "url", "e", "validateApiKeys", "storageResult", "scrapeKey", "STORAGE_KEYS", "openRouterKey", "getModelSelection", "messageModelSelection", "customModel", "recommendedModel", "defaultModel", "getSummarizerModelFromStorage", "storageResult", "STORAGE_KEYS", "DEFAULTS", "getStorageValue", "getRefinerModelFromStorage", "getTargetLanguageFromStorage", "customLanguage", "recommendedLanguage", "getCurrentVideoTab", "resolve", "tabs", "currentTab", "getVideoIdFromCurrentTab", "tab", "extractVideoId", "validateVideoId", "videoId", "ERROR_MESSAGES", "checkRefinedCaptionsAvailability", "copyCaptionBtn", "videoId", "getVideoIdFromCurrentTab", "subtitles", "getStoredSubtitles", "error", "showError", "statusElement", "message", "setStatus", "validateApiKeysForGeneration", "result", "showSettingsView", "validation", "validateApiKeys", "getValidatedVideoId", "currentTab", "getCurrentVideoTab", "extractVideoId", "validateVideoId", "setGenerationLoadingState", "elements", "isLoading", "isGenerationBusy", "initGeneration", "startGeneration", "statusText", "placeholderHtml", "handleSummaryResponse", "response", "errorMsg", "generateSummary", "STORAGE_KEYS", "summarizerModel", "getSummarizerModelFromStorage", "targetLanguage", "getTargetLanguageFromStorage", "videoInfo", "tabId", "MESSAGE_ACTIONS", "handleCaptionResponse", "generateCaptions", "refinerModel", "getRefinerModelFromStorage", "loadExistingSummary", "elements", "currentTab", "getCurrentVideoTab", "videoId", "extractVideoId", "result", "log", "displaySummary", "error", "errorToMessage", "error", "extractErrorMessage", "msg", "match", "isModelError", "error", "lowerError", "extractErrorMessage", "handleModelError", "elements", "errorMessage", "clears", "clearedCount", "STORAGE_KEYS", "handleErrorMessage", "message", "errorString", "isModel", "isModelError", "handleStatusUpdate", "checkRefinedCaptionsAvailability", "TIMING", "handleSummaryGenerated", "displaySummary", "setupMessageListener", "handlers", "MESSAGE_ACTIONS", "handler", "loadSettings", "elements", "STORAGE_KEYS", "result", "showSubtitlesValue", "DEFAULTS", "summarizerCustom", "summarizerRecommended", "setComboboxValue", "refinerCustom", "refinerRecommended", "customLanguage", "recommendedLanguage", "setupSettingsListeners", "saveSetting", "enabled", "tabs", "currentTab", "MESSAGE_ACTIONS", "log", "initializeTooltips", "infoIcons", "iconTooltips", "icon", "wrapper", "tooltip", "setupTooltipListeners", "state", "e", "elements", "showMainView", "showSettingsView", "copyRefinedCaption", "videoId", "getVideoIdFromCurrentTab", "subtitles", "getStoredSubtitles", "captionText", "segment", "text", "TIMING", "error", "initializeComboboxes", "loadSettings", "setupSettingsListeners", "initializeFontSizeSelectors", "initializeTooltips", "setupMessageListener", "loadExistingSummary", "checkRefinedCaptionsAvailability", "generateSummary", "generateCaptions", "updateContext", "tabId", "changeInfo", "tab"]
}
