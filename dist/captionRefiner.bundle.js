(()=>{var Fb=Object.create;var yo=Object.defineProperty;var Bb=Object.getOwnPropertyDescriptor;var Zb=Object.getOwnPropertyNames;var qb=Object.getPrototypeOf,Gb=Object.prototype.hasOwnProperty;var Hb=(r,e,t)=>e in r?yo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var j=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Mf=(r,e)=>{for(var t in e)yo(r,t,{get:e[t],enumerable:!0})},Vb=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Zb(e))!Gb.call(r,s)&&s!==t&&yo(r,s,{get:()=>e[s],enumerable:!(n=Bb(e,s))||n.enumerable});return r};var It=(r,e,t)=>(t=r!=null?Fb(qb(r)):{},Vb(e||!r||!r.__esModule?yo(t,"default",{value:r,enumerable:!0}):t,r));var _r=(r,e,t)=>Hb(r,typeof e!="symbol"?e+"":e,t);var zf=j((KT,Lf)=>{"use strict";Lf.exports=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var Gf=j((JT,Cc)=>{"use strict";var Kb=/[\p{Lu}]/u,Jb=/[\p{Ll}]/u,Df=/^[\p{Lu}](?![\p{Lu}])/gu,Bf=/([\p{Alpha}\p{N}_]|$)/u,Zf=/[_.\- ]+/,Wb=new RegExp("^"+Zf.source),Uf=new RegExp(Zf.source+Bf.source,"gu"),Ff=new RegExp("\\d+"+Bf.source,"gu"),Yb=(r,e,t)=>{let n=!1,s=!1,i=!1;for(let a=0;a<r.length;a++){let o=r[a];n&&Kb.test(o)?(r=r.slice(0,a)+"-"+r.slice(a),n=!1,i=s,s=!0,a++):s&&i&&Jb.test(o)?(r=r.slice(0,a-1)+"-"+r.slice(a-1),i=s,s=!1,n=!0):(n=e(o)===o&&t(o)!==o,i=s,s=t(o)===o&&e(o)!==o)}return r},Xb=(r,e)=>(Df.lastIndex=0,r.replace(Df,t=>e(t))),Qb=(r,e)=>(Uf.lastIndex=0,Ff.lastIndex=0,r.replace(Uf,(t,n)=>e(n)).replace(Ff,t=>e(t))),qf=(r,e)=>{if(!(typeof r=="string"||Array.isArray(r)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(r)?r=r.map(i=>i.trim()).filter(i=>i.length).join("-"):r=r.trim(),r.length===0)return"";let t=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),n=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return r.length===1?e.pascalCase?n(r):t(r):(r!==t(r)&&(r=Yb(r,t,n)),r=r.replace(Wb,""),e.preserveConsecutiveUppercase?r=Xb(r,t):r=t(r),e.pascalCase&&(r=n(r.charAt(0))+r.slice(1)),Qb(r,n))};Cc.exports=qf;Cc.exports.default=qf});var _p=j((sS,gp)=>{function wt(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}gp.exports=wt;wt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};wt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};wt.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};wt.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};wt.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};wt.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};wt.prototype.start=wt.prototype.try;wt.prototype.errors=function(){return this._errors};wt.prototype.attempts=function(){return this._attempts};wt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var s=this._errors[n],i=s.message,a=(r[i]||0)+1;r[i]=a,a>=t&&(e=s,t=a)}return e}});var yp=j(Wn=>{var gx=_p();Wn.operation=function(r){var e=Wn.timeouts(r);return new gx(e,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};Wn.timeouts=function(r){if(r instanceof Array)return[].concat(r);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in r)e[t]=r[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],s=0;s<e.retries;s++)n.push(this.createTimeout(s,e));return r&&r.forever&&!n.length&&n.push(this.createTimeout(s,e)),n.sort(function(i,a){return i-a}),n};Wn.createTimeout=function(r,e){var t=e.randomize?Math.random()+1:1,n=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,r));return n=Math.min(n,e.maxTimeout),n};Wn.wrap=function(r,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var n in r)typeof r[n]=="function"&&t.push(n)}for(var s=0;s<t.length;s++){var i=t[s],a=r[i];r[i]=function(u){var c=Wn.operation(e),l=Array.prototype.slice.call(arguments,1),d=l.pop();l.push(function(f){c.retry(f)||(f&&(arguments[0]=c.mainError()),d.apply(this,arguments))}),c.attempt(function(){u.apply(r,l)})}.bind(r,a),r[i].options=e}}});var wp=j((aS,bp)=>{bp.exports=yp()});var To=j((oS,Io)=>{"use strict";var _x=wp(),yx=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Oo=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},bx=(r,e,t)=>{let n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r},wx=r=>yx.includes(r),xp=(r,e)=>new Promise((t,n)=>{e={onFailedAttempt:()=>{},retries:10,...e};let s=_x.operation(e);s.attempt(async i=>{try{t(await r(i))}catch(a){if(!(a instanceof Error)){n(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof Oo)s.stop(),n(a.originalError);else if(a instanceof TypeError&&!wx(a.message))s.stop(),n(a);else{bx(a,i,e);try{await e.onFailedAttempt(a)}catch(o){n(o);return}s.retry(a)||n(s.mainError())}}})});Io.exports=xp;Io.exports.default=xp;Io.exports.AbortError=Oo});var dh=j((ok,pl)=>{"use strict";var Wx=Object.prototype.hasOwnProperty,qe="~";function ha(){}Object.create&&(ha.prototype=Object.create(null),new ha().__proto__||(qe=!1));function Yx(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function lh(r,e,t,n,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new Yx(t,n||r,s),a=qe?qe+e:e;return r._events[a]?r._events[a].fn?r._events[a]=[r._events[a],i]:r._events[a].push(i):(r._events[a]=i,r._eventsCount++),r}function Go(r,e){--r._eventsCount===0?r._events=new ha:delete r._events[e]}function De(){this._events=new ha,this._eventsCount=0}De.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)Wx.call(t,n)&&e.push(qe?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};De.prototype.listeners=function(e){var t=qe?qe+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,i=n.length,a=new Array(i);s<i;s++)a[s]=n[s].fn;return a};De.prototype.listenerCount=function(e){var t=qe?qe+e:e,n=this._events[t];return n?n.fn?1:n.length:0};De.prototype.emit=function(e,t,n,s,i,a){var o=qe?qe+e:e;if(!this._events[o])return!1;var u=this._events[o],c=arguments.length,l,d;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,s),!0;case 5:return u.fn.call(u.context,t,n,s,i),!0;case 6:return u.fn.call(u.context,t,n,s,i,a),!0}for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];u.fn.apply(u.context,l)}else{var f=u.length,p;for(d=0;d<f;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),c){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,n);break;case 4:u[d].fn.call(u[d].context,t,n,s);break;default:if(!l)for(p=1,l=new Array(c-1);p<c;p++)l[p-1]=arguments[p];u[d].fn.apply(u[d].context,l)}}return!0};De.prototype.on=function(e,t,n){return lh(this,e,t,n,!1)};De.prototype.once=function(e,t,n){return lh(this,e,t,n,!0)};De.prototype.removeListener=function(e,t,n,s){var i=qe?qe+e:e;if(!this._events[i])return this;if(!t)return Go(this,i),this;var a=this._events[i];if(a.fn)a.fn===t&&(!s||a.once)&&(!n||a.context===n)&&Go(this,i);else{for(var o=0,u=[],c=a.length;o<c;o++)(a[o].fn!==t||s&&!a[o].once||n&&a[o].context!==n)&&u.push(a[o]);u.length?this._events[i]=u.length===1?u[0]:u:Go(this,i)}return this};De.prototype.removeAllListeners=function(e){var t;return e?(t=qe?qe+e:e,this._events[t]&&Go(this,t)):(this._events=new ha,this._eventsCount=0),this};De.prototype.off=De.prototype.removeListener;De.prototype.addListener=De.prototype.on;De.prefixed=qe;De.EventEmitter=De;typeof pl<"u"&&(pl.exports=De)});var ph=j((uk,fh)=>{"use strict";fh.exports=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))});var mh=j((ck,Vo)=>{"use strict";var Xx=ph(),Ho=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},hh=(r,e,t)=>new Promise((n,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(r);return}let i=setTimeout(()=>{if(typeof t=="function"){try{n(t())}catch(u){s(u)}return}let a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Ho(a);typeof r.cancel=="function"&&r.cancel(),s(o)},e);Xx(r.then(n,s),()=>{clearTimeout(i)})});Vo.exports=hh;Vo.exports.default=hh;Vo.exports.TimeoutError=Ho});var gh=j(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});function Qx(r,e,t){let n=0,s=r.length;for(;s>0;){let i=s/2|0,a=n+i;t(r[a],e)<=0?(n=++a,s-=i+1):s=i}return n}hl.default=Qx});var _h=j(gl=>{"use strict";Object.defineProperty(gl,"__esModule",{value:!0});var ev=gh(),ml=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let n={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(n);return}let s=ev.default(this._queue,n,(i,a)=>a.priority-i.priority);this._queue.splice(s,0,n)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};gl.default=ml});var Jo=j(yl=>{"use strict";Object.defineProperty(yl,"__esModule",{value:!0});var tv=dh(),yh=mh(),rv=_h(),Ko=()=>{},nv=new yh.TimeoutError,_l=class extends tv{constructor(e){var t,n,s,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Ko,this._resolveIdle=Ko,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:rv.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Ko,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Ko,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((n,s)=>{let i=async()=>{this._pendingCount++,this._intervalCount++;try{let a=this._timeout===void 0&&t.timeout===void 0?e():yh.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(nv)});n(await a)}catch(a){s(a)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};yl.default=_l});var _a=j((_k,xh)=>{"use strict";var av="2.0.0",ov=Number.MAX_SAFE_INTEGER||9007199254740991,uv=16,cv=250,lv=["major","premajor","minor","preminor","patch","prepatch","prerelease"];xh.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:uv,MAX_SAFE_BUILD_LENGTH:cv,MAX_SAFE_INTEGER:ov,RELEASE_TYPES:lv,SEMVER_SPEC_VERSION:av,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var ya=j((yk,vh)=>{"use strict";var dv=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};vh.exports=dv});var Ks=j((Yt,Ah)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:xl,MAX_SAFE_BUILD_LENGTH:fv,MAX_LENGTH:pv}=_a(),hv=ya();Yt=Ah.exports={};var mv=Yt.re=[],gv=Yt.safeRe=[],P=Yt.src=[],_v=Yt.safeSrc=[],S=Yt.t={},yv=0,vl="[a-zA-Z0-9-]",bv=[["\\s",1],["\\d",pv],[vl,fv]],wv=r=>{for(let[e,t]of bv)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},X=(r,e,t)=>{let n=wv(e),s=yv++;hv(r,s,e),S[r]=s,P[s]=e,_v[s]=n,mv[s]=new RegExp(e,t?"g":void 0),gv[s]=new RegExp(n,t?"g":void 0)};X("NUMERICIDENTIFIER","0|[1-9]\\d*");X("NUMERICIDENTIFIERLOOSE","\\d+");X("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${vl}*`);X("MAINVERSION",`(${P[S.NUMERICIDENTIFIER]})\\.(${P[S.NUMERICIDENTIFIER]})\\.(${P[S.NUMERICIDENTIFIER]})`);X("MAINVERSIONLOOSE",`(${P[S.NUMERICIDENTIFIERLOOSE]})\\.(${P[S.NUMERICIDENTIFIERLOOSE]})\\.(${P[S.NUMERICIDENTIFIERLOOSE]})`);X("PRERELEASEIDENTIFIER",`(?:${P[S.NONNUMERICIDENTIFIER]}|${P[S.NUMERICIDENTIFIER]})`);X("PRERELEASEIDENTIFIERLOOSE",`(?:${P[S.NONNUMERICIDENTIFIER]}|${P[S.NUMERICIDENTIFIERLOOSE]})`);X("PRERELEASE",`(?:-(${P[S.PRERELEASEIDENTIFIER]}(?:\\.${P[S.PRERELEASEIDENTIFIER]})*))`);X("PRERELEASELOOSE",`(?:-?(${P[S.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${P[S.PRERELEASEIDENTIFIERLOOSE]})*))`);X("BUILDIDENTIFIER",`${vl}+`);X("BUILD",`(?:\\+(${P[S.BUILDIDENTIFIER]}(?:\\.${P[S.BUILDIDENTIFIER]})*))`);X("FULLPLAIN",`v?${P[S.MAINVERSION]}${P[S.PRERELEASE]}?${P[S.BUILD]}?`);X("FULL",`^${P[S.FULLPLAIN]}$`);X("LOOSEPLAIN",`[v=\\s]*${P[S.MAINVERSIONLOOSE]}${P[S.PRERELEASELOOSE]}?${P[S.BUILD]}?`);X("LOOSE",`^${P[S.LOOSEPLAIN]}$`);X("GTLT","((?:<|>)?=?)");X("XRANGEIDENTIFIERLOOSE",`${P[S.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);X("XRANGEIDENTIFIER",`${P[S.NUMERICIDENTIFIER]}|x|X|\\*`);X("XRANGEPLAIN",`[v=\\s]*(${P[S.XRANGEIDENTIFIER]})(?:\\.(${P[S.XRANGEIDENTIFIER]})(?:\\.(${P[S.XRANGEIDENTIFIER]})(?:${P[S.PRERELEASE]})?${P[S.BUILD]}?)?)?`);X("XRANGEPLAINLOOSE",`[v=\\s]*(${P[S.XRANGEIDENTIFIERLOOSE]})(?:\\.(${P[S.XRANGEIDENTIFIERLOOSE]})(?:\\.(${P[S.XRANGEIDENTIFIERLOOSE]})(?:${P[S.PRERELEASELOOSE]})?${P[S.BUILD]}?)?)?`);X("XRANGE",`^${P[S.GTLT]}\\s*${P[S.XRANGEPLAIN]}$`);X("XRANGELOOSE",`^${P[S.GTLT]}\\s*${P[S.XRANGEPLAINLOOSE]}$`);X("COERCEPLAIN",`(^|[^\\d])(\\d{1,${xl}})(?:\\.(\\d{1,${xl}}))?(?:\\.(\\d{1,${xl}}))?`);X("COERCE",`${P[S.COERCEPLAIN]}(?:$|[^\\d])`);X("COERCEFULL",P[S.COERCEPLAIN]+`(?:${P[S.PRERELEASE]})?(?:${P[S.BUILD]})?(?:$|[^\\d])`);X("COERCERTL",P[S.COERCE],!0);X("COERCERTLFULL",P[S.COERCEFULL],!0);X("LONETILDE","(?:~>?)");X("TILDETRIM",`(\\s*)${P[S.LONETILDE]}\\s+`,!0);Yt.tildeTrimReplace="$1~";X("TILDE",`^${P[S.LONETILDE]}${P[S.XRANGEPLAIN]}$`);X("TILDELOOSE",`^${P[S.LONETILDE]}${P[S.XRANGEPLAINLOOSE]}$`);X("LONECARET","(?:\\^)");X("CARETTRIM",`(\\s*)${P[S.LONECARET]}\\s+`,!0);Yt.caretTrimReplace="$1^";X("CARET",`^${P[S.LONECARET]}${P[S.XRANGEPLAIN]}$`);X("CARETLOOSE",`^${P[S.LONECARET]}${P[S.XRANGEPLAINLOOSE]}$`);X("COMPARATORLOOSE",`^${P[S.GTLT]}\\s*(${P[S.LOOSEPLAIN]})$|^$`);X("COMPARATOR",`^${P[S.GTLT]}\\s*(${P[S.FULLPLAIN]})$|^$`);X("COMPARATORTRIM",`(\\s*)${P[S.GTLT]}\\s*(${P[S.LOOSEPLAIN]}|${P[S.XRANGEPLAIN]})`,!0);Yt.comparatorTrimReplace="$1$2$3";X("HYPHENRANGE",`^\\s*(${P[S.XRANGEPLAIN]})\\s+-\\s+(${P[S.XRANGEPLAIN]})\\s*$`);X("HYPHENRANGELOOSE",`^\\s*(${P[S.XRANGEPLAINLOOSE]})\\s+-\\s+(${P[S.XRANGEPLAINLOOSE]})\\s*$`);X("STAR","(<|>)?=?\\s*\\*");X("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");X("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Yo=j((bk,Eh)=>{"use strict";var xv=Object.freeze({loose:!0}),vv=Object.freeze({}),Av=r=>r?typeof r!="object"?xv:r:vv;Eh.exports=Av});var Al=j((wk,Th)=>{"use strict";var Oh=/^[0-9]+$/,Ih=(r,e)=>{if(typeof r=="number"&&typeof e=="number")return r===e?0:r<e?-1:1;let t=Oh.test(r),n=Oh.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},Ev=(r,e)=>Ih(e,r);Th.exports={compareIdentifiers:Ih,rcompareIdentifiers:Ev}});var Ue=j((xk,Sh)=>{"use strict";var Xo=ya(),{MAX_LENGTH:Ph,MAX_SAFE_INTEGER:Qo}=_a(),{safeRe:eu,t:tu}=Ks(),Ov=Yo(),{compareIdentifiers:El}=Al(),Ol=class r{constructor(e,t){if(t=Ov(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Ph)throw new TypeError(`version is longer than ${Ph} characters`);Xo("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?eu[tu.LOOSE]:eu[tu.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Qo||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Qo||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Qo||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let i=+s;if(i>=0&&i<Qo)return i}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Xo("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],s=e.prerelease[t];if(Xo("prerelease compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return El(n,s)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],s=e.build[t];if(Xo("build compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return El(n,s)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let s=`-${t}`.match(this.options.loose?eu[tu.PRERELEASELOOSE]:eu[tu.PRERELEASE]);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(t){let i=[t,s];n===!1&&(i=[t]),El(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Sh.exports=Ol});var es=j((vk,Rh)=>{"use strict";var kh=Ue(),Iv=(r,e,t=!1)=>{if(r instanceof kh)return r;try{return new kh(r,e)}catch(n){if(!t)return null;throw n}};Rh.exports=Iv});var Ch=j((Ak,Nh)=>{"use strict";var Tv=es(),Pv=(r,e)=>{let t=Tv(r,e);return t?t.version:null};Nh.exports=Pv});var jh=j((Ek,$h)=>{"use strict";var Sv=es(),kv=(r,e)=>{let t=Sv(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};$h.exports=kv});var zh=j((Ok,Lh)=>{"use strict";var Mh=Ue(),Rv=(r,e,t,n,s)=>{typeof t=="string"&&(s=n,n=t,t=void 0);try{return new Mh(r instanceof Mh?r.version:r,t).inc(e,n,s).version}catch{return null}};Lh.exports=Rv});var Fh=j((Ik,Uh)=>{"use strict";var Dh=es(),Nv=(r,e)=>{let t=Dh(r,null,!0),n=Dh(e,null,!0),s=t.compare(n);if(s===0)return null;let i=s>0,a=i?t:n,o=i?n:t,u=!!a.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(a)===0)return o.minor&&!o.patch?"minor":"patch"}let l=u?"pre":"";return t.major!==n.major?l+"major":t.minor!==n.minor?l+"minor":t.patch!==n.patch?l+"patch":"prerelease"};Uh.exports=Nv});var Zh=j((Tk,Bh)=>{"use strict";var Cv=Ue(),$v=(r,e)=>new Cv(r,e).major;Bh.exports=$v});var Gh=j((Pk,qh)=>{"use strict";var jv=Ue(),Mv=(r,e)=>new jv(r,e).minor;qh.exports=Mv});var Vh=j((Sk,Hh)=>{"use strict";var Lv=Ue(),zv=(r,e)=>new Lv(r,e).patch;Hh.exports=zv});var Jh=j((kk,Kh)=>{"use strict";var Dv=es(),Uv=(r,e)=>{let t=Dv(r,e);return t&&t.prerelease.length?t.prerelease:null};Kh.exports=Uv});var xt=j((Rk,Yh)=>{"use strict";var Wh=Ue(),Fv=(r,e,t)=>new Wh(r,t).compare(new Wh(e,t));Yh.exports=Fv});var Qh=j((Nk,Xh)=>{"use strict";var Bv=xt(),Zv=(r,e,t)=>Bv(e,r,t);Xh.exports=Zv});var tm=j((Ck,em)=>{"use strict";var qv=xt(),Gv=(r,e)=>qv(r,e,!0);em.exports=Gv});var ru=j(($k,nm)=>{"use strict";var rm=Ue(),Hv=(r,e,t)=>{let n=new rm(r,t),s=new rm(e,t);return n.compare(s)||n.compareBuild(s)};nm.exports=Hv});var im=j((jk,sm)=>{"use strict";var Vv=ru(),Kv=(r,e)=>r.sort((t,n)=>Vv(t,n,e));sm.exports=Kv});var om=j((Mk,am)=>{"use strict";var Jv=ru(),Wv=(r,e)=>r.sort((t,n)=>Jv(n,t,e));am.exports=Wv});var ba=j((Lk,um)=>{"use strict";var Yv=xt(),Xv=(r,e,t)=>Yv(r,e,t)>0;um.exports=Xv});var nu=j((zk,cm)=>{"use strict";var Qv=xt(),e0=(r,e,t)=>Qv(r,e,t)<0;cm.exports=e0});var Il=j((Dk,lm)=>{"use strict";var t0=xt(),r0=(r,e,t)=>t0(r,e,t)===0;lm.exports=r0});var Tl=j((Uk,dm)=>{"use strict";var n0=xt(),s0=(r,e,t)=>n0(r,e,t)!==0;dm.exports=s0});var su=j((Fk,fm)=>{"use strict";var i0=xt(),a0=(r,e,t)=>i0(r,e,t)>=0;fm.exports=a0});var iu=j((Bk,pm)=>{"use strict";var o0=xt(),u0=(r,e,t)=>o0(r,e,t)<=0;pm.exports=u0});var Pl=j((Zk,hm)=>{"use strict";var c0=Il(),l0=Tl(),d0=ba(),f0=su(),p0=nu(),h0=iu(),m0=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return c0(r,t,n);case"!=":return l0(r,t,n);case">":return d0(r,t,n);case">=":return f0(r,t,n);case"<":return p0(r,t,n);case"<=":return h0(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};hm.exports=m0});var gm=j((qk,mm)=>{"use strict";var g0=Ue(),_0=es(),{safeRe:au,t:ou}=Ks(),y0=(r,e)=>{if(r instanceof g0)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?au[ou.COERCEFULL]:au[ou.COERCE]);else{let u=e.includePrerelease?au[ou.COERCERTLFULL]:au[ou.COERCERTL],c;for(;(c=u.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||c.index+c[0].length!==t.index+t[0].length)&&(t=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(t===null)return null;let n=t[2],s=t[3]||"0",i=t[4]||"0",a=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return _0(`${n}.${s}.${i}${a}${o}`,e)};mm.exports=y0});var ym=j((Gk,_m)=>{"use strict";var Sl=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let s=this.map.keys().next().value;this.delete(s)}this.map.set(e,t)}return this}};_m.exports=Sl});var vt=j((Hk,vm)=>{"use strict";var b0=/\s+/g,kl=class r{constructor(e,t){if(t=x0(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Rl)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(b0," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(s=>!wm(s[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let s of this.set)if(s.length===1&&P0(s[0])){this.set=[s];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&I0)|(this.options.loose&&T0))+":"+e,s=bm.get(n);if(s)return s;let i=this.options.loose,a=i?Ge[Fe.HYPHENRANGELOOSE]:Ge[Fe.HYPHENRANGE];e=e.replace(a,z0(this.options.includePrerelease)),fe("hyphen replace",e),e=e.replace(Ge[Fe.COMPARATORTRIM],A0),fe("comparator trim",e),e=e.replace(Ge[Fe.TILDETRIM],E0),fe("tilde trim",e),e=e.replace(Ge[Fe.CARETTRIM],O0),fe("caret trim",e);let o=e.split(" ").map(d=>S0(d,this.options)).join(" ").split(/\s+/).map(d=>L0(d,this.options));i&&(o=o.filter(d=>(fe("loose invalid filter",d,this.options),!!d.match(Ge[Fe.COMPARATORLOOSE])))),fe("range list",o);let u=new Map,c=o.map(d=>new Rl(d,this.options));for(let d of c){if(wm(d))return[d];u.set(d.value,d)}u.size>1&&u.has("")&&u.delete("");let l=[...u.values()];return bm.set(n,l),l}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>xm(n,t)&&e.set.some(s=>xm(s,t)&&n.every(i=>s.every(a=>i.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new v0(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(D0(this.set[t],e,this.options))return!0;return!1}};vm.exports=kl;var w0=ym(),bm=new w0,x0=Yo(),Rl=wa(),fe=ya(),v0=Ue(),{safeRe:Ge,t:Fe,comparatorTrimReplace:A0,tildeTrimReplace:E0,caretTrimReplace:O0}=Ks(),{FLAG_INCLUDE_PRERELEASE:I0,FLAG_LOOSE:T0}=_a(),wm=r=>r.value==="<0.0.0-0",P0=r=>r.value==="",xm=(r,e)=>{let t=!0,n=r.slice(),s=n.pop();for(;t&&n.length;)t=n.every(i=>s.intersects(i,e)),s=n.pop();return t},S0=(r,e)=>(r=r.replace(Ge[Fe.BUILD],""),fe("comp",r,e),r=N0(r,e),fe("caret",r),r=k0(r,e),fe("tildes",r),r=$0(r,e),fe("xrange",r),r=M0(r,e),fe("stars",r),r),He=r=>!r||r.toLowerCase()==="x"||r==="*",k0=(r,e)=>r.trim().split(/\s+/).map(t=>R0(t,e)).join(" "),R0=(r,e)=>{let t=e.loose?Ge[Fe.TILDELOOSE]:Ge[Fe.TILDE];return r.replace(t,(n,s,i,a,o)=>{fe("tilde",r,n,s,i,a,o);let u;return He(s)?u="":He(i)?u=`>=${s}.0.0 <${+s+1}.0.0-0`:He(a)?u=`>=${s}.${i}.0 <${s}.${+i+1}.0-0`:o?(fe("replaceTilde pr",o),u=`>=${s}.${i}.${a}-${o} <${s}.${+i+1}.0-0`):u=`>=${s}.${i}.${a} <${s}.${+i+1}.0-0`,fe("tilde return",u),u})},N0=(r,e)=>r.trim().split(/\s+/).map(t=>C0(t,e)).join(" "),C0=(r,e)=>{fe("caret",r,e);let t=e.loose?Ge[Fe.CARETLOOSE]:Ge[Fe.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(s,i,a,o,u)=>{fe("caret",r,s,i,a,o,u);let c;return He(i)?c="":He(a)?c=`>=${i}.0.0${n} <${+i+1}.0.0-0`:He(o)?i==="0"?c=`>=${i}.${a}.0${n} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.0${n} <${+i+1}.0.0-0`:u?(fe("replaceCaret pr",u),i==="0"?a==="0"?c=`>=${i}.${a}.${o}-${u} <${i}.${a}.${+o+1}-0`:c=`>=${i}.${a}.${o}-${u} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.${o}-${u} <${+i+1}.0.0-0`):(fe("no pr"),i==="0"?a==="0"?c=`>=${i}.${a}.${o}${n} <${i}.${a}.${+o+1}-0`:c=`>=${i}.${a}.${o}${n} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.${o} <${+i+1}.0.0-0`),fe("caret return",c),c})},$0=(r,e)=>(fe("replaceXRanges",r,e),r.split(/\s+/).map(t=>j0(t,e)).join(" ")),j0=(r,e)=>{r=r.trim();let t=e.loose?Ge[Fe.XRANGELOOSE]:Ge[Fe.XRANGE];return r.replace(t,(n,s,i,a,o,u)=>{fe("xRange",r,n,s,i,a,o,u);let c=He(i),l=c||He(a),d=l||He(o),f=d;return s==="="&&f&&(s=""),u=e.includePrerelease?"-0":"",c?s===">"||s==="<"?n="<0.0.0-0":n="*":s&&f?(l&&(a=0),o=0,s===">"?(s=">=",l?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):s==="<="&&(s="<",l?i=+i+1:a=+a+1),s==="<"&&(u="-0"),n=`${s+i}.${a}.${o}${u}`):l?n=`>=${i}.0.0${u} <${+i+1}.0.0-0`:d&&(n=`>=${i}.${a}.0${u} <${i}.${+a+1}.0-0`),fe("xRange return",n),n})},M0=(r,e)=>(fe("replaceStars",r,e),r.trim().replace(Ge[Fe.STAR],"")),L0=(r,e)=>(fe("replaceGTE0",r,e),r.trim().replace(Ge[e.includePrerelease?Fe.GTE0PRE:Fe.GTE0],"")),z0=r=>(e,t,n,s,i,a,o,u,c,l,d,f)=>(He(n)?t="":He(s)?t=`>=${n}.0.0${r?"-0":""}`:He(i)?t=`>=${n}.${s}.0${r?"-0":""}`:a?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,He(c)?u="":He(l)?u=`<${+c+1}.0.0-0`:He(d)?u=`<${c}.${+l+1}.0-0`:f?u=`<=${c}.${l}.${d}-${f}`:r?u=`<${c}.${l}.${+d+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),D0=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(fe(r[n].semver),r[n].semver!==Rl.ANY&&r[n].semver.prerelease.length>0){let s=r[n].semver;if(s.major===e.major&&s.minor===e.minor&&s.patch===e.patch)return!0}return!1}return!0}});var wa=j((Vk,Pm)=>{"use strict";var xa=Symbol("SemVer ANY"),$l=class r{static get ANY(){return xa}constructor(e,t){if(t=Am(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Cl("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===xa?this.value="":this.value=this.operator+this.semver.version,Cl("comp",this)}parse(e){let t=this.options.loose?Em[Om.COMPARATORLOOSE]:Em[Om.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Im(n[2],this.options.loose):this.semver=xa}toString(){return this.value}test(e){if(Cl("Comparator.test",e,this.options.loose),this.semver===xa||e===xa)return!0;if(typeof e=="string")try{e=new Im(e,this.options)}catch{return!1}return Nl(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Tm(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new Tm(this.value,t).test(e.semver):(t=Am(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Nl(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Nl(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Pm.exports=$l;var Am=Yo(),{safeRe:Em,t:Om}=Ks(),Nl=Pl(),Cl=ya(),Im=Ue(),Tm=vt()});var va=j((Kk,Sm)=>{"use strict";var U0=vt(),F0=(r,e,t)=>{try{e=new U0(e,t)}catch{return!1}return e.test(r)};Sm.exports=F0});var Rm=j((Jk,km)=>{"use strict";var B0=vt(),Z0=(r,e)=>new B0(r,e).set.map(t=>t.map(n=>n.value).join(" ").trim().split(" "));km.exports=Z0});var Cm=j((Wk,Nm)=>{"use strict";var q0=Ue(),G0=vt(),H0=(r,e,t)=>{let n=null,s=null,i=null;try{i=new G0(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!n||s.compare(a)===-1)&&(n=a,s=new q0(n,t))}),n};Nm.exports=H0});var jm=j((Yk,$m)=>{"use strict";var V0=Ue(),K0=vt(),J0=(r,e,t)=>{let n=null,s=null,i=null;try{i=new K0(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!n||s.compare(a)===1)&&(n=a,s=new V0(n,t))}),n};$m.exports=J0});var zm=j((Xk,Lm)=>{"use strict";var jl=Ue(),W0=vt(),Mm=ba(),Y0=(r,e)=>{r=new W0(r,e);let t=new jl("0.0.0");if(r.test(t)||(t=new jl("0.0.0-0"),r.test(t)))return t;t=null;for(let n=0;n<r.set.length;++n){let s=r.set[n],i=null;s.forEach(a=>{let o=new jl(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!i||Mm(o,i))&&(i=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),i&&(!t||Mm(t,i))&&(t=i)}return t&&r.test(t)?t:null};Lm.exports=Y0});var Um=j((Qk,Dm)=>{"use strict";var X0=vt(),Q0=(r,e)=>{try{return new X0(r,e).range||"*"}catch{return null}};Dm.exports=Q0});var uu=j((eR,qm)=>{"use strict";var eA=Ue(),Zm=wa(),{ANY:tA}=Zm,rA=vt(),nA=va(),Fm=ba(),Bm=nu(),sA=iu(),iA=su(),aA=(r,e,t,n)=>{r=new eA(r,n),e=new rA(e,n);let s,i,a,o,u;switch(t){case">":s=Fm,i=sA,a=Bm,o=">",u=">=";break;case"<":s=Bm,i=iA,a=Fm,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(nA(r,e,n))return!1;for(let c=0;c<e.set.length;++c){let l=e.set[c],d=null,f=null;if(l.forEach(p=>{p.semver===tA&&(p=new Zm(">=0.0.0")),d=d||p,f=f||p,s(p.semver,d.semver,n)?d=p:a(p.semver,f.semver,n)&&(f=p)}),d.operator===o||d.operator===u||(!f.operator||f.operator===o)&&i(r,f.semver))return!1;if(f.operator===u&&a(r,f.semver))return!1}return!0};qm.exports=aA});var Hm=j((tR,Gm)=>{"use strict";var oA=uu(),uA=(r,e,t)=>oA(r,e,">",t);Gm.exports=uA});var Km=j((rR,Vm)=>{"use strict";var cA=uu(),lA=(r,e,t)=>cA(r,e,"<",t);Vm.exports=lA});var Ym=j((nR,Wm)=>{"use strict";var Jm=vt(),dA=(r,e,t)=>(r=new Jm(r,t),e=new Jm(e,t),r.intersects(e,t));Wm.exports=dA});var Qm=j((sR,Xm)=>{"use strict";var fA=va(),pA=xt();Xm.exports=(r,e,t)=>{let n=[],s=null,i=null,a=r.sort((l,d)=>pA(l,d,t));for(let l of a)fA(l,e,t)?(i=l,s||(s=l)):(i&&n.push([s,i]),i=null,s=null);s&&n.push([s,null]);let o=[];for(let[l,d]of n)l===d?o.push(l):!d&&l===a[0]?o.push("*"):d?l===a[0]?o.push(`<=${d}`):o.push(`${l} - ${d}`):o.push(`>=${l}`);let u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var ig=j((iR,sg)=>{"use strict";var eg=vt(),Ll=wa(),{ANY:Ml}=Ll,Aa=va(),zl=xt(),hA=(r,e,t={})=>{if(r===e)return!0;r=new eg(r,t),e=new eg(e,t);let n=!1;e:for(let s of r.set){for(let i of e.set){let a=gA(s,i,t);if(n=n||a!==null,a)continue e}if(n)return!1}return!0},mA=[new Ll(">=0.0.0-0")],tg=[new Ll(">=0.0.0")],gA=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===Ml){if(e.length===1&&e[0].semver===Ml)return!0;t.includePrerelease?r=mA:r=tg}if(e.length===1&&e[0].semver===Ml){if(t.includePrerelease)return!0;e=tg}let n=new Set,s,i;for(let p of r)p.operator===">"||p.operator===">="?s=rg(s,p,t):p.operator==="<"||p.operator==="<="?i=ng(i,p,t):n.add(p.semver);if(n.size>1)return null;let a;if(s&&i){if(a=zl(s.semver,i.semver,t),a>0)return null;if(a===0&&(s.operator!==">="||i.operator!=="<="))return null}for(let p of n){if(s&&!Aa(p,String(s),t)||i&&!Aa(p,String(i),t))return null;for(let h of e)if(!Aa(p,String(h),t))return!1;return!0}let o,u,c,l,d=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1,f=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1;d&&d.prerelease.length===1&&i.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let p of e){if(l=l||p.operator===">"||p.operator===">=",c=c||p.operator==="<"||p.operator==="<=",s){if(f&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===f.major&&p.semver.minor===f.minor&&p.semver.patch===f.patch&&(f=!1),p.operator===">"||p.operator===">="){if(o=rg(s,p,t),o===p&&o!==s)return!1}else if(s.operator===">="&&!Aa(s.semver,String(p),t))return!1}if(i){if(d&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===d.major&&p.semver.minor===d.minor&&p.semver.patch===d.patch&&(d=!1),p.operator==="<"||p.operator==="<="){if(u=ng(i,p,t),u===p&&u!==i)return!1}else if(i.operator==="<="&&!Aa(i.semver,String(p),t))return!1}if(!p.operator&&(i||s)&&a!==0)return!1}return!(s&&c&&!i&&a!==0||i&&l&&!s&&a!==0||f||d)},rg=(r,e,t)=>{if(!r)return e;let n=zl(r.semver,e.semver,t);return n>0?r:n<0||e.operator===">"&&r.operator===">="?e:r},ng=(r,e,t)=>{if(!r)return e;let n=zl(r.semver,e.semver,t);return n<0?r:n>0||e.operator==="<"&&r.operator==="<="?e:r};sg.exports=hA});var cg=j((aR,ug)=>{"use strict";var Dl=Ks(),ag=_a(),_A=Ue(),og=Al(),yA=es(),bA=Ch(),wA=jh(),xA=zh(),vA=Fh(),AA=Zh(),EA=Gh(),OA=Vh(),IA=Jh(),TA=xt(),PA=Qh(),SA=tm(),kA=ru(),RA=im(),NA=om(),CA=ba(),$A=nu(),jA=Il(),MA=Tl(),LA=su(),zA=iu(),DA=Pl(),UA=gm(),FA=wa(),BA=vt(),ZA=va(),qA=Rm(),GA=Cm(),HA=jm(),VA=zm(),KA=Um(),JA=uu(),WA=Hm(),YA=Km(),XA=Ym(),QA=Qm(),eE=ig();ug.exports={parse:yA,valid:bA,clean:wA,inc:xA,diff:vA,major:AA,minor:EA,patch:OA,prerelease:IA,compare:TA,rcompare:PA,compareLoose:SA,compareBuild:kA,sort:RA,rsort:NA,gt:CA,lt:$A,eq:jA,neq:MA,gte:LA,lte:zA,cmp:DA,coerce:UA,Comparator:FA,Range:BA,satisfies:ZA,toComparators:qA,maxSatisfying:GA,minSatisfying:HA,minVersion:VA,validRange:KA,outside:JA,gtr:WA,ltr:YA,intersects:XA,simplifyRange:QA,subset:eE,SemVer:_A,re:Dl.re,src:Dl.src,tokens:Dl.t,SEMVER_SPEC_VERSION:ag.SEMVER_SPEC_VERSION,RELEASE_TYPES:ag.RELEASE_TYPES,compareIdentifiers:og.compareIdentifiers,rcompareIdentifiers:og.rcompareIdentifiers}});var Tg=j((HR,Ig)=>{"use strict";var Eg=(r=0)=>e=>`\x1B[${38+r};5;${e}m`,Og=(r=0)=>(e,t,n)=>`\x1B[${38+r};2;${e};${t};${n}m`;function TE(){let r=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,n]of Object.entries(e)){for(let[s,i]of Object.entries(n))e[s]={open:`\x1B[${i[0]}m`,close:`\x1B[${i[1]}m`},n[s]=e[s],r.set(i[0],i[1]);Object.defineProperty(e,t,{value:n,enumerable:!1})}return Object.defineProperty(e,"codes",{value:r,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=Eg(),e.color.ansi16m=Og(),e.bgColor.ansi256=Eg(10),e.bgColor.ansi16m=Og(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,n,s)=>t===n&&n===s?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(s/255*5),enumerable:!1},hexToRgb:{value:t=>{let n=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!n)return[0,0,0];let{colorString:s}=n.groups;s.length===3&&(s=s.split("").map(a=>a+a).join(""));let i=Number.parseInt(s,16);return[i>>16&255,i>>8&255,i&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(Ig,"exports",{enumerable:!0,get:TE})});var Uy=j(_c=>{"use strict";_c.byteLength=lT;_c.toByteArray=fT;_c.fromByteArray=mT;var hr=[],Ot=[],cT=typeof Uint8Array<"u"?Uint8Array:Array,ff="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Ss=0,zy=ff.length;Ss<zy;++Ss)hr[Ss]=ff[Ss],Ot[ff.charCodeAt(Ss)]=Ss;var Ss,zy;Ot[45]=62;Ot[95]=63;function Dy(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function lT(r){var e=Dy(r),t=e[0],n=e[1];return(t+n)*3/4-n}function dT(r,e,t){return(e+t)*3/4-t}function fT(r){var e,t=Dy(r),n=t[0],s=t[1],i=new cT(dT(r,n,s)),a=0,o=s>0?n-4:n,u;for(u=0;u<o;u+=4)e=Ot[r.charCodeAt(u)]<<18|Ot[r.charCodeAt(u+1)]<<12|Ot[r.charCodeAt(u+2)]<<6|Ot[r.charCodeAt(u+3)],i[a++]=e>>16&255,i[a++]=e>>8&255,i[a++]=e&255;return s===2&&(e=Ot[r.charCodeAt(u)]<<2|Ot[r.charCodeAt(u+1)]>>4,i[a++]=e&255),s===1&&(e=Ot[r.charCodeAt(u)]<<10|Ot[r.charCodeAt(u+1)]<<4|Ot[r.charCodeAt(u+2)]>>2,i[a++]=e>>8&255,i[a++]=e&255),i}function pT(r){return hr[r>>18&63]+hr[r>>12&63]+hr[r>>6&63]+hr[r&63]}function hT(r,e,t){for(var n,s=[],i=e;i<t;i+=3)n=(r[i]<<16&16711680)+(r[i+1]<<8&65280)+(r[i+2]&255),s.push(pT(n));return s.join("")}function mT(r){for(var e,t=r.length,n=t%3,s=[],i=16383,a=0,o=t-n;a<o;a+=i)s.push(hT(r,a,a+i>o?o:a+i));return n===1?(e=r[t-1],s.push(hr[e>>2]+hr[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],s.push(hr[e>>10]+hr[e>>4&63]+hr[e<<2&63]+"=")),s.join("")}});function Nc(r,e=Ms){r=r.trim();let t=r.indexOf("```");if(t===-1)return e(r);let n=r.substring(t+3);n.startsWith(`json
`)?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith(`
`)&&(n=n.substring(1));let s=n.indexOf("```"),i=n;return s!==-1&&(i=n.substring(0,s)),e(i.trim())}function Ms(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="",t=[],n=!1,s=!1;for(let i of r){if(n)i==='"'&&!s?n=!1:i===`
`&&!s?i="\\n":i==="\\"?s=!s:s=!1;else if(i==='"')n=!0,s=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}n&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch{return null}}var Hf=It(zf(),1),ew=It(Gf(),1);function Vf(r,e){return e?.[r]||(0,Hf.default)(r)}function Kf(r,e,t){let n={};for(let s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}function Jf(r){return Array.isArray(r)?[...r]:{...r}}function tw(r,e){let t=Jf(r);for(let[n,s]of Object.entries(e)){let[i,...a]=n.split(".").reverse(),o=t;for(let u of a.reverse()){if(o[u]===void 0)break;o[u]=Jf(o[u]),o=o[u]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}function $c(r){let e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}var Tt=class r{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,$c(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>this.lc_serializable_keys?.includes(n))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof r||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let i=this,a=n,[o,...u]=s.split(".").reverse();for(let c of u.reverse()){if(!(c in i)||i[c]===void 0)return;(!(c in a)||a[c]===void 0)&&(typeof i[c]=="object"&&i[c]!=null?a[c]={}:Array.isArray(i[c])&&(a[c]=[])),i=i[c],a=a[c]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:Kf(Object.keys(t).length?tw(n,t):n,Vf,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function Ls(r){return typeof r=="object"&&r!==null&&"type"in r&&typeof r.type=="string"&&"source_type"in r&&(r.source_type==="url"||r.source_type==="base64"||r.source_type==="text"||r.source_type==="id")}function Wf(r){return Ls(r)&&r.source_type==="url"&&"url"in r&&typeof r.url=="string"}function Yf(r){return Ls(r)&&r.source_type==="base64"&&"data"in r&&typeof r.data=="string"}function Xf(r){if(Ls(r)){if(r.source_type==="url")return{type:"image_url",image_url:{url:r.url}};if(r.source_type==="base64"){if(!r.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${r.mime_type};base64,${r.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function ht(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:Array.isArray(e)&&e.some(t=>Ls(t))?[{type:"text",source_type:"text",text:r},...e]:[{type:"text",text:r},...e]:Array.isArray(e)?ia(r,e)??[...r,...e]:e===""?r:Array.isArray(r)&&r.some(t=>Ls(t))?[...r,{type:"file",source_type:"text",text:e}]:[...r,{type:"text",text:e}]}function Qf(r,e){return r==="error"||e==="error"?"error":"success"}function rw(r,e){function t(n,s){if(typeof n!="object"||n===null||n===void 0)return n;if(s>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(a=>t(a,s+1));let i={};for(let a of Object.keys(n))i[a]=t(n[a],s+1);return i}return JSON.stringify(t(r,0),null,2)}var Me=class extends Tt{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let t=rw(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}};function we(r,e){let t={...r};for(let[n,s]of Object.entries(e))if(t[n]==null)t[n]=s;else{if(s==null)continue;if(typeof t[n]!=typeof s||Array.isArray(t[n])!==Array.isArray(s))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;["id","name","output_version","model_provider"].includes(n)?t[n]=s:t[n]+=s}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=we(t[n],s);else if(Array.isArray(t[n]))t[n]=ia(t[n],s);else{if(t[n]===s)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function ia(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{let t=[...r];for(let n of e)if(typeof n=="object"&&n!==null&&"index"in n&&typeof n.index=="number"){let s=t.findIndex(i=>{let a=typeof i=="object",o="index"in i&&i.index===n.index,u="id"in i&&"id"in n&&i?.id===n?.id,c=!("id"in i)||!i?.id||!("id"in n)||!n?.id;return a&&o&&(u||c)});s!==-1&&typeof t[s]=="object"&&t[s]!==null?t[s]=we(t[s],n):t.push(n)}else{if(typeof n=="object"&&n!==null&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function ep(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return ia(r,e);if(typeof r=="object"&&typeof e=="object")return we(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}var We=class extends Me{};function tp(r){return typeof r.role=="string"}function Fr(r){return typeof r?._getType=="function"}function jc(r){return Fr(r)&&typeof r.concat=="function"}function rp(r){return r!=null&&typeof r=="object"&&"lc_direct_tool_output"in r&&r.lc_direct_tool_output===!0}var yr=class extends Me{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status,this.metadata=e.metadata}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},zs=class r extends We{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new r({content:ht(this.content,e.content),additional_kwargs:we(this.additional_kwargs,e.additional_kwargs),response_metadata:we(this.response_metadata,e.response_metadata),artifact:ep(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:Qf(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function np(r){let e=[],t=[];for(let n of r)if(n.function){let s=n.function.name;try{let i=JSON.parse(n.function.arguments),a={name:s||"",args:i||{},id:n.id};e.push(a)}catch{t.push({name:s,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}var mt=class extends Me{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;let s=n.additional_kwargs?.tool_calls,i=n.tool_calls;s!=null&&s.length>0&&(i===void 0||i.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(s!=null&&i===void 0){let[a,o]=np(s);n.tool_calls=a??[],n.invalid_tool_calls=o??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}};function Pn(r){return r._getType()==="ai"}function Mc(r){return r._getType()==="ai"}var gt=class r extends We{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0||e.tool_call_chunks.length===0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{let s=(e.tool_call_chunks??[]).reduce((o,u)=>{let c=o.findIndex(([l])=>"id"in u&&u.id&&"index"in u&&u.index!==void 0?u.id===l.id&&u.index===l.index:"id"in u&&u.id?u.id===l.id:"index"in u&&u.index!==void 0?u.index===l.index:!1);return c!==-1?o[c].push(u):o.push([u]),o},[]),i=[],a=[];for(let o of s){let u={},c=o[0]?.name??"",l=o.map(p=>p.args||"").join(""),d=l.length?l:"{}",f=o[0]?.id;try{if(u=Ms(d),!f||u===null||typeof u!="object"||Array.isArray(u))throw new Error("Malformed tool call chunk args.");i.push({name:c,args:u,id:f,type:"tool_call"})}catch{a.push({name:c,args:d,id:f,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:i,invalid_tool_calls:a,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:ht(this.content,e.content),additional_kwargs:we(this.additional_kwargs,e.additional_kwargs),response_metadata:we(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let n=ia(this.tool_call_chunks,e.tool_call_chunks);n!==void 0&&n.length>0&&(t.tool_call_chunks=n)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let n={...(this.usage_metadata?.input_token_details?.audio!==void 0||e.usage_metadata?.input_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)},...(this.usage_metadata?.input_token_details?.cache_read!==void 0||e.usage_metadata?.input_token_details?.cache_read!==void 0)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)},...(this.usage_metadata?.input_token_details?.cache_creation!==void 0||e.usage_metadata?.input_token_details?.cache_creation!==void 0)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}},s={...(this.usage_metadata?.output_token_details?.audio!==void 0||e.usage_metadata?.output_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)},...(this.usage_metadata?.output_token_details?.reasoning!==void 0||e.usage_metadata?.output_token_details?.reasoning!==void 0)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}},i=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},o={input_tokens:i.input_tokens+a.input_tokens,output_tokens:i.output_tokens+a.output_tokens,total_tokens:i.total_tokens+a.total_tokens,...Object.keys(n).length>0&&{input_token_details:n},...Object.keys(s).length>0&&{output_token_details:s}};t.usage_metadata=o}return new r(t)}};var Br=class r extends Me{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return r}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},Sn=class r extends We{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new r({content:ht(this.content,e.content),additional_kwargs:we(this.additional_kwargs,e.additional_kwargs),response_metadata:we(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}};var kn=class r extends We{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new r({content:ht(this.content,e.content),additional_kwargs:we(this.additional_kwargs,e.additional_kwargs),response_metadata:we(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};var it=class extends Me{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}},Rn=class r extends We{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new r({content:ht(this.content,e.content),additional_kwargs:we(this.additional_kwargs,e.additional_kwargs),response_metadata:we(this.response_metadata,e.response_metadata),id:this.id??e.id})}};var Zr=class extends Me{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}},qr=class r extends We{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new r({content:ht(this.content,e.content),additional_kwargs:we(this.additional_kwargs,e.additional_kwargs),response_metadata:we(this.response_metadata,e.response_metadata),id:this.id??e.id})}};function bo(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Gr(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}function sp(r){return!!(r&&typeof r=="object"&&"toolCall"in r&&r.toolCall!=null&&typeof r.toolCall=="object"&&"id"in r.toolCall&&typeof r.toolCall.id=="string")}var Nn=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}};var aa=class extends Me{constructor(e){super({...e,content:""}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e.id}_getType(){return"remove"}get _printableFields(){return{...super._printableFields,id:this.id}}};function sw(r){return Gr(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function iw(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function Lc(r){let e,t;if(iw(r)){let n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{let{type:n,...s}=r;e=n,t=s}if(e==="human"||e==="user")return new it(t);if(e==="ai"||e==="assistant"){let{tool_calls:n,...s}=t;if(!Array.isArray(n))return new mt(t);let i=n.map(sw);return new mt({...s,tool_calls:i})}else{if(e==="system")return new Zr(t);if(e==="developer")return new Zr({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new yr({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});if(e==="remove"&&"id"in t&&typeof t.id=="string")return new aa({...t,id:t.id});throw bo(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Cn(r){if(typeof r=="string")return new it(r);if(Fr(r))return r;if(Array.isArray(r)){let[e,t]=r;return Lc({type:e,content:t})}else if(tp(r)){let{role:e,...t}=r;return Lc({...t,type:e})}else return Lc(r)}function oa(r,e="Human",t="AI"){let n=[];for(let s of r){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="tool")i="Tool";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);let a=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);n.push(`${i}: ${a}${o}`)}return n.join(`
`)}function zc(r){let e=r._getType();if(e==="human")return new Rn({...r});if(e==="ai"){let t={...r};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(n=>({...n,type:"tool_call_chunk",index:void 0,args:JSON.stringify(n.args)}))}),new gt({...t})}else{if(e==="system")return new qr({...r});if(e==="function")return new kn({...r});if(Br.isInstance(r))return new Sn({...r});throw new Error("Unknown message type.")}}var at={};Mf(at,{BRAND:()=>Rw,DIRTY:()=>$n,EMPTY_PATH:()=>cw,INVALID:()=>U,NEVER:()=>mx,OK:()=>Le,ParseStatus:()=>Ne,Schema:()=>te,ZodAny:()=>Kr,ZodArray:()=>vr,ZodBigInt:()=>Mn,ZodBoolean:()=>Ln,ZodBranded:()=>ca,ZodCatch:()=>Kn,ZodDate:()=>zn,ZodDefault:()=>Vn,ZodDiscriminatedUnion:()=>vo,ZodEffects:()=>bt,ZodEnum:()=>Gn,ZodError:()=>Ye,ZodFirstPartyTypeKind:()=>b,ZodFunction:()=>Eo,ZodIntersection:()=>Bn,ZodIssueCode:()=>v,ZodLazy:()=>Zn,ZodLiteral:()=>qn,ZodMap:()=>qs,ZodNaN:()=>Hs,ZodNativeEnum:()=>Hn,ZodNever:()=>Pt,ZodNull:()=>Un,ZodNullable:()=>Kt,ZodNumber:()=>jn,ZodObject:()=>Xe,ZodOptional:()=>_t,ZodParsedType:()=>T,ZodPipeline:()=>la,ZodPromise:()=>Jr,ZodReadonly:()=>Jn,ZodRecord:()=>Ao,ZodSchema:()=>te,ZodSet:()=>Gs,ZodString:()=>Vr,ZodSymbol:()=>Bs,ZodTransformer:()=>bt,ZodTuple:()=>Vt,ZodType:()=>te,ZodUndefined:()=>Dn,ZodUnion:()=>Fn,ZodUnknown:()=>xr,ZodVoid:()=>Zs,addIssueToContext:()=>O,any:()=>Uw,array:()=>qw,bigint:()=>jw,boolean:()=>mp,coerce:()=>hx,custom:()=>fp,date:()=>Mw,datetimeRegex:()=>lp,defaultErrorMap:()=>br,discriminatedUnion:()=>Kw,effect:()=>ax,enum:()=>nx,function:()=>ex,getErrorMap:()=>Ds,getParsedType:()=>Ht,instanceof:()=>Cw,intersection:()=>Jw,isAborted:()=>wo,isAsync:()=>Us,isDirty:()=>xo,isValid:()=>Hr,late:()=>Nw,lazy:()=>tx,literal:()=>rx,makeIssue:()=>ua,map:()=>Xw,nan:()=>$w,nativeEnum:()=>sx,never:()=>Bw,null:()=>Dw,nullable:()=>ux,number:()=>hp,object:()=>Gw,objectUtil:()=>Dc,oboolean:()=>px,onumber:()=>fx,optional:()=>ox,ostring:()=>dx,pipeline:()=>lx,preprocess:()=>cx,promise:()=>ix,quotelessJson:()=>aw,record:()=>Yw,set:()=>Qw,setErrorMap:()=>uw,strictObject:()=>Hw,string:()=>pp,symbol:()=>Lw,transformer:()=>ax,tuple:()=>Ww,undefined:()=>zw,union:()=>Vw,unknown:()=>Fw,util:()=>se,void:()=>Zw});var se;(function(r){r.assertEqual=s=>{};function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{let i={};for(let a of s)i[a]=a;return i},r.getValidEnumValues=s=>{let i=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(let o of i)a[o]=s[o];return r.objectValues(a)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let i=[];for(let a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},r.find=(s,i)=>{for(let a of s)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(se||(se={}));var Dc;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Dc||(Dc={}));var T=se.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ht=r=>{switch(typeof r){case"undefined":return T.undefined;case"string":return T.string;case"number":return Number.isNaN(r)?T.nan:T.number;case"boolean":return T.boolean;case"function":return T.function;case"bigint":return T.bigint;case"symbol":return T.symbol;case"object":return Array.isArray(r)?T.array:r===null?T.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?T.promise:typeof Map<"u"&&r instanceof Map?T.map:typeof Set<"u"&&r instanceof Set?T.set:typeof Date<"u"&&r instanceof Date?T.date:T.object;default:return T.unknown}};var v=se.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),aw=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),Ye=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(let a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)n._errors.push(t(a));else{let o=n,u=0;for(;u<a.path.length;){let c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return s(this),n}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,se.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let s of this.issues)if(s.path.length>0){let i=s.path[0];t[i]=t[i]||[],t[i].push(e(s))}else n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};Ye.create=r=>new Ye(r);var ow=(r,e)=>{let t;switch(r.code){case v.invalid_type:r.received===T.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case v.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,se.jsonStringifyReplacer)}`;break;case v.unrecognized_keys:t=`Unrecognized key(s) in object: ${se.joinValues(r.keys,", ")}`;break;case v.invalid_union:t="Invalid input";break;case v.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${se.joinValues(r.options)}`;break;case v.invalid_enum_value:t=`Invalid enum value. Expected ${se.joinValues(r.options)}, received '${r.received}'`;break;case v.invalid_arguments:t="Invalid function arguments";break;case v.invalid_return_type:t="Invalid function return type";break;case v.invalid_date:t="Invalid date";break;case v.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:se.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case v.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case v.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case v.custom:t="Invalid input";break;case v.invalid_intersection_types:t="Intersection results could not be merged";break;case v.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case v.not_finite:t="Number must be finite";break;default:t=e.defaultError,se.assertNever(r)}return{message:t}},br=ow;var ip=br;function uw(r){ip=r}function Ds(){return ip}var ua=r=>{let{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}},cw=[];function O(r,e){let t=Ds(),n=ua({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===br?void 0:br].filter(s=>!!s)});r.common.issues.push(n)}var Ne=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let s of t){if(s.status==="aborted")return U;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let s of t){let i=await s.key,a=await s.value;n.push({key:i,value:a})}return r.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let s of t){let{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return U;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(n[i.value]=a.value)}return{status:e.value,value:n}}},U=Object.freeze({status:"aborted"}),$n=r=>({status:"dirty",value:r}),Le=r=>({status:"valid",value:r}),wo=r=>r.status==="aborted",xo=r=>r.status==="dirty",Hr=r=>r.status==="valid",Us=r=>typeof Promise<"u"&&r instanceof Promise;var $;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})($||($={}));var yt=class{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},ap=(r,e)=>{if(Hr(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Ye(r.common.issues);return this._error=t,this._error}}};function Q(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{let{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??n??o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:s}}var te=class{get description(){return this._def.description}_getType(e){return Ht(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Us(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){let n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ht(e)},s=this._parseSync({data:e,path:n.path,parent:n});return ap(n,s)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ht(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:t});return Hr(n)?{value:n.value}:{issues:t.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(n=>Hr(n)?{value:n.value}:{issues:t.common.issues})}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ht(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(Us(s)?s:Promise.resolve(s));return ap(n,i)}refine(e,t){let n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{let a=e(s),o=()=>i.addIssue({code:v.custom,...n(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new bt({schema:this,typeName:b.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return _t.create(this,this._def)}nullable(){return Kt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return vr.create(this)}promise(){return Jr.create(this,this._def)}or(e){return Fn.create([this,e],this._def)}and(e){return Bn.create(this,e,this._def)}transform(e){return new bt({...Q(this._def),schema:this,typeName:b.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Vn({...Q(this._def),innerType:this,defaultValue:t,typeName:b.ZodDefault})}brand(){return new ca({typeName:b.ZodBranded,type:this,...Q(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Kn({...Q(this._def),innerType:this,catchValue:t,typeName:b.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return la.create(this,e)}readonly(){return Jn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},lw=/^c[^\s-]{8,}$/i,dw=/^[0-9a-z]+$/,fw=/^[0-9A-HJKMNP-TV-Z]{26}$/i,pw=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,hw=/^[a-z0-9_-]{21}$/i,mw=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,gw=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,_w=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,yw="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Uc,bw=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ww=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,xw=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,vw=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Aw=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Ew=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,up="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Ow=new RegExp(`^${up}$`);function cp(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Iw(r){return new RegExp(`^${cp(r)}$`)}function lp(r){let e=`${up}T${cp(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Tw(r,e){return!!((e==="v4"||!e)&&bw.test(r)||(e==="v6"||!e)&&xw.test(r))}function Pw(r,e){if(!mw.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function Sw(r,e){return!!((e==="v4"||!e)&&ww.test(r)||(e==="v6"||!e)&&vw.test(r))}var Vr=class r extends te{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==T.string){let i=this._getOrReturnCtx(e);return O(i,{code:v.invalid_type,expected:T.string,received:i.parsedType}),U}let n=new Ne,s;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),O(s,{code:v.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),O(s,{code:v.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?O(s,{code:v.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&O(s,{code:v.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")_w.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"email",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Uc||(Uc=new RegExp(yw,"u")),Uc.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"emoji",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")pw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"uuid",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")hw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"nanoid",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")lw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"cuid",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")dw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"cuid2",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")fw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"ulid",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),O(s,{validation:"url",code:v.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"regex",code:v.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),O(s,{code:v.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),O(s,{code:v.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),O(s,{code:v.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?lp(i).test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{code:v.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?Ow.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{code:v.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?Iw(i).test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{code:v.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?gw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"duration",code:v.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?Tw(e.data,i.version)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"ip",code:v.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?Pw(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"jwt",code:v.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?Sw(e.data,i.version)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"cidr",code:v.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?Aw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"base64",code:v.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?Ew.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"base64url",code:v.invalid_string,message:i.message}),n.dirty()):se.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:v.invalid_string,...$.errToObj(n)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...$.errToObj(e)})}url(e){return this._addCheck({kind:"url",...$.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...$.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...$.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...$.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...$.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...$.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...$.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...$.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...$.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...$.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...$.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...$.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...$.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...$.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...$.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...$.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...$.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...$.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...$.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...$.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...$.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...$.errToObj(t)})}nonempty(e){return this.min(1,$.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Vr.create=r=>new Vr({checks:[],typeName:b.ZodString,coerce:r?.coerce??!1,...Q(r)});function kw(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=Number.parseInt(r.toFixed(s).replace(".","")),a=Number.parseInt(e.toFixed(s).replace(".",""));return i%a/10**s}var jn=class r extends te{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==T.number){let i=this._getOrReturnCtx(e);return O(i,{code:v.invalid_type,expected:T.number,received:i.parsedType}),U}let n,s=new Ne;for(let i of this._def.checks)i.kind==="int"?se.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{code:v.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),O(n,{code:v.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),O(n,{code:v.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?kw(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),O(n,{code:v.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{code:v.not_finite,message:i.message}),s.dirty()):se.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,$.toString(t))}gt(e,t){return this.setLimit("min",e,!1,$.toString(t))}lte(e,t){return this.setLimit("max",e,!0,$.toString(t))}lt(e,t){return this.setLimit("max",e,!1,$.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:$.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:$.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:$.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:$.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:$.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:$.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:$.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:$.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:$.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:$.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&se.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};jn.create=r=>new jn({checks:[],typeName:b.ZodNumber,coerce:r?.coerce||!1,...Q(r)});var Mn=class r extends te{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==T.bigint)return this._getInvalidInput(e);let n,s=new Ne;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),O(n,{code:v.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),O(n,{code:v.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),O(n,{code:v.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):se.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return O(t,{code:v.invalid_type,expected:T.bigint,received:t.parsedType}),U}gte(e,t){return this.setLimit("min",e,!0,$.toString(t))}gt(e,t){return this.setLimit("min",e,!1,$.toString(t))}lte(e,t){return this.setLimit("max",e,!0,$.toString(t))}lt(e,t){return this.setLimit("max",e,!1,$.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:$.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:$.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:$.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:$.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:$.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:$.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Mn.create=r=>new Mn({checks:[],typeName:b.ZodBigInt,coerce:r?.coerce??!1,...Q(r)});var Ln=class extends te{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==T.boolean){let n=this._getOrReturnCtx(e);return O(n,{code:v.invalid_type,expected:T.boolean,received:n.parsedType}),U}return Le(e.data)}};Ln.create=r=>new Ln({typeName:b.ZodBoolean,coerce:r?.coerce||!1,...Q(r)});var zn=class r extends te{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==T.date){let i=this._getOrReturnCtx(e);return O(i,{code:v.invalid_type,expected:T.date,received:i.parsedType}),U}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return O(i,{code:v.invalid_date}),U}let n=new Ne,s;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),O(s,{code:v.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),O(s,{code:v.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):se.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:$.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:$.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};zn.create=r=>new zn({checks:[],coerce:r?.coerce||!1,typeName:b.ZodDate,...Q(r)});var Bs=class extends te{_parse(e){if(this._getType(e)!==T.symbol){let n=this._getOrReturnCtx(e);return O(n,{code:v.invalid_type,expected:T.symbol,received:n.parsedType}),U}return Le(e.data)}};Bs.create=r=>new Bs({typeName:b.ZodSymbol,...Q(r)});var Dn=class extends te{_parse(e){if(this._getType(e)!==T.undefined){let n=this._getOrReturnCtx(e);return O(n,{code:v.invalid_type,expected:T.undefined,received:n.parsedType}),U}return Le(e.data)}};Dn.create=r=>new Dn({typeName:b.ZodUndefined,...Q(r)});var Un=class extends te{_parse(e){if(this._getType(e)!==T.null){let n=this._getOrReturnCtx(e);return O(n,{code:v.invalid_type,expected:T.null,received:n.parsedType}),U}return Le(e.data)}};Un.create=r=>new Un({typeName:b.ZodNull,...Q(r)});var Kr=class extends te{constructor(){super(...arguments),this._any=!0}_parse(e){return Le(e.data)}};Kr.create=r=>new Kr({typeName:b.ZodAny,...Q(r)});var xr=class extends te{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Le(e.data)}};xr.create=r=>new xr({typeName:b.ZodUnknown,...Q(r)});var Pt=class extends te{_parse(e){let t=this._getOrReturnCtx(e);return O(t,{code:v.invalid_type,expected:T.never,received:t.parsedType}),U}};Pt.create=r=>new Pt({typeName:b.ZodNever,...Q(r)});var Zs=class extends te{_parse(e){if(this._getType(e)!==T.undefined){let n=this._getOrReturnCtx(e);return O(n,{code:v.invalid_type,expected:T.void,received:n.parsedType}),U}return Le(e.data)}};Zs.create=r=>new Zs({typeName:b.ZodVoid,...Q(r)});var vr=class r extends te{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==T.array)return O(t,{code:v.invalid_type,expected:T.array,received:t.parsedType}),U;if(s.exactLength!==null){let a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(O(t,{code:a?v.too_big:v.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(O(t,{code:v.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(O(t,{code:v.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new yt(t,a,t.path,o)))).then(a=>Ne.mergeArray(n,a));let i=[...t.data].map((a,o)=>s.type._parseSync(new yt(t,a,t.path,o)));return Ne.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:$.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:$.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:$.toString(t)}})}nonempty(e){return this.min(1,e)}};vr.create=(r,e)=>new vr({type:r,minLength:null,maxLength:null,exactLength:null,typeName:b.ZodArray,...Q(e)});function Fs(r){if(r instanceof Xe){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=_t.create(Fs(n))}return new Xe({...r._def,shape:()=>e})}else return r instanceof vr?new vr({...r._def,type:Fs(r.element)}):r instanceof _t?_t.create(Fs(r.unwrap())):r instanceof Kt?Kt.create(Fs(r.unwrap())):r instanceof Vt?Vt.create(r.items.map(e=>Fs(e))):r}var Xe=class r extends te{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=se.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==T.object){let c=this._getOrReturnCtx(e);return O(c,{code:v.invalid_type,expected:T.object,received:c.parsedType}),U}let{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Pt&&this._def.unknownKeys==="strip"))for(let c in s.data)a.includes(c)||o.push(c);let u=[];for(let c of a){let l=i[c],d=s.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new yt(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof Pt){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(c==="strict")o.length>0&&(O(s,{code:v.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let d=s.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new yt(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let d=await l.key,f=await l.value;c.push({key:d,value:f,alwaysSet:l.alwaysSet})}return c}).then(c=>Ne.mergeObjectSync(n,c)):Ne.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return $.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{let s=this._def.errorMap?.(t,n).message??n.defaultError;return t.code==="unrecognized_keys"?{message:$.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:b.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};for(let n of se.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new r({...this._def,shape:()=>t})}omit(e){let t={};for(let n of se.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new r({...this._def,shape:()=>t})}deepPartial(){return Fs(this)}partial(e){let t={};for(let n of se.objectKeys(this.shape)){let s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}return new r({...this._def,shape:()=>t})}required(e){let t={};for(let n of se.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof _t;)i=i._def.innerType;t[n]=i}return new r({...this._def,shape:()=>t})}keyof(){return dp(se.objectKeys(this.shape))}};Xe.create=(r,e)=>new Xe({shape:()=>r,unknownKeys:"strip",catchall:Pt.create(),typeName:b.ZodObject,...Q(e)});Xe.strictCreate=(r,e)=>new Xe({shape:()=>r,unknownKeys:"strict",catchall:Pt.create(),typeName:b.ZodObject,...Q(e)});Xe.lazycreate=(r,e)=>new Xe({shape:r,unknownKeys:"strip",catchall:Pt.create(),typeName:b.ZodObject,...Q(e)});var Fn=class extends te{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let a=i.map(o=>new Ye(o.ctx.common.issues));return O(t,{code:v.invalid_union,unionErrors:a}),U}if(t.common.async)return Promise.all(n.map(async i=>{let a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i,a=[];for(let u of n){let c={...t,common:{...t.common,issues:[]},parent:null},l=u._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let o=a.map(u=>new Ye(u));return O(t,{code:v.invalid_union,unionErrors:o}),U}}get options(){return this._def.options}};Fn.create=(r,e)=>new Fn({options:r,typeName:b.ZodUnion,...Q(e)});var wr=r=>r instanceof Zn?wr(r.schema):r instanceof bt?wr(r.innerType()):r instanceof qn?[r.value]:r instanceof Gn?r.options:r instanceof Hn?se.objectValues(r.enum):r instanceof Vn?wr(r._def.innerType):r instanceof Dn?[void 0]:r instanceof Un?[null]:r instanceof _t?[void 0,...wr(r.unwrap())]:r instanceof Kt?[null,...wr(r.unwrap())]:r instanceof ca||r instanceof Jn?wr(r.unwrap()):r instanceof Kn?wr(r._def.innerType):[],vo=class r extends te{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==T.object)return O(t,{code:v.invalid_type,expected:T.object,received:t.parsedType}),U;let n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(O(t,{code:v.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),U)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let s=new Map;for(let i of t){let a=wr(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new r({typeName:b.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...Q(n)})}};function Fc(r,e){let t=Ht(r),n=Ht(e);if(r===e)return{valid:!0,data:r};if(t===T.object&&n===T.object){let s=se.objectKeys(e),i=se.objectKeys(r).filter(o=>s.indexOf(o)!==-1),a={...r,...e};for(let o of i){let u=Fc(r[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===T.array&&n===T.array){if(r.length!==e.length)return{valid:!1};let s=[];for(let i=0;i<r.length;i++){let a=r[i],o=e[i],u=Fc(a,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===T.date&&n===T.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var Bn=class extends te{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=(i,a)=>{if(wo(i)||wo(a))return U;let o=Fc(i.value,a.value);return o.valid?((xo(i)||xo(a))&&t.dirty(),{status:t.value,value:o.data}):(O(n,{code:v.invalid_intersection_types}),U)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Bn.create=(r,e,t)=>new Bn({left:r,right:e,typeName:b.ZodIntersection,...Q(t)});var Vt=class r extends te{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.array)return O(n,{code:v.invalid_type,expected:T.array,received:n.parsedType}),U;if(n.data.length<this._def.items.length)return O(n,{code:v.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),U;!this._def.rest&&n.data.length>this._def.items.length&&(O(n,{code:v.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...n.data].map((a,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new yt(n,a,n.path,o)):null}).filter(a=>!!a);return n.common.async?Promise.all(i).then(a=>Ne.mergeArray(t,a)):Ne.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};Vt.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Vt({items:r,typeName:b.ZodTuple,rest:null,...Q(e)})};var Ao=class r extends te{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.object)return O(n,{code:v.invalid_type,expected:T.object,received:n.parsedType}),U;let s=[],i=this._def.keyType,a=this._def.valueType;for(let o in n.data)s.push({key:i._parse(new yt(n,o,n.path,o)),value:a._parse(new yt(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?Ne.mergeObjectAsync(t,s):Ne.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof te?new r({keyType:e,valueType:t,typeName:b.ZodRecord,...Q(n)}):new r({keyType:Vr.create(),valueType:e,typeName:b.ZodRecord,...Q(t)})}},qs=class extends te{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.map)return O(n,{code:v.invalid_type,expected:T.map,received:n.parsedType}),U;let s=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([o,u],c)=>({key:s._parse(new yt(n,o,n.path,[c,"key"])),value:i._parse(new yt(n,u,n.path,[c,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of a){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return U;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let u of a){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return U;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}}}};qs.create=(r,e,t)=>new qs({valueType:e,keyType:r,typeName:b.ZodMap,...Q(t)});var Gs=class r extends te{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.set)return O(n,{code:v.invalid_type,expected:T.set,received:n.parsedType}),U;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(O(n,{code:v.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(O(n,{code:v.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let i=this._def.valueType;function a(u){let c=new Set;for(let l of u){if(l.status==="aborted")return U;l.status==="dirty"&&t.dirty(),c.add(l.value)}return{status:t.value,value:c}}let o=[...n.data.values()].map((u,c)=>i._parse(new yt(n,u,n.path,c)));return n.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new r({...this._def,minSize:{value:e,message:$.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:$.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Gs.create=(r,e)=>new Gs({valueType:r,minSize:null,maxSize:null,typeName:b.ZodSet,...Q(e)});var Eo=class r extends te{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==T.function)return O(t,{code:v.invalid_type,expected:T.function,received:t.parsedType}),U;function n(o,u){return ua({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ds(),br].filter(c=>!!c),issueData:{code:v.invalid_arguments,argumentsError:u}})}function s(o,u){return ua({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ds(),br].filter(c=>!!c),issueData:{code:v.invalid_return_type,returnTypeError:u}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Jr){let o=this;return Le(async function(...u){let c=new Ye([]),l=await o._def.args.parseAsync(u,i).catch(p=>{throw c.addIssue(n(u,p)),c}),d=await Reflect.apply(a,this,l);return await o._def.returns._def.type.parseAsync(d,i).catch(p=>{throw c.addIssue(s(d,p)),c})})}else{let o=this;return Le(function(...u){let c=o._def.args.safeParse(u,i);if(!c.success)throw new Ye([n(u,c.error)]);let l=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(l,i);if(!d.success)throw new Ye([s(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:Vt.create(e).rest(xr.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r({args:e||Vt.create([]).rest(xr.create()),returns:t||xr.create(),typeName:b.ZodFunction,...Q(n)})}},Zn=class extends te{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Zn.create=(r,e)=>new Zn({getter:r,typeName:b.ZodLazy,...Q(e)});var qn=class extends te{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return O(t,{received:t.data,code:v.invalid_literal,expected:this._def.value}),U}return{status:"valid",value:e.data}}get value(){return this._def.value}};qn.create=(r,e)=>new qn({value:r,typeName:b.ZodLiteral,...Q(e)});function dp(r,e){return new Gn({values:r,typeName:b.ZodEnum,...Q(e)})}var Gn=class r extends te{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return O(t,{expected:se.joinValues(n),received:t.parsedType,code:v.invalid_type}),U}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return O(t,{received:t.data,code:v.invalid_enum_value,options:n}),U}return Le(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}};Gn.create=dp;var Hn=class extends te{_parse(e){let t=se.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==T.string&&n.parsedType!==T.number){let s=se.objectValues(t);return O(n,{expected:se.joinValues(s),received:n.parsedType,code:v.invalid_type}),U}if(this._cache||(this._cache=new Set(se.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let s=se.objectValues(t);return O(n,{received:n.data,code:v.invalid_enum_value,options:s}),U}return Le(e.data)}get enum(){return this._def.values}};Hn.create=(r,e)=>new Hn({values:r,typeName:b.ZodNativeEnum,...Q(e)});var Jr=class extends te{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==T.promise&&t.common.async===!1)return O(t,{code:v.invalid_type,expected:T.promise,received:t.parsedType}),U;let n=t.parsedType===T.promise?t.data:Promise.resolve(t.data);return Le(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Jr.create=(r,e)=>new Jr({type:r,typeName:b.ZodPromise,...Q(e)});var bt=class extends te{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===b.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{O(n,a),a.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){let a=s.transform(n.data,i);if(n.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return U;let u=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return u.status==="aborted"?U:u.status==="dirty"?$n(u.value):t.value==="dirty"?$n(u.value):u});{if(t.value==="aborted")return U;let o=this._def.schema._parseSync({data:a,path:n.path,parent:n});return o.status==="aborted"?U:o.status==="dirty"?$n(o.value):t.value==="dirty"?$n(o.value):o}}if(s.type==="refinement"){let a=o=>{let u=s.refinement(o,i);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?U:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?U:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Hr(a))return U;let o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>Hr(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):U);se.assertNever(s)}};bt.create=(r,e,t)=>new bt({schema:r,typeName:b.ZodEffects,effect:e,...Q(t)});bt.createWithPreprocess=(r,e,t)=>new bt({schema:e,effect:{type:"preprocess",transform:r},typeName:b.ZodEffects,...Q(t)});var _t=class extends te{_parse(e){return this._getType(e)===T.undefined?Le(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};_t.create=(r,e)=>new _t({innerType:r,typeName:b.ZodOptional,...Q(e)});var Kt=class extends te{_parse(e){return this._getType(e)===T.null?Le(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Kt.create=(r,e)=>new Kt({innerType:r,typeName:b.ZodNullable,...Q(e)});var Vn=class extends te{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===T.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Vn.create=(r,e)=>new Vn({innerType:r,typeName:b.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Q(e)});var Kn=class extends te{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Us(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ye(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ye(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Kn.create=(r,e)=>new Kn({innerType:r,typeName:b.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Q(e)});var Hs=class extends te{_parse(e){if(this._getType(e)!==T.nan){let n=this._getOrReturnCtx(e);return O(n,{code:v.invalid_type,expected:T.nan,received:n.parsedType}),U}return{status:"valid",value:e.data}}};Hs.create=r=>new Hs({typeName:b.ZodNaN,...Q(r)});var Rw=Symbol("zod_brand"),ca=class extends te{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},la=class r extends te{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?U:i.status==="dirty"?(t.dirty(),$n(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?U:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:b.ZodPipeline})}},Jn=class extends te{_parse(e){let t=this._def.innerType._parse(e),n=s=>(Hr(s)&&(s.value=Object.freeze(s.value)),s);return Us(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}};Jn.create=(r,e)=>new Jn({innerType:r,typeName:b.ZodReadonly,...Q(e)});function op(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function fp(r,e={},t){return r?Kr.create().superRefine((n,s)=>{let i=r(n);if(i instanceof Promise)return i.then(a=>{if(!a){let o=op(e,n),u=o.fatal??t??!0;s.addIssue({code:"custom",...o,fatal:u})}});if(!i){let a=op(e,n),o=a.fatal??t??!0;s.addIssue({code:"custom",...a,fatal:o})}}):Kr.create()}var Nw={object:Xe.lazycreate},b;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(b||(b={}));var Cw=(r,e={message:`Input not instance of ${r.name}`})=>fp(t=>t instanceof r,e),pp=Vr.create,hp=jn.create,$w=Hs.create,jw=Mn.create,mp=Ln.create,Mw=zn.create,Lw=Bs.create,zw=Dn.create,Dw=Un.create,Uw=Kr.create,Fw=xr.create,Bw=Pt.create,Zw=Zs.create,qw=vr.create,Gw=Xe.create,Hw=Xe.strictCreate,Vw=Fn.create,Kw=vo.create,Jw=Bn.create,Ww=Vt.create,Yw=Ao.create,Xw=qs.create,Qw=Gs.create,ex=Eo.create,tx=Zn.create,rx=qn.create,nx=Gn.create,sx=Hn.create,ix=Jr.create,ax=bt.create,ox=_t.create,ux=Kt.create,cx=bt.createWithPreprocess,lx=la.create,dx=()=>pp().optional(),fx=()=>hp().optional(),px=()=>mp().optional(),hx={string:r=>Vr.create({...r,coerce:!0}),number:r=>jn.create({...r,coerce:!0}),boolean:r=>Ln.create({...r,coerce:!0}),bigint:r=>Mn.create({...r,coerce:!0}),date:r=>zn.create({...r,coerce:!0})};var mx=U;var wd=It(To(),1);var vp=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function xx(r){return typeof r=="string"&&vp.test(r)}var Wr=xx;function vx(r){if(!Wr(r))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Ap=vx;var Ce=[];for(Po=0;Po<256;++Po)Ce.push((Po+256).toString(16).slice(1));var Po;function So(r,e=0){return(Ce[r[e+0]]+Ce[r[e+1]]+Ce[r[e+2]]+Ce[r[e+3]]+"-"+Ce[r[e+4]]+Ce[r[e+5]]+"-"+Ce[r[e+6]]+Ce[r[e+7]]+"-"+Ce[r[e+8]]+Ce[r[e+9]]+"-"+Ce[r[e+10]]+Ce[r[e+11]]+Ce[r[e+12]]+Ce[r[e+13]]+Ce[r[e+14]]+Ce[r[e+15]]).toLowerCase()}var ko,Ax=new Uint8Array(16);function Bc(){if(!ko&&(ko=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ko))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ko(Ax)}function Ex(r){r=unescape(encodeURIComponent(r));for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}var Ox="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Ix="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Zc(r,e,t){function n(s,i,a,o){var u;if(typeof s=="string"&&(s=Ex(s)),typeof i=="string"&&(i=Ap(i)),((u=i)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+s.length);if(c.set(i),c.set(s,i.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,a){o=o||0;for(var l=0;l<16;++l)a[o+l]=c[l];return a}return So(c)}try{n.name=r}catch{}return n.DNS=Ox,n.URL=Ix,n}var Tx=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),qc={randomUUID:Tx};function Px(r,e,t){if(qc.randomUUID&&!e&&!r)return qc.randomUUID();r=r||{};var n=r.random||(r.rng||Bc)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=n[s];return e}return So(n)}var ye=Px;function Sx(r,e,t,n){switch(r){case 0:return e&t^~e&n;case 1:return e^t^n;case 2:return e&t^e&n^t&n;case 3:return e^t^n}}function Gc(r,e){return r<<e|r>>>32-e}function kx(r){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){var n=unescape(encodeURIComponent(r));r=[];for(var s=0;s<n.length;++s)r.push(n.charCodeAt(s))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);for(var i=r.length/4+2,a=Math.ceil(i/16),o=new Array(a),u=0;u<a;++u){for(var c=new Uint32Array(16),l=0;l<16;++l)c[l]=r[u*64+l*4]<<24|r[u*64+l*4+1]<<16|r[u*64+l*4+2]<<8|r[u*64+l*4+3];o[u]=c}o[a-1][14]=(r.length-1)*8/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=(r.length-1)*8&4294967295;for(var d=0;d<a;++d){for(var f=new Uint32Array(80),p=0;p<16;++p)f[p]=o[d][p];for(var h=16;h<80;++h)f[h]=Gc(f[h-3]^f[h-8]^f[h-14]^f[h-16],1);for(var m=t[0],g=t[1],y=t[2],_=t[3],w=t[4],A=0;A<80;++A){var E=Math.floor(A/20),z=Gc(m,5)+Sx(E,g,y,_)+w+e[E]+f[A]>>>0;w=_,_=y,y=Gc(g,30)>>>0,g=m,m=z}t[0]=t[0]+m>>>0,t[1]=t[1]+g>>>0,t[2]=t[2]+y>>>0,t[3]=t[3]+_>>>0,t[4]=t[4]+w>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var Ep=kx;var Rx=Zc("v5",80,Ep),Ro=Rx;var Kc=class{getStore(){}run(e,t){return t()}},Vc=Symbol.for("ls:tracing_async_local_storage"),Nx=new Kc,Jc=class{getInstance(){return globalThis[Vc]??Nx}initializeGlobalInstance(e){globalThis[Vc]===void 0&&(globalThis[Vc]=e)}},Cx=new Jc;function Op(r=!1){let e=Cx.getInstance().getStore();if(!r&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}var kS=Symbol.for("langsmith:traceable:root");function No(r){return typeof r=="function"&&"langsmith:traceable"in r}var Wc={};Mf(Wc,{JsonPatchError:()=>be,_areEquals:()=>fa,applyOperation:()=>Xn,applyPatch:()=>Yr,applyReducer:()=>Lx,deepClone:()=>jx,getValueByPointer:()=>Lo,validate:()=>Tp,validator:()=>zo});var $x=Object.prototype.hasOwnProperty;function $o(r,e){return $x.call(r,e)}function jo(r){if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)$o(r,t)&&e.push(t);return e}function ze(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function Mo(r){let e=0,t=r.length,n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function Jt(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function da(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function Co(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(Co(r[t]))return!0}else if(typeof r=="object"){let t=jo(r),n=t.length;for(var e=0;e<n;e++)if(Co(r[t[e]]))return!0}}return!1}function Ip(r,e){let t=[r];for(let n in e){let s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s<"u"&&t.push(`${n}: ${s}`)}return t.join(`
`)}var Yn=class extends Error{constructor(e,t,n,s,i){super(Ip(e,{name:t,index:n,operation:s,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=Ip(e,{name:t,index:n,operation:s,tree:i})}};var be=Yn,jx=ze,Vs={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=Lo(t,this.path);n&&(n=ze(n));let s=Xn(t,{op:"remove",path:this.from}).removed;return Xn(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:n}},copy:function(r,e,t){let n=Lo(t,this.from);return Xn(t,{op:"add",path:this.path,value:ze(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:fa(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}},Mx={add:function(r,e,t){return Mo(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:Vs.move,copy:Vs.copy,test:Vs.test,_get:Vs._get};function Lo(r,e){if(e=="")return r;var t={op:"_get",path:e};return Xn(r,t),t.value}function Xn(r,e,t=!1,n=!0,s=!0,i=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):zo(e,0)),e.path===""){let a={newDocument:r};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=r,a;if(e.op==="move"||e.op==="copy")return a.newDocument=Lo(r,e.from),e.op==="move"&&(a.removed=r),a;if(e.op==="test"){if(a.test=fa(r,e.value),a.test===!1)throw new be("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return a.newDocument=r,a}else{if(e.op==="remove")return a.removed=r,a.newDocument=null,a;if(e.op==="_get")return e.value=r,a;if(t)throw new be("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,r);return a}}else{n||(r=ze(r));let o=(e.path||"").split("/"),u=r,c=1,l=o.length,d,f,p;for(typeof t=="function"?p=t:p=zo;;){if(f=o[c],f&&f.indexOf("~")!=-1&&(f=da(f)),s&&(f=="__proto__"||f=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(u[f]===void 0?d=o.slice(0,c).join("/"):c==l-1&&(d=e.path),d!==void 0&&p(e,0,r,d)),c++,Array.isArray(u)){if(f==="-")f=u.length;else{if(t&&!Mo(f))throw new be("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,r);Mo(f)&&(f=~~f)}if(c>=l){if(t&&e.op==="add"&&f>u.length)throw new be("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,r);let h=Mx[e.op].call(e,u,f,r);if(h.test===!1)throw new be("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return h}}else if(c>=l){let h=Vs[e.op].call(e,u,f,r);if(h.test===!1)throw new be("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return h}if(u=u[f],t&&c<l&&(!u||typeof u!="object"))throw new be("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,r)}}}function Yr(r,e,t,n=!0,s=!0){if(t&&!Array.isArray(e))throw new be("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=ze(r));let i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=Xn(r,e[a],t,!0,s,a),r=i[a].newDocument;return i.newDocument=r,i}function Lx(r,e,t){let n=Xn(r,e);if(n.test===!1)throw new be("Test operation failed","TEST_OPERATION_FAILED",t,e,r);return n.newDocument}function zo(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new be("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(Vs[r.op]){if(typeof r.path!="string")throw new be("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new be('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new be("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new be("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&Co(r.value))throw new be("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var s=r.path.split("/").length,i=n.split("/").length;if(s!==i+1&&s!==i)throw new be("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new be("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var a={op:"_get",path:r.from,value:void 0},o=Tp([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new be("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new be("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function Tp(r,e,t){try{if(!Array.isArray(r))throw new be("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Yr(ze(e),ze(r),t||!0);else{t=t||zo;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(s){if(s instanceof be)return s;throw s}}function fa(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),s,i,a;if(t&&n){if(i=r.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!fa(r[s],e[s]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!fa(r[a],e[a]))return!1;return!0}return r!==r&&e!==e}function Pp(r,e,t,n,s){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=jo(e),a=jo(r),o=!1,u=!1,c=a.length-1;c>=0;c--){var l=a[c],d=r[l];if($o(e,l)&&!(e[l]===void 0&&d!==void 0&&Array.isArray(e)===!1)){var f=e[l];typeof d=="object"&&d!=null&&typeof f=="object"&&f!=null&&Array.isArray(d)===Array.isArray(f)?Pp(d,f,t,n+"/"+Jt(l),s):d!==f&&(o=!0,s&&t.push({op:"test",path:n+"/"+Jt(l),value:ze(d)}),t.push({op:"replace",path:n+"/"+Jt(l),value:ze(f)}))}else Array.isArray(r)===Array.isArray(e)?(s&&t.push({op:"test",path:n+"/"+Jt(l),value:ze(d)}),t.push({op:"remove",path:n+"/"+Jt(l)}),u=!0):(s&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}),o=!0)}if(!(!u&&i.length==a.length))for(var c=0;c<i.length;c++){var l=i[c];!$o(r,l)&&e[l]!==void 0&&t.push({op:"add",path:n+"/"+Jt(l),value:ze(e[l])})}}}function Do(r,e,t=!1){var n=[];return Pp(r,e,n,"",t),n}var US={...Wc,JsonPatchError:Yn,deepClone:ze,escapePathComponent:Jt,unescapePathComponent:da};var Sp="gen_ai.operation.name",kp="gen_ai.system",Yc="gen_ai.request.model",Rp="gen_ai.response.model",Xc="gen_ai.usage.input_tokens",Qc="gen_ai.usage.output_tokens",el="gen_ai.usage.total_tokens",Np="gen_ai.request.max_tokens",Cp="gen_ai.request.temperature",$p="gen_ai.request.top_p",jp="gen_ai.request.frequency_penalty",Mp="gen_ai.request.presence_penalty",Lp="gen_ai.response.finish_reasons",zp="gen_ai.prompt",Dp="gen_ai.completion",Up="gen_ai.request.extra_query",Fp="gen_ai.request.extra_body",Bp="gen_ai.serialized.name",Zp="gen_ai.serialized.signature",qp="gen_ai.serialized.doc",Gp="gen_ai.response.id",Hp="gen_ai.response.service_tier",Vp="gen_ai.response.system_fingerprint",Kp="gen_ai.usage.input_token_details",Jp="gen_ai.usage.output_token_details",Wp="langsmith.trace.session_id",Yp="langsmith.trace.session_name",Xp="langsmith.span.kind",Qp="langsmith.trace.name",eh="langsmith.metadata",tl="langsmith.span.tags";var th="langsmith.request.streaming",rh="langsmith.request.headers";var Dx=(...r)=>fetch(...r),nh=Symbol.for("ls:fetch_implementation");var sh=()=>{let r=globalThis[nh];return r?typeof r=="function"&&"Headers"in r&&"Request"in r&&"Response"in r:!1},ih=r=>async(...e)=>{if(r||ve("DEBUG")==="true"){let[n,s]=e;console.log(`\u2192 ${s?.method||"GET"} ${n}`)}let t=await(globalThis[nh]??Dx)(...e);return(r||ve("DEBUG")==="true")&&console.log(`\u2190 ${t.status} ${t.statusText} ${t.url}`),t};var pa=()=>ve("PROJECT")??ot("LANGCHAIN_SESSION")??"default";var Uo="0.3.77";var Wt,Ux=()=>typeof window<"u"&&typeof window.document<"u",Fx=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Bx=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),ah=()=>typeof Deno<"u",Zx=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!ah(),sl=()=>Wt||(typeof Bun<"u"?Wt="bun":Ux()?Wt="browser":Zx()?Wt="node":Fx()?Wt="webworker":Bx()?Wt="jsdom":ah()?Wt="deno":Wt="other",Wt),rl;function Fo(){if(rl===void 0){let r=sl(),e=Gx();rl={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:Uo,...e}}return rl}function il(){let r=qx(),e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[n,s]of Object.entries(r))typeof s=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function qx(){let r={};try{if(typeof process<"u"&&process.env)for(let[e,t]of Object.entries(process.env))(e.startsWith("LANGCHAIN_")||e.startsWith("LANGSMITH_"))&&t!=null&&((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&typeof t=="string"?r[e]=t.slice(0,2)+"*".repeat(t.length-4)+t.slice(-2):r[e]=t)}catch{}return r}function ot(r){try{return typeof process<"u"?process.env?.[r]:void 0}catch{return}}function ve(r){return ot(`LANGSMITH_${r}`)||ot(`LANGCHAIN_${r}`)}var nl;function Gx(){if(nl!==void 0)return nl;let r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of r){let n=ot(t);n!==void 0&&(e[t]=n)}return nl=e,e}function Bo(){return ot("OTEL_ENABLED")==="true"||ve("OTEL_ENABLED")==="true"}var ul=class{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){!this.hasWarned&&Bo()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let n;if(t.length===1&&typeof t[0]=="function"?n=t[0]:t.length===2&&typeof t[1]=="function"?n=t[1]:t.length===3&&typeof t[2]=="function"&&(n=t[2]),typeof n=="function")return n()}},cl=class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new ul})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}},ll=class{active(){return{}}with(e,t){return t()}},al=Symbol.for("ls:otel_trace"),ol=Symbol.for("ls:otel_context"),oh=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),Hx=new cl,Vx=new ll,dl=class{getTraceInstance(){return globalThis[al]??Hx}getContextInstance(){return globalThis[ol]??Vx}initializeGlobalInstances(e){globalThis[al]===void 0&&(globalThis[al]=e.trace),globalThis[ol]===void 0&&(globalThis[ol]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[oh]=e}getDefaultOTLPTracerComponents(){return globalThis[oh]??void 0}},fl=new dl;function Zo(){return fl.getTraceInstance()}function uh(){return fl.getContextInstance()}function ch(){return fl.getDefaultOTLPTracerComponents()}var Kx={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function Jx(r){return Kx[r]||r}var qo=class{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(let n of e)try{if(!n.run)continue;if(n.operation==="post"){let s=this.createSpanForRun(n,n.run,t.get(n.id));s&&!n.run.end_time&&this.spans.set(n.id,s)}else this.updateSpanForRun(n,n.run)}catch(s){console.error(`Error processing operation ${n.id}:`,s)}}createSpanForRun(e,t,n){let s=n&&Zo().getSpan(n);if(s)try{return this.finishSpanSetup(s,t,e)}catch(i){console.error(`Failed to create span for run ${e.id}:`,i);return}}finishSpanSetup(e,t,n){return this.setSpanAttributes(e,t,n),t.error?(e.setStatus({code:2}),e.recordException(new Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{let n=this.spans.get(e.id);if(!n){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(n,t,e),t.error?(n.setStatus({code:2}),n.recordException(new Error(t.error))):n.setStatus({code:1});let s=t.end_time;s&&(n.end(new Date(s)),this.spans.delete(e.id))}catch(n){console.error(`Failed to update span for run ${e.id}:`,n)}}extractModelName(e){if(e.extra?.metadata){let t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){let n=t.invocation_params;if(n.model)return n.model;if(n.model_name)return n.model_name}}}setSpanAttributes(e,t,n){if("run_type"in t&&t.run_type){e.setAttribute(Xp,t.run_type);let o=Jx(t.run_type||"chain");e.setAttribute(Sp,o)}"name"in t&&t.name&&e.setAttribute(Qp,t.name),"session_id"in t&&t.session_id&&e.setAttribute(Wp,t.session_id),"session_name"in t&&t.session_name&&e.setAttribute(Yp,t.session_name),this.setGenAiSystem(e,t);let s=this.extractModelName(t);s&&e.setAttribute(Yc,s),"prompt_tokens"in t&&typeof t.prompt_tokens=="number"&&e.setAttribute(Xc,t.prompt_tokens),"completion_tokens"in t&&typeof t.completion_tokens=="number"&&e.setAttribute(Qc,t.completion_tokens),"total_tokens"in t&&typeof t.total_tokens=="number"&&e.setAttribute(el,t.total_tokens),this.setInvocationParameters(e,t);let i=t.extra?.metadata||{};for(let[o,u]of Object.entries(i))u!=null&&e.setAttribute(`${eh}.${o}`,String(u));let a=t.tags;if(a&&Array.isArray(a)?e.setAttribute(tl,a.join(", ")):a&&e.setAttribute(tl,String(a)),"serialized"in t&&typeof t.serialized=="object"){let o=t.serialized;o.name&&e.setAttribute(Bp,String(o.name)),o.signature&&e.setAttribute(Zp,String(o.signature)),o.doc&&e.setAttribute(qp,String(o.doc))}this.setIOAttributes(e,n)}setGenAiSystem(e,t){let n="langchain",s=this.extractModelName(t);if(s){let i=s.toLowerCase();i.includes("anthropic")||i.startsWith("claude")?n="anthropic":i.includes("bedrock")?n="aws.bedrock":i.includes("azure")&&i.includes("openai")?n="az.ai.openai":i.includes("azure")&&i.includes("inference")?n="az.ai.inference":i.includes("cohere")?n="cohere":i.includes("deepseek")?n="deepseek":i.includes("gemini")?n="gemini":i.includes("groq")?n="groq":i.includes("watson")||i.includes("ibm")?n="ibm.watsonx.ai":i.includes("mistral")?n="mistral_ai":i.includes("gpt")||i.includes("openai")?n="openai":i.includes("perplexity")||i.includes("sonar")?n="perplexity":i.includes("vertex")?n="vertex_ai":(i.includes("xai")||i.includes("grok"))&&(n="xai")}e.setAttribute(kp,n)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;let n=t.extra.metadata.invocation_params;n.max_tokens!==void 0&&e.setAttribute(Np,n.max_tokens),n.temperature!==void 0&&e.setAttribute(Cp,n.temperature),n.top_p!==void 0&&e.setAttribute($p,n.top_p),n.frequency_penalty!==void 0&&e.setAttribute(jp,n.frequency_penalty),n.presence_penalty!==void 0&&e.setAttribute(Mp,n.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{let n=t.run.inputs;typeof n=="object"&&n!==null&&(n.model&&Array.isArray(n.messages)&&e.setAttribute(Yc,n.model),n.stream!==void 0&&e.setAttribute(th,n.stream),n.extra_headers&&e.setAttribute(rh,JSON.stringify(n.extra_headers)),n.extra_query&&e.setAttribute(Up,JSON.stringify(n.extra_query)),n.extra_body&&e.setAttribute(Fp,JSON.stringify(n.extra_body))),e.setAttribute(zp,JSON.stringify(n))}catch(n){console.debug(`Failed to process inputs for run ${t.id}`,n)}if(t.run.outputs)try{let n=t.run.outputs,s=this.getUnifiedRunTokens(n);if(s&&(e.setAttribute(Xc,s[0]),e.setAttribute(Qc,s[1]),e.setAttribute(el,s[0]+s[1])),n&&typeof n=="object"){if(n.model&&e.setAttribute(Rp,String(n.model)),n.id&&e.setAttribute(Gp,n.id),n.choices&&Array.isArray(n.choices)){let i=n.choices.map(a=>a.finish_reason).filter(a=>a).map(String);i.length>0&&e.setAttribute(Lp,i.join(", "))}if(n.service_tier&&e.setAttribute(Hp,n.service_tier),n.system_fingerprint&&e.setAttribute(Vp,n.system_fingerprint),n.usage_metadata&&typeof n.usage_metadata=="object"){let i=n.usage_metadata;i.input_token_details&&e.setAttribute(Kp,JSON.stringify(i.input_token_details)),i.output_token_details&&e.setAttribute(Jp,JSON.stringify(i.output_token_details))}}e.setAttribute(Dp,JSON.stringify(n))}catch(n){console.debug(`Failed to process outputs for run ${t.id}`,n)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;let n=Object.keys(e);for(let a of n){let o=e[a];if(!(!o||typeof o!="object")&&(t=this.extractUnifiedRunTokens(o.usage_metadata),t||o.lc===1&&o.kwargs&&typeof o.kwargs=="object"&&(t=this.extractUnifiedRunTokens(o.kwargs.usage_metadata),t)))return t}let s=e.generations||[];if(!Array.isArray(s))return null;let i=Array.isArray(s[0])?s.flat():s;for(let a of i)if(typeof a=="object"&&a.message&&typeof a.message=="object"&&a.message.kwargs&&typeof a.message.kwargs=="object"&&(t=this.extractUnifiedRunTokens(a.message.kwargs.usage_metadata),t))return t;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}};var bh=It(To(),1),Wo=It(Jo(),1),sv=[429,500,502,503,504],ma=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Wo.default?this.queue=new Wo.default.default({concurrency:this.maxConcurrency}):this.queue=new Wo.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let n=this.onFailedResponseHook;return this.queue.add(()=>(0,bh.default)(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.name==="TimeoutError"||s.message.startsWith("AbortError")||s?.code==="ECONNABORTED")throw s;let i=s?.response;if(n&&await n(i))return;let a=i?.status??s?.status;if(a&&!sv.includes(+a))throw s},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{e.signal?.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}};function bl(r){return typeof r?._getType=="function"}function wl(r){let e={type:r._getType(),data:{content:r.content}};return r?.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}var iv=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function W(r,e){if(!iv.test(r)){let t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}var wh={};function ga(r){wh[r]||(console.warn(r),wh[r]=!0)}var tE=It(cg(),1);function Ar(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);let[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){let[s,i]=e.split("/",2);if(!s||!i)throw new Error(`Invalid identifier format: ${r}`);return[s,i,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}var Ul=class extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}};async function M(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}if(r.status===403)try{(await r.json())?.error==="org_scoped_key_requires_workspace"&&(n="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch{let o=new Error(`${r.status} ${r.statusText}`);throw o.status=r?.status,o}if(n===void 0)try{n=await r.text()}catch{n=""}let s=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Message: ${n}`;if(r.status===409)throw new Ul(s);let i=new Error(s);throw i.status=r.status,i}var lg="ERR_CONFLICTING_ENDPOINTS",cu=class extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:lg}),this.name="ConflictingEndpointsError"}};function dg(r){return typeof r=="object"&&r!==null&&r.code===lg}var fg="[...]",rE={result:"[Circular]"},du=[],Js=[],nE=new TextEncoder;function sE(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function lu(r){return nE.encode(r)}function pg(r){if(r&&typeof r=="object"&&r!==null){if(r instanceof Map)return Object.fromEntries(r);if(r instanceof Set)return Array.from(r);if(r instanceof Date)return r.toISOString();if(r instanceof RegExp)return r.toString();if(r instanceof Error)return{name:r.name,message:r.message}}else if(typeof r=="bigint")return r.toString();return r}function iE(r){return function(e,t){if(r){let n=r.call(this,e,t);if(n!==void 0)return n}return pg(t)}}function Qe(r,e,t,n,s){try{let i=JSON.stringify(r,iE(t),n);return lu(i)}catch(i){if(!i.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),lu("[Unserializable]");ve("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof s>"u"&&(s=sE()),Bl(r,"",0,[],void 0,0,s);let a;try{Js.length===0?a=JSON.stringify(r,t,n):a=JSON.stringify(r,aE(t),n)}catch{return lu("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;du.length!==0;){let o=du.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return lu(a)}}function Fl(r,e,t,n){var s=Object.getOwnPropertyDescriptor(n,t);s.get!==void 0?s.configurable?(Object.defineProperty(n,t,{value:r}),du.push([n,t,e,s])):Js.push([e,t,r]):(n[t]=r,du.push([n,t,e]))}function Bl(r,e,t,n,s,i,a){i+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){Fl(rE,r,e,s);return}if(typeof a.depthLimit<"u"&&i>a.depthLimit){Fl(fg,r,e,s);return}if(typeof a.edgesLimit<"u"&&t+1>a.edgesLimit){Fl(fg,r,e,s);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)Bl(r[o],o,o,n,r,i,a);else{r=pg(r);var u=Object.keys(r);for(o=0;o<u.length;o++){var c=u[o];Bl(r[c],c,o,n,r,i,a)}}n.pop()}}function aE(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(Js.length>0)for(var n=0;n<Js.length;n++){var s=Js[n];if(s[1]===e&&s[0]===t){t=s[2],Js.splice(n,1);break}}return r.call(this,e,t)}}function hg(r,e){let t=Fo(),n=e??il(),s=r.extra??{},i=s.metadata;return r.extra={...s,runtime:{...t,...s?.runtime},metadata:{...n,...n.revision_id||"revision_id"in r&&r.revision_id?{revision_id:("revision_id"in r?r.revision_id:void 0)??n.revision_id}:{},...i}},r}var oE=r=>{let e=r?.toString()??ve("TRACING_SAMPLING_RATE");if(e===void 0)return;let t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},uE=r=>{let t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function cE(r){let e=[];for await(let t of r)e.push(t);return e}function fu(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var lE=async r=>{if(r?.status===429){let e=parseInt(r.headers.get("retry-after")??"10",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function mg(r){return typeof r=="number"?Number(r.toFixed(4)):r}var Zl=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t,n=new Promise(i=>{t=i}),s=Qe(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:n,size:s}),this.sizeBytes+=s,n}pop({upToSizeBytes:e,upToSize:t}){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let n=[],s=0;for(;s+(this.peek()?.size??0)<e&&this.items.length>0&&n.length<t;){let i=this.items.shift();i&&(n.push(i),s+=i.size,this.sizeBytes-=i.size)}if(n.length===0&&this.items.length>0){let i=this.items.shift();n.push(i),s+=i.size,this.sizeBytes-=i.size}return[n.map(i=>({action:i.action,item:i.payload,otelContext:i.otelContext,apiKey:i.apiKey,apiUrl:i.apiUrl})),()=>n.forEach(i=>i.itemPromiseResolve())]}},dE=24*1024*1024,fE=1e4,pE=100,gg="https://api.smith.langchain.com",Qn=class r{get _fetch(){return this.fetchImplementation||ih(this.debug)}constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Zl}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:ot("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:ot("LANGSMITH_DEBUG")==="true"});let t=r.getDefaultClientConfig();if(this.tracingSampleRate=oE(e.tracingSamplingRate),this.apiUrl=fu(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=fu(e.apiKey??t.apiKey),this.webUrl=fu(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=fu(e.workspaceId??ve("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new ma({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation,this.batchIngestCaller=new ma({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:lE,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,Bo()&&(this.langSmithToOTELTranslator=new qo),this.cachedLSEnvVarsForMetadata=il()}static getDefaultClientConfig(){let e=ve("API_KEY"),t=ve("ENDPOINT")??gg,n=ve("HIDE_INPUTS")==="true",s=ve("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:uE(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${Uo}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let t={...e};return t.inputs!==void 0&&(t.inputs=await this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){let n=t?.toString()??"",s=`${this.apiUrl}${e}?${n}`;return await this.caller.call(async()=>{let a=await this._fetch(s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(a,`fetch ${e}`),a})}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let s=Number(t.get("offset"))||0,i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(i));let a=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(async()=>{let c=await this._fetch(a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(c,`fetch ${e}`),c}),u=n?n(await o.json()):await o.json();if(u.length===0||(yield u,u.length<i))break;s+=u.length}}async*_getCursorPaginatedList(e,t=null,n="POST",s="runs"){let i=t?{...t}:{};for(;;){let a=JSON.stringify(i),u=await(await this.caller.call(async()=>{let l=await this._fetch(`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(l,`fetch ${e}`),l})).json();if(!u||!u[s])break;yield u[s];let c=u.cursors;if(!c||!c.next)break;i.cursor=c.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let n=[];for(let s of e)this.filteredPostUuids.has(s.trace_id)?s.id===s.trace_id&&this.filteredPostUuids.delete(s.trace_id):n.push(s);return n}else{let n=[];for(let s of e){let i=s.trace_id??s.id;this.filteredPostUuids.has(i)||(s.id===i?this._shouldSample()?n.push(s):this.filteredPostUuids.add(i):n.push(s))}return n}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??dE}async _getBatchSizeLimit(){let e=await this._ensureServerInfo();return this.batchSizeLimit??e.batch_ingest_config?.size_limit??pE}async _getDatasetExamplesMultiPartSupport(){return(await this._ensureServerInfo()).instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t}){let n=[];for(;this.autoBatchQueue.items.length>0;){let[s,i]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:t});if(!s.length){i();break}let a=s.reduce((c,l)=>{let d=l.apiUrl??this.apiUrl,f=l.apiKey??this.apiKey,h=l.apiKey===this.apiKey&&l.apiUrl===this.apiUrl?"default":`${d}|${f}`;return c[h]||(c[h]=[]),c[h].push(l),c},{}),o=[];for(let[c,l]of Object.entries(a)){let d=this._processBatch(l,{apiUrl:c==="default"?void 0:c.split("|")[0],apiKey:c==="default"?void 0:c.split("|")[1]});o.push(d)}let u=Promise.all(o).finally(i);n.push(u)}return Promise.all(n)}async _processBatch(e,t){if(e.length)try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{let n={runCreates:e.filter(i=>i.action==="create").map(i=>i.item),runUpdates:e.filter(i=>i.action==="update").map(i=>i.item)},s=await this._ensureServerInfo();if(s?.batch_ingest_config?.use_multipart_endpoint){let i=s?.instance_flags?.gzip_body_enabled;await this.multipartIngestRuns(n,{...t,useGzip:i})}else await this.batchIngestRuns(n,t)}}catch(n){console.error("Error exporting batch:",n)}}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){let t=new Map,n=[];for(let s of e)s.item.id&&s.otelContext&&(t.set(s.item.id,s.otelContext),s.action==="create"?n.push({operation:"post",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}):n.push({operation:"patch",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}));this.langSmithToOTELTranslator.exportBatch(n,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=hg(e.item,this.cachedLSEnvVarsForMetadata);let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let n=await this._getBatchSizeLimitBytes(),s=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>n||this.autoBatchQueue.items.length>s)&&this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:s}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:s})},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){let t=await(await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(fE),...this.fetchOptions});return await M(n,"get server info"),n})).json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes(),t=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t})}_cloneCurrentOTELContext(){let e=Zo(),t=uh();if(this.langSmithToOTELTranslator!==void 0){let n=e.getActiveSpan();if(n)return e.setSpan(t.active(),n)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;let n={...this.headers,"Content-Type":"application/json"},s=e.project_name;delete e.project_name;let i=await this.prepareRunCreateOrUpdateInputs({session_name:s,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){let u=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:i,otelContext:u,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}let a=hg(i,this.cachedLSEnvVarsForMetadata);t?.apiKey!==void 0&&(n["x-api-key"]=t.apiKey),t?.workspaceId!==void 0&&(n["x-tenant-id"]=t.workspaceId);let o=Qe(a,`Creating run with id: ${a.id}`);await this.caller.call(async()=>{let u=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await M(u,"create run",!0),u})}async batchIngestRuns({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let s=await Promise.all(e?.map(u=>this.prepareRunCreateOrUpdateInputs(u))??[]),i=await Promise.all(t?.map(u=>this.prepareRunCreateOrUpdateInputs(u))??[]);if(s.length>0&&i.length>0){let u=s.reduce((l,d)=>(d.id&&(l[d.id]=d),l),{}),c=[];for(let l of i)l.id!==void 0&&u[l.id]?u[l.id]={...u[l.id],...l}:c.push(l);s=Object.values(u),i=c}let a={post:s,patch:i};if(!a.post.length&&!a.patch.length)return;let o={post:[],patch:[]};for(let u of["post","patch"]){let c=u,l=a[c].reverse(),d=l.pop();for(;d!==void 0;)o[c].push(d),d=l.pop()}if(o.post.length>0||o.patch.length>0){let u=o.post.map(c=>c.id).concat(o.patch.map(c=>c.id)).join(",");await this._postBatchIngestRuns(Qe(o,`Ingesting runs with ids: ${u}`),n)}}async _postBatchIngestRuns(e,t){let n={...this.headers,"Content-Type":"application/json",Accept:"application/json"};t?.apiKey!==void 0&&(n["x-api-key"]=t.apiKey),await this.batchIngestCaller.call(async()=>{let s=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await M(s,"batch create run",!0),s})}async multipartIngestRuns({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let s={},i=[];for(let d of e??[]){let f=await this.prepareRunCreateOrUpdateInputs(d);f.id!==void 0&&f.attachments!==void 0&&(s[f.id]=f.attachments),delete f.attachments,i.push(f)}let a=[];for(let d of t??[])a.push(await this.prepareRunCreateOrUpdateInputs(d));if(i.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&a.length>0){let d=i.reduce((p,h)=>(h.id&&(p[h.id]=h),p),{}),f=[];for(let p of a)p.id!==void 0&&d[p.id]?d[p.id]={...d[p.id],...p}:f.push(p);i=Object.values(d),a=f}if(i.length===0&&a.length===0)return;let c=[],l=[];for(let[d,f]of[["post",i],["patch",a]])for(let p of f){let{inputs:h,outputs:m,events:g,extra:y,error:_,serialized:w,attachments:A,...E}=p,z={inputs:h,outputs:m,events:g,extra:y,error:_,serialized:w},F=Qe(E,`Serializing for multipart ingestion of run with id: ${E.id}`);l.push({name:`${d}.${E.id}`,payload:new Blob([F],{type:`application/json; length=${F.length}`})});for(let[G,ee]of Object.entries(z)){if(ee===void 0)continue;let ue=Qe(ee,`Serializing ${G} for multipart ingestion of run with id: ${E.id}`);l.push({name:`${d}.${E.id}.${G}`,payload:new Blob([ue],{type:`application/json; length=${ue.length}`})})}if(E.id!==void 0){let G=s[E.id];if(G){delete s[E.id];for(let[ee,ue]of Object.entries(G)){let ce,Gt;if(Array.isArray(ue)?[ce,Gt]=ue:(ce=ue.mimeType,Gt=ue.data),ee.includes(".")){console.warn(`Skipping attachment '${ee}' for run ${E.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}l.push({name:`attachment.${E.id}.${ee}`,payload:new Blob([Gt],{type:`${ce}; length=${Gt.byteLength}`})})}}}c.push(`trace=${E.trace_id},id=${E.id}`)}await this._sendMultipartRequest(l,c.join("; "),n)}async _createNodeFetchBody(e,t){let n=[];for(let a of e)n.push(new Blob([`--${t}\r
`])),n.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r
`,`Content-Type: ${a.payload.type}\r
\r
`])),n.push(a.payload),n.push(new Blob([`\r
`]));return n.push(new Blob([`--${t}--\r
`])),await new Blob(n).arrayBuffer()}async _createMultipartStream(e,t){let n=new TextEncoder;return new ReadableStream({async start(i){let a=async o=>{typeof o=="string"?i.enqueue(n.encode(o)):i.enqueue(o)};for(let o of e){await a(`--${t}\r
`),await a(`Content-Disposition: form-data; name="${o.name}"\r
`),await a(`Content-Type: ${o.payload.type}\r
\r
`);let c=o.payload.stream().getReader();try{let l;for(;!(l=await c.read()).done;)i.enqueue(l.value)}finally{c.releaseLock()}await a(`\r
`)}await a(`--${t}--\r
`),i.close()}})}async _sendMultipartRequest(e,t,n){let s="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),i=sh(),a=()=>this._createNodeFetchBody(e,s),o=()=>this._createMultipartStream(e,s),u=async c=>this.batchIngestCaller.call(async()=>{let l=await c(),d={...this.headers,"Content-Type":`multipart/form-data; boundary=${s}`};n?.apiKey!==void 0&&(d["x-api-key"]=n.apiKey);let f=l;n?.useGzip&&typeof l=="object"&&"pipeThrough"in l&&(f=l.pipeThrough(new CompressionStream("gzip")),d["Content-Encoding"]="gzip");let p=await this._fetch(`${n?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:d,body:f,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(p,"Failed to send multipart request",!0),p});try{let c,l=!1;!i&&!this.multipartStreamingDisabled&&sl()!=="bun"?(l=!0,c=await u(o)):c=await u(a),(!this.multipartStreamingDisabled||l)&&c.status===422&&(n?.apiUrl??this.apiUrl)!==gg&&(console.warn(`Streaming multipart upload to ${n?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,c=await u(a))}catch(c){console.warn(`${c.message.trim()}

Context: ${t}`)}}async updateRun(e,t,n){W(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));let s={...t,id:e};if(!this._filterForSampling([s],!0).length)return;if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){let o=this._cloneCurrentOTELContext();if(t.end_time!==void 0&&s.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}let i={...this.headers,"Content-Type":"application/json"};n?.apiKey!==void 0&&(i["x-api-key"]=n.apiKey),n?.workspaceId!==void 0&&(i["x-tenant-id"]=n.workspaceId);let a=Qe(t,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{let o=await this._fetch(`${n?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(o,"update run",!0),o})}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){W(e);let n=await this._get(`/runs/${e}`);return t&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n?.projectName?s=(await this.readProject({projectName:n?.projectName})).id:n?.projectId?s=n?.projectId:s=(await this.readProject({projectName:ve("PROJECT")||"default"})).id;let i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){let s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await cE(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},s={};t.sort((i,a)=>(i?.dotted_order??"").localeCompare(a?.dotted_order??""));for(let i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.dotted_order?.startsWith(e.dotted_order??"")&&i.id!==e.id&&(i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),s[i.id]=i)}e.child_runs=n[e.id]||[];for(let i in n)i!==e.id&&(s[i].child_runs=n[i]);return e}async*listRuns(e){let{projectId:t,projectName:n,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:u,isRoot:c,runType:l,error:d,id:f,query:p,filter:h,traceFilter:m,treeFilter:g,limit:y,select:_,order:w}=e,A=[];if(t&&(A=Array.isArray(t)?t:[t]),n){let G=Array.isArray(n)?n:[n],ee=await Promise.all(G.map(ue=>this.readProject({projectName:ue}).then(ce=>ce.id)));A.push(...ee)}let E=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],z={session:A.length?A:null,run_type:l,reference_example:a,query:p,filter:h,trace_filter:m,tree_filter:g,execution_order:u,parent_run:s,start_time:o?o.toISOString():null,error:d,id:f,limit:y,trace:i,select:_||E,is_root:c,order:w};z.select.includes("child_run_ids")&&ga("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let F=0;for await(let G of this._getCursorPaginatedList("/runs/query",z))if(y){if(F>=y)break;if(G.length+F>y){yield*G.slice(0,y-F);break}F+=G.length,yield*G}else yield*G}async*listGroupRuns(e){let{projectId:t,projectName:n,groupBy:s,filter:i,startTime:a,endTime:o,limit:u,offset:c}=e,d={session_id:t||(await this.readProject({projectName:n})).id,group_by:s,filter:i,start_time:a?a.toISOString():null,end_time:o?o.toISOString():null,limit:Number(u)||100},f=Number(c)||0,p="/runs/group",h=`${this.apiUrl}${p}`;for(;;){let m={...d,offset:f},g=Object.fromEntries(Object.entries(m).filter(([z,F])=>F!==void 0)),y=JSON.stringify(g),w=await(await this.caller.call(async()=>{let z=await this._fetch(h,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:y});return await M(z,`Failed to fetch ${p}`),z})).json(),{groups:A,total:E}=w;if(A.length===0)break;for(let z of A)yield z;if(f+=A.length,f>=E)break}}async getRunStats({id:e,trace:t,parentRun:n,runType:s,projectNames:i,projectIds:a,referenceExampleIds:o,startTime:u,endTime:c,error:l,query:d,filter:f,traceFilter:p,treeFilter:h,isRoot:m,dataSourceType:g}){let y=a||[];i&&(y=[...a||[],...await Promise.all(i.map(F=>this.readProject({projectName:F}).then(G=>G.id)))]);let w=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:s,session:y,reference_example:o,start_time:u,end_time:c,error:l,query:d,filter:f,trace_filter:p,tree_filter:h,is_root:m,data_source_type:g}).filter(([F,G])=>G!==void 0)),A=JSON.stringify(w);return await(await this.caller.call(async()=>{let F=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:A});return await M(F,"get run stats"),F})).json()}async shareRun(e,{shareId:t}={}){let n={run_id:e,share_token:t||ye()};W(e);let s=JSON.stringify(n),a=await(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await M(o,"share run"),o})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){W(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(t,"unshare run",!0),t})}async readRunSharedLink(e){W(e);let n=await(await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(s,"read run shared link"),s})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let n=new URLSearchParams({share_token:e});if(t!==void 0)for(let a of t)n.append("id",a);return W(e),await(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(a,"list shared runs"),a})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),W(e);let s=await(await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(i,"read dataset shared schema"),i})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let n={dataset_id:e};W(e);let s=JSON.stringify(n),a=await(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await M(o,"share dataset"),o})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){W(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(t,"unshare dataset",!0),t})}async readSharedDataset(e){return W(e),await(await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(s,"read shared dataset"),s})).json()}async listSharedExamples(e,t){let n={};t?.exampleIds&&(n.id=t.exampleIds);let s=new URLSearchParams;Object.entries(n).forEach(([o,u])=>{Array.isArray(u)?u.forEach(c=>s.append(o,c)):s.append(o,u)});let i=await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(o,"list shared examples"),o}),a=await i.json();if(!i.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${Array.isArray(a.detail)?a.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`);return a.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){let o=s?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,c=i||{};n&&(c.metadata=n);let l={name:e,extra:c,description:t};a!==null&&(l.reference_dataset_id=a);let d=JSON.stringify(l);return await(await this.caller.call(async()=>{let h=await this._fetch(u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:d});return await M(h,"create project"),h})).json()}async updateProject(e,{name:t=null,description:n=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){let o=`${this.apiUrl}/sessions/${e}`,u=i;s&&(u={...u||{},metadata:s});let c=JSON.stringify({name:t,extra:u,description:n,end_time:a?new Date(a).toISOString():null});return await(await this.caller.call(async()=>{let f=await this._fetch(o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await M(f,"update project"),f})).json()}async hasProject({projectId:e,projectName:t}){let n="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)W(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");let i=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}${n}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(a,"has project"),a});try{let a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let s="/sessions",i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)W(e),s+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&i.append("include_stats",n.toString());let a=await this._get(s,i),o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");let n=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");let n=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:s,referenceDatasetName:i,includeStats:a,datasetVersion:o,referenceFree:u,metadata:c}={}){let l=new URLSearchParams;if(e!==void 0)for(let d of e)l.append("id",d);if(t!==void 0&&l.append("name",t),n!==void 0&&l.append("name_contains",n),s!==void 0)l.append("reference_dataset",s);else if(i!==void 0){let d=await this.readDataset({datasetName:i});l.append("reference_dataset",d.id)}a!==void 0&&l.append("include_stats",a.toString()),o!==void 0&&l.append("dataset_version",o),u!==void 0&&l.append("reference_free",u.toString()),c!==void 0&&l.append("metadata",JSON.stringify(c));for await(let d of this._getPaginated("/sessions",l))yield*d}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,W(n),await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(s,`delete session ${n} (${t})`,!0),s})}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:i,dataType:a,name:o}){let u=`${this.apiUrl}/datasets/upload`,c=new FormData;return c.append("file",e,t),n.forEach(f=>{c.append("input_keys",f)}),s.forEach(f=>{c.append("output_keys",f)}),i&&c.append("description",i),a&&c.append("data_type",a),o&&c.append("name",o),await(await this.caller.call(async()=>{let f=await this._fetch(u,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await M(f,"upload CSV"),f})).json()}async createDataset(e,{description:t,dataType:n,inputsSchema:s,outputsSchema:i,metadata:a}={}){let o={name:e,description:t,extra:a?{metadata:a}:void 0};n&&(o.data_type=n),s&&(o.inputs_schema_definition=s),i&&(o.outputs_schema_definition=i);let u=JSON.stringify(o);return await(await this.caller.call(async()=>{let d=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await M(d,"create dataset"),d})).json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets",s=new URLSearchParams({limit:"1"});if(e&&t)throw new Error("Must provide either datasetName or datasetId, not both");if(e)W(e),n+=`/${e}`;else if(t)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");let i=await this._get(n,s),a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:s}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:t})).id);let a=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){let n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:s,datasetNameContains:i,metadata:a}={}){let o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(let c of n)u.append("id",c);s!==void 0&&u.append("name",s),i!==void 0&&u.append("name_contains",i),a!==void 0&&u.append("metadata",JSON.stringify(a));for await(let c of this._getPaginated(o,u))yield*c}async updateDataset(e){let{datasetId:t,datasetName:n,...s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");let i=t??(await this.readDataset({datasetName:n})).id;W(i);let a=JSON.stringify(s);return await(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(u,"update dataset"),u})).json()}async updateDatasetTag(e){let{datasetId:t,datasetName:n,asOf:s,tag:i}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");let a=t??(await this.readDataset({datasetName:n})).id;W(a);let o=JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:i});await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await M(u,"update dataset tags",!0),u})}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)W(s),n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{let i=await this._fetch(this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(i,`delete ${n}`,!0),i})}async indexDataset({datasetId:e,datasetName:t,tag:n}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),W(s);let a=JSON.stringify({tag:n});await(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(u,"index dataset"),u})).json()}async similarExamples(e,t,n,{filter:s}={}){let i={limit:n,inputs:e};s!==void 0&&(i.filter=s),W(t);let a=JSON.stringify(i);return(await(await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/datasets/${t}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:a});return await M(c,"fetch similar examples"),c})).json()).examples}async createExample(e,t,n){if(_g(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=t?n?.datasetId:e.dataset_id,i=t?n?.datasetName:e.dataset_name;if(s===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:i})).id);let a=(t?n?.createdAt:e.created_at)||new Date,o;_g(e)?o=e:o={inputs:e,outputs:t,created_at:a?.toISOString(),id:n?.exampleId,metadata:n?.metadata,split:n?.split,source_run_id:n?.sourceRunId,use_source_run_io:n?.useSourceRunIO,use_source_run_attachments:n?.useSourceRunAttachments,attachments:n?.attachments};let u=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(u.example_ids?.[0]??ye())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];let _=e,w=_[0].dataset_id,A=_[0].dataset_name;if(w===void 0&&A===void 0)throw new Error("Must provide either datasetName or datasetId");if(w!==void 0&&A!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");w===void 0&&(w=(await this.readDataset({datasetName:A})).id);let E=await this._uploadExamplesMultipart(w,_);return await Promise.all(E.example_ids.map(F=>this.readExample(F)))}let{inputs:t,outputs:n,metadata:s,splits:i,sourceRunIds:a,useSourceRunIOs:o,useSourceRunAttachments:u,attachments:c,exampleIds:l,datasetId:d,datasetName:f}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let p=d,h=f;if(p===void 0&&h===void 0)throw new Error("Must provide either datasetName or datasetId");if(p!==void 0&&h!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");p===void 0&&(p=(await this.readDataset({datasetName:h})).id);let m=t.map((_,w)=>({dataset_id:p,inputs:_,outputs:n?.[w],metadata:s?.[w],split:i?.[w],id:l?.[w],attachments:c?.[w],source_run_id:a?.[w],use_source_run_io:o?.[w],use_source_run_attachments:u?.[w]})),g=await this._uploadExamplesMultipart(p,m);return await Promise.all(g.example_ids.map(_=>this.readExample(_)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){let s=e.map(a=>bl(a)?wl(a):a),i=bl(t)?wl(t):t;return this.createExample({input:s},{output:i},n)}async readExample(e){W(e);let t=`/examples/${e}`,n=await this._get(t),{attachment_urls:s,...i}=n,a=i;return s&&(a.attachments=Object.entries(s).reduce((o,[u,c])=>(o[u.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},o),{})),a}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:s,splits:i,inlineS3Urls:a,metadata:o,limit:u,offset:c,filter:l,includeAttachments:d}={}){let f;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)f=e;else if(t!==void 0)f=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");let p=new URLSearchParams({dataset:f}),h=s?typeof s=="string"?s:s?.toISOString():void 0;h&&p.append("as_of",h);let m=a??!0;if(p.append("inline_s3_urls",m.toString()),n!==void 0)for(let y of n)p.append("id",y);if(i!==void 0)for(let y of i)p.append("splits",y);if(o!==void 0){let y=JSON.stringify(o);p.append("metadata",y)}u!==void 0&&p.append("limit",u.toString()),c!==void 0&&p.append("offset",c.toString()),l!==void 0&&p.append("filter",l),d===!0&&["attachment_urls","outputs","metadata"].forEach(y=>p.append("select",y));let g=0;for await(let y of this._getPaginated("/examples",p)){for(let _ of y){let{attachment_urls:w,...A}=_,E=A;w&&(E.attachments=Object.entries(w).reduce((z,[F,G])=>(z[F.slice(11)]={presigned_url:G.presigned_url,mime_type:G.mime_type||void 0},z),{})),yield E,g++}if(u!==void 0&&g>=u)break}}async deleteExample(e){W(e);let t=`/examples/${e}`;await this.caller.call(async()=>{let n=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(n,`delete ${t}`,!0),n})}async updateExample(e,t){let n;t?n=e:n=e.id,W(n);let s;t?s={id:n,...t}:s=e;let i;return s.dataset_id!==void 0?i=s.dataset_id:i=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(i,[s])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:s}){let i;if(e?i=e:i=(await this.readDataset({datasetName:t})).id,W(i),n&&s||!n&&!s)throw new Error("Exactly one of asOf and tag must be specified.");let a=new URLSearchParams;return n!==void 0&&a.append("as_of",typeof n=="string"?n:n.toISOString()),s!==void 0&&a.append("tag",s),await(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/datasets/${i}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(u,"read dataset version"),u})).json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,W(s);let i=new URLSearchParams,a=n?typeof n=="string"?n:n?.toISOString():void 0;return a&&i.append("as_of",a),await this._get(`/datasets/${s}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:s,remove:i=!1}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,W(a);let o={split_name:n,examples:s.map(c=>(W(c),c)),remove:i},u=JSON.stringify(o);await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await M(c,"update dataset splits",!0),c})}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){ga("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));let o=await t.evaluateRun(a,i),[u,c]=await this._logEvaluationFeedback(o,a,n);return c[0]}async createFeedback(e,t,{score:n,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:l,feedbackConfig:d,projectId:f,comparativeExperimentId:p}){if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");let h={type:u??"api",metadata:o??{}};c!==void 0&&h?.metadata!==void 0&&!h.metadata.__run&&(h.metadata.__run={run_id:c}),h?.metadata!==void 0&&h.metadata.__run?.run_id!==void 0&&W(h.metadata.__run.run_id);let m={id:l??ye(),run_id:e,key:t,score:mg(n),value:s,correction:i,comment:a,feedback_source:h,comparative_experiment_id:p,feedbackConfig:d,session_id:f},g=JSON.stringify(m),y=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{let _=await this._fetch(y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:g});return await M(_,"create feedback",!0),_}),m}async updateFeedback(e,{score:t,value:n,correction:s,comment:i}){let a={};t!=null&&(a.score=mg(t)),n!=null&&(a.value=n),s!=null&&(a.correction=s),i!=null&&(a.comment=i),W(e);let o=JSON.stringify(a);await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await M(u,"update feedback",!0),u})}async readFeedback(e){W(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){W(e);let t=`/feedback/${e}`;await this.caller.call(async()=>{let n=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(n,`delete ${t}`,!0),n})}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){let s=new URLSearchParams;if(e)for(let i of e)W(i),s.append("run",i);if(t)for(let i of t)s.append("key",i);if(n)for(let i of n)s.append("source",i);for await(let i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:s}={}){let i={run_id:e,feedback_key:t,feedback_config:s};n?typeof n=="string"?i.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(i.expires_in=n):i.expires_in={hours:3};let a=JSON.stringify(i);return await(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(u,"create presigned feedback token"),u})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:s,description:i,metadata:a,id:o}){if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");let u={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:i,created_at:(s??new Date)?.toISOString(),extra:{}};a&&(u.extra.metadata=a);let c=JSON.stringify(u);return(await this.caller.call(async()=>{let d=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await M(d,"create comparative experiment"),d})).json()}async*listPresignedFeedbackTokens(e){W(e);let t=new URLSearchParams({run_id:e});for await(let n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,n){let s=this._selectEvalResults(e),i=[];for(let a of s){let o=n||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let u=null;a.targetRunId?u=a.targetRunId:t&&(u=t.id),i.push(await this.createFeedback(u,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[s,i]}async logEvaluationFeedback(e,t,n){let[s]=await this._logEvaluationFeedback(e,t,n);return s}async*listAnnotationQueues(e={}){let{queueIds:t,name:n,nameContains:s,limit:i}=e,a=new URLSearchParams;t&&t.forEach((u,c)=>{W(u,`queueIds[${c}]`),a.append("ids",u)}),n&&a.append("name",n),s&&a.append("name_contains",s),a.append("limit",(i!==void 0?Math.min(i,100):100).toString());let o=0;for await(let u of this._getPaginated("/annotation-queues",a))if(yield*u,o++,i!==void 0&&o>=i)break}async createAnnotationQueue(e){let{name:t,description:n,queueId:s,rubricInstructions:i}=e,a={name:t,description:n,id:s||ye(),rubric_instructions:i},o=JSON.stringify(Object.fromEntries(Object.entries(a).filter(([c,l])=>l!==void 0)));return(await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await M(c,"create annotation queue"),c})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/annotation-queues/${W(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(n,"read annotation queue"),n})).json()}async updateAnnotationQueue(e,t){let{name:n,description:s,rubricInstructions:i}=t,a=JSON.stringify({name:n,description:s,rubric_instructions:i});await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/annotation-queues/${W(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(o,"update annotation queue",!0),o})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${W(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(t,"delete annotation queue",!0),t})}async addRunsToAnnotationQueue(e,t){let n=JSON.stringify(t.map((s,i)=>W(s,`runIds[${i}]`).toString()));await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/annotation-queues/${W(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await M(s,"add runs to annotation queue",!0),s})}async getRunFromAnnotationQueue(e,t){let n=`/annotation-queues/${W(e,"queueId")}/run`;return(await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(i,"get run from annotation queue"),i})).json()}async deleteRunFromAnnotationQueue(e,t){await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/annotation-queues/${W(e,"queueId")}/runs/${W(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(n,"delete run from annotation queue",!0),n})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/annotation-queues/${W(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(n,"get size from annotation queue"),n})).json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){let n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let n=await(await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(s,"get latest commit hash"),s})).json();if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[n,s,i]=Ar(e),a=JSON.stringify({like:t});return(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/likes/${n}/${s}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(u,`${t?"like":"unlike"} prompt`),u})).json()}async _getPromptUrl(e){let[t,n,s]=Ar(e);if(await this._currentTenantIsOwner(t)){let i=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${n}/${s.substring(0,8)}?organizationId=${i.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${i.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){let t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);for await(let n of this._getPaginated("/repos",t,s=>s.repos))yield*n}async getPrompt(e){let[t,n,s]=Ar(e),a=await(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return o?.status===404?null:(await M(o,"get prompt"),o)}))?.json();return a?.repo?a.repo:null}async createPrompt(e,t){let n=await this._getSettings();if(t?.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[s,i,a]=Ar(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);let o={repo_handle:i,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},u=JSON.stringify(o),c=await this.caller.call(async()=>{let d=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await M(d,"create prompt"),d}),{repo:l}=await c.json();return l}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[s,i,a]=Ar(e),o=n?.parentCommitHash==="latest"||!n?.parentCommitHash?await this._getLatestCommitHash(`${s}/${i}`):n?.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=JSON.stringify(u),d=await(await this.caller.call(async()=>{let f=await this._fetch(`${this.apiUrl}/commits/${s}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await M(f,"create commit"),f})).json();return this._getPromptUrl(`${s}/${i}${d.commit_hash?`:${d.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let n=new FormData;for(let a of t){let o=a.id,u={...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split}},c=Qe(u,`Serializing body for example with id: ${o}`),l=new Blob([c],{type:"application/json"});if(n.append(o,l),a.inputs){let d=Qe(a.inputs,`Serializing inputs for example with id: ${o}`),f=new Blob([d],{type:"application/json"});n.append(`${o}.inputs`,f)}if(a.outputs){let d=Qe(a.outputs,`Serializing outputs whle updating example with id: ${o}`),f=new Blob([d],{type:"application/json"});n.append(`${o}.outputs`,f)}if(a.attachments)for(let[d,f]of Object.entries(a.attachments)){let p,h;Array.isArray(f)?[p,h]=f:(p=f.mimeType,h=f.data);let m=new Blob([h],{type:`${p}; length=${h.byteLength}`});n.append(`${o}.attachment.${d}`,m)}if(a.attachments_operations){let d=Qe(a.attachments_operations,`Serializing attachments while updating example with id: ${o}`),f=new Blob([d],{type:"application/json"});n.append(`${o}.attachments_operations`,f)}}let s=e??t[0]?.dataset_id;return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${s}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await M(a,"update examples"),a})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let n=new FormData;for(let i of t){let a=(i.id??ye()).toString(),o={created_at:i.created_at,...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split},...i.source_run_id&&{source_run_id:i.source_run_id},...i.use_source_run_io&&{use_source_run_io:i.use_source_run_io},...i.use_source_run_attachments&&{use_source_run_attachments:i.use_source_run_attachments}},u=Qe(o,`Serializing body for uploaded example with id: ${a}`),c=new Blob([u],{type:"application/json"});if(n.append(a,c),i.inputs){let l=Qe(i.inputs,`Serializing inputs for uploaded example with id: ${a}`),d=new Blob([l],{type:"application/json"});n.append(`${a}.inputs`,d)}if(i.outputs){let l=Qe(i.outputs,`Serializing outputs for uploaded example with id: ${a}`),d=new Blob([l],{type:"application/json"});n.append(`${a}.outputs`,d)}if(i.attachments)for(let[l,d]of Object.entries(i.attachments)){let f,p;Array.isArray(d)?[f,p]=d:(f=d.mimeType,p=d.data);let h=new Blob([p],{type:`${f}; length=${p.byteLength}`});n.append(`${a}.attachment.${l}`,h)}}return(await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await M(i,"upload examples"),i})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[n,s]=Ar(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);let i={};if(t?.description!==void 0&&(i.description=t.description),t?.readme!==void 0&&(i.readme=t.readme),t?.tags!==void 0&&(i.tags=t.tags),t?.isPublic!==void 0&&(i.is_public=t.isPublic),t?.isArchived!==void 0&&(i.is_archived=t.isArchived),Object.keys(i).length===0)throw new Error("No valid update options provided");let a=JSON.stringify(i);return(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/repos/${n}/${s}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(u,"update prompt"),u})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[t,n,s]=Ar(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(a,"delete prompt"),a})).json()}async pullPromptCommit(e,t){let[n,s,i]=Ar(e),o=await(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/commits/${n}/${s}/${i}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(u,"pull prompt commit"),u})).json();return{owner:n,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){let n=await this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:n=this.apiUrl,datasetName:s}=t,[i,a]=this.parseTokenOrUrl(e,n),o=new r({apiUrl:i,apiKey:"placeholder"}),u=await o.readSharedDataset(a),c=s||u.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}let l=await o.listSharedExamples(a),d=await this.createDataset(c,{description:u.description,dataType:u.data_type||"kv",inputsSchema:u.inputs_schema_definition??void 0,outputsSchema:u.outputs_schema_definition??void 0});try{await this.createExamples({inputs:l.map(f=>f.inputs),outputs:l.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:d.id})}catch(f){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,n=2,s="dataset"){try{return W(e),[t,e]}catch{}try{let a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=n){let o=a[a.length-n];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await ch()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}};function _g(r){return"dataset_id"in r||"dataset_name"in r}var yg=r=>r!==void 0?r:!!["TRACING_V2","TRACING"].find(t=>ve(t)==="true");var pu=Symbol.for("lc:context_variables");function hE(r){return r.replace(/[-:.]/g,"")}function ql(r,e,t=1){let n=t.toFixed(0).slice(0,3).padStart(3,"0"),s=`${new Date(r).toISOString().slice(0,-1)}${n}Z`;return{dottedOrder:hE(s)+e,microsecondPrecisionDatestring:s}}var hu=class r{constructor(e,t,n,s){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n,this.replicas=s}static fromHeader(e){let t=e.split(","),n={},s=[],i,a;for(let o of t){let[u,c]=o.split("="),l=decodeURIComponent(c);u==="langsmith-metadata"?n=JSON.parse(l):u==="langsmith-tags"?s=l.split(","):u==="langsmith-project"?i=l:u==="langsmith-replicas"&&(a=JSON.parse(l))}return new r(n,s,i,a)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}},St=class r{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),wg(e)){Object.assign(this,{...e});return}let t=r.getDefaultConfig(),{metadata:n,...s}=e,i=s.client??r.getSharedClient(),a={...n,...s?.extra?.metadata};if(s.extra={...s.extra,metadata:a},Object.assign(this,{...t,...s,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=bE(this.replicas),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){let{dottedOrder:o,microsecondPrecisionDatestring:u}=ql(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+o:this.dotted_order=o,this._serialized_start_time=u}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:ye(),run_type:"chain",project_name:pa(),child_runs:[],api_url:ot("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:ot("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return r.sharedClient||(r.sharedClient=new Qn),r.sharedClient}createChild(e){let t=this.child_execution_order+1,n=new r({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});pu in this&&(n[pu]=this[pu]);let s=Symbol.for("lc:child_config"),i=e.extra?.[s]??this.extra[s];if(gE(i)){let u={...i},c=mE(u.callbacks)?u.callbacks.copy?.():void 0;c&&(Object.assign(c,{_parentRunId:n.id}),c.handlers?.find(xg)?.updateFromRunTree?.(n),u.callbacks=c),n.extra[s]=u}let a=new Set,o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,n=!0){let s=e.extra??{};if(s?.runtime?.library===void 0&&(s.runtime||(s.runtime={}),t))for(let[o,u]of Object.entries(t))s.runtime[o]||(s.runtime[o]=u);let i,a;return n?(a=e.parent_run?.id??e.parent_run_id,i=[]):(i=e.child_runs.map(o=>this._convertToCreate(o,t,n)),a=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,n=!0){let s=this._convertToCreate(this,t,n);if(e===this.project_name)return s;let i=d=>Ro(`${d}:${e}`,Ro.DNS),a=i(s.id),o=s.trace_id?i(s.trace_id):void 0,u=s.parent_run_id?i(s.parent_run_id):void 0,c;if(s.dotted_order){let d=_E(s.dotted_order),f=[];for(let h=0;h<d.length-1;h++){let[m,g]=d[h],y=i(g);f.push(m.toISOString().replace(/[-:]/g,"").replace(".","")+y)}let[p]=d[d.length-1];f.push(p.toISOString().replace(/[-:]/g,"").replace(".","")+a),c=f.join(".")}else c=void 0;return{...s,id:a,trace_id:o,parent_run_id:u,dotted_order:c,session_name:e}}async postRun(e=!0){try{let t=Fo();if(this.replicas&&this.replicas.length>0)for(let{projectName:n,apiKey:s,apiUrl:i,workspaceId:a}of this.replicas){let o=this._remapForProject(n??this.project_name,t,!0);await this.client.createRun(o,{apiKey:s,apiUrl:i,workspaceId:a})}else{let n=this._convertToCreate(this,t,e);await this.client.createRun(n)}if(!e){ga("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let n of this.child_runs)await n.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(e){if(this.replicas&&this.replicas.length>0)for(let{projectName:t,apiKey:n,apiUrl:s,workspaceId:i,updates:a}of this.replicas){let o=this._remapForProject(t??this.project_name),u={id:o.id,outputs:o.outputs,error:o.error,parent_run_id:o.parent_run_id,session_name:o.session_name,reference_example_id:o.reference_example_id,end_time:o.end_time,dotted_order:o.dotted_order,trace_id:o.trace_id,events:o.events,tags:o.tags,extra:o.extra,attachments:this.attachments,...a};e?.excludeInputs||(u.inputs=o.inputs),await this.client.updateRun(o.id,u,{apiKey:n,apiUrl:s,workspaceId:i})}else try{let t={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e?.excludeInputs||(t.inputs=this.inputs),await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){let n=e?.callbacks,s,i,a,o=yg();if(n){let c=n?.getParentRunId?.()??"",l=n?.handlers?.find(d=>d?.name=="langchain_tracer");s=l?.getRun?.(c),i=l?.projectName,a=l?.client,o=o||!!l}return s?new r({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:a,tracingEnabled:o,project_name:i,tags:[...new Set((s?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...s?.extra?.metadata,...e?.metadata}}}).createChild(t):new r({...t,client:a,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=n["langsmith-trace"];if(!s||typeof s!="string")return;let i=s.trim(),a=i.split(".").map(c=>{let[l,d]=c.split("Z");return{strTime:l,time:Date.parse(l+"Z"),uuid:d}}),o=a[0].uuid,u={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:a.at(-1)?.uuid,trace_id:o,dotted_order:i};if(n.baggage&&typeof n.baggage=="string"){let c=hu.fromHeader(n.baggage);u.metadata=c.metadata,u.tags=c.tags,u.project_name=c.project_name,u.replicas=c.replicas}return new r(u)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new hu(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[n,s]of Object.entries(t))e.set(n,s);return t}};Object.defineProperty(St,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function wg(r){return r!=null&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function xg(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function bg(r){return Array.isArray(r)&&r.some(e=>xg(e))}function mE(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function gE(r){return r!=null&&typeof r.callbacks=="object"&&(bg(r.callbacks?.handlers)||bg(r.callbacks))}function _E(r){return r.split(".").map(t=>{let n=t.slice(0,-36),s=t.slice(-36),i=parseInt(n.slice(0,4)),a=parseInt(n.slice(4,6))-1,o=parseInt(n.slice(6,8)),u=parseInt(n.slice(9,11)),c=parseInt(n.slice(11,13)),l=parseInt(n.slice(13,15)),d=parseInt(n.slice(15,21));return[new Date(i,a,o,u,c,l,d/1e3),s]})}function yE(){let r=ot("LANGSMITH_RUNS_ENDPOINTS");if(!r)return[];try{let e=JSON.parse(r);if(Array.isArray(e)){let t=[];for(let n of e){if(typeof n!="object"||n===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof n}`);continue}if(typeof n.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_url}`);continue}if(typeof n.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_key}`);continue}t.push({apiUrl:n.api_url.replace(/\/$/,""),apiKey:n.api_key})}return t}else if(typeof e=="object"&&e!==null){wE(e);let t=[];for(let[n,s]of Object.entries(e)){let i=n.replace(/\/$/,"");if(typeof s=="string")t.push({apiUrl:i,apiKey:s});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${n}: expected string, got ${typeof s}`);continue}}return t}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof e}`),[]}catch(e){if(dg(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function bE(r){return r?r.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):yE()}function wE(r){if(Object.keys(r).length>0&&ve("ENDPOINT"))throw new cu}var xE=()=>typeof window<"u"&&typeof window.document<"u",vE=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",AE=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Hl=()=>typeof Deno<"u",EE=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Hl(),OE=()=>{let r;return xE()?r="browser":EE()?r="node":vE()?r="webworker":AE()?r="jsdom":Hl()?r="deno":r="other",r},Gl;function vg(){return Gl===void 0&&(Gl={library:"langchain-js",runtime:OE()}),Gl}function pe(r){try{return typeof process<"u"?process.env?.[r]:Hl()?Deno?.env.get(r):void 0}catch{return}}var Vl=class{};function Kl(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}var ts=class r extends Vl{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,$c(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:pe("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Tt.prototype.toJSON.call(this)}toJSONNotImplemented(){return Tt.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends r{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ye()}),Object.assign(this,e)}}return new t}},Ag=r=>{let e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};var IE=r=>{if(r)return r.events=r.events??[],r.child_runs=r.child_runs??[],r};function Wl(r,e){if(r)return new St({...r,start_time:r._serialized_start_time??r.start_time,parent_run:Wl(e),child_runs:r.child_runs.map(t=>Wl(t)).filter(t=>t!==void 0),extra:{...r.extra,runtime:vg()},tracingEnabled:!1})}function Jl(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function Ws(r){return typeof r._addRunToRunMap=="function"}var At=class extends ts{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?IE(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let{dottedOrder:t,microsecondPrecisionDatestring:n}=ql(new Date(e.start_time).getTime(),e.id,e.execution_order),s={...e},i=this.getRunById(s.parent_run_id);if(s.parent_run_id!==void 0?i&&(this._addChildRun(i,s),i.child_execution_order=Math.max(i.child_execution_order,s.child_execution_order),s.trace_id=i.trace_id,i.dotted_order!==void 0&&(s.dotted_order=[i.dotted_order,t].join("."),s._serialized_start_time=n)):(s.trace_id=s.id,s.dotted_order=t,s._serialized_start_time=n),this.usesRunTreeMap){let a=Wl(s,i);a!==void 0&&this.runTreeMap.set(s.id,a)}else this.runMap.set(s.id,s);return s}async _endTrace(e){let t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){let t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,s,i,a,o,u){let c=this._getExecutionOrder(s),l=Date.now(),d=o?{...i,metadata:o}:i,f={id:n,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(f)}async handleLLMStart(e,t,n,s,i,a,o,u){let c=this.getRunById(n)??this._createRunForLLMStart(e,t,n,s,i,a,o,u);return await this.onRunCreate?.(c),await this.onLLMStart?.(c),c}_createRunForChatModelStart(e,t,n,s,i,a,o,u){let c=this._getExecutionOrder(s),l=Date.now(),d=o?{...i,metadata:o}:i,f={id:n,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(f)}async handleChatModelStart(e,t,n,s,i,a,o,u){let c=this.getRunById(n)??this._createRunForChatModelStart(e,t,n,s,i,a,o,u);return await this.onRunCreate?.(c),await this.onLLMStart?.(c),c}async handleLLMEnd(e,t,n,s,i){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await this.onLLMEnd?.(a),await this._endTrace(a),a}async handleLLMError(e,t,n,s,i){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await this.onLLMError?.(a),await this._endTrace(a),a}_createRunForChainStart(e,t,n,s,i,a,o,u){let c=this._getExecutionOrder(s),l=Date.now(),d={id:n,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,n,s,i,a,o,u){let c=this.getRunById(n)??this._createRunForChainStart(e,t,n,s,i,a,o,u);return await this.onRunCreate?.(c),await this.onChainStart?.(c),c}async handleChainEnd(e,t,n,s,i){let a=this.getRunById(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=Jl(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),i?.inputs!==void 0&&(a.inputs=Jl(i.inputs,"input")),await this.onChainEnd?.(a),await this._endTrace(a),a}async handleChainError(e,t,n,s,i){let a=this.getRunById(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),i?.inputs!==void 0&&(a.inputs=Jl(i.inputs,"input")),await this.onChainError?.(a),await this._endTrace(a),a}_createRunForToolStart(e,t,n,s,i,a,o){let u=this._getExecutionOrder(s),c=Date.now(),l={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(l)}async handleToolStart(e,t,n,s,i,a,o){let u=this.getRunById(n)??this._createRunForToolStart(e,t,n,s,i,a,o);return await this.onRunCreate?.(u),await this.onToolStart?.(u),u}async handleToolEnd(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await this.onToolEnd?.(n),await this._endTrace(n),n}async handleToolError(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await this.onToolError?.(n),await this._endTrace(n),n}async handleAgentAction(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="chain")return;let s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(n)}async handleAgentEnd(e,t){let n=this.getRunById(t);!n||n?.run_type!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(n))}_createRunForRetrieverStart(e,t,n,s,i,a,o){let u=this._getExecutionOrder(s),c=Date.now(),l={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(l)}async handleRetrieverStart(e,t,n,s,i,a,o){let u=this.getRunById(n)??this._createRunForRetrieverStart(e,t,n,s,i,a,o);return await this.onRunCreate?.(u),await this.onRetrieverStart?.(u),u}async handleRetrieverEnd(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await this.onRetrieverEnd?.(n),await this._endTrace(n),n}async handleRetrieverError(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await this.onRetrieverError?.(n),await this._endTrace(n),n}async handleText(e,t){let n=this.getRunById(t);!n||n?.run_type!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(n))}async handleLLMNewToken(e,t,n,s,i,a){let o=this.getRunById(n);if(!o||o?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),await this.onLLMNewToken?.(o,e,{chunk:a?.chunk}),o}};var Yl=It(Tg(),1);function Ve(r,e){return`${r.open}${e}${r.close}`}function Et(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function Pg(r){return typeof r=="string"?r.trim():r==null?r:Et(r,r.toString())}function Xr(r){if(!r.end_time)return"";let e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:et}=Yl.default,Ea=class extends At{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],n=e;for(;n.parent_run_id;){let s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){let n=[...this.getParents(e).reverse(),e].map((s,i,a)=>{let o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?Ve(Yl.default.bold,o):o}).join(" > ");return Ve(et.grey,n)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Et(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.cyan,"[chain/end]")} [${t}] [${Xr(e)}] Exiting Chain run with output: ${Et(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.red,"[chain/error]")} [${t}] [${Xr(e)}] Chain run errored with error: ${Et(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${Ve(et.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Et(n,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.cyan,"[llm/end]")} [${t}] [${Xr(e)}] Exiting LLM run with output: ${Et(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.red,"[llm/error]")} [${t}] [${Xr(e)}] LLM run errored with error: ${Et(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Pg(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.cyan,"[tool/end]")} [${t}] [${Xr(e)}] Exiting Tool run with output: "${Pg(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.red,"[tool/error]")} [${t}] [${Xr(e)}] Tool run errored with error: ${Et(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Et(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.cyan,"[retriever/end]")} [${t}] [${Xr(e)}] Exiting Retriever run with output: ${Et(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.red,"[retriever/error]")} [${t}] [${Xr(e)}] Retriever run errored with error: ${Et(e.error,"[error]")}`)}onAgentAction(e){let t=e,n=this.getBreadcrumbs(e);console.log(`${Ve(et.blue,"[agent/action]")} [${n}] Agent selected action: ${Et(t.actions[t.actions.length-1],"[action]")}`)}};var Xl,Ql=()=>{if(Xl===void 0){let r=pe("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};Xl=new Qn(r)}return Xl};var Ys=class r extends At{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});let{exampleId:t,projectName:n,client:s,replicas:i}=e;this.projectName=n??pa(),this.replicas=i,this.exampleId=t,this.client=s??Ql();let a=r.getTraceableRunTree();a&&this.updateFromRunTree(a)}async persistRun(e){}async onRunCreate(e){await this.getRunTreeWithTracingConfig(e.id)?.postRun()}async onRunUpdate(e){await this.getRunTreeWithTracingConfig(e.id)?.patchRun()}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){this.runTreeMap.set(e.id,e);let t=e,n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();let s=[t];for(;s.length>0;){let i=s.shift();!i||n.has(i.id)||(n.add(i.id),this.runTreeMap.set(i.id,i),i.child_runs&&s.push(...i.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){let t=this.runTreeMap.get(e);if(t)return new St({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return Op(!0)}catch{return}}};var mu=It(Jo(),1);var Sg=Symbol.for("ls:tracing_async_local_storage"),rs=Symbol.for("lc:context_variables"),kg=r=>{globalThis[Sg]=r},Qr=()=>globalThis[Sg];var Oa;function PE(){let r="default"in mu.default?mu.default.default:mu.default;return new r({autoStart:!0,concurrency:1})}function SE(){return typeof Oa>"u"&&(Oa=PE()),Oa}async function xe(r,e){if(e===!0){let t=Qr();t!==void 0?await t.run(void 0,async()=>r()):await r()}else Oa=SE(),Oa.add(async()=>{let t=Qr();t!==void 0?await t.run(void 0,async()=>r()):await r()})}var Rg=r=>r!==void 0?r:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>pe(t)==="true");function ed(r){let e=Qr();return e===void 0?void 0:e.getStore()?.[rs]?.[r]}var kE=Symbol("lc:configure_hooks"),Ng=()=>ed(kE)||[];function Cg(r){return r?Array.isArray(r)||"name"in r?{callbacks:r}:r:{}}var td=class{setHandler(e){return this.setHandlers([e])}},Xs=class{constructor(e,t,n,s,i,a,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>xe(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,s,i){await Promise.all(this.handlers.map(a=>xe(async()=>{try{await a.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}},rd=class extends Xs{getChild(e){let t=new $e(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>xe(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw n}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>xe(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${n}`),t.raiseError)throw e}},t.awaitHandlers)))}},gu=class extends Xs{async handleLLMNewToken(e,t,n,s,i,a){await Promise.all(this.handlers.map(o=>xe(async()=>{if(!o.ignoreLLM)try{await o.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a)}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}async handleLLMError(e,t,n,s,i){await Promise.all(this.handlers.map(a=>xe(async()=>{if(!a.ignoreLLM)try{await a.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,i)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleLLMEnd(e,t,n,s,i){await Promise.all(this.handlers.map(a=>xe(async()=>{if(!a.ignoreLLM)try{await a.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,i)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}},nd=class extends Xs{getChild(e){let t=new $e(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,s,i){await Promise.all(this.handlers.map(a=>xe(async()=>{if(!a.ignoreChain)try{await a.handleChainError?.(e,this.runId,this._parentRunId,this.tags,i)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleChainEnd(e,t,n,s,i){await Promise.all(this.handlers.map(a=>xe(async()=>{if(!a.ignoreChain)try{await a.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,i)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>xe(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>xe(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}},sd=class extends Xs{getChild(e){let t=new $e(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>xe(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>xe(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}},$e=class r extends td{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(c,l)=>{let d=l===0&&n?n:ye();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Ws(f)&&f._createRunForLLMStart(e,[c],d,this._parentRunId,i,this.tags,this.metadata,u),xe(async()=>{try{await f.handleLLMStart?.(e,[c],d,this._parentRunId,i,this.tags,this.metadata,u)}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new gu(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(c,l)=>{let d=l===0&&n?n:ye();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Ws(f)&&f._createRunForChatModelStart(e,[c],d,this._parentRunId,i,this.tags,this.metadata,u),xe(async()=>{try{if(f.handleChatModelStart)await f.handleChatModelStart?.(e,[c],d,this._parentRunId,i,this.tags,this.metadata,u);else if(f.handleLLMStart){let p=oa(c);await f.handleLLMStart?.(e,[p],d,this._parentRunId,i,this.tags,this.metadata,u)}}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new gu(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=ye(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return Ws(u)&&u._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,s,o),xe(async()=>{try{await u.handleChainStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,s,o)}catch(c){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${c}`),u.raiseError)throw c}},u.awaitHandlers)})),new nd(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=ye(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return Ws(u)&&u._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),xe(async()=>{try{await u.handleToolStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o)}catch(c){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${c}`),u.raiseError)throw c}},u.awaitHandlers)})),new sd(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=ye(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return Ws(u)&&u._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),xe(async()=>{try{await u.handleRetrieverStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o)}catch(c){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${c}`),u.raiseError)throw c}},u.awaitHandlers)})),new rd(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,s,i){await Promise.all(this.handlers.map(a=>xe(async()=>{if(!a.ignoreCustomEvent)try{await a.handleCustomEvent?.(e,t,n,this.tags,this.metadata)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let n=new r(this._parentRunId);for(let s of this.handlers){let i=this.inheritableHandlers.includes(s);n.addHandler(s,i)}for(let s of this.tags){let i=this.inheritableTags.includes(s);n.addTags([s],i)}for(let s of Object.keys(this.metadata)){let i=Object.keys(this.inheritableMetadata).includes(s);n.addMetadata({[s]:this.metadata[s]},i)}for(let s of e)n.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||n.addHandler(s,t);return n}static fromHandlers(e){class t extends ts{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ye()}),Object.assign(this,e)}}let n=new this;return n.addHandler(new t),n}static configure(e,t,n,s,i,a,o){return this._configureSync(e,t,n,s,i,a,o)}static _configureSync(e,t,n,s,i,a,o){let u;(e||t)&&(Array.isArray(e)||!e?(u=new r,u.setHandlers(e?.map(Ia)??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(Ia):t?.handlers,!1));let c=pe("LANGCHAIN_VERBOSE")==="true"||o?.verbose,l=Ys.getTraceableRunTree()?.tracingEnabled||Rg(),d=l||(pe("LANGCHAIN_TRACING")??!1);if(c||d){if(u||(u=new r),c&&!u.handlers.some(f=>f.name===Ea.prototype.name)){let f=new Ea;u.addHandler(f,!0)}if(d&&!u.handlers.some(f=>f.name==="langchain_tracer")&&l){let f=new Ys;u.addHandler(f,!0)}if(l){let f=Ys.getTraceableRunTree();f&&u._parentRunId===void 0&&(u._parentRunId=f.id,u.handlers.find(h=>h.name==="langchain_tracer")?.updateFromRunTree(f))}}for(let{contextVar:f,inheritable:p=!0,handlerClass:h,envVar:m}of Ng()){let g=m&&pe(m)==="true"&&h,y,_=f!==void 0?ed(f):void 0;_&&Ag(_)?y=_:g&&(y=new h({})),y!==void 0&&(u||(u=new r),u.handlers.some(w=>w.name===y.name)||u.addHandler(y,p))}return(n||s)&&u&&(u.addTags(n??[]),u.addTags(s??[],!1)),(i||a)&&u&&(u.addMetadata(i??{}),u.addMetadata(a??{},!1)),u}};function Ia(r){return"name"in r?r:ts.fromMethods(r)}var _u=class{getStore(){}run(e,t){return t()}enterWith(e){}},RE=new _u,$g=Symbol.for("lc:child_config"),id=class{getInstance(){return Qr()??RE}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[$g]}runWithConfig(e,t,n){let s=$e._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),i=this.getInstance(),a=i.getStore(),o=s?.getParentRunId(),u=s?.handlers?.find(l=>l?.name==="langchain_tracer"),c;return u&&o?c=u.getRunTreeWithTracingConfig(o):n||(c=new St({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[$g]:e}),a!==void 0&&a[rs]!==void 0&&(c===void 0&&(c={}),c[rs]=a[rs]),i.run(c,t)}initializeGlobalInstance(e){Qr()===void 0&&kg(e)}},tt=new id;var yu=25;async function rt(r){return $e._configureSync(r?.callbacks,void 0,r?.tags,void 0,r?.metadata)}function Qs(...r){let e={};for(let t of r.filter(n=>!!n))for(let n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){let s=e[n]??[];e[n]=[...new Set(s.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){let s=e.callbacks,i=t.callbacks;if(Array.isArray(i))if(!s)e.callbacks=i;else if(Array.isArray(s))e.callbacks=s.concat(i);else{let a=s.copy();for(let o of i)a.addHandler(Ia(o),!0);e.callbacks=a}else if(i)if(!s)e.callbacks=i;else if(Array.isArray(s)){let a=i.copy();for(let o of s)a.addHandler(Ia(o),!0);e.callbacks=a}else e.callbacks=new $e(i._parentRunId,{handlers:s.handlers.concat(i.handlers),inheritableHandlers:s.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(i.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(i.inheritableTags))),metadata:{...s.metadata,...i.metadata}})}else{let s=n;e[s]=t[s]??e[s]}return e}var NE=new Set(["string","number","boolean"]);function ie(r){let e=tt.getRunnableConfig(),t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let{runId:n,runName:s,...i}=e;t=Object.entries(i).reduce((a,[o,u])=>(u!==void 0&&(a[o]=u),a),t)}if(r&&(t=Object.entries(r).reduce((n,[s,i])=>(i!==void 0&&(n[s]=i),n),t)),t?.configurable)for(let n of Object.keys(t.configurable))NE.has(typeof t.configurable[n])&&!t.metadata?.[n]&&(t.metadata||(t.metadata={}),t.metadata[n]=t.configurable[n]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");let n=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,n])):t.signal=n,delete t.timeout}return t}function Ae(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:s,configurable:i,runId:a}={}){let o=ie(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),i!==void 0&&(o.configurable={...o.configurable,...i}),a!==void 0&&delete o.runId,o}function kt(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}async function Xt(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!e?.aborted)throw n}),new Promise((n,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}var Be=class r extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let t=e.getReader();return new r({start(n){return s();function s(){return t.read().then(({done:i,value:a})=>{if(i){n.close();return}return n.enqueue(a),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new r({async pull(t){let{value:n,done:s}=await e.next();s&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}};function ad(r,e=2){let t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){let i=await r.next();for(let a of t)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function Or(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){let t={...r};for(let[n,s]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=Or(t[n],s):t[n]=s;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}var Er=class{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,n)=>{tt.runWithConfig(kt(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,n):this.firstResult.then(s=>t(void 0),n)},!0)})}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?tt.runWithConfig(kt(this.config),this.signal?async()=>Xt(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}};async function jg(r,e,t,n,...s){let i=new Er({generator:e,startSetup:t,signal:n}),a=await i.setup;return{output:r(i,a,...s),setup:a}}var Rt=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),n=Yr({},t);return new Ta({ops:t,state:n[n.length-1].newDocument})}},Ta=class r extends Rt{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),n=Yr(this.state,e.ops);return new r({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){let t=Yr({},e.ops);return new r({ops:e.ops,state:t[t.length-1].newDocument})}},zg=r=>r.name==="log_stream_tracer";async function Mg(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&t?.input===""))return t.input}async function Lg(r,e){let{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&t?.output!==void 0?t.output:t}function CE(r){return r!==void 0&&r.message!==void 0}var Pa=class extends At{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Be.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(s=>this.includeTags?.includes(s))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(s=>!this.excludeTags?.includes(s))),n}async*tapOutputIterable(e,t){for await(let n of t){if(e!==this.rootId){let s=this.keyMapByRunId[e];s&&await this.writer.write(new Rt({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Rt({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await Mg(e,this._schemaFormat)),await this.writer.write(new Rt({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await Mg(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await Lg(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let s=new Rt({ops:n});await this.writer.write(s)}finally{if(e.id===this.rootId){let t=new Rt({ops:[{op:"replace",path:"/final_output",value:await Lg(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){let s=this.keyMapByRunId[e.id];if(s===void 0)return;let i=e.inputs.messages!==void 0,a;i?CE(n?.chunk)?a=n?.chunk:a=new gt({id:`run-${e.id}`,content:t}):a=t;let o=new Rt({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}};var bu="__run",Nt=class r{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new r({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},en=class r extends Nt{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new r({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}};function wu({name:r,serialized:e}){return r!==void 0?r:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var Dg=r=>r.name==="event_stream_tracer",xu=class extends At{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Be.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(s=>this.includeTags?.includes(s))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(s=>!this.excludeTags?.includes(s))),n}async*tapOutputIterable(e,t){let n=await t.next();if(n.done)return;let s=this.runInfoMap.get(e);if(s===void 0){yield n.value;return}function i(o,u){return o==="llm"&&typeof u=="string"?new Nt({text:u}):u}let a=this.tappedPromises.get(e);if(a===void 0){let o;a=new Promise(u=>{o=u}),this.tappedPromises.set(e,a);try{let u={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...u,data:{chunk:i(s.runType,n.value)}},s),yield n.value;for await(let c of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...u,data:{chunk:i(s.runType,c)}},s),yield c}finally{o()}}else{yield n.value;for await(let o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=wu(e),n=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,s);let i=`on_${n}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onLLMNewToken(e,t,n){let s=this.runInfoMap.get(e.id),i,a;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")a="on_chat_model_stream",n?.chunk===void 0?i=new gt({content:t,id:`run-${e.id}`}):i=n.chunk.message;else if(s.runType==="llm")a="on_llm_stream",n?.chunk===void 0?i=new Nt({text:t}):i=n.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:a,data:{chunk:i},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){let t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let s=e.outputs?.generations,i;if(t.runType==="chat_model"){for(let a of s??[]){if(i!==void 0)break;i=a[0]?.message}n="on_chat_model_end"}else if(t.runType==="llm")i={generations:s?.map(a=>a.map(o=>({text:o.text,generationInfo:o.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){let t=wu(e),n=e.run_type??"chain",s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},s.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,s.inputs=e.inputs.input):(i.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${n}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let n=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},a={output:e.outputs?.output??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(a.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:n,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=wu(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},n)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let n=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=wu(e),s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){let s=this.runInfoMap.get(n);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}};var Ug=It(To(),1),vu=It(Jo(),1),$E=[400,401,402,403,404,405,406,407,409],jE=r=>{if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||r?.code==="ECONNABORTED")throw r;let e=r?.response?.status??r?.status;if(e&&$E.includes(+e))throw r;if(r?.error?.code==="insufficient_quota"){let t=new Error(r?.message);throw t.name="InsufficientQuotaError",t}},Ir=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??jE;let t="default"in vu.default?vu.default.default:vu.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,Ug.default)(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{e.signal?.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};var Sa=class extends At{constructor({config:e,onStart:t,onEnd:n,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function ka(r){return r?r.lc_runnable:!1}var Au=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,s=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||s.some(i=>this.includeTags?.includes(i))),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&s.every(i=>!this.excludeTags?.includes(i))),n}};function od(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}var ME=["*","_","`"];function LE(r){let e="";for(let[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function Fg(r,e,t){let{firstNode:n,lastNode:s,nodeColors:i,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{},c=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){let p="default",h={[p]:"{0}({1})"};n!==void 0&&(h[n]="{0}([{1}]):::first"),s!==void 0&&(h[s]="{0}([{1}]):::last");for(let[m,g]of Object.entries(r)){let y=g.name.split(":").pop()??"",w=ME.some(E=>y.startsWith(E)&&y.endsWith(E))?`<p>${y}</p>`:y;Object.keys(g.metadata??{}).length&&(w+=`<hr/><small><em>${Object.entries(g.metadata??{}).map(([E,z])=>`${E} = ${z}`).join(`
`)}</em></small>`);let A=(h[m]??h[p]).replace("{0}",od(m)).replace("{1}",w);c+=`	${A}
`}}let l={};for(let p of e){let h=p.source.split(":"),m=p.target.split(":"),g=h.filter((y,_)=>y===m[_]).join(":");l[g]||(l[g]=[]),l[g].push(p)}let d=new Set;function f(p,h){let m=p.length===1&&p[0].source===p[0].target;if(h&&!m){let g=h.split(":").pop();if(d.has(g))throw new Error(`Found duplicate subgraph '${g}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(g),c+=`	subgraph ${g}
`}for(let g of p){let{source:y,target:_,data:w,conditional:A}=g,E="";if(w!==void 0){let z=w,F=z.split(" ");F.length>u&&(z=Array.from({length:Math.ceil(F.length/u)},(G,ee)=>F.slice(ee*u,(ee+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),E=A?` -. &nbsp;${z}&nbsp; .-> `:` -- &nbsp;${z}&nbsp; --> `}else E=A?" -.-> ":" --> ";c+=`	${od(y)}${E}${od(_)};
`}for(let g in l)g.startsWith(`${h}:`)&&g!==h&&f(l[g],g);h&&!m&&(c+=`	end
`)}f(l[""]??[],"");for(let p in l)!p.includes(":")&&p!==""&&f(l[p],p);return a&&(c+=LE(i??{})),c}async function Bg(r,e){return zE(r,{...e,imageType:"png"})}async function zE(r,e){let t=e?.backgroundColor??"white",n=e?.imageType??"png",s=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));let i=`https://mermaid.ink/img/${s}?bgColor=${t}&type=${n}`,a=await fetch(i);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}var aC=Object.freeze({status:"aborted"});function ei(r,e,t){function n(o,u){var c;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(c=o._zod).traits??(c.traits=new Set),o._zod.traits.add(r),e(o,u);for(let l in a.prototype)l in o||Object.defineProperty(o,l,{value:a.prototype[l].bind(o)});o._zod.constr=a,o._zod.def=u}let s=t?.Parent??Object;class i extends s{}Object.defineProperty(i,"name",{value:r});function a(o){var u;let c=t?.Parent?new i:this;n(c,o),(u=c._zod).deferred??(u.deferred=[]);for(let l of c._zod.deferred)l();return c}return Object.defineProperty(a,"init",{value:n}),Object.defineProperty(a,Symbol.hasInstance,{value:o=>t?.Parent&&o instanceof t.Parent?!0:o?._zod?.traits?.has(r)}),Object.defineProperty(a,"name",{value:r}),a}var oC=Symbol("zod_brand"),tn=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},ud={};function ti(r){return r&&Object.assign(ud,r),ud}function cd(r){let e=Object.values(r).filter(n=>typeof n=="number");return Object.entries(r).filter(([n,s])=>e.indexOf(+n)===-1).map(([n,s])=>s)}function qg(r,e){return typeof e=="bigint"?e.toString():e}function Gg(r){return{get value(){{let t=r();return Object.defineProperty(this,"value",{value:t}),t}throw new Error("cached value already set")}}}var ld=Error.captureStackTrace?Error.captureStackTrace:(...r)=>{};var DE=Gg(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let r=Function;return new r(""),!0}catch{return!1}});function ri(r,e,t){let n=new r._zod.constr(e??r._zod.def);return(!e||t?.parent)&&(n._zod.parent=r),n}function Hg(r){let e=r;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}var uC={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Ou(r,e=0){for(let t=e;t<r.issues.length;t++)if(r.issues[t]?.continue!==!0)return!0;return!1}function Eu(r){return typeof r=="string"?r:r?.message}function ni(r,e,t){let n={...r,path:r.path??[]};if(!r.message){let s=Eu(r.inst?._zod.def?.error?.(r))??Eu(e?.error?.(r))??Eu(t.customError?.(r))??Eu(t.localeError?.(r))??"Invalid input";n.message=s}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}var Vg=(r,e)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:e,enumerable:!1}),Object.defineProperty(r,"message",{get(){return JSON.stringify(e,qg,2)},enumerable:!0}),Object.defineProperty(r,"toString",{value:()=>r.message,enumerable:!1})},Kg=ei("$ZodError",Vg),Na=ei("$ZodError",Vg,{Parent:Error});var FE=r=>(e,t,n,s)=>{let i=n?Object.assign(n,{async:!1}):{async:!1},a=e._zod.run({value:t,issues:[]},i);if(a instanceof Promise)throw new tn;if(a.issues.length){let o=new(s?.Err??r)(a.issues.map(u=>ni(u,i,ti())));throw ld(o,s?.callee),o}return a.value},Jg=FE(Na),BE=r=>async(e,t,n,s)=>{let i=n?Object.assign(n,{async:!0}):{async:!0},a=e._zod.run({value:t,issues:[]},i);if(a instanceof Promise&&(a=await a),a.issues.length){let o=new(s?.Err??r)(a.issues.map(u=>ni(u,i,ti())));throw ld(o,s?.callee),o}return a.value},Wg=BE(Na),ZE=r=>(e,t,n)=>{let s=n?{...n,async:!1}:{async:!1},i=e._zod.run({value:t,issues:[]},s);if(i instanceof Promise)throw new tn;return i.issues.length?{success:!1,error:new(r??Kg)(i.issues.map(a=>ni(a,s,ti())))}:{success:!0,data:i.value}},Yg=ZE(Na),qE=r=>async(e,t,n)=>{let s=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:t,issues:[]},s);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new r(i.issues.map(a=>ni(a,s,ti())))}:{success:!0,data:i.value}},Xg=qE(Na);var Qg={major:4,minor:0,patch:0};var GE=ei("$ZodType",(r,e)=>{var t;r??(r={}),r._zod.def=e,r._zod.bag=r._zod.bag||{},r._zod.version=Qg;let n=[...r._zod.def.checks??[]];r._zod.traits.has("$ZodCheck")&&n.unshift(r);for(let s of n)for(let i of s._zod.onattach)i(r);if(n.length===0)(t=r._zod).deferred??(t.deferred=[]),r._zod.deferred?.push(()=>{r._zod.run=r._zod.parse});else{let s=(i,a,o)=>{let u=Ou(i),c;for(let l of a){if(l._zod.def.when){if(!l._zod.def.when(i))continue}else if(u)continue;let d=i.issues.length,f=l._zod.check(i);if(f instanceof Promise&&o?.async===!1)throw new tn;if(c||f instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await f,i.issues.length!==d&&(u||(u=Ou(i,d)))});else{if(i.issues.length===d)continue;u||(u=Ou(i,d))}}return c?c.then(()=>i):i};r._zod.run=(i,a)=>{let o=r._zod.parse(i,a);if(o instanceof Promise){if(a.async===!1)throw new tn;return o.then(u=>s(u,n,a))}return s(o,n,a)}}r["~standard"]={validate:s=>{try{let i=Yg(r,s);return i.success?{value:i.data}:{issues:i.error?.issues}}catch{return Xg(r,s).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}});var e_=ei("$ZodNever",(r,e)=>{GE.init(r,e),r._zod.parse=(t,n)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:r}),t)});var TC=Symbol("ZodOutput"),PC=Symbol("ZodInput"),Ca=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){let n=t[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&typeof t=="object"&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let n={...this.get(t)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}};function HE(){return new Ca}var Qt=HE();function t_(r,e){return new r({type:"never",...Hg(e)})}var Iu=class{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??Qt,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var n;let s=e._zod.def,i={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},a=this.seen.get(e);if(a)return a.count++,t.schemaPath.includes(e)&&(a.cycle=t.path),a.schema;let o={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,o);let u=e._zod.toJSONSchema?.();if(u)o.schema=u;else{let d={...t,schemaPath:[...t.schemaPath,e],path:t.path},f=e._zod.parent;if(f)o.ref=f,this.process(f,d),this.seen.get(f).isParent=!0;else{let p=o.schema;switch(s.type){case"string":{let h=p;h.type="string";let{minimum:m,maximum:g,format:y,patterns:_,contentEncoding:w}=e._zod.bag;if(typeof m=="number"&&(h.minLength=m),typeof g=="number"&&(h.maxLength=g),y&&(h.format=i[y]??y,h.format===""&&delete h.format),w&&(h.contentEncoding=w),_&&_.size>0){let A=[..._];A.length===1?h.pattern=A[0].source:A.length>1&&(o.schema.allOf=[...A.map(E=>({...this.target==="draft-7"?{type:"string"}:{},pattern:E.source}))])}break}case"number":{let h=p,{minimum:m,maximum:g,format:y,multipleOf:_,exclusiveMaximum:w,exclusiveMinimum:A}=e._zod.bag;typeof y=="string"&&y.includes("int")?h.type="integer":h.type="number",typeof A=="number"&&(h.exclusiveMinimum=A),typeof m=="number"&&(h.minimum=m,typeof A=="number"&&(A>=m?delete h.minimum:delete h.exclusiveMinimum)),typeof w=="number"&&(h.exclusiveMaximum=w),typeof g=="number"&&(h.maximum=g,typeof w=="number"&&(w<=g?delete h.maximum:delete h.exclusiveMaximum)),typeof _=="number"&&(h.multipleOf=_);break}case"boolean":{let h=p;h.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{p.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{p.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{let h=p,{minimum:m,maximum:g}=e._zod.bag;typeof m=="number"&&(h.minItems=m),typeof g=="number"&&(h.maxItems=g),h.type="array",h.items=this.process(s.element,{...d,path:[...d.path,"items"]});break}case"object":{let h=p;h.type="object",h.properties={};let m=s.shape;for(let _ in m)h.properties[_]=this.process(m[_],{...d,path:[...d.path,"properties",_]});let g=new Set(Object.keys(m)),y=new Set([...g].filter(_=>{let w=s.shape[_]._zod;return this.io==="input"?w.optin===void 0:w.optout===void 0}));y.size>0&&(h.required=Array.from(y)),s.catchall?._zod.def.type==="never"?h.additionalProperties=!1:s.catchall?s.catchall&&(h.additionalProperties=this.process(s.catchall,{...d,path:[...d.path,"additionalProperties"]})):this.io==="output"&&(h.additionalProperties=!1);break}case"union":{let h=p;h.anyOf=s.options.map((m,g)=>this.process(m,{...d,path:[...d.path,"anyOf",g]}));break}case"intersection":{let h=p,m=this.process(s.left,{...d,path:[...d.path,"allOf",0]}),g=this.process(s.right,{...d,path:[...d.path,"allOf",1]}),y=w=>"allOf"in w&&Object.keys(w).length===1,_=[...y(m)?m.allOf:[m],...y(g)?g.allOf:[g]];h.allOf=_;break}case"tuple":{let h=p;h.type="array";let m=s.items.map((_,w)=>this.process(_,{...d,path:[...d.path,"prefixItems",w]}));if(this.target==="draft-2020-12"?h.prefixItems=m:h.items=m,s.rest){let _=this.process(s.rest,{...d,path:[...d.path,"items"]});this.target==="draft-2020-12"?h.items=_:h.additionalItems=_}s.rest&&(h.items=this.process(s.rest,{...d,path:[...d.path,"items"]}));let{minimum:g,maximum:y}=e._zod.bag;typeof g=="number"&&(h.minItems=g),typeof y=="number"&&(h.maxItems=y);break}case"record":{let h=p;h.type="object",h.propertyNames=this.process(s.keyType,{...d,path:[...d.path,"propertyNames"]}),h.additionalProperties=this.process(s.valueType,{...d,path:[...d.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{let h=p,m=cd(s.entries);m.every(g=>typeof g=="number")&&(h.type="number"),m.every(g=>typeof g=="string")&&(h.type="string"),h.enum=m;break}case"literal":{let h=p,m=[];for(let g of s.values)if(g===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof g=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");m.push(Number(g))}else m.push(g);if(m.length!==0)if(m.length===1){let g=m[0];h.type=g===null?"null":typeof g,h.const=g}else m.every(g=>typeof g=="number")&&(h.type="number"),m.every(g=>typeof g=="string")&&(h.type="string"),m.every(g=>typeof g=="boolean")&&(h.type="string"),m.every(g=>g===null)&&(h.type="null"),h.enum=m;break}case"file":{let h=p,m={type:"string",format:"binary",contentEncoding:"binary"},{minimum:g,maximum:y,mime:_}=e._zod.bag;g!==void 0&&(m.minLength=g),y!==void 0&&(m.maxLength=y),_?_.length===1?(m.contentMediaType=_[0],Object.assign(h,m)):h.anyOf=_.map(w=>({...m,contentMediaType:w})):Object.assign(h,m);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let h=this.process(s.innerType,d);p.anyOf=[h,{type:"null"}];break}case"nonoptional":{this.process(s.innerType,d),o.ref=s.innerType;break}case"success":{let h=p;h.type="boolean";break}case"default":{this.process(s.innerType,d),o.ref=s.innerType,p.default=JSON.parse(JSON.stringify(s.defaultValue));break}case"prefault":{this.process(s.innerType,d),o.ref=s.innerType,this.io==="input"&&(p._prefault=JSON.parse(JSON.stringify(s.defaultValue)));break}case"catch":{this.process(s.innerType,d),o.ref=s.innerType;let h;try{h=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}p.default=h;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let h=p,m=e._zod.pattern;if(!m)throw new Error("Pattern not found in template literal");h.type="string",h.pattern=m.source;break}case"pipe":{let h=this.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;this.process(h,d),o.ref=h;break}case"readonly":{this.process(s.innerType,d),o.ref=s.innerType,p.readOnly=!0;break}case"promise":{this.process(s.innerType,d),o.ref=s.innerType;break}case"optional":{this.process(s.innerType,d),o.ref=s.innerType;break}case"lazy":{let h=e._zod.innerType;this.process(h,d),o.ref=h;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}default:}}}let c=this.metadataRegistry.get(e);return c&&Object.assign(o.schema,c),this.io==="input"&&Oe(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((n=o.schema).default??(n.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,t){let n={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},s=this.seen.get(e);if(!s)throw new Error("Unprocessed schema. This is a bug in Zod.");let i=l=>{let d=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){let m=n.external.registry.get(l[0])?.id,g=n.external.uri??(_=>_);if(m)return{ref:g(m)};let y=l[1].defId??l[1].schema.id??`schema${this.counter++}`;return l[1].defId=y,{defId:y,ref:`${g("__shared")}#/${d}/${y}`}}if(l[1]===s)return{ref:"#"};let p=`#/${d}/`,h=l[1].schema.id??`__schema${this.counter++}`;return{defId:h,ref:p+h}},a=l=>{if(l[1].schema.$ref)return;let d=l[1],{ref:f,defId:p}=i(l);d.def={...d.schema},p&&(d.defId=p);let h=d.schema;for(let m in h)delete h[m];h.$ref=f};if(n.cycles==="throw")for(let l of this.seen.entries()){let d=l[1];if(d.cycle)throw new Error(`Cycle detected: #/${d.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let l of this.seen.entries()){let d=l[1];if(e===l[0]){a(l);continue}if(n.external){let p=n.external.registry.get(l[0])?.id;if(e!==l[0]&&p){a(l);continue}}if(this.metadataRegistry.get(l[0])?.id){a(l);continue}if(d.cycle){a(l);continue}if(d.count>1&&n.reused==="ref"){a(l);continue}}let o=(l,d)=>{let f=this.seen.get(l),p=f.def??f.schema,h={...p};if(f.ref===null)return;let m=f.ref;if(f.ref=null,m){o(m,d);let g=this.seen.get(m).schema;g.$ref&&d.target==="draft-7"?(p.allOf=p.allOf??[],p.allOf.push(g)):(Object.assign(p,g),Object.assign(p,h))}f.isParent||this.override({zodSchema:l,jsonSchema:p,path:f.path??[]})};for(let l of[...this.seen.entries()].reverse())o(l[0],{target:this.target});let u={};if(this.target==="draft-2020-12"?u.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?u.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){let l=n.external.registry.get(e)?.id;if(!l)throw new Error("Schema is missing an `id` property");u.$id=n.external.uri(l)}Object.assign(u,s.def);let c=n.external?.defs??{};for(let l of this.seen.entries()){let d=l[1];d.def&&d.defId&&(c[d.defId]=d.def)}n.external||Object.keys(c).length>0&&(this.target==="draft-2020-12"?u.$defs=c:u.definitions=c);try{return JSON.parse(JSON.stringify(u))}catch{throw new Error("Error converting schema to JSON.")}}};function dd(r,e){if(r instanceof Ca){let n=new Iu(e),s={};for(let o of r._idmap.entries()){let[u,c]=o;n.process(c)}let i={},a={registry:r,uri:e?.uri,defs:s};for(let o of r._idmap.entries()){let[u,c]=o;i[u]=n.emit(c,{...e,external:a})}if(Object.keys(s).length>0){let o=n.target==="draft-2020-12"?"$defs":"definitions";i.__shared={[o]:s}}return{schemas:i}}let t=new Iu(e);return t.process(r),t.emit(r,e)}function Oe(r,e){let t=e??{seen:new Set};if(t.seen.has(r))return!1;t.seen.add(r);let s=r._zod.def;switch(s.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return Oe(s.element,t);case"object":{for(let i in s.shape)if(Oe(s.shape[i],t))return!0;return!1}case"union":{for(let i of s.options)if(Oe(i,t))return!0;return!1}case"intersection":return Oe(s.left,t)||Oe(s.right,t);case"tuple":{for(let i of s.items)if(Oe(i,t))return!0;return!!(s.rest&&Oe(s.rest,t))}case"record":return Oe(s.keyType,t)||Oe(s.valueType,t);case"map":return Oe(s.keyType,t)||Oe(s.valueType,t);case"set":return Oe(s.valueType,t);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return Oe(s.innerType,t);case"lazy":return Oe(s.getter(),t);case"default":return Oe(s.innerType,t);case"prefault":return Oe(s.innerType,t);case"custom":return!1;case"transform":return!0;case"pipe":return Oe(s.in,t)||Oe(s.out,t);case"success":return!1;case"catch":return!1;default:}throw new Error(`Unknown schema type: ${s.type}`)}var n_=Symbol("Let zodToJsonSchema decide on which parser to use");var r_={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},s_=r=>typeof r=="string"?{...r_,name:r}:{...r_,...r};var i_=r=>{let e=s_(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function fd(r,e,t,n){n?.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function ae(r,e,t,n,s){r[e]=t,fd(r,e,n,s)}var Tu=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")};function me(r){if(r.target!=="openAi")return{};let e=[...r.basePath,r.definitionPath,r.openAiAnyTypeName];return r.flags.hasReferencedOpenAiAnyType=!0,{$ref:r.$refStrategy==="relative"?Tu(e,r.currentPath):e.join("/")}}function a_(r,e){let t={type:"array"};return r.type?._def&&r.type?._def?.typeName!==b.ZodAny&&(t.items=Z(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&ae(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&ae(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(ae(t,"minItems",r.exactLength.value,r.exactLength.message,e),ae(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function o_(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?ae(t,"minimum",n.value,n.message,e):ae(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),ae(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?ae(t,"maximum",n.value,n.message,e):ae(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),ae(t,"maximum",n.value,n.message,e));break;case"multipleOf":ae(t,"multipleOf",n.value,n.message,e);break}return t}function u_(){return{type:"boolean"}}function Pu(r,e){return Z(r.type._def,e)}var c_=(r,e)=>Z(r.innerType._def,e);function pd(r,e,t){let n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,i)=>pd(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return VE(r,e)}}var VE=(r,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let n of r.checks)switch(n.kind){case"min":ae(t,"minimum",n.value,n.message,e);break;case"max":ae(t,"maximum",n.value,n.message,e);break}return t};function l_(r,e){return{...Z(r.innerType._def,e),default:r.defaultValue()}}function d_(r,e){return e.effectStrategy==="input"?Z(r.schema._def,e):me(e)}function f_(r){return{type:"string",enum:Array.from(r.values)}}var KE=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function p_(r,e){let t=[Z(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Z(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return t.forEach(i=>{if(KE(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){let{additionalProperties:o,...u}=i;a=u}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function h_(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var hd,Ct={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(hd===void 0&&(hd=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),hd),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Su(r,e){let t={type:"string"};if(r.checks)for(let n of r.checks)switch(n.kind){case"min":ae(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":ae(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":$t(t,"email",n.message,e);break;case"format:idn-email":$t(t,"idn-email",n.message,e);break;case"pattern:zod":Ke(t,Ct.email,n.message,e);break}break;case"url":$t(t,"uri",n.message,e);break;case"uuid":$t(t,"uuid",n.message,e);break;case"regex":Ke(t,n.regex,n.message,e);break;case"cuid":Ke(t,Ct.cuid,n.message,e);break;case"cuid2":Ke(t,Ct.cuid2,n.message,e);break;case"startsWith":Ke(t,RegExp(`^${md(n.value,e)}`),n.message,e);break;case"endsWith":Ke(t,RegExp(`${md(n.value,e)}$`),n.message,e);break;case"datetime":$t(t,"date-time",n.message,e);break;case"date":$t(t,"date",n.message,e);break;case"time":$t(t,"time",n.message,e);break;case"duration":$t(t,"duration",n.message,e);break;case"length":ae(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),ae(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{Ke(t,RegExp(md(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&$t(t,"ipv4",n.message,e),n.version!=="v4"&&$t(t,"ipv6",n.message,e);break}case"base64url":Ke(t,Ct.base64url,n.message,e);break;case"jwt":Ke(t,Ct.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Ke(t,Ct.ipv4Cidr,n.message,e),n.version!=="v4"&&Ke(t,Ct.ipv6Cidr,n.message,e);break}case"emoji":Ke(t,Ct.emoji(),n.message,e);break;case"ulid":{Ke(t,Ct.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{$t(t,"binary",n.message,e);break}case"contentEncoding:base64":{ae(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Ke(t,Ct.base64,n.message,e);break}}break}case"nanoid":Ke(t,Ct.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}function md(r,e){return e.patternStrategy==="escape"?WE(r):r}var JE=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function WE(r){let e="";for(let t=0;t<r.length;t++)JE.has(r[t])||(e+="\\"),e+=r[t];return e}function $t(r,e,t,n){r.format||r.anyOf?.some(s=>s.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):ae(r,"format",e,t,n)}function Ke(r,e,t,n){r.pattern||r.allOf?.some(s=>s.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:m_(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):ae(r,"pattern",m_(e,n),t,n)}function m_(r,e){if(!e.applyRegexFlags||!r.flags)return r.source;let t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source,s="",i=!1,a=!1,o=!1;for(let u=0;u<n.length;u++){if(i){s+=n[u],i=!1;continue}if(t.i){if(a){if(n[u].match(/[a-z]/)){o?(s+=n[u],s+=`${n[u-2]}-${n[u]}`.toUpperCase(),o=!1):n[u+1]==="-"&&n[u+2]?.match(/[a-z]/)?(s+=n[u],o=!0):s+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){s+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(t.m){if(n[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&n[u]==="."){s+=a?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}s+=n[u],n[u]==="\\"?i=!0:a&&n[u]==="]"?a=!1:!a&&n[u]==="["&&(a=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return s}function ku(r,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&r.keyType?._def.typeName===b.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((n,s)=>({...n,[s]:Z(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",s]})??me(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let t={type:"object",additionalProperties:Z(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(r.keyType?._def.typeName===b.ZodString&&r.keyType._def.checks?.length){let{type:n,...s}=Su(r.keyType._def,e);return{...t,propertyNames:s}}else{if(r.keyType?._def.typeName===b.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(r.keyType?._def.typeName===b.ZodBranded&&r.keyType._def.type._def.typeName===b.ZodString&&r.keyType._def.type._def.checks?.length){let{type:n,...s}=Pu(r.keyType._def,e);return{...t,propertyNames:s}}}return t}function g_(r,e){if(e.mapStrategy==="record")return ku(r,e);let t=Z(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||me(e),n=Z(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||me(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function __(r){let e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function y_(r){return r.target==="openAi"?void 0:{not:me({...r,currentPath:[...r.currentPath,"not"]})}}function b_(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var $a={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function x_(r,e){if(e.target==="openApi3")return w_(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in $a&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((s,i)=>{let a=$a[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((s,i)=>{let a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){let s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return w_(r,e)}var w_=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>Z(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function v_(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:$a[r.innerType._def.typeName],nullable:!0}:{type:[$a[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=Z(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let t=Z(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function A_(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",fd(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?ae(t,"minimum",n.value,n.message,e):ae(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),ae(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?ae(t,"maximum",n.value,n.message,e):ae(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),ae(t,"maximum",n.value,n.message,e));break;case"multipleOf":ae(t,"multipleOf",n.value,n.message,e);break}return t}function E_(r,e){let t=e.target==="openAi",n={type:"object",properties:{}},s=[],i=r.shape();for(let o in i){let u=i[o];if(u===void 0||u._def===void 0)continue;let c=XE(u);c&&t&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),c=!1);let l=Z(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});l!==void 0&&(n.properties[o]=l,c||s.push(o))}s.length&&(n.required=s);let a=YE(r,e);return a!==void 0&&(n.additionalProperties=a),n}function YE(r,e){if(r.catchall._def.typeName!=="ZodNever")return Z(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function XE(r){try{return r.isOptional()}catch{return!0}}var O_=(r,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return Z(r.innerType._def,e);let t=Z(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:me(e)},t]}:me(e)};var I_=(r,e)=>{if(e.pipeStrategy==="input")return Z(r.in._def,e);if(e.pipeStrategy==="output")return Z(r.out._def,e);let t=Z(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=Z(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function T_(r,e){return Z(r.type._def,e)}function P_(r,e){let n={type:"array",uniqueItems:!0,items:Z(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&ae(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&ae(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function S_(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>Z(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:Z(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>Z(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function k_(r){return{not:me(r)}}function R_(r){return me(r)}var N_=(r,e)=>Z(r.innerType._def,e);var C_=(r,e,t)=>{switch(e){case b.ZodString:return Su(r,t);case b.ZodNumber:return A_(r,t);case b.ZodObject:return E_(r,t);case b.ZodBigInt:return o_(r,t);case b.ZodBoolean:return u_();case b.ZodDate:return pd(r,t);case b.ZodUndefined:return k_(t);case b.ZodNull:return b_(t);case b.ZodArray:return a_(r,t);case b.ZodUnion:case b.ZodDiscriminatedUnion:return x_(r,t);case b.ZodIntersection:return p_(r,t);case b.ZodTuple:return S_(r,t);case b.ZodRecord:return ku(r,t);case b.ZodLiteral:return h_(r,t);case b.ZodEnum:return f_(r);case b.ZodNativeEnum:return __(r);case b.ZodNullable:return v_(r,t);case b.ZodOptional:return O_(r,t);case b.ZodMap:return g_(r,t);case b.ZodSet:return P_(r,t);case b.ZodLazy:return()=>r.getter()._def;case b.ZodPromise:return T_(r,t);case b.ZodNaN:case b.ZodNever:return y_(t);case b.ZodEffects:return d_(r,t);case b.ZodAny:return me(t);case b.ZodUnknown:return R_(t);case b.ZodDefault:return l_(r,t);case b.ZodBranded:return Pu(r,t);case b.ZodReadonly:return N_(r,t);case b.ZodCatch:return c_(r,t);case b.ZodPipeline:return I_(r,t);case b.ZodFunction:case b.ZodVoid:case b.ZodSymbol:return;default:return(n=>{})(e)}};function Z(r,e,t=!1){let n=e.seen.get(r);if(e.override){let o=e.override?.(r,e,n,t);if(o!==n_)return o}if(n&&!t){let o=QE(n,e);if(o!==void 0)return o}let s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);let i=C_(r,r.typeName,e),a=typeof i=="function"?Z(i(),e):i;if(a&&eO(r,e,a),e.postProcess){let o=e.postProcess(a,r,e);return s.jsonSchema=a,o}return s.jsonSchema=a,a}var QE=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:Tu(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),me(e)):e.$refStrategy==="seen"?me(e):void 0}},eO=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var si=(r,e)=>{let t=i_(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[c,l])=>({...u,[c]:Z(l._def,{...t,currentPath:[...t.basePath,t.definitionPath,c]},!0)??me(t)}),{}):void 0,s=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,i=Z(r._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1)??me(t),a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(i.title=a),t.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[t.openAiAnyTypeName]||(n[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));let o=s===void 0?n?{...i,[t.definitionPath]:n}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:i}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};function Tr(r,e){let t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;let n=r.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(!Tr(r[s],e[s]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;let n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(let a of n)if(!Tr(r[a],e[a]))return!1;return!0}return r===e}function ut(r){return encodeURI(tO(r))}function tO(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}var rO={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},nO={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},sO={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},iO=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function rn(r,e=Object.create(null),t=iO,n=""){if(r&&typeof r=="object"&&!Array.isArray(r)){let i=r.$id||r.id;if(i){let a=new URL(i,t.href);a.hash.length>1?e[a.href]=r:(a.hash="",n===""?t=a:rn(r,e,t))}}else if(r!==!0&&r!==!1)return e;let s=t.href+(n?"#"+n:"");if(e[s]!==void 0)throw new Error(`Duplicate schema URI "${s}".`);if(e[s]=r,r===!0||r===!1)return e;if(r.__absolute_uri__===void 0&&Object.defineProperty(r,"__absolute_uri__",{enumerable:!1,value:s}),r.$ref&&r.__absolute_ref__===void 0){let i=new URL(r.$ref,t.href);i.hash=i.hash,Object.defineProperty(r,"__absolute_ref__",{enumerable:!1,value:i.href})}if(r.$recursiveRef&&r.__absolute_recursive_ref__===void 0){let i=new URL(r.$recursiveRef,t.href);i.hash=i.hash,Object.defineProperty(r,"__absolute_recursive_ref__",{enumerable:!1,value:i.href})}if(r.$anchor){let i=new URL("#"+r.$anchor,t.href);e[i.href]=r}for(let i in r){if(sO[i])continue;let a=`${n}/${ut(i)}`,o=r[i];if(Array.isArray(o)){if(rO[i]){let u=o.length;for(let c=0;c<u;c++)rn(o[c],e,t,`${a}/${c}`)}}else if(nO[i])for(let u in o)rn(o[u],e,t,`${a}/${ut(u)}`);else rn(o,e,t,a)}return e}var aO=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,oO=[0,31,28,31,30,31,30,31,31,30,31,30,31],uO=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,cO=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,lO=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,dO=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,fO=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,pO=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,hO=/^(?:\/(?:[^~/]|~0|~1)*)*$/,mO=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,gO=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,_O=r=>{if(r[0]==='"')return!1;let[e,t,...n]=r.split("@");return!e||!t||n.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},yO=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,bO=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,wO=r=>r.length>1&&r.length<80&&(/^P\d+([.,]\d+)?W$/.test(r)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(r)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(r));function er(r){return r.test.bind(r)}var gd={date:$_,time:j_.bind(void 0,!1),"date-time":AO,duration:wO,uri:IO,"uri-reference":er(lO),"uri-template":er(dO),url:er(fO),email:_O,hostname:er(cO),ipv4:er(yO),ipv6:er(bO),regex:PO,uuid:er(pO),"json-pointer":er(hO),"json-pointer-uri-fragment":er(mO),"relative-json-pointer":er(gO)};function xO(r){return r%4===0&&(r%100!==0||r%400===0)}function $_(r){let e=r.match(aO);if(!e)return!1;let t=+e[1],n=+e[2],s=+e[3];return n>=1&&n<=12&&s>=1&&s<=(n==2&&xO(t)?29:oO[n])}function j_(r,e){let t=e.match(uO);if(!t)return!1;let n=+t[1],s=+t[2],i=+t[3],a=!!t[5];return(n<=23&&s<=59&&i<=59||n==23&&s==59&&i==60)&&(!r||a)}var vO=/t|\s/i;function AO(r){let e=r.split(vO);return e.length==2&&$_(e[0])&&j_(!0,e[1])}var EO=/\/|:/,OO=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function IO(r){return EO.test(r)&&OO.test(r)}var TO=/[^\\]\\Z/;function PO(r){if(TO.test(r))return!1;try{return new RegExp(r,"u"),!0}catch{return!1}}var M_;(function(r){r[r.Flag=1]="Flag",r[r.Basic=2]="Basic",r[r.Detailed=4]="Detailed"})(M_||(M_={}));function L_(r){let e=0,t=r.length,n=0,s;for(;n<t;)e++,s=r.charCodeAt(n++),s>=55296&&s<=56319&&n<t&&(s=r.charCodeAt(n),(s&64512)==56320&&n++);return e}function he(r,e,t="2019-09",n=rn(e),s=!0,i=null,a="#",o="#",u=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:a,keyword:"false",keywordLocation:a,error:"False boolean schema."}]};let c=typeof r,l;switch(c){case"boolean":case"number":case"string":l=c;break;case"object":r===null?l="null":Array.isArray(r)?l="array":l="object";break;default:throw new Error(`Instances of "${c}" type are not supported.`)}let{$ref:d,$recursiveRef:f,$recursiveAnchor:p,type:h,const:m,enum:g,required:y,not:_,anyOf:w,allOf:A,oneOf:E,if:z,then:F,else:G,format:ee,properties:ue,patternProperties:ce,additionalProperties:Gt,unevaluatedProperties:$s,minProperties:ta,maxProperties:js,propertyNames:Sf,dependentRequired:Ic,dependentSchemas:Tc,dependencies:Pc,prefixItems:Sc,items:ra,additionalItems:kf,unevaluatedItems:Rf,contains:Nf,minContains:gr,maxContains:fo,minItems:kc,maxItems:Rc,uniqueItems:Db,minimum:In,maximum:Tn,exclusiveMinimum:na,exclusiveMaximum:sa,multipleOf:po,minLength:ho,maxLength:mo,pattern:Cf,__absolute_ref__:go,__absolute_recursive_ref__:Ub}=e,k=[];if(p===!0&&i===null&&(i=e),f==="#"){let H=i===null?n[Ub]:i,D=`${o}/$recursiveRef`,J=he(r,i===null?e:i,t,n,s,H,a,D,u);J.valid||k.push({instanceLocation:a,keyword:"$recursiveRef",keywordLocation:D,error:"A subschema had errors."},...J.errors)}if(d!==void 0){let D=n[go||d];if(D===void 0){let I=`Unresolved $ref "${d}".`;throw go&&go!==d&&(I+=`  Absolute URI "${go}".`),I+=`
Known schemas:
- ${Object.keys(n).join(`
- `)}`,new Error(I)}let J=`${o}/$ref`,R=he(r,D,t,n,s,i,a,J,u);if(R.valid||k.push({instanceLocation:a,keyword:"$ref",keywordLocation:J,error:"A subschema had errors."},...R.errors),t==="4"||t==="7")return{valid:k.length===0,errors:k}}if(Array.isArray(h)){let H=h.length,D=!1;for(let J=0;J<H;J++)if(l===h[J]||h[J]==="integer"&&l==="number"&&r%1===0&&r===r){D=!0;break}D||k.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${l}" is invalid. Expected "${h.join('", "')}".`})}else h==="integer"?(l!=="number"||r%1||r!==r)&&k.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${l}" is invalid. Expected "${h}".`}):h!==void 0&&l!==h&&k.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${l}" is invalid. Expected "${h}".`});if(m!==void 0&&(l==="object"||l==="array"?Tr(r,m)||k.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`}):r!==m&&k.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`})),g!==void 0&&(l==="object"||l==="array"?g.some(H=>Tr(r,H))||k.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(H=>r===H)||k.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),_!==void 0){let H=`${o}/not`;he(r,_,t,n,s,i,a,H).valid&&k.push({instanceLocation:a,keyword:"not",keywordLocation:H,error:'Instance matched "not" schema.'})}let _o=[];if(w!==void 0){let H=`${o}/anyOf`,D=k.length,J=!1;for(let R=0;R<w.length;R++){let I=w[R],K=Object.create(u),V=he(r,I,t,n,s,p===!0?i:null,a,`${H}/${R}`,K);k.push(...V.errors),J=J||V.valid,V.valid&&_o.push(K)}J?k.length=D:k.splice(D,0,{instanceLocation:a,keyword:"anyOf",keywordLocation:H,error:"Instance does not match any subschemas."})}if(A!==void 0){let H=`${o}/allOf`,D=k.length,J=!0;for(let R=0;R<A.length;R++){let I=A[R],K=Object.create(u),V=he(r,I,t,n,s,p===!0?i:null,a,`${H}/${R}`,K);k.push(...V.errors),J=J&&V.valid,V.valid&&_o.push(K)}J?k.length=D:k.splice(D,0,{instanceLocation:a,keyword:"allOf",keywordLocation:H,error:"Instance does not match every subschema."})}if(E!==void 0){let H=`${o}/oneOf`,D=k.length,J=E.filter((R,I)=>{let K=Object.create(u),V=he(r,R,t,n,s,p===!0?i:null,a,`${H}/${I}`,K);return k.push(...V.errors),V.valid&&_o.push(K),V.valid}).length;J===1?k.length=D:k.splice(D,0,{instanceLocation:a,keyword:"oneOf",keywordLocation:H,error:`Instance does not match exactly one subschema (${J} matches).`})}if((l==="object"||l==="array")&&Object.assign(u,..._o),z!==void 0){let H=`${o}/if`;if(he(r,z,t,n,s,i,a,H,u).valid){if(F!==void 0){let J=he(r,F,t,n,s,i,a,`${o}/then`,u);J.valid||k.push({instanceLocation:a,keyword:"if",keywordLocation:H,error:'Instance does not match "then" schema.'},...J.errors)}}else if(G!==void 0){let J=he(r,G,t,n,s,i,a,`${o}/else`,u);J.valid||k.push({instanceLocation:a,keyword:"if",keywordLocation:H,error:'Instance does not match "else" schema.'},...J.errors)}}if(l==="object"){if(y!==void 0)for(let R of y)R in r||k.push({instanceLocation:a,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${R}".`});let H=Object.keys(r);if(ta!==void 0&&H.length<ta&&k.push({instanceLocation:a,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${ta} properties.`}),js!==void 0&&H.length>js&&k.push({instanceLocation:a,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${js} properties.`}),Sf!==void 0){let R=`${o}/propertyNames`;for(let I in r){let K=`${a}/${ut(I)}`,V=he(I,Sf,t,n,s,i,K,R);V.valid||k.push({instanceLocation:a,keyword:"propertyNames",keywordLocation:R,error:`Property name "${I}" does not match schema.`},...V.errors)}}if(Ic!==void 0){let R=`${o}/dependantRequired`;for(let I in Ic)if(I in r){let K=Ic[I];for(let V of K)V in r||k.push({instanceLocation:a,keyword:"dependentRequired",keywordLocation:R,error:`Instance has "${I}" but does not have "${V}".`})}}if(Tc!==void 0)for(let R in Tc){let I=`${o}/dependentSchemas`;if(R in r){let K=he(r,Tc[R],t,n,s,i,a,`${I}/${ut(R)}`,u);K.valid||k.push({instanceLocation:a,keyword:"dependentSchemas",keywordLocation:I,error:`Instance has "${R}" but does not match dependant schema.`},...K.errors)}}if(Pc!==void 0){let R=`${o}/dependencies`;for(let I in Pc)if(I in r){let K=Pc[I];if(Array.isArray(K))for(let V of K)V in r||k.push({instanceLocation:a,keyword:"dependencies",keywordLocation:R,error:`Instance has "${I}" but does not have "${V}".`});else{let V=he(r,K,t,n,s,i,a,`${R}/${ut(I)}`);V.valid||k.push({instanceLocation:a,keyword:"dependencies",keywordLocation:R,error:`Instance has "${I}" but does not match dependant schema.`},...V.errors)}}}let D=Object.create(null),J=!1;if(ue!==void 0){let R=`${o}/properties`;for(let I in ue){if(!(I in r))continue;let K=`${a}/${ut(I)}`,V=he(r[I],ue[I],t,n,s,i,K,`${R}/${ut(I)}`);if(V.valid)u[I]=D[I]=!0;else if(J=s,k.push({instanceLocation:a,keyword:"properties",keywordLocation:R,error:`Property "${I}" does not match schema.`},...V.errors),J)break}}if(!J&&ce!==void 0){let R=`${o}/patternProperties`;for(let I in ce){let K=new RegExp(I,"u"),V=ce[I];for(let Je in r){if(!K.test(Je))continue;let $f=`${a}/${ut(Je)}`,jf=he(r[Je],V,t,n,s,i,$f,`${R}/${ut(I)}`);jf.valid?u[Je]=D[Je]=!0:(J=s,k.push({instanceLocation:a,keyword:"patternProperties",keywordLocation:R,error:`Property "${Je}" matches pattern "${I}" but does not match associated schema.`},...jf.errors))}}}if(!J&&Gt!==void 0){let R=`${o}/additionalProperties`;for(let I in r){if(D[I])continue;let K=`${a}/${ut(I)}`,V=he(r[I],Gt,t,n,s,i,K,R);V.valid?u[I]=!0:(J=s,k.push({instanceLocation:a,keyword:"additionalProperties",keywordLocation:R,error:`Property "${I}" does not match additional properties schema.`},...V.errors))}}else if(!J&&$s!==void 0){let R=`${o}/unevaluatedProperties`;for(let I in r)if(!u[I]){let K=`${a}/${ut(I)}`,V=he(r[I],$s,t,n,s,i,K,R);V.valid?u[I]=!0:k.push({instanceLocation:a,keyword:"unevaluatedProperties",keywordLocation:R,error:`Property "${I}" does not match unevaluated properties schema.`},...V.errors)}}}else if(l==="array"){Rc!==void 0&&r.length>Rc&&k.push({instanceLocation:a,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${r.length} > ${Rc}).`}),kc!==void 0&&r.length<kc&&k.push({instanceLocation:a,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${r.length} < ${kc}).`});let H=r.length,D=0,J=!1;if(Sc!==void 0){let R=`${o}/prefixItems`,I=Math.min(Sc.length,H);for(;D<I;D++){let K=he(r[D],Sc[D],t,n,s,i,`${a}/${D}`,`${R}/${D}`);if(u[D]=!0,!K.valid&&(J=s,k.push({instanceLocation:a,keyword:"prefixItems",keywordLocation:R,error:"Items did not match schema."},...K.errors),J))break}}if(ra!==void 0){let R=`${o}/items`;if(Array.isArray(ra)){let I=Math.min(ra.length,H);for(;D<I;D++){let K=he(r[D],ra[D],t,n,s,i,`${a}/${D}`,`${R}/${D}`);if(u[D]=!0,!K.valid&&(J=s,k.push({instanceLocation:a,keyword:"items",keywordLocation:R,error:"Items did not match schema."},...K.errors),J))break}}else for(;D<H;D++){let I=he(r[D],ra,t,n,s,i,`${a}/${D}`,R);if(u[D]=!0,!I.valid&&(J=s,k.push({instanceLocation:a,keyword:"items",keywordLocation:R,error:"Items did not match schema."},...I.errors),J))break}if(!J&&kf!==void 0){let I=`${o}/additionalItems`;for(;D<H;D++){let K=he(r[D],kf,t,n,s,i,`${a}/${D}`,I);u[D]=!0,K.valid||(J=s,k.push({instanceLocation:a,keyword:"additionalItems",keywordLocation:I,error:"Items did not match additional items schema."},...K.errors))}}}if(Nf!==void 0)if(H===0&&gr===void 0)k.push({instanceLocation:a,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(gr!==void 0&&H<gr)k.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${H}) than minContains (${gr}).`});else{let R=`${o}/contains`,I=k.length,K=0;for(let V=0;V<H;V++){let Je=he(r[V],Nf,t,n,s,i,`${a}/${V}`,R);Je.valid?(u[V]=!0,K++):k.push(...Je.errors)}K>=(gr||0)&&(k.length=I),gr===void 0&&fo===void 0&&K===0?k.splice(I,0,{instanceLocation:a,keyword:"contains",keywordLocation:R,error:"Array does not contain item matching schema."}):gr!==void 0&&K<gr?k.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${gr} items matching schema. Only ${K} items were found.`}):fo!==void 0&&K>fo&&k.push({instanceLocation:a,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${fo} items matching schema. ${K} items were found.`})}if(!J&&Rf!==void 0){let R=`${o}/unevaluatedItems`;for(D;D<H;D++){if(u[D])continue;let I=he(r[D],Rf,t,n,s,i,`${a}/${D}`,R);u[D]=!0,I.valid||k.push({instanceLocation:a,keyword:"unevaluatedItems",keywordLocation:R,error:"Items did not match unevaluated items schema."},...I.errors)}}if(Db)for(let R=0;R<H;R++){let I=r[R],K=typeof I=="object"&&I!==null;for(let V=0;V<H;V++){if(R===V)continue;let Je=r[V];(I===Je||K&&(typeof Je=="object"&&Je!==null)&&Tr(I,Je))&&(k.push({instanceLocation:a,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${R} and ${V}.`}),R=Number.MAX_SAFE_INTEGER,V=Number.MAX_SAFE_INTEGER)}}}else if(l==="number"){if(t==="4"?(In!==void 0&&(na===!0&&r<=In||r<In)&&k.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${na?"or equal to ":""} ${In}.`}),Tn!==void 0&&(sa===!0&&r>=Tn||r>Tn)&&k.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${sa?"or equal to ":""} ${Tn}.`})):(In!==void 0&&r<In&&k.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${In}.`}),Tn!==void 0&&r>Tn&&k.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${Tn}.`}),na!==void 0&&r<=na&&k.push({instanceLocation:a,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${r} is less than ${na}.`}),sa!==void 0&&r>=sa&&k.push({instanceLocation:a,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${r} is greater than or equal to ${sa}.`})),po!==void 0){let H=r%po;Math.abs(0-H)>=11920929e-14&&Math.abs(po-H)>=11920929e-14&&k.push({instanceLocation:a,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${r} is not a multiple of ${po}.`})}}else if(l==="string"){let H=ho===void 0&&mo===void 0?0:L_(r);ho!==void 0&&H<ho&&k.push({instanceLocation:a,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${H} < ${ho}).`}),mo!==void 0&&H>mo&&k.push({instanceLocation:a,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${H} > ${mo}).`}),Cf!==void 0&&!new RegExp(Cf,"u").test(r)&&k.push({instanceLocation:a,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),ee!==void 0&&gd[ee]&&!gd[ee](r)&&k.push({instanceLocation:a,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${ee}".`})}return{valid:k.length===0,errors:k}}function jt(r){if(typeof r!="object"||r===null)return!1;let e=r;if(!("_zod"in e))return!1;let t=e._zod;return typeof t=="object"&&t!==null&&"def"in t}function tr(r){if(typeof r!="object"||r===null)return!1;let e=r;if(!("_def"in e)||"_zod"in e)return!1;let t=e._def;return typeof t=="object"&&t!=null&&"typeName"in t}function ns(r){return!r||typeof r!="object"||Array.isArray(r)?!1:!!(jt(r)||tr(r))}async function z_(r,e){if(jt(r))try{return{success:!0,data:await Wg(r,e)}}catch(t){return{success:!1,error:t}}if(tr(r))return r.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function oi(r,e){if(jt(r))return Jg(r,e);if(tr(r))return r.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function ja(r){if(jt(r))return Qt.get(r)?.description;if(tr(r)||"description"in r&&typeof r.description=="string")return r.description}function _d(r){return ns(r)?tr(r)?r._def.typeName==="ZodString":jt(r)?r._zod.def.type==="string":!1:!1}function ai(r){return jt(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="object":!1}function D_(r){return jt(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="array":!1}function Ru(r,e=!1){if(tr(r))return r.strict();if(ai(r)){let t=r._zod.def.shape;if(e)for(let[i,a]of Object.entries(r._zod.def.shape)){if(ai(a)){let u=Ru(a,e);t[i]=u}else if(D_(a)){let u=a._zod.def.element;ai(u)&&(u=Ru(u,e)),t[i]=ri(a,{...a._zod.def,element:u})}else t[i]=a;let o=Qt.get(a);o&&Qt.add(t[i],o)}let n=ri(r,{...r._zod.def,shape:t,catchall:t_(e_)}),s=Qt.get(r);return s&&Qt.add(n,s),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function SO(r){return tr(r)&&"typeName"in r._def&&r._def.typeName==="ZodEffects"}function kO(r){return jt(r)&&r._zod.def.type==="pipe"}function ii(r,e=!1){if(tr(r))return SO(r)?ii(r._def.schema,e):r;if(jt(r)){let t=r;if(kO(r)&&(t=ii(r._zod.def.in,e)),e){if(ai(t)){let s=t._zod.def.shape;for(let[i,a]of Object.entries(t._zod.def.shape))s[i]=ii(a,e);t=ri(t,{...t._zod.def,shape:s})}else if(D_(t)){let s=ii(t._zod.def.element,e);t=ri(t,{...t._zod.def,element:s})}}let n=Qt.get(r);return n&&Qt.add(t,n),t}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function nn(r){if(jt(r)){let e=ii(r,!0);if(ai(e)){let t=Ru(e,!0);return dd(t)}else return dd(r)}return tr(r)?si(r):r}function RO(r,e){if(r!==void 0&&!Wr(r))return r;if(ka(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function NO(r){return ka(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...nn(r.data.schema),title:r.data.name}}}var Ma=class r{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=Wr(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...NO(t)})),edges:this.edges.map(t=>{let n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let s=t??ye(),i={id:s,data:e,name:RO(t,e),metadata:n};return this.nodes[s]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let i={source:e.id,target:t.id,data:n,conditional:s};return this.edges.push(i),i}firstNode(){return U_(this)}lastNode(){return F_(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(c=>c.id).every(Wr)&&(n="");let i=c=>n?`${n}:${c}`:c;Object.entries(e.nodes).forEach(([c,l])=>{this.nodes[i(c)]={...l,id:i(c)}});let a=e.edges.map(c=>({...c,source:i(c.source),target:i(c.target)}));this.edges=[...this.edges,...a];let o=e.firstNode(),u=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,u?{id:i(u.id),data:u.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&U_(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&F_(this,[e.id])&&this.removeNode(e)}reid(){let e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),t=new Map;Object.values(e).forEach(s=>{t.set(s,(t.get(s)||0)+1)});let n=s=>{let i=e[s];return Wr(s)&&t.get(i)===1?i:s};return new r({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,i])=>[n(s),{...i,id:n(s)}])),edges:this.edges.map(s=>({...s,source:n(s.source),target:n(s.target)}))})}drawMermaid(e){let{withStyles:t,curveStyle:n,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},a=this.reid(),o=a.firstNode(),u=a.lastNode();return Fg(a.nodes,a.edges,{firstNode:o?.id,lastNode:u?.id,withStyles:t,curveStyle:n,nodeColors:s,wrapLabelNWords:i})}async drawMermaidPng(e){let t=this.drawMermaid(e);return Bg(t,{backgroundColor:e?.backgroundColor})}};function U_(r,e=[]){let t=new Set(r.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),n=[];for(let s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function F_(r,e=[]){let t=new Set(r.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),n=[];for(let s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function B_(r){let e=new TextEncoder,t=new ReadableStream({async start(n){for await(let s of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return Be.fromReadableStream(t)}function yd(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}var Z_=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function Nu(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*bd(r,e){for(;;){let{value:t,done:n}=tt.runWithConfig(kt(r),e.next.bind(e),!0);if(n)break;yield t}}async function*Cu(r,e){let t=e[Symbol.asyncIterator]();for(;;){let{value:n,done:s}=await tt.runWithConfig(kt(r),t.next.bind(e),!0);if(s)break;yield n}}function Ie(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}var de=class extends Tt{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new Sr({bound:this,kwargs:e,config:{}})}map(){return new $u({bound:this})}withRetry(e){return new La({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new Sr({bound:this,config:e,kwargs:{}})}withFallbacks(e){let t=Array.isArray(e)?e:e.fallbacks;return new ju({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(ie);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let n=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,i)=>ie(i===0?e:n))}return Array.from({length:t},()=>ie(e))}async batch(e,t,n){let s=this._getOptionsList(t??{},e.length),i=s[0]?.maxConcurrency??n?.maxConcurrency,a=new Ir({maxConcurrency:i,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>a.call(async()=>{try{return await this.invoke(u,s[c])}catch(l){if(n?.returnExceptions)return l;throw l}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let n=ie(t),s=new Er({generator:this._streamIterator(e,n),config:n});return await s.setup,Be.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=ie(e):t=ie({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){let s=ie(n),a=await(await rt(s))?.handleChainStart(this.toJSON(),Ie(t,"input"),s.runId,s?.runType,void 0,void 0,s?.runName??this.getName());delete s.runId;let o;try{let u=e.call(this,t,s,a);o=await Xt(u,n?.signal)}catch(u){throw await a?.handleChainError(u),u}return await a?.handleChainEnd(Ie(o,"output")),o}async _batchWithConfig(e,t,n,s){let i=this._getOptionsList(n??{},t.length),a=await Promise.all(i.map(rt)),o=await Promise.all(a.map(async(c,l)=>{let d=await c?.handleChainStart(this.toJSON(),Ie(t[l],"input"),i[l].runId,i[l].runType,void 0,void 0,i[l].runName??this.getName());return delete i[l].runId,d})),u;try{let c=e.call(this,t,i,o,s);u=await Xt(c,i?.[0]?.signal)}catch(c){throw await Promise.all(o.map(l=>l?.handleChainError(c))),c}return await Promise.all(o.map(c=>c?.handleChainEnd(Ie(u,"output")))),u}_concatOutputChunks(e,t){return Or(e,t)}async*_transformStreamWithConfig(e,t,n){let s,i=!0,a,o=!0,u=ie(n),c=await rt(u),l=this;async function*d(){for await(let p of e){if(i)if(s===void 0)s=p;else try{s=l._concatOutputChunks(s,p)}catch{s=void 0,i=!1}yield p}}let f;try{let p=await jg(t.bind(this),d(),async()=>c?.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),n?.signal,u);delete u.runId,f=p.setup;let h=f?.handlers.find(Dg),m=p.output;h!==void 0&&f!==void 0&&(m=h.tapOutputIterable(f.runId,m));let g=f?.handlers.find(zg);g!==void 0&&f!==void 0&&(m=g.tapOutputIterable(f.runId,m));for await(let y of m)if(yield y,o)if(a===void 0)a=y;else try{a=this._concatOutputChunks(a,y)}catch{a=void 0,o=!1}}catch(p){throw await f?.handleChainError(p,void 0,void 0,void 0,{inputs:Ie(s,"input")}),p}await f?.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:Ie(s,"input")})}getGraph(e){let t=new Ma,n=t.addNode({name:`${this.getName()}Input`,schema:at.any()}),s=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:at.any()});return t.addEdge(n,s),t.addEdge(s,i),t}pipe(e){return new kr({first:this,last:Pr(e)})}pick(e){return this.pipe(new Mu(e))}assign(e){return this.pipe(new ui(new sn({steps:e})))}async*transform(e,t){let n;for await(let s of e)n===void 0?n=s:n=this._concatOutputChunks(n,s);yield*this._streamIterator(n,ie(t))}async*streamLog(e,t,n){let s=new Pa({...n,autoClose:!1,_schemaFormat:"original"}),i=ie(t);yield*this._streamLog(e,s,i)}async*_streamLog(e,t,n){let{callbacks:s}=n;if(s===void 0)n.callbacks=[t];else if(Array.isArray(s))n.callbacks=s.concat([t]);else{let u=s.copy();u.addHandler(t,!0),n.callbacks=u}let i=this.stream(e,n);async function a(){try{let u=await i;for await(let c of u){let l=new Rt({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(l)}}finally{await t.writer.close()}}let o=a();try{for await(let u of t)yield u}finally{await o}}streamEvents(e,t,n){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,n);else if(t.version==="v2")s=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?B_(s):Be.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,n){let s=new xu({...n,autoClose:!1}),i=ie(t),a=i.runId??ye();i.runId=a;let o=i.callbacks;if(o===void 0)i.callbacks=[s];else if(Array.isArray(o))i.callbacks=o.concat(s);else{let h=o.copy();h.addHandler(s,!0),i.callbacks=h}let u=new AbortController,c=this;async function l(){let h,m=null;try{t?.signal?"any"in AbortSignal?h=AbortSignal.any([u.signal,t.signal]):(h=t.signal,m=()=>{u.abort()},t.signal.addEventListener("abort",m,{once:!0})):h=u.signal;let g=await c.stream(e,{...i,signal:h}),y=s.tapOutputIterable(a,g);for await(let _ of y)if(u.signal.aborted)break}finally{await s.finish(),h&&m&&h.removeEventListener("abort",m)}}let d=l(),f=!1,p;try{for await(let h of s){if(!f){h.data.input=e,f=!0,p=h.run_id,yield h;continue}h.run_id===p&&h.event.endsWith("_end")&&h.data?.input&&delete h.data.input,yield h}}finally{u.abort(),await d}}async*_streamEventsV1(e,t,n){let s,i=!1,a=ie(t),o=a.tags??[],u=a.metadata??{},c=a.runName??this.getName(),l=new Pa({...n,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Au({...n}),f=this._streamLog(e,l,a);for await(let h of f){if(s?s=s.concat(h):s=Ta.fromRunLogPatch(h),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;let _={...s.state},w={run_id:_.id,event:`on_${_.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};d.includeEvent(w,_.type)&&(yield w)}let m=h.ops.filter(_=>_.path.startsWith("/logs/")).map(_=>_.path.split("/")[2]),g=[...new Set(m)];for(let _ of g){let w,A={},E=s.state.logs[_];if(E.end_time===void 0?E.streamed_output.length>0?w="stream":w="start":w="end",w==="start")E.inputs!==void 0&&(A.input=E.inputs);else if(w==="end")E.inputs!==void 0&&(A.input=E.inputs),A.output=E.final_output;else if(w==="stream"){let z=E.streamed_output.length;if(z!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${z} instead. Encountered in: "${E.name}"`);A={chunk:E.streamed_output[0]},E.streamed_output=[]}yield{event:`on_${E.type}_${w}`,name:E.name,run_id:E.id,tags:E.tags,metadata:E.metadata,data:A}}let{state:y}=s;if(y.streamed_output.length>0){let _=y.streamed_output.length;if(_!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${_} instead. Encountered in: "${y.name}"`);let w={chunk:y.streamed_output[0]};y.streamed_output=[];let A={event:`on_${y.type}_stream`,run_id:y.id,tags:o,metadata:u,name:c,data:w};d.includeEvent(A,y.type)&&(yield A)}}let p=s?.state;if(p!==void 0){let h={event:`on_${p.type}_end`,name:c,run_id:p.id,tags:o,metadata:u,data:{output:p.final_output}};d.includeEvent(h,p.type)&&(yield h)}}static isRunnable(e){return ka(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new Sr({bound:this,config:{},configFactories:[s=>({callbacks:[new Sa({config:s,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return $O(this,e)}},Sr=class r extends de{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=Qs(this.config,...e);return Qs(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new La({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(ie(t),this.kwargs))}async batch(e,t,n){let s=Array.isArray(t)?await Promise.all(t.map(async i=>this._mergeConfig(ie(i),this.kwargs))):await this._mergeConfig(ie(t),this.kwargs);return this.bound.batch(e,s,n)}_concatOutputChunks(e,t){return this.bound._concatOutputChunks(e,t)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(ie(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(ie(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(ie(t),this.kwargs))}streamEvents(e,t,n){let s=this,i=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(ie(t),s.kwargs),version:t.version},n)};return Be.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&de.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new Sa({config:s,onStart:e,onEnd:t,onError:n})]})]})}},$u=class r extends de{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new r({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,Ae(t,{callbacks:n?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}},La=class extends Sr{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){let s=e>1?`retry:attempt:${e}`:void 0;return Ae(t,{callbacks:n?.getChild(s)})}async _invoke(e,t,n){return(0,wd.default)(s=>super.invoke(e,this._patchConfigForRetry(s,t,n)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,s){let i={};try{await(0,wd.default)(async a=>{let o=e.map((f,p)=>p).filter(f=>i[f.toString()]===void 0||i[f.toString()]instanceof Error),u=o.map(f=>e[f]),c=o.map(f=>this._patchConfigForRetry(a,t?.[f],n?.[f])),l=await super.batch(u,c,{...s,returnExceptions:!0}),d;for(let f=0;f<l.length;f+=1){let p=l[f],h=o[f];p instanceof Error&&d===void 0&&(d=p,d.input=u[f]),i[h.toString()]=p}if(d)throw d;return l},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if(s?.returnExceptions!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}},kr=class r extends de{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let n=ie(t),i=await(await rt(n))?.handleChainStart(this.toJSON(),Ie(e,"input"),n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let a=e,o;try{let u=[this.first,...this.middle];for(let c=0;c<u.length;c+=1){let d=u[c].invoke(a,Ae(n,{callbacks:i?.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));a=await Xt(d,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");o=await this.last.invoke(a,Ae(n,{callbacks:i?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(u){throw await i?.handleChainError(u),u}return await i?.handleChainEnd(Ie(o,"output")),o}async batch(e,t,n){let s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(rt)),a=await Promise.all(i.map(async(u,c)=>{let l=await u?.handleChainStart(this.toJSON(),Ie(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName);return delete s[c].runId,l})),o=e;try{for(let u=0;u<this.steps.length;u+=1){let l=this.steps[u].batch(o,a.map((d,f)=>{let p=d?.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`);return Ae(s[f],{callbacks:p})}),n);o=await Xt(l,s[0]?.signal)}}catch(u){throw await Promise.all(a.map(c=>c?.handleChainError(u))),u}return await Promise.all(a.map(u=>u?.handleChainEnd(Ie(o,"output")))),o}_concatOutputChunks(e,t){return this.last._concatOutputChunks(e,t)}async*_streamIterator(e,t){let n=await rt(t),{runId:s,...i}=t??{},a=await n?.handleChainStart(this.toJSON(),Ie(e,"input"),s,void 0,void 0,void 0,i?.runName),o=[this.first,...this.middle,this.last],u=!0,c;async function*l(){yield e}try{let d=o[0].transform(l(),Ae(i,{callbacks:a?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let f=1;f<o.length;f+=1)d=await o[f].transform(d,Ae(i,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${f+1}`)}));for await(let f of d)if(t?.signal?.throwIfAborted(),yield f,u)if(c===void 0)c=f;else try{c=this._concatOutputChunks(c,f)}catch{c=void 0,u=!1}}catch(d){throw await a?.handleChainError(d),d}await a?.handleChainEnd(Ie(c,"output"))}getGraph(e){let t=new Ma,n=null;return this.steps.forEach((s,i)=>{let a=s.getGraph(e);i!==0&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);let o=a.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);n&&t.addEdge(n,o),n=a.lastNode()}),t}pipe(e){return r.isRunnableSequence(e)?new r({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new r({first:this.first,middle:[...this.middle,this.last],last:Pr(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&de.isRunnable(e)}static from([e,...t],n){let s={};return typeof n=="string"?s.name=n:n!==void 0&&(s=n),new r({...s,first:Pr(e),middle:t.slice(0,-1).map(Pr),last:Pr(t[t.length-1])})}},sn=class r extends de{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,n]of Object.entries(e.steps))this.steps[t]=Pr(n)}static from(e){return new r({steps:e})}async invoke(e,t){let n=ie(t),i=await(await rt(n))?.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let a={};try{let o=Object.entries(this.steps).map(async([u,c])=>{a[u]=await c.invoke(e,Ae(n,{callbacks:i?.getChild(`map:key:${u}`)}))});await Xt(Promise.all(o),t?.signal)}catch(o){throw await i?.handleChainError(o),o}return await i?.handleChainEnd(a),a}async*_transform(e,t,n){let s={...this.steps},i=ad(e,Object.keys(s).length),a=new Map(Object.entries(s).map(([o,u],c)=>{let l=u.transform(i[c],Ae(n,{callbacks:t?.getChild(`map:key:${o}`)}));return[o,l.next().then(d=>({key:o,gen:l,result:d}))]}));for(;a.size;){let o=Promise.race(a.values()),{key:u,result:c,gen:l}=await Xt(o,n?.signal);a.delete(u),c.done||(yield{[u]:c.value},a.set(u,l.next().then(d=>({key:u,gen:l,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=ie(t),i=new Er({generator:this.transform(n(),s),config:s});return await i.setup,Be.fromAsyncGenerator(i)}},xd=class r extends de{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!No(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[n]=this._getOptionsList(t??{},1),s=await rt(n),i=this.func(Ae(n,{callbacks:s}),e);return Xt(i,n?.signal)}async*_streamIterator(e,t){let[n]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(Nu(s)){for await(let i of s)n?.signal?.throwIfAborted(),yield i;return}if(Z_(s)){for(;;){n?.signal?.throwIfAborted();let i=s.next();if(i.done)break;yield i.value}return}yield s}static from(e){return new r({func:e})}};function CO(r){if(No(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var Rr=class r extends de{static lc_name(){return"RunnableLambda"}constructor(e){if(No(e.func))return xd.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),CO(e.func),this.func=e.func}static from(e){return new r({func:e})}async _invoke(e,t,n){return new Promise((s,i)=>{let a=Ae(t,{callbacks:n?.getChild(),recursionLimit:(t?.recursionLimit??yu)-1});tt.runWithConfig(kt(a),async()=>{try{let o=await this.func(e,{...a});if(o&&de.isRunnable(o)){if(t?.recursionLimit===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...a,recursionLimit:(a.recursionLimit??yu)-1})}else if(Nu(o)){let u;for await(let c of Cu(a,o))if(t?.signal?.throwIfAborted(),u===void 0)u=c;else try{u=this._concatOutputChunks(u,c)}catch{u=c}o=u}else if(yd(o)){let u;for(let c of bd(a,o))if(t?.signal?.throwIfAborted(),u===void 0)u=c;else try{u=this._concatOutputChunks(u,c)}catch{u=c}o=u}s(o)}catch(o){i(o)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){let s;for await(let o of e)if(s===void 0)s=o;else try{s=this._concatOutputChunks(s,o)}catch{s=o}let i=Ae(n,{callbacks:t?.getChild(),recursionLimit:(n?.recursionLimit??yu)-1}),a=await new Promise((o,u)=>{tt.runWithConfig(kt(i),async()=>{try{let c=await this.func(s,{...i,config:i});o(c)}catch(c){u(c)}})});if(a&&de.isRunnable(a)){if(n?.recursionLimit===0)throw new Error("Recursion limit reached.");let o=await a.stream(s,i);for await(let u of o)yield u}else if(Nu(a))for await(let o of Cu(i,a))n?.signal?.throwIfAborted(),yield o;else if(yd(a))for(let o of bd(i,a))n?.signal?.throwIfAborted(),yield o;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=ie(t),i=new Er({generator:this.transform(n(),s),config:s});return await i.setup,Be.fromAsyncGenerator(i)}};var ju=class extends de{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}async invoke(e,t){let n=ie(t),s=await rt(n),{runId:i,...a}=n,o=await s?.handleChainStart(this.toJSON(),Ie(e,"input"),i,void 0,void 0,void 0,a?.runName),u=Ae(a,{callbacks:o?.getChild()});return await tt.runWithConfig(u,async()=>{let l;for(let d of this.runnables()){n?.signal?.throwIfAborted();try{let f=await d.invoke(e,u);return await o?.handleChainEnd(Ie(f,"output")),f}catch(f){l===void 0&&(l=f)}}throw l===void 0?new Error("No error stored at end of fallback."):(await o?.handleChainError(l),l)})}async*_streamIterator(e,t){let n=ie(t),s=await rt(n),{runId:i,...a}=n,o=await s?.handleChainStart(this.toJSON(),Ie(e,"input"),i,void 0,void 0,void 0,a?.runName),u,c;for(let d of this.runnables()){n?.signal?.throwIfAborted();let f=Ae(a,{callbacks:o?.getChild()});try{let p=await d.stream(e,f);c=Cu(f,p);break}catch(p){u===void 0&&(u=p)}}if(c===void 0){let d=u??new Error("No error stored at end of fallback.");throw await o?.handleChainError(d),d}let l;try{for await(let d of c){yield d;try{l=l===void 0?l:this._concatOutputChunks(l,d)}catch{l=void 0}}}catch(d){throw await o?.handleChainError(d),d}await o?.handleChainEnd(Ie(l,"output"))}async batch(e,t,n){if(n?.returnExceptions)throw new Error("Not implemented.");let s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(u=>rt(u))),a=await Promise.all(i.map(async(u,c)=>{let l=await u?.handleChainStart(this.toJSON(),Ie(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName);return delete s[c].runId,l})),o;for(let u of this.runnables()){s[0].signal?.throwIfAborted();try{let c=await u.batch(e,a.map((l,d)=>Ae(s[d],{callbacks:l?.getChild()})),n);return await Promise.all(a.map((l,d)=>l?.handleChainEnd(Ie(c[d],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(await Promise.all(a.map(u=>u?.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};function Pr(r){if(typeof r=="function")return new Rr({func:r});if(de.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){let e={};for(let[t,n]of Object.entries(r))e[t]=Pr(n);return new sn({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var ui=class extends de{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof sn&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){let s=this.mapper.getStepsKeys(),[i,a]=ad(e),o=this.mapper.transform(a,Ae(n,{callbacks:t?.getChild()})),u=o.next();for await(let c of i){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);let l=Object.fromEntries(Object.entries(c).filter(([d])=>!s.includes(d)));Object.keys(l).length>0&&(yield l)}yield(await u).value;for await(let c of o)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=ie(t),i=new Er({generator:this.transform(n(),s),config:s});return await i.setup,Be.fromAsyncGenerator(i)}},Mu=class extends de{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(let t of e){let n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=ie(t),i=new Er({generator:this.transform(n(),s),config:s});return await i.setup,Be.fromAsyncGenerator(i)}},za=class extends Sr{constructor(e){let t=kr.from([Rr.from(async n=>{let s;if(Gr(n))try{s=await oi(this.schema,n.args)}catch{throw new Nn("Received tool input did not match expected schema",JSON.stringify(n.args))}else s=n;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function $O(r,e){let t=e.name??r.getName(),n=e.description??ja(e.schema);return _d(e.schema)?new za({name:t,description:n,schema:at.object({input:at.string()}).transform(s=>s.input),bound:r}):new za({name:t,description:n,schema:e.schema,bound:r})}var Lu="RFC3986",zu={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},q_="RFC1738";var jO=Array.isArray,rr=(()=>{let r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})();var vd=1024,G_=(r,e,t,n,s)=>{if(r.length===0)return r;let i=r;if(typeof r=="symbol"?i=Symbol.prototype.toString.call(r):typeof r!="string"&&(i=String(r)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=vd){let u=i.length>=vd?i.slice(o,o+vd):i,c=[];for(let l=0;l<u.length;++l){let d=u.charCodeAt(l);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===q_&&(d===40||d===41)){c[c.length]=u.charAt(l);continue}if(d<128){c[c.length]=rr[d];continue}if(d<2048){c[c.length]=rr[192|d>>6]+rr[128|d&63];continue}if(d<55296||d>=57344){c[c.length]=rr[224|d>>12]+rr[128|d>>6&63]+rr[128|d&63];continue}l+=1,d=65536+((d&1023)<<10|u.charCodeAt(l)&1023),c[c.length]=rr[240|d>>18]+rr[128|d>>12&63]+rr[128|d>>6&63]+rr[128|d&63]}a+=c.join("")}return a};function H_(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function Ad(r,e){if(jO(r)){let t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}var MO=Object.prototype.hasOwnProperty,V_={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},nr=Array.isArray,LO=Array.prototype.push,K_=function(r,e){LO.apply(r,nr(e)?e:[e])},zO=Date.prototype.toISOString,Te={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:G_,encodeValuesOnly:!1,format:Lu,formatter:zu[Lu],indices:!1,serializeDate(r){return zO.call(r)},skipNulls:!1,strictNullHandling:!1};function DO(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}var Ed={};function J_(r,e,t,n,s,i,a,o,u,c,l,d,f,p,h,m,g,y){let _=r,w=y,A=0,E=!1;for(;(w=w.get(Ed))!==void 0&&!E;){let ue=w.get(r);if(A+=1,typeof ue<"u"){if(ue===A)throw new RangeError("Cyclic object value");E=!0}typeof w.get(Ed)>"u"&&(A=0)}if(typeof c=="function"?_=c(e,_):_ instanceof Date?_=f?.(_):t==="comma"&&nr(_)&&(_=Ad(_,function(ue){return ue instanceof Date?f?.(ue):ue})),_===null){if(i)return u&&!m?u(e,Te.encoder,g,"key",p):e;_=""}if(DO(_)||H_(_)){if(u){let ue=m?e:u(e,Te.encoder,g,"key",p);return[h?.(ue)+"="+h?.(u(_,Te.encoder,g,"value",p))]}return[h?.(e)+"="+h?.(String(_))]}let z=[];if(typeof _>"u")return z;let F;if(t==="comma"&&nr(_))m&&u&&(_=Ad(_,u)),F=[{value:_.length>0?_.join(",")||null:void 0}];else if(nr(c))F=c;else{let ue=Object.keys(_);F=l?ue.sort(l):ue}let G=o?String(e).replace(/\./g,"%2E"):String(e),ee=n&&nr(_)&&_.length===1?G+"[]":G;if(s&&nr(_)&&_.length===0)return ee+"[]";for(let ue=0;ue<F.length;++ue){let ce=F[ue],Gt=typeof ce=="object"&&typeof ce.value<"u"?ce.value:_[ce];if(a&&Gt===null)continue;let $s=d&&o?ce.replace(/\./g,"%2E"):ce,ta=nr(_)?typeof t=="function"?t(ee,$s):ee:ee+(d?"."+$s:"["+$s+"]");y.set(r,A);let js=new WeakMap;js.set(Ed,y),K_(z,J_(Gt,ta,t,n,s,i,a,o,t==="comma"&&m&&nr(_)?null:u,c,l,d,f,p,h,m,g,js))}return z}function UO(r=Te){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=r.charset||Te.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Lu;if(typeof r.format<"u"){if(!MO.call(zu,r.format))throw new TypeError("Unknown format option provided.");t=r.format}let n=zu[t],s=Te.filter;(typeof r.filter=="function"||nr(r.filter))&&(s=r.filter);let i;if(r.arrayFormat&&r.arrayFormat in V_?i=r.arrayFormat:"indices"in r?i=r.indices?"indices":"repeat":i=Te.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let a=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:Te.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:Te.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:Te.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:Te.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?Te.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:Te.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:Te.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:Te.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:Te.encodeValuesOnly,filter:s,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:Te.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:Te.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:Te.strictNullHandling}}function Od(r,e={}){let t=r,n=UO(e),s,i;typeof n.filter=="function"?(i=n.filter,t=i("",t)):nr(n.filter)&&(i=n.filter,s=i);let a=[];if(typeof t!="object"||t===null)return"";let o=V_[n.arrayFormat],u=o==="comma"&&n.commaRoundTrip;s||(s=Object.keys(t)),n.sort&&s.sort(n.sort);let c=new WeakMap;for(let f=0;f<s.length;++f){let p=s[f];n.skipNulls&&t[p]===null||K_(a,J_(t[p],p,o,u,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}let l=a.join(n.delimiter),d=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),l.length>0?d+l:""}var ss="4.104.0";var W_=!1,is,Id,BO,ZO,qO,Td,GO,Du,Pd,Sd,kd,Uu,Rd;function Y_(r,e={auto:!1}){if(W_)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(is)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${is}'\``);W_=e.auto,is=r.kind,Id=r.fetch,BO=r.Request,ZO=r.Response,qO=r.Headers,Td=r.FormData,GO=r.Blob,Du=r.File,Pd=r.ReadableStream,Sd=r.getMultipartRequestOptions,kd=r.getDefaultAgent,Uu=r.fileFromPath,Rd=r.isFsReadStream}var Fu=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function X_({manuallyImported:r}={}){let e=r?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,n,s,i;try{t=fetch,n=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Fu(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}var Nd=()=>{is||Y_(X_(),{auto:!0})};Nd();var C=class extends Error{},Ee=class r extends C{constructor(e,t,n,s){super(`${r.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s?.["x-request-id"],this.error=t;let i=t;this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(e,t,n){let s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new Nr({message:n,cause:Bu(t)});let i=t?.error;return e===400?new ci(e,i,n,s):e===401?new li(e,i,n,s):e===403?new di(e,i,n,s):e===404?new fi(e,i,n,s):e===409?new pi(e,i,n,s):e===422?new hi(e,i,n,s):e===429?new mi(e,i,n,s):e>=500?new gi(e,i,n,s):new r(e,i,n,s)}},ge=class extends Ee{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Nr=class extends Ee{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Mt=class extends Nr{constructor({message:e}={}){super({message:e??"Request timed out."})}},ci=class extends Ee{},li=class extends Ee{},di=class extends Ee{},fi=class extends Ee{},pi=class extends Ee{},hi=class extends Ee{},mi=class extends Ee{},gi=class extends Ee{},_i=class extends C{constructor(){super("Could not parse response content as the length limit was reached")}},yi=class extends C{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var Zu=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},as=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},ct,os=class{constructor(){ct.set(this,void 0),this.buffer=new Uint8Array,Zu(this,ct,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e,n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;let s=[],i;for(;(i=KO(this.buffer,as(this,ct,"f")))!=null;){if(i.carriage&&as(this,ct,"f")==null){Zu(this,ct,i.index,"f");continue}if(as(this,ct,"f")!=null&&(i.index!==as(this,ct,"f")+1||i.carriage)){s.push(this.decodeText(this.buffer.slice(0,as(this,ct,"f")-1))),this.buffer=this.buffer.slice(as(this,ct,"f")),Zu(this,ct,null,"f");continue}let a=as(this,ct,"f")!==null?i.preceding-1:i.preceding,o=this.decodeText(this.buffer.slice(0,a));s.push(o),this.buffer=this.buffer.slice(i.index),Zu(this,ct,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new C(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new C(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new C("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};ct=new WeakMap;os.NEWLINE_CHARS=new Set([`
`,"\r"]);os.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function KO(r,e){for(let s=e??0;s<r.length;s++){if(r[s]===10)return{preceding:s,index:s+1,carriage:!1};if(r[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function Q_(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}function Cd(r){if(r[Symbol.asyncIterator])return r;let e=r.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var sr=class r{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(let a of JO(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null||a.event.startsWith("response.")||a.event.startsWith("transcript.")){let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(o&&o.error)throw new Ee(void 0,o.error,void 0,jd(e.headers));yield o}else{let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(a.event=="error")throw new Ee(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new r(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){let a=new os,o=Cd(e);for await(let u of o)for(let c of a.decode(u))yield c;for(let u of a.flush())yield u}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new r(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),s=i=>({next:()=>{if(i.length===0){let a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new r(()=>s(e),this.controller),new r(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,n=new TextEncoder;return new Pd({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:i,done:a}=await t.next();if(a)return s.close();let o=n.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){await t.return?.()}})}};async function*JO(r,e){if(!r.body)throw e.abort(),new C("Attempted to iterate over a response with no body");let t=new $d,n=new os,s=Cd(r.body);for await(let i of WO(s))for(let a of n.decode(i)){let o=t.decode(a);o&&(yield o)}for(let i of n.flush()){let a=t.decode(i);a&&(yield a)}}async function*WO(r){let e=new Uint8Array;for await(let t of r){if(t==null)continue;let n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let i;for(;(i=Q_(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}var $d=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=YO(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function YO(r,e){let t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}var ey=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",ty=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&Da(r),Da=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",XO=r=>ty(r)||ey(r)||Rd(r);async function zd(r,e,t){if(r=await r,ty(r))return r;if(ey(r)){let s=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");let i=Da(s)?[await s.arrayBuffer()]:[s];return new Du(i,e,t)}let n=await QO(r);if(e||(e=tI(r)??"unknown_file"),!t?.type){let s=n[0]?.type;typeof s=="string"&&(t={...t,type:s})}return new Du(n,e,t)}async function QO(r){let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(Da(r))e.push(await r.arrayBuffer());else if(rI(r))for await(let t of r)e.push(t);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${r?.constructor?.name}; props: ${eI(r)}`);return e}function eI(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function tI(r){return Md(r.name)||Md(r.filename)||Md(r.path)?.split(/[\\/]/).pop()}var Md=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},rI=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Dd=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody";var nt=async r=>{let e=await ry(r.body);return Sd(e,r)},ry=async r=>{let e=new Td;return await Promise.all(Object.entries(r||{}).map(([t,n])=>Ld(e,t,n))),e};var Ld=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(XO(t)){let n=await zd(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>Ld(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>Ld(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var sI=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},iI=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},qu;Nd();async function uy(r){let{response:e}=r;if(r.options.stream)return Cr("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):sr.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;let n=e.headers.get("content-type")?.split(";")[0]?.trim();if(n?.includes("application/json")||n?.endsWith("+json")){let a=await e.json();return Cr("response",e.status,e.url,e.headers,a),cy(a,e)}let i=await e.text();return Cr("response",e.status,e.url,e.headers,i),i}function cy(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Hu=class r extends Promise{constructor(e,t=uy){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new r(this.responsePromise,async t=>cy(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Vu=class{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Ud("maxRetries",t),this.timeout=Ud("timeout",n),this.httpAgent=s,this.fetch=i??Id}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...cI(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${pI()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{let i=s&&Da(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){let n={...e},{method:s,path:i,query:a,headers:o={}}=n,u=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:Dd(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,c=this.calculateContentLength(u),l=this.buildURL(i,a);"timeout"in n&&Ud("timeout",n.timeout),n.timeout=n.timeout??this.timeout;let d=n.httpAgent??this.httpAgent??kd(l),f=n.timeout+1e3;typeof d?.options?.timeout=="number"&&f>(d.options.timeout??0)&&(d.options.timeout=f),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let p=this.buildHeaders({options:n,headers:o,contentLength:c,retryCount:t});return{req:{method:s,...u&&{body:u},headers:p,...d&&{agent:d},signal:n.signal??null},url:l,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){let i={};n&&(i["content-length"]=n);let a=this.defaultHeaders(e);return ay(i,a),ay(i,t),Dd(e.body)&&is!=="node"&&delete i["content-type"],Gu(a,"x-stainless-retry-count")===void 0&&Gu(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),Gu(a,"x-stainless-timeout")===void 0&&Gu(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return Ee.generate(e,t,n,s)}request(e,t=null){return new Hu(this.makeRequest(e,t))}async makeRequest(e,t){let n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);let{req:i,url:a,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:n}),Cr("request",a,n,i.headers),n.signal?.aborted)throw new ge;let u=new AbortController,c=await this.fetchWithTimeout(a,i,o,u).catch(Bu);if(c instanceof Error){if(n.signal?.aborted)throw new ge;if(t)return this.retryRequest(n,t);throw c.name==="AbortError"?new Mt:new Nr({cause:c})}let l=jd(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){let g=`retrying, ${t} attempts remaining`;return Cr(`response (error; ${g})`,c.status,a,l),this.retryRequest(n,t,l)}let d=await c.text().catch(g=>Bu(g).message),f=lI(d),p=f?void 0:d;throw Cr(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,l,p),this.makeStatusError(c.status,f,p,l)}return{response:c,options:n,controller:u}}requestAPIList(e,t){let n=this.makeRequest(t,null);return new Fd(this,n,e)}buildURL(e,t){let n=fI(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return ly(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new C(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){let{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),n),u={signal:s.signal,...a};return u.method&&(u.method=u.method.toUpperCase()),this.fetch.call(void 0,e,u).finally(()=>{clearTimeout(o)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s,i=n?.["retry-after-ms"];if(i){let o=parseFloat(i);Number.isNaN(o)||(s=o)}let a=n?.["retry-after"];if(a&&!s){let o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){let o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await $r(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${ss}`}},Ua=class{constructor(e,t,n,s){qu.set(this,void 0),sI(this,qu,e,"f"),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new C("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,i]of n)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await iI(this,qu,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(qu=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Fd=class extends Hu{constructor(e,t,n){super(t,async s=>new n(e,s.response,await uy(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},jd=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){let n=t.toString();return e[n.toLowerCase()]||e[n]}}),aI={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Y=r=>typeof r=="object"&&r!==null&&!ly(r)&&Object.keys(r).every(e=>dy(aI,e)),oI=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ss,"X-Stainless-OS":sy(Deno.build.os),"X-Stainless-Arch":ny(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ss,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ss,"X-Stainless-OS":sy(process.platform),"X-Stainless-Arch":ny(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let r=uI();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ss,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ss,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function uI(){if(typeof navigator>"u"||!navigator)return null;let r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of r){let n=t.exec(navigator.userAgent);if(n){let s=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}var ny=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",sy=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown"),iy,cI=()=>iy??(iy=oI()),lI=r=>{try{return JSON.parse(r)}catch{return}},dI=/^[a-z][a-z0-9+.-]*:/i,fI=r=>dI.test(r),$r=r=>new Promise(e=>setTimeout(e,r)),Ud=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new C(`${r} must be an integer`);if(e<0)throw new C(`${r} must be a positive integer`);return e},Bu=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)};var Fa=r=>{if(typeof process<"u")return process.env?.[r]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(r)?.trim()};function ly(r){if(!r)return!0;for(let e in r)return!1;return!0}function dy(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function ay(r,e){for(let t in e){if(!dy(e,t))continue;let n=t.toLowerCase();if(!n)continue;let s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}var oy=new Set(["authorization","api-key"]);function Cr(r,...e){if(typeof process<"u"&&process?.env?.DEBUG==="true"){let t=e.map(n=>{if(!n)return n;if(n.headers){let i={...n,headers:{...n.headers}};for(let a in n.headers)oy.has(a.toLowerCase())&&(i.headers[a]="REDACTED");return i}let s=null;for(let i in n)oy.has(i.toLowerCase())&&(s??(s={...n}),s[i]="REDACTED");return s??n});console.log(`OpenAI:DEBUG:${r}`,...t)}}var pI=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),fy=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",hI=r=>typeof r?.get=="function";var Gu=(r,e)=>{let t=e.toLowerCase();if(hI(r)){let n=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(s,i,a)=>i+a.toUpperCase());for(let s of[e,t,e.toUpperCase(),n]){let i=r.get(s);if(i)return i}}for(let[n,s]of Object.entries(r))if(n.toLowerCase()===t)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${e} header, using the first entry.`),s[0]):s};var py=r=>{if(typeof Buffer<"u"){let e=Buffer.from(r,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(r),t=e.length,n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);return Array.from(new Float32Array(n.buffer))}};function Ba(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}var ir=class extends Ua{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}},ne=class extends Ua{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let t=e[e.length-1]?.id;return t?{params:{after:t}}:null}};var x=class{constructor(e){this._client=e}};var bi=class extends x{list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,Ku,{query:t,...n})}};var an=class extends x{constructor(){super(...arguments),this.messages=new bi(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/chat/completions",on,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}},on=class extends ne{},Ku=class extends ne{};an.ChatCompletionsPage=on;an.Messages=bi;var Mr=class extends x{constructor(){super(...arguments),this.completions=new an(this._client)}};Mr.Completions=an;Mr.ChatCompletionsPage=on;var wi=class extends x{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}};var xi=class extends x{create(e,t){return this._client.post("/audio/transcriptions",nt({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}};var vi=class extends x{create(e,t){return this._client.post("/audio/translations",nt({body:e,...t,__metadata:{model:e.model}}))}};var ar=class extends x{constructor(){super(...arguments),this.transcriptions=new xi(this._client),this.translations=new vi(this._client),this.speech=new wi(this._client)}};ar.Transcriptions=xi;ar.Translations=vi;ar.Speech=wi;var un=class extends x{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/batches",us,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}},us=class extends ne{};un.BatchesPage=us;var Lt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},_e=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Bd,Ju,Wu,Za,qa,Yu,Ga,Lr,Ha,Xu,Qu,Ai,hy,cn=class{constructor(){Bd.add(this),this.controller=new AbortController,Ju.set(this,void 0),Wu.set(this,()=>{}),Za.set(this,()=>{}),qa.set(this,void 0),Yu.set(this,()=>{}),Ga.set(this,()=>{}),Lr.set(this,{}),Ha.set(this,!1),Xu.set(this,!1),Qu.set(this,!1),Ai.set(this,!1),Lt(this,Ju,new Promise((e,t)=>{Lt(this,Wu,e,"f"),Lt(this,Za,t,"f")}),"f"),Lt(this,qa,new Promise((e,t)=>{Lt(this,Yu,e,"f"),Lt(this,Ga,t,"f")}),"f"),_e(this,Ju,"f").catch(()=>{}),_e(this,qa,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},_e(this,Bd,"m",hy).bind(this))},0)}_connected(){this.ended||(_e(this,Wu,"f").call(this),this._emit("connect"))}get ended(){return _e(this,Ha,"f")}get errored(){return _e(this,Xu,"f")}get aborted(){return _e(this,Qu,"f")}abort(){this.controller.abort()}on(e,t){return(_e(this,Lr,"f")[e]||(_e(this,Lr,"f")[e]=[])).push({listener:t}),this}off(e,t){let n=_e(this,Lr,"f")[e];if(!n)return this;let s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(_e(this,Lr,"f")[e]||(_e(this,Lr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{Lt(this,Ai,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){Lt(this,Ai,!0,"f"),await _e(this,qa,"f")}_emit(e,...t){if(_e(this,Ha,"f"))return;e==="end"&&(Lt(this,Ha,!0,"f"),_e(this,Yu,"f").call(this));let n=_e(this,Lr,"f")[e];if(n&&(_e(this,Lr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!_e(this,Ai,"f")&&!n?.length&&Promise.reject(s),_e(this,Za,"f").call(this,s),_e(this,Ga,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!_e(this,Ai,"f")&&!n?.length&&Promise.reject(s),_e(this,Za,"f").call(this,s),_e(this,Ga,"f").call(this,s),this._emit("end")}}_emitFinal(){}};Ju=new WeakMap,Wu=new WeakMap,Za=new WeakMap,qa=new WeakMap,Yu=new WeakMap,Ga=new WeakMap,Lr=new WeakMap,Ha=new WeakMap,Xu=new WeakMap,Qu=new WeakMap,Ai=new WeakMap,Bd=new WeakSet,hy=function(e){if(Lt(this,Xu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ge),e instanceof ge)return Lt(this,Qu,!0,"f"),this._emit("abort",e);if(e instanceof C)return this._emit("error",e);if(e instanceof Error){let t=new C(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new C(String(e)))};var L=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},lt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},je,Zd,or,ec,zt,ls,Ei,cs,nc,dt,tc,rc,Ja,Va,Ka,my,gy,_y,yy,by,wy,xy,ur=class r extends cn{constructor(){super(...arguments),je.add(this),Zd.set(this,[]),or.set(this,{}),ec.set(this,{}),zt.set(this,void 0),ls.set(this,void 0),Ei.set(this,void 0),cs.set(this,void 0),nc.set(this,void 0),dt.set(this,void 0),tc.set(this,void 0),rc.set(this,void 0),Ja.set(this,void 0)}[(Zd=new WeakMap,or=new WeakMap,ec=new WeakMap,zt=new WeakMap,ls=new WeakMap,Ei=new WeakMap,cs=new WeakMap,nc=new WeakMap,dt=new WeakMap,tc=new WeakMap,rc=new WeakMap,Ja=new WeakMap,je=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new r;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=sr.fromReadableStream(e,this.controller);for await(let i of s)L(this,je,"m",Va).call(this,i);if(s.controller.signal?.aborted)throw new ge;return this._addRun(L(this,je,"m",Ka).call(this))}toReadableStream(){return new sr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,i){let a=new r;return a._run(()=>a._runToolAssistantStream(e,t,n,s,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,s,i){let a=i?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let o={...s,stream:!0},u=await e.submitToolOutputs(t,n,o,{...i,signal:this.controller.signal});this._connected();for await(let c of u)L(this,je,"m",Va).call(this,c);if(u.controller.signal?.aborted)throw new ge;return this._addRun(L(this,je,"m",Ka).call(this))}static createThreadAssistantStream(e,t,n){let s=new r;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){let i=new r;return i._run(()=>i._runAssistantStream(e,t,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return L(this,tc,"f")}currentRun(){return L(this,rc,"f")}currentMessageSnapshot(){return L(this,zt,"f")}currentRunStepSnapshot(){return L(this,Ja,"f")}async finalRunSteps(){return await this.done(),Object.values(L(this,or,"f"))}async finalMessages(){return await this.done(),Object.values(L(this,ec,"f"))}async finalRun(){if(await this.done(),!L(this,ls,"f"))throw Error("Final run was not received.");return L(this,ls,"f")}async _createThreadAssistantStream(e,t,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(let o of a)L(this,je,"m",Va).call(this,o);if(a.controller.signal?.aborted)throw new ge;return this._addRun(L(this,je,"m",Ka).call(this))}async _createAssistantStream(e,t,n,s){let i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(let u of o)L(this,je,"m",Va).call(this,u);if(o.controller.signal?.aborted)throw new ge;return this._addRun(L(this,je,"m",Ka).call(this))}static accumulateDelta(e,t){for(let[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let i=e[n];if(i==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Ba(i)&&Ba(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(let a of s){if(!Ba(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let u=i[o];u==null?i.push(a):i[o]=this.accumulateDelta(u,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${i}`);e[n]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,i){return await this._createToolAssistantStream(n,e,t,s,i)}};Va=function(e){if(!this.ended)switch(lt(this,tc,e,"f"),L(this,je,"m",_y).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":L(this,je,"m",xy).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":L(this,je,"m",gy).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":L(this,je,"m",my).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},Ka=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");if(!L(this,ls,"f"))throw Error("Final run has not been received");return L(this,ls,"f")},my=function(e){let[t,n]=L(this,je,"m",by).call(this,e,L(this,zt,"f"));lt(this,zt,t,"f"),L(this,ec,"f")[t.id]=t;for(let s of n){let i=t.content[s.index];i?.type=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=L(this,Ei,"f")){if(L(this,cs,"f"))switch(L(this,cs,"f").type){case"text":this._emit("textDone",L(this,cs,"f").text,L(this,zt,"f"));break;case"image_file":this._emit("imageFileDone",L(this,cs,"f").image_file,L(this,zt,"f"));break}lt(this,Ei,s.index,"f")}lt(this,cs,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(L(this,Ei,"f")!==void 0){let s=e.data.content[L(this,Ei,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,L(this,zt,"f"));break;case"text":this._emit("textDone",s.text,L(this,zt,"f"));break}}L(this,zt,"f")&&this._emit("messageDone",e.data),lt(this,zt,void 0,"f")}},gy=function(e){let t=L(this,je,"m",yy).call(this,e);switch(lt(this,Ja,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let i of n.step_details.tool_calls)i.index==L(this,nc,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(L(this,dt,"f")&&this._emit("toolCallDone",L(this,dt,"f")),lt(this,nc,i.index,"f"),lt(this,dt,t.step_details.tool_calls[i.index],"f"),L(this,dt,"f")&&this._emit("toolCallCreated",L(this,dt,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":lt(this,Ja,void 0,"f"),e.data.step_details.type=="tool_calls"&&L(this,dt,"f")&&(this._emit("toolCallDone",L(this,dt,"f")),lt(this,dt,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},_y=function(e){L(this,Zd,"f").push(e),this._emit("event",e)},yy=function(e){switch(e.event){case"thread.run.step.created":return L(this,or,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=L(this,or,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let s=ur.accumulateDelta(t,n.delta);L(this,or,"f")[e.data.id]=s}return L(this,or,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":L(this,or,"f")[e.data.id]=e.data;break}if(L(this,or,"f")[e.data.id])return L(this,or,"f")[e.data.id];throw new Error("No snapshot available")},by=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=L(this,je,"m",wy).call(this,i,a)}else t.content[i.index]=i,n.push(i);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},wy=function(e,t){return ur.accumulateDelta(t,e)},xy=function(e){switch(lt(this,rc,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":lt(this,ls,e.data,"f"),L(this,dt,"f")&&(this._emit("toolCallDone",L(this,dt,"f")),lt(this,dt,void 0,"f"));break;case"thread.run.cancelling":break}};var ds=class extends x{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/assistants",Oi,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}},Oi=class extends ne{};ds.AssistantsPage=Oi;function qd(r){return typeof r.parse=="function"}var ln=r=>r?.role==="assistant",Gd=r=>r?.role==="function",Hd=r=>r?.role==="tool";function vy(r,e){let t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Wa(r){return r?.$brand==="auto-parseable-response-format"}function Ay(r,{parser:e,callback:t}){let n={...r};return Object.defineProperties(n,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),n}function fs(r){return r?.$brand==="auto-parseable-tool"}function Ey(r,e){return!e||!Vd(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Ya(r,e)}function Ya(r,e){let t=r.choices.map(n=>{if(n.finish_reason==="length")throw new _i;if(n.finish_reason==="content_filter")throw new yi;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:n.message.tool_calls?.map(s=>vI(e,s))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?xI(e,n.message.content):null}}});return{...r,choices:t}}function xI(r,e){return r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function vI(r,e){let t=r.tools?.find(n=>n.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:fs(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function Oy(r,e){if(!r)return!1;let t=r.tools?.find(n=>n.function?.name===e.function.name);return fs(t)||t?.function.strict||!1}function Vd(r){return Wa(r.response_format)?!0:r.tools?.some(e=>fs(e)||e.type==="function"&&e.function.strict===!0)??!1}function Iy(r){for(let e of r??[]){if(e.type!=="function")throw new C(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new C(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var st=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ze,Kd,sc,Jd,Wd,Yd,Py,Xd,Ty=10,Ii=class extends cn{constructor(){super(...arguments),Ze.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Gd(e)||Hd(e))&&e.content)this._emit("functionCallResult",e.content);else if(ln(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ln(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new C("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),st(this,Ze,"m",Kd).call(this)}async finalMessage(){return await this.done(),st(this,Ze,"m",sc).call(this)}async finalFunctionCall(){return await this.done(),st(this,Ze,"m",Jd).call(this)}async finalFunctionCallResult(){return await this.done(),st(this,Ze,"m",Wd).call(this)}async totalUsage(){return await this.done(),st(this,Ze,"m",Yd).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=st(this,Ze,"m",sc).call(this);t&&this._emit("finalMessage",t);let n=st(this,Ze,"m",Kd).call(this);n&&this._emit("finalContent",n);let s=st(this,Ze,"m",Jd).call(this);s&&this._emit("finalFunctionCall",s);let i=st(this,Ze,"m",Wd).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",st(this,Ze,"m",Yd).call(this))}async _createChatCompletion(e,t,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),st(this,Ze,"m",Py).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Ya(i,t))}async _runChatCompletion(e,t,n){for(let s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){let s="function",{function_call:i="auto",stream:a,...o}=t,u=typeof i!="string"&&i?.name,{maxChatCompletions:c=Ty}=n||{},l={};for(let f of t.functions)l[f.name||f.function.name]=f;let d=t.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(let f of t.messages)this._addMessage(f,!1);for(let f=0;f<c;++f){let h=(await this._createChatCompletion(e,{...o,function_call:i,functions:d,messages:[...this.messages]},n)).choices[0]?.message;if(!h)throw new C("missing message in ChatCompletion response");if(!h.function_call)return;let{name:m,arguments:g}=h.function_call,y=l[m];if(y){if(u&&u!==m){let E=`Invalid function_call: ${JSON.stringify(m)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,name:m,content:E});continue}}else{let E=`Invalid function_call: ${JSON.stringify(m)}. Available options are: ${d.map(z=>JSON.stringify(z.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:m,content:E});continue}let _;try{_=qd(y)?await y.parse(g):g}catch(E){this._addMessage({role:s,name:m,content:E instanceof Error?E.message:String(E)});continue}let w=await y.function(_,this),A=st(this,Ze,"m",Xd).call(this,w);if(this._addMessage({role:s,name:m,content:A}),u)return}}async _runTools(e,t,n){let s="tool",{tool_choice:i="auto",stream:a,...o}=t,u=typeof i!="string"&&i?.function?.name,{maxChatCompletions:c=Ty}=n||{},l=t.tools.map(p=>{if(fs(p)){if(!p.$callback)throw new C("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:p.$callback,name:p.function.name,description:p.function.description||"",parameters:p.function.parameters,parse:p.$parseRaw,strict:!0}}}return p}),d={};for(let p of l)p.type==="function"&&(d[p.function.name||p.function.function.name]=p.function);let f="tools"in t?l.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description,strict:p.function.strict}}:p):void 0;for(let p of t.messages)this._addMessage(p,!1);for(let p=0;p<c;++p){let m=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:f,messages:[...this.messages]},n)).choices[0]?.message;if(!m)throw new C("missing message in ChatCompletion response");if(!m.tool_calls?.length)return;for(let g of m.tool_calls){if(g.type!=="function")continue;let y=g.id,{name:_,arguments:w}=g.function,A=d[_];if(A){if(u&&u!==_){let G=`Invalid tool_call: ${JSON.stringify(_)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:y,content:G});continue}}else{let G=`Invalid tool_call: ${JSON.stringify(_)}. Available options are: ${Object.keys(d).map(ee=>JSON.stringify(ee)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:y,content:G});continue}let E;try{E=qd(A)?await A.parse(w):w}catch(G){let ee=G instanceof Error?G.message:String(G);this._addMessage({role:s,tool_call_id:y,content:ee});continue}let z=await A.function(E,this),F=st(this,Ze,"m",Xd).call(this,z);if(this._addMessage({role:s,tool_call_id:y,content:F}),u)return}}}};Ze=new WeakSet,Kd=function(){return st(this,Ze,"m",sc).call(this).content??null},sc=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(ln(t)){let{function_call:n,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return n&&(i.function_call=n),i}}throw new C("stream ended without producing a ChatCompletionMessage with role=assistant")},Jd=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(ln(t)&&t?.function_call)return t.function_call;if(ln(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},Wd=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Gd(t)&&t.content!=null||Hd(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(s=>s.type==="function"&&s.id===t.tool_call_id)))return t.content}},Yd=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Py=function(e){if(e.n!=null&&e.n>1)throw new C("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Xd=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var Xa=class r extends Ii{static runFunctions(e,t,n){let s=new r,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){let s=new r,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),ln(e)&&e.content&&this._emit("content",e.content)}};var Se={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},Qd=class extends Error{},ef=class extends Error{};function AI(r,e=Se.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return EI(r.trim(),e)}var EI=(r,e)=>{let t=r.length,n=0,s=f=>{throw new Qd(`${f} at position ${n}`)},i=f=>{throw new ef(`${f} at position ${n}`)},a=()=>(d(),n>=t&&s("Unexpected end of input"),r[n]==='"'?o():r[n]==="{"?u():r[n]==="["?c():r.substring(n,n+4)==="null"||Se.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||Se.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||Se.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||Se.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||Se.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||Se.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):l()),o=()=>{let f=n,p=!1;for(n++;n<t&&(r[n]!=='"'||p&&r[n-1]==="\\");)p=r[n]==="\\"?!p:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(f,++n-Number(p)))}catch(h){i(String(h))}else if(Se.STR&e)try{return JSON.parse(r.substring(f,n-Number(p))+'"')}catch{return JSON.parse(r.substring(f,r.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},u=()=>{n++,d();let f={};try{for(;r[n]!=="}";){if(d(),n>=t&&Se.OBJ&e)return f;let p=o();d(),n++;try{let h=a();Object.defineProperty(f,p,{value:h,writable:!0,enumerable:!0,configurable:!0})}catch(h){if(Se.OBJ&e)return f;throw h}d(),r[n]===","&&n++}}catch{if(Se.OBJ&e)return f;s("Expected '}' at end of object")}return n++,f},c=()=>{n++;let f=[];try{for(;r[n]!=="]";)f.push(a()),d(),r[n]===","&&n++}catch{if(Se.ARR&e)return f;s("Expected ']' at end of array")}return n++,f},l=()=>{if(n===0){r==="-"&&Se.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r)}catch(p){if(Se.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}i(String(p))}}let f=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(Se.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(r.substring(f,n))}catch{r.substring(f,n)==="-"&&Se.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r.substring(f,r.lastIndexOf("e")))}catch(h){i(String(h))}}},d=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return a()},tf=r=>AI(r,Se.ALL^Se.NUM);var Ti=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},le=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Pe,zr,Pi,dn,rf,ic,nf,sf,af,ac,of,Sy,Si=class r extends Ii{constructor(e){super(),Pe.add(this),zr.set(this,void 0),Pi.set(this,void 0),dn.set(this,void 0),Ti(this,zr,e,"f"),Ti(this,Pi,[],"f")}get currentChatCompletionSnapshot(){return le(this,dn,"f")}static fromReadableStream(e){let t=new r(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){let s=new r(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){super._createChatCompletion;let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),le(this,Pe,"m",rf).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let a of i)le(this,Pe,"m",nf).call(this,a);if(i.controller.signal?.aborted)throw new ge;return this._addChatCompletion(le(this,Pe,"m",ac).call(this))}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),le(this,Pe,"m",rf).call(this),this._connected();let s=sr.fromReadableStream(e,this.controller),i;for await(let a of s)i&&i!==a.id&&this._addChatCompletion(le(this,Pe,"m",ac).call(this)),le(this,Pe,"m",nf).call(this,a),i=a.id;if(s.controller.signal?.aborted)throw new ge;return this._addChatCompletion(le(this,Pe,"m",ac).call(this))}[(zr=new WeakMap,Pi=new WeakMap,dn=new WeakMap,Pe=new WeakSet,rf=function(){this.ended||Ti(this,dn,void 0,"f")},ic=function(t){let n=le(this,Pi,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},le(this,Pi,"f")[t.index]=n,n)},nf=function(t){if(this.ended)return;let n=le(this,Pe,"m",Sy).call(this,t);this._emit("chunk",t,n);for(let s of t.choices){let i=n.choices[s.index];s.delta.content!=null&&i.message?.role==="assistant"&&i.message?.content&&(this._emit("content",s.delta.content,i.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:i.message.content,parsed:i.message.parsed})),s.delta.refusal!=null&&i.message?.role==="assistant"&&i.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:i.message.refusal}),s.logprobs?.content!=null&&i.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:i.logprobs?.content??[]}),s.logprobs?.refusal!=null&&i.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:i.logprobs?.refusal??[]});let a=le(this,Pe,"m",ic).call(this,i);i.finish_reason&&(le(this,Pe,"m",af).call(this,i),a.current_tool_call_index!=null&&le(this,Pe,"m",sf).call(this,i,a.current_tool_call_index));for(let o of s.delta.tool_calls??[])a.current_tool_call_index!==o.index&&(le(this,Pe,"m",af).call(this,i),a.current_tool_call_index!=null&&le(this,Pe,"m",sf).call(this,i,a.current_tool_call_index)),a.current_tool_call_index=o.index;for(let o of s.delta.tool_calls??[]){let u=i.message.tool_calls?.[o.index];u?.type&&(u?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:u.function?.name,index:o.index,arguments:u.function.arguments,parsed_arguments:u.function.parsed_arguments,arguments_delta:o.function?.arguments??""}):(u?.type,void 0))}}},sf=function(t,n){if(le(this,Pe,"m",ic).call(this,t).done_tool_calls.has(n))return;let i=t.message.tool_calls?.[n];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){let a=le(this,zr,"f")?.tools?.find(o=>o.type==="function"&&o.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:n,arguments:i.function.arguments,parsed_arguments:fs(a)?a.$parseRaw(i.function.arguments):a?.function.strict?JSON.parse(i.function.arguments):null})}else i.type},af=function(t){let n=le(this,Pe,"m",ic).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;let s=le(this,Pe,"m",of).call(this);this._emit("content.done",{content:t.message.content,parsed:s?s.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},ac=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");let t=le(this,dn,"f");if(!t)throw new C("request ended without sending any chunks");return Ti(this,dn,void 0,"f"),Ti(this,Pi,[],"f"),OI(t,le(this,zr,"f"))},of=function(){let t=le(this,zr,"f")?.response_format;return Wa(t)?t:null},Sy=function(t){var n,s,i,a;let o=le(this,dn,"f"),{choices:u,...c}=t;o?Object.assign(o,c):o=Ti(this,dn,{...c,choices:[]},"f");for(let{delta:l,finish_reason:d,index:f,logprobs:p=null,...h}of t.choices){let m=o.choices[f];if(m||(m=o.choices[f]={finish_reason:d,index:f,message:{},logprobs:p,...h}),p)if(!m.logprobs)m.logprobs=Object.assign({},p);else{let{content:z,refusal:F,...G}=p;Object.assign(m.logprobs,G),z&&((n=m.logprobs).content??(n.content=[]),m.logprobs.content.push(...z)),F&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...F))}if(d&&(m.finish_reason=d,le(this,zr,"f")&&Vd(le(this,zr,"f")))){if(d==="length")throw new _i;if(d==="content_filter")throw new yi}if(Object.assign(m,h),!l)continue;let{content:g,refusal:y,function_call:_,role:w,tool_calls:A,...E}=l;if(Object.assign(m.message,E),y&&(m.message.refusal=(m.message.refusal||"")+y),w&&(m.message.role=w),_&&(m.message.function_call?(_.name&&(m.message.function_call.name=_.name),_.arguments&&((i=m.message.function_call).arguments??(i.arguments=""),m.message.function_call.arguments+=_.arguments)):m.message.function_call=_),g&&(m.message.content=(m.message.content||"")+g,!m.message.refusal&&le(this,Pe,"m",of).call(this)&&(m.message.parsed=tf(m.message.content))),A){m.message.tool_calls||(m.message.tool_calls=[]);for(let{index:z,id:F,type:G,function:ee,...ue}of A){let ce=(a=m.message.tool_calls)[z]??(a[z]={});Object.assign(ce,ue),F&&(ce.id=F),G&&(ce.type=G),ee&&(ce.function??(ce.function={name:ee.name??"",arguments:""})),ee?.name&&(ce.function.name=ee.name),ee?.arguments&&(ce.function.arguments+=ee.arguments,Oy(le(this,zr,"f"),ce)&&(ce.function.parsed_arguments=tf(ce.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("chunk",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new sr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function OI(r,e){let{id:t,choices:n,created:s,model:i,system_fingerprint:a,...o}=r,u={...o,id:t,choices:n.map(({message:c,finish_reason:l,index:d,logprobs:f,...p})=>{if(!l)throw new C(`missing finish_reason for choice ${d}`);let{content:h=null,function_call:m,tool_calls:g,...y}=c,_=c.role;if(!_)throw new C(`missing role for choice ${d}`);if(m){let{arguments:w,name:A}=m;if(w==null)throw new C(`missing function_call.arguments for choice ${d}`);if(!A)throw new C(`missing function_call.name for choice ${d}`);return{...p,message:{content:h,function_call:{arguments:w,name:A},role:_,refusal:c.refusal??null},finish_reason:l,index:d,logprobs:f}}return g?{...p,index:d,finish_reason:l,logprobs:f,message:{...y,role:_,content:h,refusal:c.refusal??null,tool_calls:g.map((w,A)=>{let{function:E,type:z,id:F,...G}=w,{arguments:ee,name:ue,...ce}=E||{};if(F==null)throw new C(`missing choices[${d}].tool_calls[${A}].id
${oc(r)}`);if(z==null)throw new C(`missing choices[${d}].tool_calls[${A}].type
${oc(r)}`);if(ue==null)throw new C(`missing choices[${d}].tool_calls[${A}].function.name
${oc(r)}`);if(ee==null)throw new C(`missing choices[${d}].tool_calls[${A}].function.arguments
${oc(r)}`);return{...G,id:F,type:z,function:{...ce,name:ue,arguments:ee}}})}}:{...p,message:{...y,content:h,role:_,refusal:c.refusal??null},finish_reason:l,index:d,logprobs:f}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return Ey(u,e)}function oc(r){return JSON.stringify(r)}var Qa=class r extends Si{static fromReadableStream(e){let t=new r(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){let s=new r(null),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){let s=new r(t),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}};var eo=class extends x{parse(e,t){return Iy(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>Ya(n,e))}runFunctions(e,t){return e.stream?Qa.runFunctions(this._client,e,t):Xa.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Qa.runTools(this._client,e,t):Xa.runTools(this._client,e,t)}stream(e,t){return Si.createChatCompletion(this._client,e,t)}};var ki=class extends x{constructor(){super(...arguments),this.completions=new eo(this._client)}};(function(r){r.Completions=eo})(ki||(ki={}));var Ri=class extends x{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}};var Ni=class extends x{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}};var fn=class extends x{constructor(){super(...arguments),this.sessions=new Ri(this._client),this.transcriptionSessions=new Ni(this._client)}};fn.Sessions=Ri;fn.TranscriptionSessions=Ni;var ps=class extends x{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Ci,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}},Ci=class extends ne{};ps.MessagesPage=Ci;var hs=class extends x{retrieve(e,t,n,s={},i){return Y(s)?this.retrieve(e,t,n,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}list(e,t,n={},s){return Y(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,$i,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}},$i=class extends ne{};hs.RunStepsPage=$i;var Dr=class extends x{constructor(){super(...arguments),this.steps=new hs(this._client)}create(e,t,n){let{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,ji,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){let s=await this.create(e,t,n);return await this.poll(e,s.id,n)}createAndStream(e,t,n){return ur.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){let s={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let{data:i,response:a}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let u=a.headers.get("openai-poll-after-ms");if(u){let c=parseInt(u);isNaN(c)||(o=c)}}await $r(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return ur.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,s){let i=await this.submitToolOutputs(e,t,n,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,n,s){return ur.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}},ji=class extends ne{};Dr.RunsPage=ji;Dr.Steps=hs;Dr.RunStepsPage=$i;var cr=class extends x{constructor(){super(...arguments),this.runs=new Dr(this._client),this.messages=new ps(this._client)}create(e={},t){return Y(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){let n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return ur.createThreadAssistantStream(e,this._client.beta.threads,t)}};cr.Runs=Dr;cr.RunsPage=ji;cr.Messages=ps;cr.MessagesPage=Ci;var Dt=class extends x{constructor(){super(...arguments),this.realtime=new fn(this._client),this.chat=new ki(this._client),this.assistants=new ds(this._client),this.threads=new cr(this._client)}};Dt.Realtime=fn;Dt.Assistants=ds;Dt.AssistantsPage=Oi;Dt.Threads=cr;var ms=class extends x{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};var Mi=class extends x{retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}/content`,{...n,headers:{Accept:"application/binary",...n?.headers},__binaryResponse:!0})}};var pn=class extends x{constructor(){super(...arguments),this.content=new Mi(this._client)}create(e,t,n){return this._client.post(`/containers/${e}/files`,nt({body:t,...n}))}retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}`,n)}list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,Li,{query:t,...n})}del(e,t,n){return this._client.delete(`/containers/${e}/files/${t}`,{...n,headers:{Accept:"*/*",...n?.headers}})}},Li=class extends ne{};pn.FileListResponsesPage=Li;pn.Content=Mi;var lr=class extends x{constructor(){super(...arguments),this.files=new pn(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/containers",gs,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}},gs=class extends ne{};lr.ContainerListResponsesPage=gs;lr.Files=pn;lr.FileListResponsesPage=Li;var _s=class extends x{create(e,t){let n=!!e.encoding_format,s=n?e.encoding_format:"base64";n&&Cr("Request","User defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return n?i:(Cr("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{let u=o.embedding;o.embedding=py(u)}),a)))}};var ys=class extends x{retrieve(e,t,n,s){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,s)}list(e,t,n={},s){return Y(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,zi,{query:n,...s})}},zi=class extends ne{};ys.OutputItemListResponsesPage=zi;var Ur=class extends x{constructor(){super(...arguments),this.outputItems=new ys(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,Di,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}},Di=class extends ne{};Ur.RunListResponsesPage=Di;Ur.OutputItems=ys;Ur.OutputItemListResponsesPage=zi;var dr=class extends x{constructor(){super(...arguments),this.runs=new Ur(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/evals",bs,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}},bs=class extends ne{};dr.EvalListResponsesPage=bs;dr.Runs=Ur;dr.RunListResponsesPage=Di;var hn=class extends x{create(e,t){return this._client.post("/files",nt({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/files",ws,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await $r(t),a=await this.retrieve(e),Date.now()-i>n)throw new Mt({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}},ws=class extends ne{};hn.FileObjectsPage=ws;var Ui=class extends x{};var Fi=class extends x{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var xs=class extends x{constructor(){super(...arguments),this.graders=new Fi(this._client)}};xs.Graders=Fi;var vs=class extends x{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Bi,{body:t,method:"post",...n})}retrieve(e,t={},n){return Y(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,n)}},Bi=class extends ir{};vs.PermissionCreateResponsesPage=Bi;var mn=class extends x{constructor(){super(...arguments),this.permissions=new vs(this._client)}};mn.Permissions=vs;mn.PermissionCreateResponsesPage=Bi;var As=class extends x{list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Zi,{query:t,...n})}},Zi=class extends ne{};As.FineTuningJobCheckpointsPage=Zi;var fr=class extends x{constructor(){super(...arguments),this.checkpoints=new As(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",qi,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return Y(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Gi,{query:t,...n})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}},qi=class extends ne{},Gi=class extends ne{};fr.FineTuningJobsPage=qi;fr.FineTuningJobEventsPage=Gi;fr.Checkpoints=As;fr.FineTuningJobCheckpointsPage=Zi;var ft=class extends x{constructor(){super(...arguments),this.methods=new Ui(this._client),this.jobs=new fr(this._client),this.checkpoints=new mn(this._client),this.alpha=new xs(this._client)}};ft.Methods=Ui;ft.Jobs=fr;ft.FineTuningJobsPage=qi;ft.FineTuningJobEventsPage=Gi;ft.Checkpoints=mn;ft.Alpha=xs;var Hi=class extends x{};var gn=class extends x{constructor(){super(...arguments),this.graderModels=new Hi(this._client)}};gn.GraderModels=Hi;var Es=class extends x{createVariation(e,t){return this._client.post("/images/variations",nt({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",nt({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};var _n=class extends x{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Os,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},Os=class extends ir{};_n.ModelsPage=Os;var Is=class extends x{create(e,t){return this._client.post("/moderations",{body:e,...t})}};function ky(r,e){return!e||!KI(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:uf(r,e)}function uf(r,e){let t=r.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:YI(e,s)};if(s.type==="message"){let i=s.content.map(a=>a.type==="output_text"?{...a,parsed:VI(e,a.text)}:a);return{...s,content:i}}return s}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||cf(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let s of n.output)if(s.type==="message"){for(let i of s.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),n}function VI(r,e){return r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(e):JSON.parse(e)}function KI(r){return!!Wa(r.text?.format)}function JI(r){return r?.$brand==="auto-parseable-tool"}function WI(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function YI(r,e){let t=WI(r.tools??[],e.name);return{...e,...e,parsed_arguments:JI(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function cf(r){let e=[];for(let t of r.output)if(t.type==="message")for(let n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}var Vi=class extends x{list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,uc,{query:t,...n})}};var Ki=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},yn=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ji,cc,bn,lc,Ry,Ny,Cy,$y,dc=class r extends cn{constructor(e){super(),Ji.add(this),cc.set(this,void 0),bn.set(this,void 0),lc.set(this,void 0),Ki(this,cc,e,"f")}static createResponse(e,t,n){let s=new r(t);return s._run(()=>s._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,t,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),yn(this,Ji,"m",Ry).call(this);let i,a=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let o of i)yn(this,Ji,"m",Ny).call(this,o,a);if(i.controller.signal?.aborted)throw new ge;return yn(this,Ji,"m",Cy).call(this)}[(cc=new WeakMap,bn=new WeakMap,lc=new WeakMap,Ji=new WeakSet,Ry=function(){this.ended||Ki(this,bn,void 0,"f")},Ny=function(t,n){if(this.ended)return;let s=(a,o)=>{(n==null||o.sequence_number>n)&&this._emit(a,o)},i=yn(this,Ji,"m",$y).call(this,t);switch(s("event",t),t.type){case"response.output_text.delta":{let a=i.output[t.output_index];if(!a)throw new C(`missing output at index ${t.output_index}`);if(a.type==="message"){let o=a.content[t.content_index];if(!o)throw new C(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new C(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let a=i.output[t.output_index];if(!a)throw new C(`missing output at index ${t.output_index}`);a.type==="function_call"&&s("response.function_call_arguments.delta",{...t,snapshot:a.arguments});break}default:s(t.type,t);break}},Cy=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");let t=yn(this,bn,"f");if(!t)throw new C("request ended without sending any events");Ki(this,bn,void 0,"f");let n=QI(t,yn(this,cc,"f"));return Ki(this,lc,n,"f"),n},$y=function(t){let n=yn(this,bn,"f");if(!n){if(t.type!=="response.created")throw new C(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=Ki(this,bn,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{let s=n.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{let s=n.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);if(s.type==="message"){let i=s.content[t.content_index];if(!i)throw new C(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new C(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{let s=n.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{Ki(this,bn,t.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=yn(this,lc,"f");if(!e)throw new C("stream ended without producing a ChatCompletion");return e}};function QI(r,e){return ky(r,e)}var wn=class extends x{constructor(){super(...arguments),this.inputItems=new Vi(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&cf(n),n))}retrieve(e,t={},n){return this._client.get(`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>uf(n,e))}stream(e,t){return dc.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t?.headers}})}},uc=class extends ne{};wn.InputItems=Vi;var Wi=class extends x{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,nt({body:t,...n}))}};var xn=class extends x{constructor(){super(...arguments),this.parts=new Wi(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}};xn.Parts=Wi;var jy=async r=>{let e=await Promise.allSettled(r),t=e.filter(s=>s.status==="rejected");if(t.length){for(let s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let n=[];for(let s of e)s.status==="fulfilled"&&n.push(s.value);return n};var vn=class extends x{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,An,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){let s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){let s={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let i=await this.retrieve(e,t,{...n,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let u=i.response.headers.get("openai-poll-after-ms");if(u){let c=parseInt(u);isNaN(c)||(o=c)}}await $r(o);break;case"failed":case"completed":return a}}}async upload(e,t,n){let s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){let s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Yi,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}},An=class extends ne{},Yi=class extends ir{};vn.VectorStoreFilesPage=An;vn.FileContentResponsesPage=Yi;var Xi=class extends x{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){let s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n={},s){return Y(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,An,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async poll(e,t,n){let s={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let{data:i,response:a}=await this.retrieve(e,t,{...n,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let u=a.headers.get("openai-poll-after-ms");if(u){let c=parseInt(u);isNaN(c)||(o=c)}}await $r(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=s?.maxConcurrency??5,a=Math.min(i,t.length),o=this._client,u=t.values(),c=[...n];async function l(f){for(let p of f){let h=await o.files.create({file:p,purpose:"assistants"},s);c.push(h.id)}}let d=Array(a).fill(u).map(l);return await jy(d),await this.createAndPoll(e,{file_ids:c})}};var pt=class extends x{constructor(){super(...arguments),this.files=new vn(this._client),this.fileBatches=new Xi(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/vector_stores",Ts,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,Ps,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}},Ts=class extends ne{},Ps=class extends ir{};pt.VectorStoresPage=Ts;pt.VectorStoreSearchResponsesPage=Ps;pt.Files=vn;pt.VectorStoreFilesPage=An;pt.FileContentResponsesPage=Yi;pt.FileBatches=Xi;var My,q=class extends Vu{constructor({baseURL:e=Fa("OPENAI_BASE_URL"),apiKey:t=Fa("OPENAI_API_KEY"),organization:n=Fa("OPENAI_ORG_ID")??null,project:s=Fa("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new C("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let a={apiKey:t,organization:n,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&fy())throw new C(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new ms(this),this.chat=new Mr(this),this.embeddings=new _s(this),this.files=new hn(this),this.images=new Es(this),this.audio=new ar(this),this.moderations=new Is(this),this.models=new _n(this),this.fineTuning=new ft(this),this.graders=new gn(this),this.vectorStores=new pt(this),this.beta=new Dt(this),this.batches=new un(this),this.uploads=new xn(this),this.responses=new wn(this),this.evals=new dr(this),this.containers=new lr(this),this._options=a,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Od(e,{arrayFormat:"brackets"})}};My=q;q.OpenAI=My;q.DEFAULT_TIMEOUT=6e5;q.OpenAIError=C;q.APIError=Ee;q.APIConnectionError=Nr;q.APIConnectionTimeoutError=Mt;q.APIUserAbortError=ge;q.NotFoundError=fi;q.ConflictError=pi;q.RateLimitError=mi;q.BadRequestError=ci;q.AuthenticationError=li;q.InternalServerError=gi;q.PermissionDeniedError=di;q.UnprocessableEntityError=hi;q.toFile=zd;q.fileFromPath=Uu;q.Completions=ms;q.Chat=Mr;q.ChatCompletionsPage=on;q.Embeddings=_s;q.Files=hn;q.FileObjectsPage=ws;q.Images=Es;q.Audio=ar;q.Moderations=Is;q.Models=_n;q.ModelsPage=Os;q.FineTuning=ft;q.Graders=gn;q.VectorStores=pt;q.VectorStoresPage=Ts;q.VectorStoreSearchResponsesPage=Ps;q.Beta=Dt;q.Batches=un;q.BatchesPage=us;q.Uploads=xn;q.Responses=wn;q.Evals=dr;q.EvalListResponsesPage=bs;q.Containers=lr;q.ContainerListResponsesPage=gs;var sT=typeof window=="object"?window:{},re="0123456789abcdef".split(""),iT=[-2147483648,8388608,32768,128],Ut=[24,16,8,0];var ke=[];function Ft(r){r?(ke[0]=ke[16]=ke[1]=ke[2]=ke[3]=ke[4]=ke[5]=ke[6]=ke[7]=ke[8]=ke[9]=ke[10]=ke[11]=ke[12]=ke[13]=ke[14]=ke[15]=0,this.blocks=ke):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Ft.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===sT.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,s,i=r.length||0,a=this.blocks;n<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;n<i&&s<64;++n)a[s>>2]|=r[n]<<Ut[s++&3];else for(s=this.start;n<i&&s<64;++n)t=r.charCodeAt(n),t<128?a[s>>2]|=t<<Ut[s++&3]:t<2048?(a[s>>2]|=(192|t>>6)<<Ut[s++&3],a[s>>2]|=(128|t&63)<<Ut[s++&3]):t<55296||t>=57344?(a[s>>2]|=(224|t>>12)<<Ut[s++&3],a[s>>2]|=(128|t>>6&63)<<Ut[s++&3],a[s>>2]|=(128|t&63)<<Ut[s++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),a[s>>2]|=(240|t>>18)<<Ut[s++&3],a[s>>2]|=(128|t>>12&63)<<Ut[s++&3],a[s>>2]|=(128|t>>6&63)<<Ut[s++&3],a[s>>2]|=(128|t&63)<<Ut[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Ft.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=iT[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};Ft.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i,a,o,u=this.blocks;for(a=16;a<80;++a)o=u[a-3]^u[a-8]^u[a-14]^u[a-16],u[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)i=e&t|~e&n,o=r<<5|r>>>27,s=o+i+s+1518500249+u[a]<<0,e=e<<30|e>>>2,i=r&e|~r&t,o=s<<5|s>>>27,n=o+i+n+1518500249+u[a+1]<<0,r=r<<30|r>>>2,i=s&r|~s&e,o=n<<5|n>>>27,t=o+i+t+1518500249+u[a+2]<<0,s=s<<30|s>>>2,i=n&s|~n&r,o=t<<5|t>>>27,e=o+i+e+1518500249+u[a+3]<<0,n=n<<30|n>>>2,i=t&n|~t&s,o=e<<5|e>>>27,r=o+i+r+1518500249+u[a+4]<<0,t=t<<30|t>>>2;for(;a<40;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s+1859775393+u[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n+1859775393+u[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t+1859775393+u[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e+1859775393+u[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r+1859775393+u[a+4]<<0,t=t<<30|t>>>2;for(;a<60;a+=5)i=e&t|e&n|t&n,o=r<<5|r>>>27,s=o+i+s-1894007588+u[a]<<0,e=e<<30|e>>>2,i=r&e|r&t|e&t,o=s<<5|s>>>27,n=o+i+n-1894007588+u[a+1]<<0,r=r<<30|r>>>2,i=s&r|s&e|r&e,o=n<<5|n>>>27,t=o+i+t-1894007588+u[a+2]<<0,s=s<<30|s>>>2,i=n&s|n&r|s&r,o=t<<5|t>>>27,e=o+i+e-1894007588+u[a+3]<<0,n=n<<30|n>>>2,i=t&n|t&s|n&s,o=e<<5|e>>>27,r=o+i+r-1894007588+u[a+4]<<0,t=t<<30|t>>>2;for(;a<80;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s-899497514+u[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n-899497514+u[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t-899497514+u[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e-899497514+u[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r-899497514+u[a+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0};Ft.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return re[r>>28&15]+re[r>>24&15]+re[r>>20&15]+re[r>>16&15]+re[r>>12&15]+re[r>>8&15]+re[r>>4&15]+re[r&15]+re[e>>28&15]+re[e>>24&15]+re[e>>20&15]+re[e>>16&15]+re[e>>12&15]+re[e>>8&15]+re[e>>4&15]+re[e&15]+re[t>>28&15]+re[t>>24&15]+re[t>>20&15]+re[t>>16&15]+re[t>>12&15]+re[t>>8&15]+re[t>>4&15]+re[t&15]+re[n>>28&15]+re[n>>24&15]+re[n>>20&15]+re[n>>16&15]+re[n>>12&15]+re[n>>8&15]+re[n>>4&15]+re[n&15]+re[s>>28&15]+re[s>>24&15]+re[s>>20&15]+re[s>>16&15]+re[s>>12&15]+re[s>>8&15]+re[s>>4&15]+re[s&15]};Ft.prototype.toString=Ft.prototype.hex;Ft.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,s>>24&255,s>>16&255,s>>8&255,s&255]};Ft.prototype.array=Ft.prototype.digest;Ft.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};var Ly=!1,lf=r=>(Ly||(console.warn(["The default method for hashing keys is insecure and will be replaced in a future version,","but hasn't been replaced yet as to not break existing caches. It's recommended that you use","a more secure hashing algorithm to avoid cache poisoning.","","See this page for more information:","|","\u2514> https://js.langchain.com/docs/troubleshooting/warnings/insecure-cache-algorithm"].join(`
`)),Ly=!0),new Ft(!0).update(r).hex());var N="0123456789abcdef".split(""),aT=[-2147483648,8388608,32768,128],Bt=[24,16,8,0],fc=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];var Re=[];function pr(r,e){e?(Re[0]=Re[16]=Re[1]=Re[2]=Re[3]=Re[4]=Re[5]=Re[6]=Re[7]=Re[8]=Re[9]=Re[10]=Re[11]=Re[12]=Re[13]=Re[14]=Re[15]=0,this.blocks=Re):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=r}pr.prototype.update=function(r){if(!this.finalized){var e,t=typeof r;if(t!=="string"){if(t==="object"){if(r===null)throw new Error(ERROR);if(ARRAY_BUFFER&&r.constructor===ArrayBuffer)r=new Uint8Array(r);else if(!Array.isArray(r)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(r)))throw new Error(ERROR)}else throw new Error(ERROR);e=!0}for(var n,s=0,i,a=r.length,o=this.blocks;s<a;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),e)for(i=this.start;s<a&&i<64;++s)o[i>>>2]|=r[s]<<Bt[i++&3];else for(i=this.start;s<a&&i<64;++s)n=r.charCodeAt(s),n<128?o[i>>>2]|=n<<Bt[i++&3]:n<2048?(o[i>>>2]|=(192|n>>>6)<<Bt[i++&3],o[i>>>2]|=(128|n&63)<<Bt[i++&3]):n<55296||n>=57344?(o[i>>>2]|=(224|n>>>12)<<Bt[i++&3],o[i>>>2]|=(128|n>>>6&63)<<Bt[i++&3],o[i>>>2]|=(128|n&63)<<Bt[i++&3]):(n=65536+((n&1023)<<10|r.charCodeAt(++s)&1023),o[i>>>2]|=(240|n>>>18)<<Bt[i++&3],o[i>>>2]|=(128|n>>>12&63)<<Bt[i++&3],o[i>>>2]|=(128|n>>>6&63)<<Bt[i++&3],o[i>>>2]|=(128|n&63)<<Bt[i++&3]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=o[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};pr.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>>2]|=aT[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};pr.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i=this.h5,a=this.h6,o=this.h7,u=this.blocks,c,l,d,f,p,h,m,g,y,_,w;for(c=16;c<64;++c)p=u[c-15],l=(p>>>7|p<<25)^(p>>>18|p<<14)^p>>>3,p=u[c-2],d=(p>>>17|p<<15)^(p>>>19|p<<13)^p>>>10,u[c]=u[c-16]+l+u[c-7]+d<<0;for(w=e&t,c=0;c<64;c+=4)this.first?(this.is224?(g=300032,p=u[0]-1413257819,o=p-150054599<<0,n=p+24177077<<0):(g=704751109,p=u[0]-210244248,o=p-1521486534<<0,n=p+143694565<<0),this.first=!1):(l=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),d=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),g=r&e,f=g^r&t^w,m=s&i^~s&a,p=o+d+m+fc[c]+u[c],h=l+f,o=n+p<<0,n=p+h<<0),l=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),d=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),y=n&r,f=y^n&e^g,m=a&o^~a&s,p=i+d+m+fc[c+1]+u[c+1],h=l+f,a=t+p<<0,t=p+h<<0,l=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),d=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),_=t&n,f=_^t&r^y,m=i&a^~i&o,p=s+d+m+fc[c+2]+u[c+2],h=l+f,i=e+p<<0,e=p+h<<0,l=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),d=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),w=e&t,f=w^e&n^_,m=i&a^~i&o,p=s+d+m+fc[c+3]+u[c+3],h=l+f,s=r+p<<0,r=p+h<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0,this.h5=this.h5+i<<0,this.h6=this.h6+a<<0,this.h7=this.h7+o<<0};pr.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i=this.h5,a=this.h6,o=this.h7,u=N[r>>>28&15]+N[r>>>24&15]+N[r>>>20&15]+N[r>>>16&15]+N[r>>>12&15]+N[r>>>8&15]+N[r>>>4&15]+N[r&15]+N[e>>>28&15]+N[e>>>24&15]+N[e>>>20&15]+N[e>>>16&15]+N[e>>>12&15]+N[e>>>8&15]+N[e>>>4&15]+N[e&15]+N[t>>>28&15]+N[t>>>24&15]+N[t>>>20&15]+N[t>>>16&15]+N[t>>>12&15]+N[t>>>8&15]+N[t>>>4&15]+N[t&15]+N[n>>>28&15]+N[n>>>24&15]+N[n>>>20&15]+N[n>>>16&15]+N[n>>>12&15]+N[n>>>8&15]+N[n>>>4&15]+N[n&15]+N[s>>>28&15]+N[s>>>24&15]+N[s>>>20&15]+N[s>>>16&15]+N[s>>>12&15]+N[s>>>8&15]+N[s>>>4&15]+N[s&15]+N[i>>>28&15]+N[i>>>24&15]+N[i>>>20&15]+N[i>>>16&15]+N[i>>>12&15]+N[i>>>8&15]+N[i>>>4&15]+N[i&15]+N[a>>>28&15]+N[a>>>24&15]+N[a>>>20&15]+N[a>>>16&15]+N[a>>>12&15]+N[a>>>8&15]+N[a>>>4&15]+N[a&15];return this.is224||(u+=N[o>>>28&15]+N[o>>>24&15]+N[o>>>20&15]+N[o>>>16&15]+N[o>>>12&15]+N[o>>>8&15]+N[o>>>4&15]+N[o&15]),u};pr.prototype.toString=pr.prototype.hex;pr.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i=this.h5,a=this.h6,o=this.h7,u=[r>>>24&255,r>>>16&255,r>>>8&255,r&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255];return this.is224||u.push(o>>>24&255,o>>>16&255,o>>>8&255,o&255),u};pr.prototype.array=pr.prototype.digest;pr.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(this.is224?28:32),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),r};var oT=(...r)=>lf(r.join("_"));var df=class{constructor(){Object.defineProperty(this,"keyEncoder",{enumerable:!0,configurable:!0,writable:!0,value:oT})}makeDefaultKeyEncoder(e){this.keyEncoder=e}},uT=new Map,pc=class r extends df{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(this.keyEncoder(e,t))??null)}async update(e,t,n){this.cache.set(this.keyEncoder(e,t),n)}static global(){return new r(uT)}};var hc=class extends Tt{},mc=class extends hc{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new it(this.value)]}},gc=class extends hc{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return oa(this.messages)}toChatMessages(){return this.messages}};var Fy=It(Uy(),1);var gT=Object.defineProperty,_T=(r,e,t)=>e in r?gT(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,yT=(r,e,t)=>(_T(r,typeof e!="symbol"?e+"":e,t),t);function bT(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){let i=r.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(n==null||a<n[0])&&(n=[a,s])}if(n!=null){let s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function wT(r,e){return r.length===1?[e.get(r.join(","))]:bT(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function xT(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var pf=class{constructor(r,e){_r(this,"specialTokens");_r(this,"inverseSpecialTokens");_r(this,"patStr");_r(this,"textEncoder",new TextEncoder);_r(this,"textDecoder",new TextDecoder("utf-8"));_r(this,"rankMap",new Map);_r(this,"textMap",new Map);this.patStr=r.pat_str;let t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{let[i,a,...o]=s.split(" "),u=Number.parseInt(a,10);return o.forEach((c,l)=>n[c]=u+l),n},{});for(let[n,s]of Object.entries(t)){let i=Fy.default.toByteArray(n);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,i])=>(n[i]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){let n=new RegExp(this.patStr,"ug"),s=pf.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!a.has(c)):t);if(o.size>0){let c=pf.specialTokenRegex([...o]),l=r.match(c);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let u=0;for(;;){let c=null,l=u;for(;s.lastIndex=l,c=s.exec(r),!(c==null||a.has(c[0]));)l=c.index+1;let d=c?.index??r.length;for(let p of r.substring(u,d).matchAll(n)){let h=this.textEncoder.encode(p[0]),m=this.rankMap.get(h.join(","));if(m!=null){i.push(m);continue}i.push(...wT(h,this.rankMap))}if(c==null)break;let f=this.specialTokens[c[0]];i.push(f),u=c.index+c[0].length}return i}decode(r){let e=[],t=0;for(let i=0;i<r.length;++i){let a=r[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}let n=new Uint8Array(t),s=0;for(let i of e)n.set(i,s),s+=i.length;return this.textDecoder.decode(n)}},yc=pf;yT(yc,"specialTokenRegex",r=>new RegExp(r.map(e=>xT(e)).join("|"),"g"));function hf(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}var bc={},vT=new Ir({});async function AT(r){return r in bc||(bc[r]=vT.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new yc(e)).catch(e=>{throw delete bc[r],e})),await bc[r]}async function By(r){return AT(hf(r))}var ET=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r;function Zy(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}var OT=()=>!1,to=class extends de{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??OT(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},ro=class extends to{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){let{cache:s,...i}=n;super({callbacks:e??t,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=pc.global():this.cache=void 0,this.caller=new Ir(n??{})}async getNumTokens(e){let t;typeof e=="string"?t=e:t=e.map(s=>typeof s=="string"?s:s.type==="text"&&"text"in s?s.text:"").join("");let n=Math.ceil(t.length/4);if(!this._encoding)try{this._encoding=await By("modelName"in this?ET(this.modelName):"gpt2")}catch(s){console.warn("Failed to calculate number of tokens, falling back to approximate count",s)}if(this._encoding)try{n=this._encoding.encode(t).length}catch(s){console.warn("Failed to calculate number of tokens, falling back to approximate count",s)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new mc(e):Array.isArray(e)?new gc(e.map(Cn)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){let n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}};var mr=class extends de{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){let n=ie(t);return this.func&&await this.func(e,n),this._callWithConfig(s=>Promise.resolve(s),e,n)}async*transform(e,t){let n=ie(t),s,i=!0;for await(let a of this._transformStreamWithConfig(e,o=>o,n))if(yield a,i)if(s===void 0)s=a;else try{s=Or(s,a)}catch{s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,n)}static assign(e){return new ui(new sn({steps:e}))}};function mf(r){let e=[];for(let t of r){let n=t;if(Array.isArray(t.content))for(let s=0;s<t.content.length;s++){let i=t.content[s];(Wf(i)||Yf(i))&&n===t&&(n=new t.constructor({...n,content:[...t.content.slice(0,s),Xf(i),...t.content.slice(s+1)]}))}e.push(n)}return e}var wc=class r extends ro{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){let[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async invoke(e,t){let n=r._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===r.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{let s=r._convertInputToPromptValue(e).toChatMessages(),[i,a]=this._separateRunnableConfigFromCallOptionsCompat(t),o={...i.metadata,...this.getLsParams(a)},u=await $e.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:a,invocation_params:this?.invocationParams(a),batch_size:1},l=await u?.handleChatModelStart(this.toJSON(),[mf(s)],i.runId,void 0,c,void 0,void 0,i.runName),d,f;try{for await(let p of this._streamResponseChunks(s,a,l?.[0])){if(p.message.id==null){let h=l?.at(0)?.runId;h!=null&&p.message._updateId(`run-${h}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},yield p.message,d?d=d.concat(p):d=p,Mc(p.message)&&p.message.usage_metadata!==void 0&&(f={tokenUsage:{promptTokens:p.message.usage_metadata.input_tokens,completionTokens:p.message.usage_metadata.output_tokens,totalTokens:p.message.usage_metadata.total_tokens}})}}catch(p){throw await Promise.all((l??[]).map(h=>h?.handleLLMError(p))),p}await Promise.all((l??[]).map(p=>p?.handleLLMEnd({generations:[[d]],llmOutput:f})))}}getLsParams(e){let t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,n,s){let i=e.map(d=>d.map(Cn)),a;if(s!==void 0&&s.length===i.length)a=s;else{let d={...n.metadata,...this.getLsParams(t)},f=await $e.configure(n.callbacks,this.callbacks,n.tags,this.tags,d,this.metadata,{verbose:this.verbose}),p={options:t,invocation_params:this?.invocationParams(t),batch_size:1};a=await f?.handleChatModelStart(this.toJSON(),i.map(mf),n.runId,void 0,p,void 0,void 0,n.runName)}let o=[],u=[];if(!!a?.[0].handlers.find(Kl)&&!this.disableStreaming&&i.length===1&&this._streamResponseChunks!==r.prototype._streamResponseChunks)try{let d=await this._streamResponseChunks(i[0],t,a?.[0]),f,p;for await(let h of d){if(h.message.id==null){let m=a?.at(0)?.runId;m!=null&&h.message._updateId(`run-${m}`)}f===void 0?f=h:f=Or(f,h),Mc(h.message)&&h.message.usage_metadata!==void 0&&(p={tokenUsage:{promptTokens:h.message.usage_metadata.input_tokens,completionTokens:h.message.usage_metadata.output_tokens,totalTokens:h.message.usage_metadata.total_tokens}})}if(f===void 0)throw new Error("Received empty response from chat model call.");o.push([f]),await a?.[0].handleLLMEnd({generations:o,llmOutput:p})}catch(d){throw await a?.[0].handleLLMError(d),d}else{let d=await Promise.allSettled(i.map((f,p)=>this._generate(f,{...t,promptIndex:p},a?.[p])));await Promise.all(d.map(async(f,p)=>{if(f.status==="fulfilled"){let h=f.value;for(let m of h.generations){if(m.message.id==null){let g=a?.at(0)?.runId;g!=null&&m.message._updateId(`run-${g}`)}m.message.response_metadata={...m.generationInfo,...m.message.response_metadata}}return h.generations.length===1&&(h.generations[0].message.response_metadata={...h.llmOutput,...h.generations[0].message.response_metadata}),o[p]=h.generations,u[p]=h.llmOutput,a?.[p]?.handleLLMEnd({generations:[h.generations],llmOutput:h.llmOutput})}else return await a?.[p]?.handleLLMError(f.reason),Promise.reject(f.reason)}))}let l={generations:o,llmOutput:u.length?this._combineLLMOutput?.(...u):void 0};return Object.defineProperty(l,bu,{value:a?{runIds:a?.map(d=>d.runId)}:void 0,configurable:!0}),l}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:s,handledOptions:i}){let a=e.map(g=>g.map(Cn)),o={...i.metadata,...this.getLsParams(s)},u=await $e.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this?.invocationParams(s),batch_size:1},l=await u?.handleChatModelStart(this.toJSON(),a.map(mf),i.runId,void 0,c,void 0,void 0,i.runName),d=[],p=(await Promise.allSettled(a.map(async(g,y)=>{let _=r._convertInputToPromptValue(g).toString(),w=await t.lookup(_,n);return w==null&&d.push(y),w}))).map((g,y)=>({result:g,runManager:l?.[y]})).filter(({result:g})=>g.status==="fulfilled"&&g.value!=null||g.status==="rejected"),h=[];await Promise.all(p.map(async({result:g,runManager:y},_)=>{if(g.status==="fulfilled"){let w=g.value;return h[_]=w.map(A=>("message"in A&&Fr(A.message)&&Pn(A.message)&&(A.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),A.generationInfo={...A.generationInfo,tokenUsage:{}},A)),w.length&&await y?.handleLLMNewToken(w[0].text),y?.handleLLMEnd({generations:[w]},void 0,void 0,void 0,{cached:!0})}else return await y?.handleLLMError(g.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(g.reason)}));let m={generations:h,missingPromptIndices:d,startedRunManagers:l};return Object.defineProperty(m,bu,{value:l?{runIds:l?.map(g=>g.runId)}:void 0,configurable:!0}),m}async generate(e,t,n){let s;Array.isArray(t)?s={stop:t}:s=t;let i=e.map(h=>h.map(Cn)),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(a.callbacks=a.callbacks??n,!this.cache)return this._generateUncached(i,o,a);let{cache:u}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:l,missingPromptIndices:d,startedRunManagers:f}=await this._generateCached({messages:i,cache:u,llmStringKey:c,parsedOptions:o,handledOptions:a}),p={};if(d.length>0){let h=await this._generateUncached(d.map(m=>i[m]),o,a,f!==void 0?d.map(m=>f?.[m]):void 0);await Promise.all(h.generations.map(async(m,g)=>{let y=d[g];l[y]=m;let _=r._convertInputToPromptValue(i[y]).toString();return u.update(_,c,m)})),p=h.llmOutput??{}}return{generations:l,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){let s=e.map(i=>i.toChatMessages());return this.generate(s,t,n)}async call(e,t,n){return(await this.generate([e.map(Cn)],t,n)).generations[0][0].message}async callPrompt(e,t,n){let s=e.toChatMessages();return this.call(s,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){let s=new it(e),i=await this.call([s],t,n);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t?.strict)throw new Error('"strict" mode is not supported for this model by default.');let n=e,s=t?.name,i=ja(n)??"A function available to call.",a=t?.method,o=t?.includeRaw;if(a==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=s??"extract",c;ns(n)?c=[{type:"function",function:{name:u,description:i,parameters:nn(n)}}]:("name"in n&&(u=n.name),c=[{type:"function",function:{name:u,description:i,parameters:n}}]);let l=this.bindTools(c),d=Rr.from(m=>{if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");let g=m.tool_calls.find(y=>y.name===u);if(!g)throw new Error(`No tool call found with name ${u}.`);return g.args});if(!o)return l.pipe(d).withConfig({runName:"StructuredOutput"});let f=mr.assign({parsed:(m,g)=>d.invoke(m.raw,g)}),p=mr.assign({parsed:()=>null}),h=f.withFallbacks({fallbacks:[p]});return kr.from([{raw:l},h]).withConfig({runName:"StructuredOutputRunnable"})}};var gf=class extends de{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,s)=>this.parseResult([{text:n}],s?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,s)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],s?.callbacks),e,{...t,runType:"parser"})}},Qi=class extends gf{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}},En=class extends Error{constructor(e,t,n,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=s,s&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");bo(this,"OUTPUT_PARSING_FAILURE")}};var ea=class extends Qi{async*_transform(e){for await(let t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}},ks=class extends ea{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async*_transform(e){let t,n;for await(let s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(jc(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new en({message:s,text:s.content})}else if(Fr(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new en({message:zc(s),text:s.content})}else i=new Nt({text:s});n===void 0?n=i:n=n.concat(i);let a=await this.parsePartialResult([n]);a!=null&&!Tr(a,t)&&(this.diff?yield this._diff(t,a):yield a,t=a)}}getFormatInstructions(){return""}};var no=class extends Qi{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){let t=at.object(Object.fromEntries(Object.entries(e).map(([n,s])=>[n,at.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(nn(this.schema))}
\`\`\`
`}async parse(e){try{let t=e.trim(),s=(t.match(/^```(?:json)?\s*([\s\S]*?)```/)?.[1]||t.match(/```json\s*([\s\S]*?)```/)?.[1]||t).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(i,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await oi(this.schema,JSON.parse(s))}catch(t){throw new En(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}};var so=class extends ks{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_concatOutputChunks(e,t){return this.diff?super._concatOutputChunks(e,t):t}_diff(e,t){if(t)return e?Do(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Nc(e[0].text)}async parse(e){return Nc(e,JSON.parse)}getFormatInstructions(){return""}};function yf(r,e){if(r.function===void 0)return;let t;if(e?.partial)try{t=Ms(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(s){throw new En([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}let n={name:r.function.name,args:t,type:"tool_call"};return e?.returnId&&(n.id=r.id),n}function qy(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function Gy(r,e){return{name:r.function?.name,args:r.function?.arguments,id:r.id,error:e,type:"invalid_tool_call"}}var _f=class extends ks{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){let n=e[0].message,s;if(Pn(n)&&n.tool_calls?.length?s=n.tool_calls.map(a=>{let{id:o,...u}=a;return this.returnId?{id:o,...u}:u}):n.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(o=>yf(o,{returnId:this.returnId,partial:t}))),!s)return[];let i=[];for(let a of s)if(a!==void 0){let o={type:a.name,args:a.args,id:a.id};i.push(o)}return i}},io=class extends _f{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;let t=await z_(this.zodSchema,e);if(t.success)return t.data;throw new En(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error?.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let n=(await super.parsePartialResult(e)).filter(i=>i.type===this.keyName),s=n;if(n.length)return this.returnId||(s=n.map(i=>i.args)),this.returnSingle?s[0]:s}async parseResult(e){let n=(await super.parsePartialResult(e,!1)).filter(a=>a.type===this.keyName),s=n;return n.length?(this.returnId||(s=n.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))):void 0}};var Vy=Symbol("Let zodToJsonSchema decide on which parser to use"),Hy={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Ky=r=>typeof r=="string"?{...Hy,basePath:["#"],definitions:{},name:r}:{...Hy,basePath:["#"],definitions:{},...r};var ao=r=>"_def"in r?r._def:r;function Jy(r){if(!r)return!0;for(let e in r)return!1;return!0}var Wy=r=>{let e=Ky(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[ao(s),{def:ao(s),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function bf(r,e,t,n){n?.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function oe(r,e,t,n,s){r[e]=t,bf(r,e,n,s)}function Yy(){return{}}function Xy(r,e){let t={type:"array"};return r.type?._def?.typeName!==b.ZodAny&&(t.items=B(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&oe(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&oe(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(oe(t,"minItems",r.exactLength.value,r.exactLength.message,e),oe(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function Qy(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?oe(t,"minimum",n.value,n.message,e):oe(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),oe(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?oe(t,"maximum",n.value,n.message,e):oe(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),oe(t,"maximum",n.value,n.message,e));break;case"multipleOf":oe(t,"multipleOf",n.value,n.message,e);break}return t}function eb(){return{type:"boolean"}}function tb(r,e){return B(r.type._def,e)}var rb=(r,e)=>B(r.innerType._def,e);function wf(r,e,t){let n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,i)=>wf(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return IT(r,e)}}var IT=(r,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let n of r.checks)switch(n.kind){case"min":oe(t,"minimum",n.value,n.message,e);break;case"max":oe(t,"maximum",n.value,n.message,e);break}return t};function nb(r,e){return{...B(r.innerType._def,e),default:r.defaultValue()}}function sb(r,e,t){return e.effectStrategy==="input"?B(r.schema._def,e,t):{}}function ib(r){return{type:"string",enum:[...r.values]}}var TT=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function ab(r,e){let t=[B(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),B(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return t.forEach(i=>{if(TT(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){let{additionalProperties:o,...u}=i;a=u}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function ob(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var xf,Rs={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(xf===void 0&&(xf=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),xf),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function xc(r,e){let t={type:"string"};function n(s){return e.patternStrategy==="escape"?PT(s):s}if(r.checks)for(let s of r.checks)switch(s.kind){case"min":oe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":oe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Zt(t,"email",s.message,e);break;case"format:idn-email":Zt(t,"idn-email",s.message,e);break;case"pattern:zod":qt(t,Rs.email,s.message,e);break}break;case"url":Zt(t,"uri",s.message,e);break;case"uuid":Zt(t,"uuid",s.message,e);break;case"regex":qt(t,s.regex,s.message,e);break;case"cuid":qt(t,Rs.cuid,s.message,e);break;case"cuid2":qt(t,Rs.cuid2,s.message,e);break;case"startsWith":qt(t,RegExp(`^${n(s.value)}`),s.message,e);break;case"endsWith":qt(t,RegExp(`${n(s.value)}$`),s.message,e);break;case"datetime":Zt(t,"date-time",s.message,e);break;case"date":Zt(t,"date",s.message,e);break;case"time":Zt(t,"time",s.message,e);break;case"duration":Zt(t,"duration",s.message,e);break;case"length":oe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),oe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{qt(t,RegExp(n(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&Zt(t,"ipv4",s.message,e),s.version!=="v4"&&Zt(t,"ipv6",s.message,e);break}case"emoji":qt(t,Rs.emoji,s.message,e);break;case"ulid":{qt(t,Rs.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Zt(t,"binary",s.message,e);break}case"contentEncoding:base64":{oe(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{qt(t,Rs.base64,s.message,e);break}}break}case"nanoid":qt(t,Rs.nanoid,s.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}var PT=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Zt=(r,e,t,n)=>{r.format||r.anyOf?.some(s=>s.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):oe(r,"format",e,t,n)},qt=(r,e,t,n)=>{r.pattern||r.allOf?.some(s=>s.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:ub(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):oe(r,"pattern",ub(e,n),t,n)},ub=(r,e)=>{let t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;let n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=n.i?t.source.toLowerCase():t.source,i="",a=!1,o=!1,u=!1;for(let c=0;c<s.length;c++){if(a){i+=s[c],a=!1;continue}if(n.i){if(o){if(s[c].match(/[a-z]/)){u?(i+=s[c],i+=`${s[c-2]}-${s[c]}`.toUpperCase(),u=!1):s[c+1]==="-"&&s[c+2]?.match(/[a-z]/)?(i+=s[c],u=!0):i+=`${s[c]}${s[c].toUpperCase()}`;continue}}else if(s[c].match(/[a-z]/)){i+=`[${s[c]}${s[c].toUpperCase()}]`;continue}}if(n.m){if(s[c]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(s[c]==="$"){i+=`($|(?=[\r
]))`;continue}}if(n.s&&s[c]==="."){i+=o?`${s[c]}\r
`:`[${s[c]}\r
]`;continue}i+=s[c],s[c]==="\\"?a=!0:o&&s[c]==="]"?o=!1:!o&&s[c]==="["&&(o=!0)}try{let c=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function vc(r,e){if(e.target==="openApi3"&&r.keyType?._def.typeName===b.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((n,s)=>({...n,[s]:B(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",s]})??{}}),{}),additionalProperties:!1};let t={type:"object",additionalProperties:B(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(r.keyType?._def.typeName===b.ZodString&&r.keyType._def.checks?.length){let n=Object.entries(xc(r.keyType._def,e)).reduce((s,[i,a])=>i==="type"?s:{...s,[i]:a},{});return{...t,propertyNames:n}}else if(r.keyType?._def.typeName===b.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function cb(r,e){if(e.mapStrategy==="record")return vc(r,e);let t=B(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=B(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function lb(r){let e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function db(){return{not:{}}}function fb(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var oo={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function hb(r,e){if(e.target==="openApi3")return pb(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in oo&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((s,i)=>{let a=oo[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((s,i)=>{let a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){let s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return pb(r,e)}var pb=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>B(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function mb(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:oo[r.innerType._def.typeName],nullable:!0}:{type:[oo[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=B(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let t=B(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function gb(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",bf(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?oe(t,"minimum",n.value,n.message,e):oe(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),oe(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?oe(t,"maximum",n.value,n.message,e):oe(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),oe(t,"maximum",n.value,n.message,e));break;case"multipleOf":oe(t,"multipleOf",n.value,n.message,e);break}return t}function ST(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":B(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":B(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function _b(r,e){let t={type:"object",...Object.entries(r.shape()).reduce((n,[s,i])=>{if(i===void 0||i._def===void 0)return n;let a=[...e.currentPath,"properties",s],o=B(i._def,{...e,currentPath:a,propertyPath:a});return o===void 0?n:(e.openaiStrictMode&&i.isOptional()&&!i.isNullable()&&console.warn(`Zod field at \`${a.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required
This will become an error in a future version of the SDK.`),{properties:{...n.properties,[s]:o},required:i.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,s]})},{properties:{},required:[]}),additionalProperties:ST(r,e)};return t.required.length||delete t.required,t}var yb=(r,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return B(r.innerType._def,e);let t=B(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}};var bb=(r,e)=>{if(e.pipeStrategy==="input")return B(r.in._def,e);if(e.pipeStrategy==="output")return B(r.out._def,e);let t=B(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=B(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function wb(r,e){return B(r.type._def,e)}function xb(r,e){let n={type:"array",uniqueItems:!0,items:B(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&oe(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&oe(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function vb(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>B(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:B(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>B(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function Ab(){return{not:{}}}function Eb(){return{}}var Ob=(r,e)=>B(r.innerType._def,e);function B(r,e,t=!1){let n=e.seen.get(r);if(e.override){let a=e.override?.(r,e,n,t);if(a!==Vy)return a}if(n&&!t){let a=kT(n,e);if(a!==void 0)return"$ref"in a&&e.seenRefs.add(a.$ref),a}let s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);let i=NT(r,r.typeName,e,t);return i&&CT(r,e,i),s.jsonSchema=i,i}var kT=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":let t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:RT(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,s)=>e.currentPath[s]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},RT=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},NT=(r,e,t,n)=>{switch(e){case b.ZodString:return xc(r,t);case b.ZodNumber:return gb(r,t);case b.ZodObject:return _b(r,t);case b.ZodBigInt:return Qy(r,t);case b.ZodBoolean:return eb();case b.ZodDate:return wf(r,t);case b.ZodUndefined:return Ab();case b.ZodNull:return fb(t);case b.ZodArray:return Xy(r,t);case b.ZodUnion:case b.ZodDiscriminatedUnion:return hb(r,t);case b.ZodIntersection:return ab(r,t);case b.ZodTuple:return vb(r,t);case b.ZodRecord:return vc(r,t);case b.ZodLiteral:return ob(r,t);case b.ZodEnum:return ib(r);case b.ZodNativeEnum:return lb(r);case b.ZodNullable:return mb(r,t);case b.ZodOptional:return yb(r,t);case b.ZodMap:return cb(r,t);case b.ZodSet:return xb(r,t);case b.ZodLazy:return B(r.getter()._def,t);case b.ZodPromise:return wb(r,t);case b.ZodNaN:case b.ZodNever:return db();case b.ZodEffects:return sb(r,t,n);case b.ZodAny:return Yy();case b.ZodUnknown:return Eb();case b.ZodDefault:return nb(r,t);case b.ZodBranded:return tb(r,t);case b.ZodReadonly:return Ob(r,t);case b.ZodCatch:return rb(r,t);case b.ZodPipeline:return bb(r,t);case b.ZodFunction:case b.ZodVoid:case b.ZodSymbol:return;default:return(s=>{})(e)}},CT=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var Ib=(r,e)=>{let t=Wy(e),n=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=B(r._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i);let a=(()=>{if(Jy(t.definitions))return;let u={},c=new Set;for(let l=0;l<500;l++){let d=Object.entries(t.definitions).filter(([f])=>!c.has(f));if(d.length===0)break;for(let[f,p]of d)u[f]=B(ao(p),{...t,currentPath:[...t.basePath,t.definitionPath,f]},!0)??{},c.add(f)}return u})(),o=n===void 0?a?{...s,[t.definitionPath]:a}:s:t.nameStrategy==="duplicate-ref"?{...s,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[n]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...a,[n]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function Tb(r,e){return Ib(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function Pb(r,e,t){return vy({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:Tb(r,{name:e})}},n=>r.parse(JSON.parse(n)))}function Sb(r){return Ay({type:"function",function:{name:r.name,parameters:Tb(r.parameters,{name:r.name}),strict:!0,...r.description?{description:r.description}:void 0}},{callback:r.function,parser:e=>r.parameters.parse(JSON.parse(e))})}function On(r){let{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=r;if((n||a)&&s&&e)return`${s}/${e}`;if((n||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(n||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function vf(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function Af(r){return r!==void 0&&de.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function Ef(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&(ns(r.schema)||r.schema!=null&&typeof r.schema=="object"&&"type"in r.schema&&typeof r.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(r.schema.type))}function uo(r){return Ef(r)||Af(r)||vf(r)}function Of(r,e){let t=typeof e=="number"?void 0:e;return{name:r.name,description:r.description,parameters:nn(r.schema),...t?.strict!==void 0?{strict:t.strict}:{}}}function co(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Ns(r){let e;return r.constructor.name===Mt.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===ge.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=co(r,"INVALID_TOOL_RESULTS"):r.status===401?e=co(r,"MODEL_AUTHENTICATION"):r.status===429?e=co(r,"MODEL_RATE_LIMIT"):r.status===404?e=co(r,"MODEL_NOT_FOUND"):e=r,e}function kb(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function $T(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function Rb(r){let e=["namespace functions {",""];for(let t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(Nb(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function Nb(r,e){let t=[];for(let[n,s]of Object.entries(r.properties??{}))s.description&&e<2&&t.push(`// ${s.description}`),r.required?.includes(n)?t.push(`${n}: ${Ac(s,e)},`):t.push(`${n}?: ${Ac(s,e)},`);return t.map(n=>" ".repeat(e)+n).join(`
`)}function Ac(r,e){if($T(r))return r.anyOf.map(t=>Ac(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",Nb(r,e+2),"}"].join(`
`);case"array":return r.items?`${Ac(r.items,e)}[]`:"any[]";default:return""}}function Cb(r,e){let t;if(uo(r)){let n=Sb({name:r.name,parameters:r.schema,description:r.description});n.function.parameters?t={type:n.type,function:{name:n.function.name,description:n.function.description,parameters:n.function.parameters,...e?.strict!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:Of(r,e)}}else t=r;return e?.strict!==void 0&&(t.function.strict=e.strict),t}function jT(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function jb(r){let e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Br.isInstance(r))throw new Error("Invalid generic chat message");return jT(r)}default:throw new Error(`Unknown message type: ${e}`)}}function MT(r,e,t){let n=r.tool_calls;switch(r.role){case"assistant":{let s=[],i=[];for(let u of n??[])try{s.push(yf(u,{returnId:!0}))}catch(c){i.push(Gy(u,c.message))}let a={function_call:r.function_call,tool_calls:n};t!==void 0&&(a.__raw_response=e);let o={model_name:e.model,...e.system_fingerprint?{usage:{...e.usage},system_fingerprint:e.system_fingerprint}:{}};return r.audio&&(a.audio=r.audio),new mt({content:r.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:e.id})}default:return new Br(r.content||"",r.role??"unknown")}}function LT(r,e,t,n){let s=r.role??t,i=r.content??"",a;r.function_call?a={function_call:r.function_call}:r.tool_calls?a={tool_calls:r.tool_calls}:a={},n&&(a.__raw_response=e),r.audio&&(a.audio={...r.audio,index:e.choices[0].index});let o={usage:{...e.usage}};if(s==="user")return new Rn({content:i,response_metadata:o});if(s==="assistant"){let u=[];if(Array.isArray(r.tool_calls))for(let c of r.tool_calls)u.push({name:c.function?.name,args:c.function?.arguments,id:c.id,index:c.index,type:"tool_call_chunk"});return new gt({content:i,tool_call_chunks:u,additional_kwargs:a,id:e.id,response_metadata:o})}else return s==="system"?new qr({content:i,response_metadata:o}):s==="developer"?new qr({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new kn({content:i,additional_kwargs:a,name:r.name,response_metadata:o}):s==="tool"?new zs({content:i,additional_kwargs:a,tool_call_id:r.tool_call_id,response_metadata:o}):new Sn({content:i,role:s,response_metadata:o})}function If(r,e){return r.flatMap(t=>{let n=jb(t);n==="system"&&e?.startsWith("o1")&&(n="developer");let s={role:n,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=null),Pn(t)&&t.tool_calls?.length?(s.tool_calls=t.tool_calls.map(qy),s.content=null):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){let i={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,i]}return s})}function $b(r,e){return Zy(r)?e?.strict!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:Cb(r,e)}var lo=class extends wc{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIEndpoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.apiKey??e?.openAIApiKey??e?.configuration?.apiKey??pe("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=e?.azureOpenAIApiKey??pe("AZURE_OPENAI_API_KEY"),this.azureADTokenProvider=e?.azureADTokenProvider??void 0,!this.azureOpenAIApiKey&&!this.apiKey&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??pe("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??pe("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??pe("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??pe("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??pe("OPENAI_ORGANIZATION"),this.azureOpenAIEndpoint=e?.azureOpenAIEndpoint??pe("AZURE_OPENAI_ENDPOINT"),this.modelName=e?.model??e?.modelName??this.model,this.model=this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this?.stop,this.user=e?.user,this.__includeRawResponse=e?.__includeRawResponse,this.audio=e?.audio,this.modalities=e?.modalities,this.reasoningEffort=e?.reasoningEffort,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath&&!this.azureOpenAIEndpoint)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName&&this.azureOpenAIBasePath){let n=this.azureOpenAIBasePath.split("/openai/deployments/");if(n.length===2){let[,s]=n;this.azureOpenAIApiDeploymentName=s}}if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??"",this.streamUsage=!1}this.model==="o1"&&(this.disableStreaming=!0),this.streaming=e?.streaming??!1,this.streamUsage=e?.streamUsage??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration},e?.supportsStrictToolCalling!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return t?.strict!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>$b(s,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Ec(e.json_schema.schema)?Pb(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){let n;e?.strict!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling);let s={};e?.stream_options!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t?.streaming)&&(s={stream_options:{include_usage:!0}});let i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:e?.tools?.length?e.tools.map(o=>$b(o,{strict:n})):void 0,tool_choice:kb(e?.tool_choice),response_format:this.createResponseFormat(e?.response_format),seed:e?.seed,...s,parallel_tool_calls:e?.parallel_tool_calls,...this.audio||e?.audio?{audio:this.audio||e?.audio}:{},...this.modalities||e?.modalities?{modalities:this.modalities||e?.modalities}:{},...this.modelKwargs};e?.prediction!==void 0&&(i.prediction=e.prediction);let a=e?.reasoning_effort??this.reasoningEffort;return a!==void 0&&(i.reasoning_effort=a),i}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){let s=If(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0},a,o=await this.completionWithRetry(i,t),u;for await(let c of o){let l=c?.choices?.[0];if(c.usage&&(u=c.usage),!l)continue;let{delta:d}=l;if(!d)continue;let f=LT(d,c,a,this.__includeRawResponse);a=d.role??a;let p={prompt:t.promptIndex??0,completion:l.index??0};if(typeof f.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let h={...p};l.finish_reason!=null&&(h.finish_reason=l.finish_reason,h.system_fingerprint=c.system_fingerprint,h.model_name=c.model),this.logprobs&&(h.logprobs=l.logprobs);let m=new en({message:f,text:f.content,generationInfo:h});yield m,await n?.handleLLMNewToken(m.text??"",p,void 0,void 0,void 0,{chunk:m})}if(u){let c={...u.prompt_tokens_details?.audio_tokens!==null&&{audio:u.prompt_tokens_details?.audio_tokens},...u.prompt_tokens_details?.cached_tokens!==null&&{cache_read:u.prompt_tokens_details?.cached_tokens}},l={...u.completion_tokens_details?.audio_tokens!==null&&{audio:u.completion_tokens_details?.audio_tokens},...u.completion_tokens_details?.reasoning_tokens!==null&&{reasoning:u.completion_tokens_details?.reasoning_tokens}};yield new en({message:new gt({content:"",response_metadata:{usage:{...u}},usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens,...Object.keys(c).length>0&&{input_token_details:c},...Object.keys(l).length>0&&{output_token_details:l}}}),text:""})}if(t.signal?.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,n){let s={},i=this.invocationParams(t),a=If(e,this.model);if(i.stream){let o=this._streamResponseChunks(e,t,n),u={};for await(let h of o){h.message.response_metadata={...h.generationInfo,...h.message.response_metadata};let m=h.generationInfo?.completion??0;u[m]===void 0?u[m]=h:u[m]=u[m].concat(h)}let c=Object.entries(u).sort(([h],[m])=>parseInt(h,10)-parseInt(m,10)).map(([h,m])=>m),{functions:l,function_call:d}=this.invocationParams(t),f=await this.getEstimatedTokenCountFromPrompt(e,l,d),p=await this.getNumTokensFromGenerations(c);return s.input_tokens=f,s.output_tokens=p,s.total_tokens=f+p,{generations:c,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let o;t.response_format&&t.response_format.type==="json_schema"?o=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:a},{signal:t?.signal,...t?.options}):o=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t?.signal,...t?.options});let{completion_tokens:u,prompt_tokens:c,total_tokens:l,prompt_tokens_details:d,completion_tokens_details:f}=o?.usage??{};u&&(s.output_tokens=(s.output_tokens??0)+u),c&&(s.input_tokens=(s.input_tokens??0)+c),l&&(s.total_tokens=(s.total_tokens??0)+l),(d?.audio_tokens!==null||d?.cached_tokens!==null)&&(s.input_token_details={...d?.audio_tokens!==null&&{audio:d?.audio_tokens},...d?.cached_tokens!==null&&{cache_read:d?.cached_tokens}}),(f?.audio_tokens!==null||f?.reasoning_tokens!==null)&&(s.output_token_details={...f?.audio_tokens!==null&&{audio:f?.audio_tokens},...f?.reasoning_tokens!==null&&{reasoning:f?.reasoning_tokens}});let p=[];for(let h of o?.choices??[]){let g={text:h.message?.content??"",message:MT(h.message??{role:"assistant"},o,this.__includeRawResponse)};g.generationInfo={...h.finish_reason?{finish_reason:h.finish_reason}:{},...h.logprobs?{logprobs:h.logprobs}:{}},Pn(g.message)&&(g.message.usage_metadata=s),g.message=new mt(Object.fromEntries(Object.entries(g.message).filter(([y])=>!y.startsWith("lc_")))),p.push(g)}return{generations:p,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){let i=Rb(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>n.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.model==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);let i=await Promise.all(e.map(async a=>{let o=await this.getNumTokens(a.content),u=await this.getNumTokens(jb(a)),c=a.name!==void 0?s+await this.getNumTokens(a.name):0,l=o+n+u+c,d=a;if(d._getType()==="function"&&(l-=2),d.additional_kwargs?.function_call&&(l+=3),d?.additional_kwargs.function_call?.name&&(l+=await this.getNumTokens(d.additional_kwargs.function_call?.name)),d.additional_kwargs.function_call?.arguments)try{l+=await this.getNumTokens(JSON.stringify(JSON.parse(d.additional_kwargs.function_call?.arguments)))}catch(f){console.error("Error parsing function arguments",f,JSON.stringify(d.additional_kwargs.function_call)),l+=await this.getNumTokens(d.additional_kwargs.function_call?.arguments)}return t+=l,l}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){let n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw Ns(s)}})}async betaParsedCompletionWithRetry(e,t){let n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(s){throw Ns(s)}})}_getClientOptions(e){if(!this.client){let n={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL,azureOpenAIEndpoint:this.azureOpenAIEndpoint},s=On(n),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new q(i)}let t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,s,i,a;zT(e)?(n=e.schema,s=e.name,i=e.method,a=e.includeRaw):(n=e,s=t?.name,i=t?.method,a=t?.includeRaw);let o,u;if(t?.strict!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Ec(n)?u=no.fromZodSchema(n):u=new so;else if(i==="jsonSchema")o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:n.description,schema:n,strict:t?.strict}}}),Ec(n)?u=no.fromZodSchema(n):u=new so;else{let f=s??"extract";if(Ec(n)){let p=si(n);o=this.bind({tools:[{type:"function",function:{name:f,description:p.description,parameters:p}}],tool_choice:{type:"function",function:{name:f}},...t?.strict!==void 0?{strict:t.strict}:{}}),u=new io({returnSingle:!0,keyName:f,zodSchema:n})}else{let p;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(p=n,f=n.name):(f=n.title??f,p={name:f,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:p}],tool_choice:{type:"function",function:{name:f}},...t?.strict!==void 0?{strict:t.strict}:{}}),u=new io({returnSingle:!0,keyName:f})}}if(!a)return o.pipe(u);let c=mr.assign({parsed:(f,p)=>u.invoke(f.raw,p)}),l=mr.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[l]});return kr.from([{raw:o},d])}};function Ec(r){return typeof r?.parse=="function"}function zT(r){return r!==void 0&&typeof r.schema=="object"}var Tf=class extends to{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),Object.defineProperty(this,"defaultConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat,this.defaultConfig=e?.defaultConfig??this.defaultConfig,this.metadata=e?.metadata??this.metadata}async invoke(e,t){let n,s=ie(Qs(this.defaultConfig,t));return Gr(e)?(n=e.args,s={...s,toolCall:e}):n=e,this.call(n,s)}async call(e,t,n){let s=Gr(e)?e.args:e,i;if(ns(this.schema))try{i=await oi(this.schema,s)}catch(h){let m="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(m=`${m}
Details: ${h.message}`),new Nn(m,JSON.stringify(e))}else{let h=he(s,this.schema);if(!h.valid){let m="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(m=`${m}
Details: ${h.errors.map(g=>`${g.keywordLocation}: ${g.error}`).join(`
`)}`),new Nn(m,JSON.stringify(e))}i=s}let a=Cg(t),u=await $e.configure(a.callbacks,this.callbacks,a.tags||n,this.tags,a.metadata,this.metadata,{verbose:this.verbose})?.handleToolStart(this.toJSON(),typeof e=="string"?e:JSON.stringify(e),a.runId,void 0,void 0,void 0,a.runName);delete a.runId;let c;try{c=await this._call(i,u,a)}catch(h){throw await u?.handleToolError(h),h}let l,d;if(this.responseFormat==="content_and_artifact")if(Array.isArray(c)&&c.length===2)[l,d]=c;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(c)}`);else l=c;let f;Gr(e)&&(f=e.id),!f&&sp(a)&&(f=a.toolCall.id);let p=UT({content:l,artifact:d,toolCallId:f,name:this.name,metadata:this.metadata});return await u?.handleToolEnd(p),p}},Oc=class extends Tf{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:at.object({input:at.string().optional()}).transform(t=>t.input)})}call(e,t){let n=typeof e=="string"||e==null?{input:e}:e;return super.call(n,t)}};function UT(r){let{content:e,artifact:t,toolCallId:n,metadata:s}=r;return n&&!rp(e)?typeof e=="string"||Array.isArray(e)&&e.every(i=>typeof i=="object")?new yr({status:"success",content:e,artifact:t,tool_call_id:n,name:r.name,metadata:s}):new yr({status:"success",content:FT(e),artifact:t,tool_call_id:n,name:r.name,metadata:s}):e}function FT(r){try{return JSON.stringify(r,null,2)??""}catch{return`${r}`}}var Pf=class extends Oc{static lc_name(){return"DallEAPIWrapper"}constructor(e){e?.responseFormat!==void 0&&["url","b64_json"].includes(e.responseFormat)&&(e.dallEResponseFormat=e.responseFormat,e.responseFormat="content"),super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"dallEResponseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=e?.apiKey??e?.openAIApiKey??pe("OPENAI_API_KEY"),n=e?.organization??pe("OPENAI_ORGANIZATION"),s={apiKey:t,organization:n,dangerouslyAllowBrowser:!0,baseUrl:e?.baseUrl};this.client=new q(s),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.dallEResponseFormat=e?.dallEResponseFormat??this.dallEResponseFormat,this.user=e?.user}processMultipleGeneratedUrls(e){return this.dallEResponseFormat==="url"?e.flatMap(t=>t.data.flatMap(s=>s.url?{type:"image_url",image_url:s.url}:[]).filter(s=>s!==void 0&&s.type==="image_url"&&typeof s.image_url=="string"&&s.image_url!==void 0)):e.flatMap(t=>t.data.flatMap(s=>s.b64_json?{type:"image_url",image_url:{url:s.b64_json}}:[]).filter(s=>s!==void 0&&s.type==="image_url"&&typeof s.image_url=="object"&&"url"in s.image_url&&typeof s.image_url.url=="string"&&s.image_url.url!==void 0))}async _call(e){let t={model:this.model,prompt:e,n:1,size:this.size,response_format:this.dallEResponseFormat,style:this.style,quality:this.quality,user:this.user};if(this.n>1){let i=await Promise.all(Array.from({length:this.n}).map(()=>this.client.images.generate(t)));return this.processMultipleGeneratedUrls(i)}let n=await this.client.images.generate(t),s="";return this.dallEResponseFormat==="url"?[s]=n.data.map(i=>i.url).filter(i=>i!=="undefined"):[s]=n.data.map(i=>i.b64_json).filter(i=>i!=="undefined"),s}};Object.defineProperty(Pf,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});var Cs={MAX_SEGMENTS_PER_CHUNK:50,CHUNK_SENTINEL:"<<<__CHUNK_END__>>>",MODEL:"google/gemini-2.5-flash-lite-preview-09-2025"};function zb(r,e){let t=[],n=r.length,s=0;for(;s<n;){let i=Math.min(s+e,n);t.push([s,i]),s=i}return t}function Mb(r){let e=r.split(/\s+/).join(" "),t=e.match(/\[([^\]]+)\]\s*(.*)/);return t?t[2].trim():e.trim()}function BT(r,e){if(!r||!e)return 0;let t=ZT(r,e),n=new Set(r.toLowerCase().match(/[A-Za-z0-9']+/g)||[]),s=new Set(e.toLowerCase().match(/[A-Za-z0-9']+/g)||[]),i=new Set([...n].filter(u=>s.has(u))),a=new Set([...n,...s]),o=a.size>0?i.size/a.size:0;return .7*t+.3*o}function ZT(r,e){if(r===e)return 1;if(!r||!e)return 0;let t=r.length,n=e.length,s=Math.max(t,n);if(s===0)return 1;let i=0,a=Math.min(t,n);for(let o=0;o<a;o++)r[o]===e[o]&&i++;return i/s}function Lb(r,e,t=!1){let a=r.length,o=e.length;if(a===0)return[];let u=Array(a+1).fill(null).map(()=>Array(o+1).fill(-1/0)),c=Array(a+1).fill(null).map(()=>Array(o+1).fill(null));u[0][0]=0;for(let m=1;m<=a;m++)u[m][0]=u[m-1][0]+-.3,c[m][0]="O";for(let m=1;m<=o;m++)u[0][m]=u[0][m-1]+-.3,c[0][m]="R";for(let m=1;m<=a;m++){let g=r[m-1].text||"";for(let y=1;y<=o;y++){let _=e[y-1]||"",A=u[m-1][y-1]+BT(g,_),E="M",z=u[m-1][y]+-.3;z>A&&(A=z,E="O");let F=u[m][y-1]+-.3;F>A&&(A=F,E="R"),u[m][y]=A,c[m][y]=E}}let l=Array(a).fill(null),d=a,f=o;for(;d>0||f>0;){let m=d>=0&&f>=0?c[d][f]:null;if(m==="M"&&d>0&&f>0)l[d-1]=f-1,d--,f--;else if(m==="O"&&d>0)l[d-1]=null,d--;else if(m==="R"&&f>0)f--;else if(d>0)l[d-1]=null,d--;else if(f>0)f--;else break}let p=[],h=t?a-5:a+1;for(let m=0;m<r.length;m++){let g=r[m],y=l[m],_;if(y!==null&&y>=0&&y<o?_=e[y]:_=g.text,m>=h&&_){let w=g.text?.length||1;Math.abs(_.length-w)/w>.1&&(_=g.text)}_||(_=g.text),p.push({text:_,startMs:g.startMs,endMs:g.endMs,startTimeText:g.startTimeText})}return p}function qT(r,e){if(!r)return[];function t(){let s=r.split(Cs.CHUNK_SENTINEL),i=zb(e,Cs.MAX_SEGMENTS_PER_CHUNK);for(;s.length<i.length;)s.push("");let a=[];for(let o=0;o<i.length;o++){let[u,c]=i[o],l=s[o]||"",d=e.slice(u,c),p=l.trim().split(`
`).filter(h=>h).map(h=>h.split(/\s+/).join(" ")).map(h=>Mb(h)).filter(h=>h);p.length!==d.length&&console.warn(`Parser chunk warning: expected ${d.length} lines, got ${p.length}`),a.push(...Lb(d,p,!0))}return a}function n(){let s=r.trim().split(`
`).map(i=>Mb(i)).filter(i=>i);return s.length!==e.length&&console.warn(`Parser warning: Expected ${e.length} lines, got ${s.length} lines`),Lb(e,s,!1)}return r.includes(Cs.CHUNK_SENTINEL)?t():n()}async function GT(r,e,t,n,s=null,i=Cs.MODEL){if(!r||r.length===0)return[];let a=typeof chrome<"u"&&chrome.runtime?chrome.runtime.getURL(""):"https://github.com/better-youtube-caption",o=new lo({model:i,apiKey:n,configuration:{baseURL:"https://openrouter.ai/api/v1",defaultHeaders:{"HTTP-Referer":a,"X-Title":"Better YouTube Caption"}},temperature:0}),u=`You are correcting segments of a YouTube video transcript. These segments could be from anywhere in the video (beginning, middle, or end). Use the video title and description for context.

CRITICAL CONSTRAINTS:
- Only fix typos and grammar. Do NOT change meaning or structure.
- PRESERVE ALL NEWLINES: each line is a distinct transcript segment.
- Do NOT add, remove, or merge lines. Keep the same number of lines.
- MAINTAIN SIMILAR LINE LENGTHS: Each output line should be approximately the same character count as its corresponding input line (\xB110% tolerance). Do NOT expand short lines into long paragraphs. Do NOT condense long lines significantly. Keep each line concise.
- If a sentence is broken across lines, keep it broken the same way.
- PRESERVE THE ORIGINAL LANGUAGE: output must be in the same language as the input transcript.
- Focus on minimal corrections: fix typos, correct grammar errors, but keep expansions/additions to an absolute minimum.

EXAMPLES OF CORRECT BEHAVIOR:

Input:
up to 900. From 900 up to 1,100.
If you sold at the reasonable
valuations, when the gains that already
been had, you missed out big time. I

Output:
up to $900. From $900 up to $1,100.
If you sold at the reasonable
valuations, when the gains that already
had been had, you missed out big time. I`;function c(_,w){return[`Video Title: ${_||""}`,`Video Description: ${w||""}`,"","Transcript Chunk:"].join(`
`)}let l=c(e,t),d=zb(r,Cs.MAX_SEGMENTS_PER_CHUNK),f=[],p=[];for(let _=0;_<d.length;_++){let[w,A]=d[_],E=r.slice(w,A),z=E.length,F=E.map(ee=>(ee.text||"").split(/\s+/).join(" ")).join(`
`),G=[new Zr({content:u}),new it({content:`${l}
${F}`})];f.push(G),p.push({chunkIdx:_+1,startIdx:w,endIdx:A,expectedLineCount:z})}s&&s(0,f.length);let h=await o.batch(f),m=[];for(let _=0;_<h.length;_++){let w=h[_],A=p[_],E=A.chunkIdx,z=A.expectedLineCount,G=w.content.trim().split(`
`),ee=G.length;s&&s(E,f.length),ee!==z&&console.warn(`WARNING: Line count mismatch in chunk ${E}! Expected ${z}, got ${ee}`),m.push(...G),m.push(Cs.CHUNK_SENTINEL)}let g=m.join(`
`);return qT(g,r)}typeof globalThis<"u"&&(globalThis.refineTranscriptWithLLM=GT,globalThis.REFINER_CONFIG=Cs);})();
/*! Bundled license information:

@langchain/core/dist/utils/fast-json-patch/src/helpers.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

@langchain/core/dist/utils/fast-json-patch/src/duplex.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2013-2021 Joachim Wester
   * MIT license
   *)

@langchain/core/dist/utils/js-sha1/hash.js:
  (*
   * [js-sha1]{@link https://github.com/emn178/js-sha1}
   *
   * @version 0.6.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   *)

@langchain/core/dist/utils/js-sha256/hash.js:
  (**
   * [js-sha256]{@link https://github.com/emn178/js-sha256}
   *
   * @version 0.11.1
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2025
   * @license MIT
   *)
*/
//# sourceMappingURL=captionRefiner.bundle.js.map
