var BetterYouTubeCaption=(()=>{var Hb=Object.create;var ia=Object.defineProperty;var Vb=Object.getOwnPropertyDescriptor;var Kb=Object.getOwnPropertyNames;var Jb=Object.getPrototypeOf,Wb=Object.prototype.hasOwnProperty;var Yb=(r,e,t)=>e in r?ia(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var j=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Cc=(r,e)=>{for(var t in e)ia(r,t,{get:e[t],enumerable:!0})},Ff=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Kb(e))!Wb.call(r,s)&&s!==t&&ia(r,s,{get:()=>e[s],enumerable:!(n=Vb(e,s))||n.enumerable});return r};var It=(r,e,t)=>(t=r!=null?Hb(Jb(r)):{},Ff(e||!r||!r.__esModule?ia(t,"default",{value:r,enumerable:!0}):t,r)),Xb=r=>Ff(ia({},"__esModule",{value:!0}),r);var _r=(r,e,t)=>Yb(r,typeof e!="symbol"?e+"":e,t);var Zf=j((XT,Bf)=>{"use strict";Bf.exports=function(r,e){if(typeof r!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,r.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var Wf=j((QT,jc)=>{"use strict";var Qb=/[\p{Lu}]/u,ew=/[\p{Ll}]/u,qf=/^[\p{Lu}](?![\p{Lu}])/gu,Vf=/([\p{Alpha}\p{N}_]|$)/u,Kf=/[_.\- ]+/,tw=new RegExp("^"+Kf.source),Gf=new RegExp(Kf.source+Vf.source,"gu"),Hf=new RegExp("\\d+"+Vf.source,"gu"),rw=(r,e,t)=>{let n=!1,s=!1,i=!1;for(let a=0;a<r.length;a++){let o=r[a];n&&Qb.test(o)?(r=r.slice(0,a)+"-"+r.slice(a),n=!1,i=s,s=!0,a++):s&&i&&ew.test(o)?(r=r.slice(0,a-1)+"-"+r.slice(a-1),i=s,s=!1,n=!0):(n=e(o)===o&&t(o)!==o,i=s,s=t(o)===o&&e(o)!==o)}return r},nw=(r,e)=>(qf.lastIndex=0,r.replace(qf,t=>e(t))),sw=(r,e)=>(Gf.lastIndex=0,Hf.lastIndex=0,r.replace(Gf,(t,n)=>e(n)).replace(Hf,t=>e(t))),Jf=(r,e)=>{if(!(typeof r=="string"||Array.isArray(r)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(r)?r=r.map(i=>i.trim()).filter(i=>i.length).join("-"):r=r.trim(),r.length===0)return"";let t=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),n=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return r.length===1?e.pascalCase?n(r):t(r):(r!==t(r)&&(r=rw(r,t,n)),r=r.replace(tw,""),e.preserveConsecutiveUppercase?r=nw(r,t):r=t(r),e.pascalCase&&(r=n(r.charAt(0))+r.slice(1)),sw(r,n))};jc.exports=Jf;jc.exports.default=Jf});var vp=j((uS,xp)=>{function wt(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}xp.exports=wt;wt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};wt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};wt.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};wt.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};wt.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};wt.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};wt.prototype.start=wt.prototype.try;wt.prototype.errors=function(){return this._errors};wt.prototype.attempts=function(){return this._attempts};wt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var s=this._errors[n],i=s.message,a=(r[i]||0)+1;r[i]=a,a>=t&&(e=s,t=a)}return e}});var Ap=j(Wn=>{var xx=vp();Wn.operation=function(r){var e=Wn.timeouts(r);return new xx(e,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};Wn.timeouts=function(r){if(r instanceof Array)return[].concat(r);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in r)e[t]=r[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],s=0;s<e.retries;s++)n.push(this.createTimeout(s,e));return r&&r.forever&&!n.length&&n.push(this.createTimeout(s,e)),n.sort(function(i,a){return i-a}),n};Wn.createTimeout=function(r,e){var t=e.randomize?Math.random()+1:1,n=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,r));return n=Math.min(n,e.maxTimeout),n};Wn.wrap=function(r,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var n in r)typeof r[n]=="function"&&t.push(n)}for(var s=0;s<t.length;s++){var i=t[s],a=r[i];r[i]=function(u){var c=Wn.operation(e),d=Array.prototype.slice.call(arguments,1),l=d.pop();d.push(function(f){c.retry(f)||(f&&(arguments[0]=c.mainError()),l.apply(this,arguments))}),c.attempt(function(){u.apply(r,d)})}.bind(r,a),r[i].options=e}}});var Op=j((lS,Ep)=>{Ep.exports=Ap()});var To=j((dS,Io)=>{"use strict";var vx=Op(),Ax=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Oo=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},Ex=(r,e,t)=>{let n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r},Ox=r=>Ax.includes(r),Ip=(r,e)=>new Promise((t,n)=>{e={onFailedAttempt:()=>{},retries:10,...e};let s=vx.operation(e);s.attempt(async i=>{try{t(await r(i))}catch(a){if(!(a instanceof Error)){n(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof Oo)s.stop(),n(a.originalError);else if(a instanceof TypeError&&!Ox(a.message))s.stop(),n(a);else{Ex(a,i,e);try{await e.onFailedAttempt(a)}catch(o){n(o);return}s.retry(a)||n(s.mainError())}}})});Io.exports=Ip;Io.exports.default=Ip;Io.exports.AbortError=Oo});var gh=j((dk,ml)=>{"use strict";var tv=Object.prototype.hasOwnProperty,qe="~";function ma(){}Object.create&&(ma.prototype=Object.create(null),new ma().__proto__||(qe=!1));function rv(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function mh(r,e,t,n,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new rv(t,n||r,s),a=qe?qe+e:e;return r._events[a]?r._events[a].fn?r._events[a]=[r._events[a],i]:r._events[a].push(i):(r._events[a]=i,r._eventsCount++),r}function Go(r,e){--r._eventsCount===0?r._events=new ma:delete r._events[e]}function De(){this._events=new ma,this._eventsCount=0}De.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)tv.call(t,n)&&e.push(qe?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};De.prototype.listeners=function(e){var t=qe?qe+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,i=n.length,a=new Array(i);s<i;s++)a[s]=n[s].fn;return a};De.prototype.listenerCount=function(e){var t=qe?qe+e:e,n=this._events[t];return n?n.fn?1:n.length:0};De.prototype.emit=function(e,t,n,s,i,a){var o=qe?qe+e:e;if(!this._events[o])return!1;var u=this._events[o],c=arguments.length,d,l;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,s),!0;case 5:return u.fn.call(u.context,t,n,s,i),!0;case 6:return u.fn.call(u.context,t,n,s,i,a),!0}for(l=1,d=new Array(c-1);l<c;l++)d[l-1]=arguments[l];u.fn.apply(u.context,d)}else{var f=u.length,p;for(l=0;l<f;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,n);break;case 4:u[l].fn.call(u[l].context,t,n,s);break;default:if(!d)for(p=1,d=new Array(c-1);p<c;p++)d[p-1]=arguments[p];u[l].fn.apply(u[l].context,d)}}return!0};De.prototype.on=function(e,t,n){return mh(this,e,t,n,!1)};De.prototype.once=function(e,t,n){return mh(this,e,t,n,!0)};De.prototype.removeListener=function(e,t,n,s){var i=qe?qe+e:e;if(!this._events[i])return this;if(!t)return Go(this,i),this;var a=this._events[i];if(a.fn)a.fn===t&&(!s||a.once)&&(!n||a.context===n)&&Go(this,i);else{for(var o=0,u=[],c=a.length;o<c;o++)(a[o].fn!==t||s&&!a[o].once||n&&a[o].context!==n)&&u.push(a[o]);u.length?this._events[i]=u.length===1?u[0]:u:Go(this,i)}return this};De.prototype.removeAllListeners=function(e){var t;return e?(t=qe?qe+e:e,this._events[t]&&Go(this,t)):(this._events=new ma,this._eventsCount=0),this};De.prototype.off=De.prototype.removeListener;De.prototype.addListener=De.prototype.on;De.prefixed=qe;De.EventEmitter=De;typeof ml<"u"&&(ml.exports=De)});var yh=j((fk,_h)=>{"use strict";_h.exports=(r,e)=>(e=e||(()=>{}),r.then(t=>new Promise(n=>{n(e())}).then(()=>t),t=>new Promise(n=>{n(e())}).then(()=>{throw t})))});var wh=j((pk,Vo)=>{"use strict";var nv=yh(),Ho=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},bh=(r,e,t)=>new Promise((n,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){n(r);return}let i=setTimeout(()=>{if(typeof t=="function"){try{n(t())}catch(u){s(u)}return}let a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Ho(a);typeof r.cancel=="function"&&r.cancel(),s(o)},e);nv(r.then(n,s),()=>{clearTimeout(i)})});Vo.exports=bh;Vo.exports.default=bh;Vo.exports.TimeoutError=Ho});var xh=j(gl=>{"use strict";Object.defineProperty(gl,"__esModule",{value:!0});function sv(r,e,t){let n=0,s=r.length;for(;s>0;){let i=s/2|0,a=n+i;t(r[a],e)<=0?(n=++a,s-=i+1):s=i}return n}gl.default=sv});var vh=j(yl=>{"use strict";Object.defineProperty(yl,"__esModule",{value:!0});var iv=xh(),_l=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let n={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(n);return}let s=iv.default(this._queue,n,(i,a)=>a.priority-i.priority);this._queue.splice(s,0,n)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};yl.default=_l});var Jo=j(wl=>{"use strict";Object.defineProperty(wl,"__esModule",{value:!0});var av=gh(),Ah=wh(),ov=vh(),Ko=()=>{},uv=new Ah.TimeoutError,bl=class extends av{constructor(e){var t,n,s,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Ko,this._resolveIdle=Ko,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:ov.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Ko,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Ko,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((n,s)=>{let i=async()=>{this._pendingCount++,this._intervalCount++;try{let a=this._timeout===void 0&&t.timeout===void 0?e():Ah.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(uv)});n(await a)}catch(a){s(a)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};wl.default=bl});var ya=j((xk,Ih)=>{"use strict";var dv="2.0.0",fv=Number.MAX_SAFE_INTEGER||9007199254740991,pv=16,hv=250,mv=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Ih.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:pv,MAX_SAFE_BUILD_LENGTH:hv,MAX_SAFE_INTEGER:fv,RELEASE_TYPES:mv,SEMVER_SPEC_VERSION:dv,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var ba=j((vk,Th)=>{"use strict";var gv=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};Th.exports=gv});var Ks=j((Yt,Ph)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Al,MAX_SAFE_BUILD_LENGTH:_v,MAX_LENGTH:yv}=ya(),bv=ba();Yt=Ph.exports={};var wv=Yt.re=[],xv=Yt.safeRe=[],P=Yt.src=[],vv=Yt.safeSrc=[],S=Yt.t={},Av=0,El="[a-zA-Z0-9-]",Ev=[["\\s",1],["\\d",yv],[El,_v]],Ov=r=>{for(let[e,t]of Ev)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},X=(r,e,t)=>{let n=Ov(e),s=Av++;bv(r,s,e),S[r]=s,P[s]=e,vv[s]=n,wv[s]=new RegExp(e,t?"g":void 0),xv[s]=new RegExp(n,t?"g":void 0)};X("NUMERICIDENTIFIER","0|[1-9]\\d*");X("NUMERICIDENTIFIERLOOSE","\\d+");X("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${El}*`);X("MAINVERSION",`(${P[S.NUMERICIDENTIFIER]})\\.(${P[S.NUMERICIDENTIFIER]})\\.(${P[S.NUMERICIDENTIFIER]})`);X("MAINVERSIONLOOSE",`(${P[S.NUMERICIDENTIFIERLOOSE]})\\.(${P[S.NUMERICIDENTIFIERLOOSE]})\\.(${P[S.NUMERICIDENTIFIERLOOSE]})`);X("PRERELEASEIDENTIFIER",`(?:${P[S.NONNUMERICIDENTIFIER]}|${P[S.NUMERICIDENTIFIER]})`);X("PRERELEASEIDENTIFIERLOOSE",`(?:${P[S.NONNUMERICIDENTIFIER]}|${P[S.NUMERICIDENTIFIERLOOSE]})`);X("PRERELEASE",`(?:-(${P[S.PRERELEASEIDENTIFIER]}(?:\\.${P[S.PRERELEASEIDENTIFIER]})*))`);X("PRERELEASELOOSE",`(?:-?(${P[S.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${P[S.PRERELEASEIDENTIFIERLOOSE]})*))`);X("BUILDIDENTIFIER",`${El}+`);X("BUILD",`(?:\\+(${P[S.BUILDIDENTIFIER]}(?:\\.${P[S.BUILDIDENTIFIER]})*))`);X("FULLPLAIN",`v?${P[S.MAINVERSION]}${P[S.PRERELEASE]}?${P[S.BUILD]}?`);X("FULL",`^${P[S.FULLPLAIN]}$`);X("LOOSEPLAIN",`[v=\\s]*${P[S.MAINVERSIONLOOSE]}${P[S.PRERELEASELOOSE]}?${P[S.BUILD]}?`);X("LOOSE",`^${P[S.LOOSEPLAIN]}$`);X("GTLT","((?:<|>)?=?)");X("XRANGEIDENTIFIERLOOSE",`${P[S.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);X("XRANGEIDENTIFIER",`${P[S.NUMERICIDENTIFIER]}|x|X|\\*`);X("XRANGEPLAIN",`[v=\\s]*(${P[S.XRANGEIDENTIFIER]})(?:\\.(${P[S.XRANGEIDENTIFIER]})(?:\\.(${P[S.XRANGEIDENTIFIER]})(?:${P[S.PRERELEASE]})?${P[S.BUILD]}?)?)?`);X("XRANGEPLAINLOOSE",`[v=\\s]*(${P[S.XRANGEIDENTIFIERLOOSE]})(?:\\.(${P[S.XRANGEIDENTIFIERLOOSE]})(?:\\.(${P[S.XRANGEIDENTIFIERLOOSE]})(?:${P[S.PRERELEASELOOSE]})?${P[S.BUILD]}?)?)?`);X("XRANGE",`^${P[S.GTLT]}\\s*${P[S.XRANGEPLAIN]}$`);X("XRANGELOOSE",`^${P[S.GTLT]}\\s*${P[S.XRANGEPLAINLOOSE]}$`);X("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Al}})(?:\\.(\\d{1,${Al}}))?(?:\\.(\\d{1,${Al}}))?`);X("COERCE",`${P[S.COERCEPLAIN]}(?:$|[^\\d])`);X("COERCEFULL",P[S.COERCEPLAIN]+`(?:${P[S.PRERELEASE]})?(?:${P[S.BUILD]})?(?:$|[^\\d])`);X("COERCERTL",P[S.COERCE],!0);X("COERCERTLFULL",P[S.COERCEFULL],!0);X("LONETILDE","(?:~>?)");X("TILDETRIM",`(\\s*)${P[S.LONETILDE]}\\s+`,!0);Yt.tildeTrimReplace="$1~";X("TILDE",`^${P[S.LONETILDE]}${P[S.XRANGEPLAIN]}$`);X("TILDELOOSE",`^${P[S.LONETILDE]}${P[S.XRANGEPLAINLOOSE]}$`);X("LONECARET","(?:\\^)");X("CARETTRIM",`(\\s*)${P[S.LONECARET]}\\s+`,!0);Yt.caretTrimReplace="$1^";X("CARET",`^${P[S.LONECARET]}${P[S.XRANGEPLAIN]}$`);X("CARETLOOSE",`^${P[S.LONECARET]}${P[S.XRANGEPLAINLOOSE]}$`);X("COMPARATORLOOSE",`^${P[S.GTLT]}\\s*(${P[S.LOOSEPLAIN]})$|^$`);X("COMPARATOR",`^${P[S.GTLT]}\\s*(${P[S.FULLPLAIN]})$|^$`);X("COMPARATORTRIM",`(\\s*)${P[S.GTLT]}\\s*(${P[S.LOOSEPLAIN]}|${P[S.XRANGEPLAIN]})`,!0);Yt.comparatorTrimReplace="$1$2$3";X("HYPHENRANGE",`^\\s*(${P[S.XRANGEPLAIN]})\\s+-\\s+(${P[S.XRANGEPLAIN]})\\s*$`);X("HYPHENRANGELOOSE",`^\\s*(${P[S.XRANGEPLAINLOOSE]})\\s+-\\s+(${P[S.XRANGEPLAINLOOSE]})\\s*$`);X("STAR","(<|>)?=?\\s*\\*");X("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");X("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Yo=j((Ak,Sh)=>{"use strict";var Iv=Object.freeze({loose:!0}),Tv=Object.freeze({}),Pv=r=>r?typeof r!="object"?Iv:r:Tv;Sh.exports=Pv});var Ol=j((Ek,Nh)=>{"use strict";var kh=/^[0-9]+$/,Rh=(r,e)=>{if(typeof r=="number"&&typeof e=="number")return r===e?0:r<e?-1:1;let t=kh.test(r),n=kh.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},Sv=(r,e)=>Rh(e,r);Nh.exports={compareIdentifiers:Rh,rcompareIdentifiers:Sv}});var Ue=j((Ok,$h)=>{"use strict";var Xo=ba(),{MAX_LENGTH:Ch,MAX_SAFE_INTEGER:Qo}=ya(),{safeRe:eu,t:tu}=Ks(),kv=Yo(),{compareIdentifiers:Il}=Ol(),Tl=class r{constructor(e,t){if(t=kv(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Ch)throw new TypeError(`version is longer than ${Ch} characters`);Xo("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?eu[tu.LOOSE]:eu[tu.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Qo||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Qo||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Qo||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let i=+s;if(i>=0&&i<Qo)return i}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Xo("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],s=e.prerelease[t];if(Xo("prerelease compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return Il(n,s)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],s=e.build[t];if(Xo("build compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return Il(n,s)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let s=`-${t}`.match(this.options.loose?eu[tu.PRERELEASELOOSE]:eu[tu.PRERELEASE]);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(t){let i=[t,s];n===!1&&(i=[t]),Il(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};$h.exports=Tl});var es=j((Ik,Mh)=>{"use strict";var jh=Ue(),Rv=(r,e,t=!1)=>{if(r instanceof jh)return r;try{return new jh(r,e)}catch(n){if(!t)return null;throw n}};Mh.exports=Rv});var Lh=j((Tk,zh)=>{"use strict";var Nv=es(),Cv=(r,e)=>{let t=Nv(r,e);return t?t.version:null};zh.exports=Cv});var Uh=j((Pk,Dh)=>{"use strict";var $v=es(),jv=(r,e)=>{let t=$v(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};Dh.exports=jv});var Zh=j((Sk,Bh)=>{"use strict";var Fh=Ue(),Mv=(r,e,t,n,s)=>{typeof t=="string"&&(s=n,n=t,t=void 0);try{return new Fh(r instanceof Fh?r.version:r,t).inc(e,n,s).version}catch{return null}};Bh.exports=Mv});var Hh=j((kk,Gh)=>{"use strict";var qh=es(),zv=(r,e)=>{let t=qh(r,null,!0),n=qh(e,null,!0),s=t.compare(n);if(s===0)return null;let i=s>0,a=i?t:n,o=i?n:t,u=!!a.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(a)===0)return o.minor&&!o.patch?"minor":"patch"}let d=u?"pre":"";return t.major!==n.major?d+"major":t.minor!==n.minor?d+"minor":t.patch!==n.patch?d+"patch":"prerelease"};Gh.exports=zv});var Kh=j((Rk,Vh)=>{"use strict";var Lv=Ue(),Dv=(r,e)=>new Lv(r,e).major;Vh.exports=Dv});var Wh=j((Nk,Jh)=>{"use strict";var Uv=Ue(),Fv=(r,e)=>new Uv(r,e).minor;Jh.exports=Fv});var Xh=j((Ck,Yh)=>{"use strict";var Bv=Ue(),Zv=(r,e)=>new Bv(r,e).patch;Yh.exports=Zv});var em=j(($k,Qh)=>{"use strict";var qv=es(),Gv=(r,e)=>{let t=qv(r,e);return t&&t.prerelease.length?t.prerelease:null};Qh.exports=Gv});var xt=j((jk,rm)=>{"use strict";var tm=Ue(),Hv=(r,e,t)=>new tm(r,t).compare(new tm(e,t));rm.exports=Hv});var sm=j((Mk,nm)=>{"use strict";var Vv=xt(),Kv=(r,e,t)=>Vv(e,r,t);nm.exports=Kv});var am=j((zk,im)=>{"use strict";var Jv=xt(),Wv=(r,e)=>Jv(r,e,!0);im.exports=Wv});var ru=j((Lk,um)=>{"use strict";var om=Ue(),Yv=(r,e,t)=>{let n=new om(r,t),s=new om(e,t);return n.compare(s)||n.compareBuild(s)};um.exports=Yv});var lm=j((Dk,cm)=>{"use strict";var Xv=ru(),Qv=(r,e)=>r.sort((t,n)=>Xv(t,n,e));cm.exports=Qv});var fm=j((Uk,dm)=>{"use strict";var e0=ru(),t0=(r,e)=>r.sort((t,n)=>e0(n,t,e));dm.exports=t0});var wa=j((Fk,pm)=>{"use strict";var r0=xt(),n0=(r,e,t)=>r0(r,e,t)>0;pm.exports=n0});var nu=j((Bk,hm)=>{"use strict";var s0=xt(),i0=(r,e,t)=>s0(r,e,t)<0;hm.exports=i0});var Pl=j((Zk,mm)=>{"use strict";var a0=xt(),o0=(r,e,t)=>a0(r,e,t)===0;mm.exports=o0});var Sl=j((qk,gm)=>{"use strict";var u0=xt(),c0=(r,e,t)=>u0(r,e,t)!==0;gm.exports=c0});var su=j((Gk,_m)=>{"use strict";var l0=xt(),d0=(r,e,t)=>l0(r,e,t)>=0;_m.exports=d0});var iu=j((Hk,ym)=>{"use strict";var f0=xt(),p0=(r,e,t)=>f0(r,e,t)<=0;ym.exports=p0});var kl=j((Vk,bm)=>{"use strict";var h0=Pl(),m0=Sl(),g0=wa(),_0=su(),y0=nu(),b0=iu(),w0=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return h0(r,t,n);case"!=":return m0(r,t,n);case">":return g0(r,t,n);case">=":return _0(r,t,n);case"<":return y0(r,t,n);case"<=":return b0(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};bm.exports=w0});var xm=j((Kk,wm)=>{"use strict";var x0=Ue(),v0=es(),{safeRe:au,t:ou}=Ks(),A0=(r,e)=>{if(r instanceof x0)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?au[ou.COERCEFULL]:au[ou.COERCE]);else{let u=e.includePrerelease?au[ou.COERCERTLFULL]:au[ou.COERCERTL],c;for(;(c=u.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||c.index+c[0].length!==t.index+t[0].length)&&(t=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(t===null)return null;let n=t[2],s=t[3]||"0",i=t[4]||"0",a=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return v0(`${n}.${s}.${i}${a}${o}`,e)};wm.exports=A0});var Am=j((Jk,vm)=>{"use strict";var Rl=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let s=this.map.keys().next().value;this.delete(s)}this.map.set(e,t)}return this}};vm.exports=Rl});var vt=j((Wk,Tm)=>{"use strict";var E0=/\s+/g,Nl=class r{constructor(e,t){if(t=I0(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Cl)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(E0," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(s=>!Om(s[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let s of this.set)if(s.length===1&&C0(s[0])){this.set=[s];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&R0)|(this.options.loose&&N0))+":"+e,s=Em.get(n);if(s)return s;let i=this.options.loose,a=i?Ge[Fe.HYPHENRANGELOOSE]:Ge[Fe.HYPHENRANGE];e=e.replace(a,Z0(this.options.includePrerelease)),fe("hyphen replace",e),e=e.replace(Ge[Fe.COMPARATORTRIM],P0),fe("comparator trim",e),e=e.replace(Ge[Fe.TILDETRIM],S0),fe("tilde trim",e),e=e.replace(Ge[Fe.CARETTRIM],k0),fe("caret trim",e);let o=e.split(" ").map(l=>$0(l,this.options)).join(" ").split(/\s+/).map(l=>B0(l,this.options));i&&(o=o.filter(l=>(fe("loose invalid filter",l,this.options),!!l.match(Ge[Fe.COMPARATORLOOSE])))),fe("range list",o);let u=new Map,c=o.map(l=>new Cl(l,this.options));for(let l of c){if(Om(l))return[l];u.set(l.value,l)}u.size>1&&u.has("")&&u.delete("");let d=[...u.values()];return Em.set(n,d),d}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>Im(n,t)&&e.set.some(s=>Im(s,t)&&n.every(i=>s.every(a=>i.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new T0(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(q0(this.set[t],e,this.options))return!0;return!1}};Tm.exports=Nl;var O0=Am(),Em=new O0,I0=Yo(),Cl=xa(),fe=ba(),T0=Ue(),{safeRe:Ge,t:Fe,comparatorTrimReplace:P0,tildeTrimReplace:S0,caretTrimReplace:k0}=Ks(),{FLAG_INCLUDE_PRERELEASE:R0,FLAG_LOOSE:N0}=ya(),Om=r=>r.value==="<0.0.0-0",C0=r=>r.value==="",Im=(r,e)=>{let t=!0,n=r.slice(),s=n.pop();for(;t&&n.length;)t=n.every(i=>s.intersects(i,e)),s=n.pop();return t},$0=(r,e)=>(r=r.replace(Ge[Fe.BUILD],""),fe("comp",r,e),r=z0(r,e),fe("caret",r),r=j0(r,e),fe("tildes",r),r=D0(r,e),fe("xrange",r),r=F0(r,e),fe("stars",r),r),He=r=>!r||r.toLowerCase()==="x"||r==="*",j0=(r,e)=>r.trim().split(/\s+/).map(t=>M0(t,e)).join(" "),M0=(r,e)=>{let t=e.loose?Ge[Fe.TILDELOOSE]:Ge[Fe.TILDE];return r.replace(t,(n,s,i,a,o)=>{fe("tilde",r,n,s,i,a,o);let u;return He(s)?u="":He(i)?u=`>=${s}.0.0 <${+s+1}.0.0-0`:He(a)?u=`>=${s}.${i}.0 <${s}.${+i+1}.0-0`:o?(fe("replaceTilde pr",o),u=`>=${s}.${i}.${a}-${o} <${s}.${+i+1}.0-0`):u=`>=${s}.${i}.${a} <${s}.${+i+1}.0-0`,fe("tilde return",u),u})},z0=(r,e)=>r.trim().split(/\s+/).map(t=>L0(t,e)).join(" "),L0=(r,e)=>{fe("caret",r,e);let t=e.loose?Ge[Fe.CARETLOOSE]:Ge[Fe.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(s,i,a,o,u)=>{fe("caret",r,s,i,a,o,u);let c;return He(i)?c="":He(a)?c=`>=${i}.0.0${n} <${+i+1}.0.0-0`:He(o)?i==="0"?c=`>=${i}.${a}.0${n} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.0${n} <${+i+1}.0.0-0`:u?(fe("replaceCaret pr",u),i==="0"?a==="0"?c=`>=${i}.${a}.${o}-${u} <${i}.${a}.${+o+1}-0`:c=`>=${i}.${a}.${o}-${u} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.${o}-${u} <${+i+1}.0.0-0`):(fe("no pr"),i==="0"?a==="0"?c=`>=${i}.${a}.${o}${n} <${i}.${a}.${+o+1}-0`:c=`>=${i}.${a}.${o}${n} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.${o} <${+i+1}.0.0-0`),fe("caret return",c),c})},D0=(r,e)=>(fe("replaceXRanges",r,e),r.split(/\s+/).map(t=>U0(t,e)).join(" ")),U0=(r,e)=>{r=r.trim();let t=e.loose?Ge[Fe.XRANGELOOSE]:Ge[Fe.XRANGE];return r.replace(t,(n,s,i,a,o,u)=>{fe("xRange",r,n,s,i,a,o,u);let c=He(i),d=c||He(a),l=d||He(o),f=l;return s==="="&&f&&(s=""),u=e.includePrerelease?"-0":"",c?s===">"||s==="<"?n="<0.0.0-0":n="*":s&&f?(d&&(a=0),o=0,s===">"?(s=">=",d?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):s==="<="&&(s="<",d?i=+i+1:a=+a+1),s==="<"&&(u="-0"),n=`${s+i}.${a}.${o}${u}`):d?n=`>=${i}.0.0${u} <${+i+1}.0.0-0`:l&&(n=`>=${i}.${a}.0${u} <${i}.${+a+1}.0-0`),fe("xRange return",n),n})},F0=(r,e)=>(fe("replaceStars",r,e),r.trim().replace(Ge[Fe.STAR],"")),B0=(r,e)=>(fe("replaceGTE0",r,e),r.trim().replace(Ge[e.includePrerelease?Fe.GTE0PRE:Fe.GTE0],"")),Z0=r=>(e,t,n,s,i,a,o,u,c,d,l,f)=>(He(n)?t="":He(s)?t=`>=${n}.0.0${r?"-0":""}`:He(i)?t=`>=${n}.${s}.0${r?"-0":""}`:a?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,He(c)?u="":He(d)?u=`<${+c+1}.0.0-0`:He(l)?u=`<${c}.${+d+1}.0-0`:f?u=`<=${c}.${d}.${l}-${f}`:r?u=`<${c}.${d}.${+l+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),q0=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(fe(r[n].semver),r[n].semver!==Cl.ANY&&r[n].semver.prerelease.length>0){let s=r[n].semver;if(s.major===e.major&&s.minor===e.minor&&s.patch===e.patch)return!0}return!1}return!0}});var xa=j((Yk,Cm)=>{"use strict";var va=Symbol("SemVer ANY"),Ml=class r{static get ANY(){return va}constructor(e,t){if(t=Pm(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),jl("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===va?this.value="":this.value=this.operator+this.semver.version,jl("comp",this)}parse(e){let t=this.options.loose?Sm[km.COMPARATORLOOSE]:Sm[km.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Rm(n[2],this.options.loose):this.semver=va}toString(){return this.value}test(e){if(jl("Comparator.test",e,this.options.loose),this.semver===va||e===va)return!0;if(typeof e=="string")try{e=new Rm(e,this.options)}catch{return!1}return $l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Nm(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new Nm(this.value,t).test(e.semver):(t=Pm(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||$l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||$l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Cm.exports=Ml;var Pm=Yo(),{safeRe:Sm,t:km}=Ks(),$l=kl(),jl=ba(),Rm=Ue(),Nm=vt()});var Aa=j((Xk,$m)=>{"use strict";var G0=vt(),H0=(r,e,t)=>{try{e=new G0(e,t)}catch{return!1}return e.test(r)};$m.exports=H0});var Mm=j((Qk,jm)=>{"use strict";var V0=vt(),K0=(r,e)=>new V0(r,e).set.map(t=>t.map(n=>n.value).join(" ").trim().split(" "));jm.exports=K0});var Lm=j((eR,zm)=>{"use strict";var J0=Ue(),W0=vt(),Y0=(r,e,t)=>{let n=null,s=null,i=null;try{i=new W0(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!n||s.compare(a)===-1)&&(n=a,s=new J0(n,t))}),n};zm.exports=Y0});var Um=j((tR,Dm)=>{"use strict";var X0=Ue(),Q0=vt(),eA=(r,e,t)=>{let n=null,s=null,i=null;try{i=new Q0(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!n||s.compare(a)===1)&&(n=a,s=new X0(n,t))}),n};Dm.exports=eA});var Zm=j((rR,Bm)=>{"use strict";var zl=Ue(),tA=vt(),Fm=wa(),rA=(r,e)=>{r=new tA(r,e);let t=new zl("0.0.0");if(r.test(t)||(t=new zl("0.0.0-0"),r.test(t)))return t;t=null;for(let n=0;n<r.set.length;++n){let s=r.set[n],i=null;s.forEach(a=>{let o=new zl(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!i||Fm(o,i))&&(i=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),i&&(!t||Fm(t,i))&&(t=i)}return t&&r.test(t)?t:null};Bm.exports=rA});var Gm=j((nR,qm)=>{"use strict";var nA=vt(),sA=(r,e)=>{try{return new nA(r,e).range||"*"}catch{return null}};qm.exports=sA});var uu=j((sR,Jm)=>{"use strict";var iA=Ue(),Km=xa(),{ANY:aA}=Km,oA=vt(),uA=Aa(),Hm=wa(),Vm=nu(),cA=iu(),lA=su(),dA=(r,e,t,n)=>{r=new iA(r,n),e=new oA(e,n);let s,i,a,o,u;switch(t){case">":s=Hm,i=cA,a=Vm,o=">",u=">=";break;case"<":s=Vm,i=lA,a=Hm,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(uA(r,e,n))return!1;for(let c=0;c<e.set.length;++c){let d=e.set[c],l=null,f=null;if(d.forEach(p=>{p.semver===aA&&(p=new Km(">=0.0.0")),l=l||p,f=f||p,s(p.semver,l.semver,n)?l=p:a(p.semver,f.semver,n)&&(f=p)}),l.operator===o||l.operator===u||(!f.operator||f.operator===o)&&i(r,f.semver))return!1;if(f.operator===u&&a(r,f.semver))return!1}return!0};Jm.exports=dA});var Ym=j((iR,Wm)=>{"use strict";var fA=uu(),pA=(r,e,t)=>fA(r,e,">",t);Wm.exports=pA});var Qm=j((aR,Xm)=>{"use strict";var hA=uu(),mA=(r,e,t)=>hA(r,e,"<",t);Xm.exports=mA});var rg=j((oR,tg)=>{"use strict";var eg=vt(),gA=(r,e,t)=>(r=new eg(r,t),e=new eg(e,t),r.intersects(e,t));tg.exports=gA});var sg=j((uR,ng)=>{"use strict";var _A=Aa(),yA=xt();ng.exports=(r,e,t)=>{let n=[],s=null,i=null,a=r.sort((d,l)=>yA(d,l,t));for(let d of a)_A(d,e,t)?(i=d,s||(s=d)):(i&&n.push([s,i]),i=null,s=null);s&&n.push([s,null]);let o=[];for(let[d,l]of n)d===l?o.push(d):!l&&d===a[0]?o.push("*"):l?d===a[0]?o.push(`<=${l}`):o.push(`${d} - ${l}`):o.push(`>=${d}`);let u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var lg=j((cR,cg)=>{"use strict";var ig=vt(),Dl=xa(),{ANY:Ll}=Dl,Ea=Aa(),Ul=xt(),bA=(r,e,t={})=>{if(r===e)return!0;r=new ig(r,t),e=new ig(e,t);let n=!1;e:for(let s of r.set){for(let i of e.set){let a=xA(s,i,t);if(n=n||a!==null,a)continue e}if(n)return!1}return!0},wA=[new Dl(">=0.0.0-0")],ag=[new Dl(">=0.0.0")],xA=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===Ll){if(e.length===1&&e[0].semver===Ll)return!0;t.includePrerelease?r=wA:r=ag}if(e.length===1&&e[0].semver===Ll){if(t.includePrerelease)return!0;e=ag}let n=new Set,s,i;for(let p of r)p.operator===">"||p.operator===">="?s=og(s,p,t):p.operator==="<"||p.operator==="<="?i=ug(i,p,t):n.add(p.semver);if(n.size>1)return null;let a;if(s&&i){if(a=Ul(s.semver,i.semver,t),a>0)return null;if(a===0&&(s.operator!==">="||i.operator!=="<="))return null}for(let p of n){if(s&&!Ea(p,String(s),t)||i&&!Ea(p,String(i),t))return null;for(let h of e)if(!Ea(p,String(h),t))return!1;return!0}let o,u,c,d,l=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1,f=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1;l&&l.prerelease.length===1&&i.operator==="<"&&l.prerelease[0]===0&&(l=!1);for(let p of e){if(d=d||p.operator===">"||p.operator===">=",c=c||p.operator==="<"||p.operator==="<=",s){if(f&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===f.major&&p.semver.minor===f.minor&&p.semver.patch===f.patch&&(f=!1),p.operator===">"||p.operator===">="){if(o=og(s,p,t),o===p&&o!==s)return!1}else if(s.operator===">="&&!Ea(s.semver,String(p),t))return!1}if(i){if(l&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===l.major&&p.semver.minor===l.minor&&p.semver.patch===l.patch&&(l=!1),p.operator==="<"||p.operator==="<="){if(u=ug(i,p,t),u===p&&u!==i)return!1}else if(i.operator==="<="&&!Ea(i.semver,String(p),t))return!1}if(!p.operator&&(i||s)&&a!==0)return!1}return!(s&&c&&!i&&a!==0||i&&d&&!s&&a!==0||f||l)},og=(r,e,t)=>{if(!r)return e;let n=Ul(r.semver,e.semver,t);return n>0?r:n<0||e.operator===">"&&r.operator===">="?e:r},ug=(r,e,t)=>{if(!r)return e;let n=Ul(r.semver,e.semver,t);return n<0?r:n>0||e.operator==="<"&&r.operator==="<="?e:r};cg.exports=bA});var hg=j((lR,pg)=>{"use strict";var Fl=Ks(),dg=ya(),vA=Ue(),fg=Ol(),AA=es(),EA=Lh(),OA=Uh(),IA=Zh(),TA=Hh(),PA=Kh(),SA=Wh(),kA=Xh(),RA=em(),NA=xt(),CA=sm(),$A=am(),jA=ru(),MA=lm(),zA=fm(),LA=wa(),DA=nu(),UA=Pl(),FA=Sl(),BA=su(),ZA=iu(),qA=kl(),GA=xm(),HA=xa(),VA=vt(),KA=Aa(),JA=Mm(),WA=Lm(),YA=Um(),XA=Zm(),QA=Gm(),eE=uu(),tE=Ym(),rE=Qm(),nE=rg(),sE=sg(),iE=lg();pg.exports={parse:AA,valid:EA,clean:OA,inc:IA,diff:TA,major:PA,minor:SA,patch:kA,prerelease:RA,compare:NA,rcompare:CA,compareLoose:$A,compareBuild:jA,sort:MA,rsort:zA,gt:LA,lt:DA,eq:UA,neq:FA,gte:BA,lte:ZA,cmp:qA,coerce:GA,Comparator:HA,Range:VA,satisfies:KA,toComparators:JA,maxSatisfying:WA,minSatisfying:YA,minVersion:XA,validRange:QA,outside:eE,gtr:tE,ltr:rE,intersects:nE,simplifyRange:sE,subset:iE,SemVer:vA,re:Fl.re,src:Fl.src,tokens:Fl.t,SEMVER_SPEC_VERSION:dg.SEMVER_SPEC_VERSION,RELEASE_TYPES:dg.RELEASE_TYPES,compareIdentifiers:fg.compareIdentifiers,rcompareIdentifiers:fg.rcompareIdentifiers}});var Ng=j((WR,Rg)=>{"use strict";var Sg=(r=0)=>e=>`\x1B[${38+r};5;${e}m`,kg=(r=0)=>(e,t,n)=>`\x1B[${38+r};2;${e};${t};${n}m`;function NE(){let r=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,n]of Object.entries(e)){for(let[s,i]of Object.entries(n))e[s]={open:`\x1B[${i[0]}m`,close:`\x1B[${i[1]}m`},n[s]=e[s],r.set(i[0],i[1]);Object.defineProperty(e,t,{value:n,enumerable:!1})}return Object.defineProperty(e,"codes",{value:r,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=Sg(),e.color.ansi16m=kg(),e.bgColor.ansi256=Sg(10),e.bgColor.ansi16m=kg(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,n,s)=>t===n&&n===s?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(s/255*5),enumerable:!1},hexToRgb:{value:t=>{let n=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!n)return[0,0,0];let{colorString:s}=n.groups;s.length===3&&(s=s.split("").map(a=>a+a).join(""));let i=Number.parseInt(s,16);return[i>>16&255,i>>8&255,i&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(Rg,"exports",{enumerable:!0,get:NE})});var Gy=j(_c=>{"use strict";_c.byteLength=mT;_c.toByteArray=_T;_c.fromByteArray=wT;var hr=[],Ot=[],hT=typeof Uint8Array<"u"?Uint8Array:Array,hf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Ss=0,Zy=hf.length;Ss<Zy;++Ss)hr[Ss]=hf[Ss],Ot[hf.charCodeAt(Ss)]=Ss;var Ss,Zy;Ot[45]=62;Ot[95]=63;function qy(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function mT(r){var e=qy(r),t=e[0],n=e[1];return(t+n)*3/4-n}function gT(r,e,t){return(e+t)*3/4-t}function _T(r){var e,t=qy(r),n=t[0],s=t[1],i=new hT(gT(r,n,s)),a=0,o=s>0?n-4:n,u;for(u=0;u<o;u+=4)e=Ot[r.charCodeAt(u)]<<18|Ot[r.charCodeAt(u+1)]<<12|Ot[r.charCodeAt(u+2)]<<6|Ot[r.charCodeAt(u+3)],i[a++]=e>>16&255,i[a++]=e>>8&255,i[a++]=e&255;return s===2&&(e=Ot[r.charCodeAt(u)]<<2|Ot[r.charCodeAt(u+1)]>>4,i[a++]=e&255),s===1&&(e=Ot[r.charCodeAt(u)]<<10|Ot[r.charCodeAt(u+1)]<<4|Ot[r.charCodeAt(u+2)]>>2,i[a++]=e>>8&255,i[a++]=e&255),i}function yT(r){return hr[r>>18&63]+hr[r>>12&63]+hr[r>>6&63]+hr[r&63]}function bT(r,e,t){for(var n,s=[],i=e;i<t;i+=3)n=(r[i]<<16&16711680)+(r[i+1]<<8&65280)+(r[i+2]&255),s.push(yT(n));return s.join("")}function wT(r){for(var e,t=r.length,n=t%3,s=[],i=16383,a=0,o=t-n;a<o;a+=i)s.push(bT(r,a,a+i>o?o:a+i));return n===1?(e=r[t-1],s.push(hr[e>>2]+hr[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],s.push(hr[e>>10]+hr[e>>4&63]+hr[e<<2&63]+"=")),s.join("")}});var JT={};Cc(JT,{REFINER_CONFIG:()=>Cs,refineTranscriptWithLLM:()=>Zb});function $c(r,e=Ms){r=r.trim();let t=r.indexOf("```");if(t===-1)return e(r);let n=r.substring(t+3);n.startsWith(`json
`)?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith(`
`)&&(n=n.substring(1));let s=n.indexOf("```"),i=n;return s!==-1&&(i=n.substring(0,s)),e(i.trim())}function Ms(r){if(typeof r>"u")return null;try{return JSON.parse(r)}catch{}let e="",t=[],n=!1,s=!1;for(let i of r){if(n)i==='"'&&!s?n=!1:i===`
`&&!s?i="\\n":i==="\\"?s=!s:s=!1;else if(i==='"')n=!0,s=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}n&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch{return null}}var Yf=It(Zf(),1),iw=It(Wf(),1);function Xf(r,e){return e?.[r]||(0,Yf.default)(r)}function Qf(r,e,t){let n={};for(let s in r)Object.hasOwn(r,s)&&(n[e(s,t)]=r[s]);return n}function ep(r){return Array.isArray(r)?[...r]:{...r}}function aw(r,e){let t=ep(r);for(let[n,s]of Object.entries(e)){let[i,...a]=n.split(".").reverse(),o=t;for(let u of a.reverse()){if(o[u]===void 0)break;o[u]=ep(o[u]),o=o[u]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}function Mc(r){let e=Object.getPrototypeOf(r);return typeof r.lc_name=="function"&&(typeof e.lc_name!="function"||r.lc_name()!==e.lc_name())?r.lc_name():r.name}var Tt=class r{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Mc(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([n])=>this.lc_serializable_keys?.includes(n))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof r||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},n=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(n,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let i=this,a=n,[o,...u]=s.split(".").reverse();for(let c of u.reverse()){if(!(c in i)||i[c]===void 0)return;(!(c in a)||a[c]===void 0)&&(typeof i[c]=="object"&&i[c]!=null?a[c]={}:Array.isArray(i[c])&&(a[c]=[])),i=i[c],a=a[c]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:Qf(Object.keys(t).length?aw(n,t):n,Xf,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function zs(r){return typeof r=="object"&&r!==null&&"type"in r&&typeof r.type=="string"&&"source_type"in r&&(r.source_type==="url"||r.source_type==="base64"||r.source_type==="text"||r.source_type==="id")}function tp(r){return zs(r)&&r.source_type==="url"&&"url"in r&&typeof r.url=="string"}function rp(r){return zs(r)&&r.source_type==="base64"&&"data"in r&&typeof r.data=="string"}function np(r){if(zs(r)){if(r.source_type==="url")return{type:"image_url",image_url:{url:r.url}};if(r.source_type==="base64"){if(!r.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${r.mime_type};base64,${r.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function ht(r,e){return typeof r=="string"?r===""?e:typeof e=="string"?r+e:Array.isArray(e)&&e.some(t=>zs(t))?[{type:"text",source_type:"text",text:r},...e]:[{type:"text",text:r},...e]:Array.isArray(e)?aa(r,e)??[...r,...e]:e===""?r:Array.isArray(r)&&r.some(t=>zs(t))?[...r,{type:"file",source_type:"text",text:e}]:[...r,{type:"text",text:e}]}function sp(r,e){return r==="error"||e==="error"?"error":"success"}function ow(r,e){function t(n,s){if(typeof n!="object"||n===null||n===void 0)return n;if(s>=e)return Array.isArray(n)?"[Array]":"[Object]";if(Array.isArray(n))return n.map(a=>t(a,s+1));let i={};for(let a of Object.keys(n))i[a]=t(n[a],s+1);return i}return JSON.stringify(t(r,0),null,2)}var Me=class extends Tt{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let t=ow(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}};function we(r,e){let t={...r};for(let[n,s]of Object.entries(e))if(t[n]==null)t[n]=s;else{if(s==null)continue;if(typeof t[n]!=typeof s||Array.isArray(t[n])!==Array.isArray(s))throw new Error(`field[${n}] already exists in the message chunk, but with a different type.`);if(typeof t[n]=="string"){if(n==="type")continue;["id","name","output_version","model_provider"].includes(n)?t[n]=s:t[n]+=s}else if(typeof t[n]=="object"&&!Array.isArray(t[n]))t[n]=we(t[n],s);else if(Array.isArray(t[n]))t[n]=aa(t[n],s);else{if(t[n]===s)continue;console.warn(`field[${n}] already exists in this message chunk and value has unsupported type.`)}}return t}function aa(r,e){if(!(r===void 0&&e===void 0)){if(r===void 0||e===void 0)return r||e;{let t=[...r];for(let n of e)if(typeof n=="object"&&n!==null&&"index"in n&&typeof n.index=="number"){let s=t.findIndex(i=>{let a=typeof i=="object",o="index"in i&&i.index===n.index,u="id"in i&&"id"in n&&i?.id===n?.id,c=!("id"in i)||!i?.id||!("id"in n)||!n?.id;return a&&o&&(u||c)});s!==-1&&typeof t[s]=="object"&&t[s]!==null?t[s]=we(t[s],n):t.push(n)}else{if(typeof n=="object"&&n!==null&&"text"in n&&n.text==="")continue;t.push(n)}return t}}}function ip(r,e){if(!r&&!e)throw new Error("Cannot merge two undefined objects.");if(!r||!e)return r||e;if(typeof r!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof r}
Right ${typeof e}`);if(typeof r=="string"&&typeof e=="string")return r+e;if(Array.isArray(r)&&Array.isArray(e))return aa(r,e);if(typeof r=="object"&&typeof e=="object")return we(r,e);if(r===e)return r;throw new Error(`Can not merge objects of different types.
Left ${r}
Right ${e}`)}var We=class extends Me{};function ap(r){return typeof r.role=="string"}function Fr(r){return typeof r?._getType=="function"}function zc(r){return Fr(r)&&typeof r.concat=="function"}function op(r){return r!=null&&typeof r=="object"&&"lc_direct_tool_output"in r&&r.lc_direct_tool_output===!0}var yr=class extends Me{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,n){typeof e=="string"&&(e={content:e,name:n,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status,this.metadata=e.metadata}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},Ls=class r extends We{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new r({content:ht(this.content,e.content),additional_kwargs:we(this.additional_kwargs,e.additional_kwargs),response_metadata:we(this.response_metadata,e.response_metadata),artifact:ip(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:sp(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function up(r){let e=[],t=[];for(let n of r)if(n.function){let s=n.function.name;try{let i=JSON.parse(n.function.arguments),a={name:s||"",args:i||{},id:n.id};e.push(a)}catch{t.push({name:s,args:n.function.arguments,id:n.id,error:"Malformed args."})}}else continue;return[e,t]}var mt=class extends Me{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{n=e;let s=n.additional_kwargs?.tool_calls,i=n.tool_calls;s!=null&&s.length>0&&(i===void 0||i.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(s!=null&&i===void 0){let[a,o]=up(s);n.tool_calls=a??[],n.invalid_tool_calls=o??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}};function Pn(r){return r._getType()==="ai"}function Lc(r){return r._getType()==="ai"}var gt=class r extends We{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0||e.tool_call_chunks.length===0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{let s=(e.tool_call_chunks??[]).reduce((o,u)=>{let c=o.findIndex(([d])=>"id"in u&&u.id&&"index"in u&&u.index!==void 0?u.id===d.id&&u.index===d.index:"id"in u&&u.id?u.id===d.id:"index"in u&&u.index!==void 0?u.index===d.index:!1);return c!==-1?o[c].push(u):o.push([u]),o},[]),i=[],a=[];for(let o of s){let u={},c=o[0]?.name??"",d=o.map(p=>p.args||"").join(""),l=d.length?d:"{}",f=o[0]?.id;try{if(u=Ms(l),!f||u===null||typeof u!="object"||Array.isArray(u))throw new Error("Malformed tool call chunk args.");i.push({name:c,args:u,id:f,type:"tool_call"})}catch{a.push({name:c,args:l,id:f,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:i,invalid_tool_calls:a,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:ht(this.content,e.content),additional_kwargs:we(this.additional_kwargs,e.additional_kwargs),response_metadata:we(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let n=aa(this.tool_call_chunks,e.tool_call_chunks);n!==void 0&&n.length>0&&(t.tool_call_chunks=n)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let n={...(this.usage_metadata?.input_token_details?.audio!==void 0||e.usage_metadata?.input_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)},...(this.usage_metadata?.input_token_details?.cache_read!==void 0||e.usage_metadata?.input_token_details?.cache_read!==void 0)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)},...(this.usage_metadata?.input_token_details?.cache_creation!==void 0||e.usage_metadata?.input_token_details?.cache_creation!==void 0)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}},s={...(this.usage_metadata?.output_token_details?.audio!==void 0||e.usage_metadata?.output_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)},...(this.usage_metadata?.output_token_details?.reasoning!==void 0||e.usage_metadata?.output_token_details?.reasoning!==void 0)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}},i=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},o={input_tokens:i.input_tokens+a.input_tokens,output_tokens:i.output_tokens+a.output_tokens,total_tokens:i.total_tokens+a.total_tokens,...Object.keys(n).length>0&&{input_token_details:n},...Object.keys(s).length>0&&{output_token_details:s}};t.usage_metadata=o}return new r(t)}};var Br=class r extends Me{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return r}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},Sn=class r extends We{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new r({content:ht(this.content,e.content),additional_kwargs:we(this.additional_kwargs,e.additional_kwargs),response_metadata:we(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}};var kn=class r extends We{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new r({content:ht(this.content,e.content),additional_kwargs:we(this.additional_kwargs,e.additional_kwargs),response_metadata:we(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};var it=class extends Me{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}},Rn=class r extends We{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new r({content:ht(this.content,e.content),additional_kwargs:we(this.additional_kwargs,e.additional_kwargs),response_metadata:we(this.response_metadata,e.response_metadata),id:this.id??e.id})}};var Zr=class extends Me{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}},qr=class r extends We{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new r({content:ht(this.content,e.content),additional_kwargs:we(this.additional_kwargs,e.additional_kwargs),response_metadata:we(this.response_metadata,e.response_metadata),id:this.id??e.id})}};function bo(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Gr(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="tool_call")}function cp(r){return!!(r&&typeof r=="object"&&"toolCall"in r&&r.toolCall!=null&&typeof r.toolCall=="object"&&"id"in r.toolCall&&typeof r.toolCall.id=="string")}var Nn=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}};var oa=class extends Me{constructor(e){super({...e,content:""}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e.id}_getType(){return"remove"}get _printableFields(){return{...super._printableFields,id:this.id}}};function cw(r){return Gr(r)?r:typeof r.id=="string"&&r.type==="function"&&typeof r.function=="object"&&r.function!==null&&"arguments"in r.function&&typeof r.function.arguments=="string"&&"name"in r.function&&typeof r.function.name=="string"?{id:r.id,args:JSON.parse(r.function.arguments),name:r.function.name,type:"tool_call"}:r}function lw(r){return typeof r=="object"&&r!=null&&r.lc===1&&Array.isArray(r.id)&&r.kwargs!=null&&typeof r.kwargs=="object"}function Dc(r){let e,t;if(lw(r)){let n=r.id.at(-1);n==="HumanMessage"||n==="HumanMessageChunk"?e="user":n==="AIMessage"||n==="AIMessageChunk"?e="assistant":n==="SystemMessage"||n==="SystemMessageChunk"?e="system":n==="FunctionMessage"||n==="FunctionMessageChunk"?e="function":n==="ToolMessage"||n==="ToolMessageChunk"?e="tool":e="unknown",t=r.kwargs}else{let{type:n,...s}=r;e=n,t=s}if(e==="human"||e==="user")return new it(t);if(e==="ai"||e==="assistant"){let{tool_calls:n,...s}=t;if(!Array.isArray(n))return new mt(t);let i=n.map(cw);return new mt({...s,tool_calls:i})}else{if(e==="system")return new Zr(t);if(e==="developer")return new Zr({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new yr({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});if(e==="remove"&&"id"in t&&typeof t.id=="string")return new oa({...t,id:t.id});throw bo(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(r,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Cn(r){if(typeof r=="string")return new it(r);if(Fr(r))return r;if(Array.isArray(r)){let[e,t]=r;return Dc({type:e,content:t})}else if(ap(r)){let{role:e,...t}=r;return Dc({...t,type:e})}else return Dc(r)}function ua(r,e="Human",t="AI"){let n=[];for(let s of r){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="tool")i="Tool";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);let a=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);n.push(`${i}: ${a}${o}`)}return n.join(`
`)}function Uc(r){let e=r._getType();if(e==="human")return new Rn({...r});if(e==="ai"){let t={...r};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(n=>({...n,type:"tool_call_chunk",index:void 0,args:JSON.stringify(n.args)}))}),new gt({...t})}else{if(e==="system")return new qr({...r});if(e==="function")return new kn({...r});if(Br.isInstance(r))return new Sn({...r});throw new Error("Unknown message type.")}}var at={};Cc(at,{BRAND:()=>Mw,DIRTY:()=>$n,EMPTY_PATH:()=>hw,INVALID:()=>U,NEVER:()=>wx,OK:()=>ze,ParseStatus:()=>Ne,Schema:()=>te,ZodAny:()=>Kr,ZodArray:()=>vr,ZodBigInt:()=>Mn,ZodBoolean:()=>zn,ZodBranded:()=>la,ZodCatch:()=>Kn,ZodDate:()=>Ln,ZodDefault:()=>Vn,ZodDiscriminatedUnion:()=>vo,ZodEffects:()=>bt,ZodEnum:()=>Gn,ZodError:()=>Ye,ZodFirstPartyTypeKind:()=>b,ZodFunction:()=>Eo,ZodIntersection:()=>Bn,ZodIssueCode:()=>v,ZodLazy:()=>Zn,ZodLiteral:()=>qn,ZodMap:()=>qs,ZodNaN:()=>Hs,ZodNativeEnum:()=>Hn,ZodNever:()=>Pt,ZodNull:()=>Un,ZodNullable:()=>Kt,ZodNumber:()=>jn,ZodObject:()=>Xe,ZodOptional:()=>_t,ZodParsedType:()=>T,ZodPipeline:()=>da,ZodPromise:()=>Jr,ZodReadonly:()=>Jn,ZodRecord:()=>Ao,ZodSchema:()=>te,ZodSet:()=>Gs,ZodString:()=>Vr,ZodSymbol:()=>Bs,ZodTransformer:()=>bt,ZodTuple:()=>Vt,ZodType:()=>te,ZodUndefined:()=>Dn,ZodUnion:()=>Fn,ZodUnknown:()=>xr,ZodVoid:()=>Zs,addIssueToContext:()=>O,any:()=>Gw,array:()=>Jw,bigint:()=>Uw,boolean:()=>wp,coerce:()=>bx,custom:()=>_p,date:()=>Fw,datetimeRegex:()=>mp,defaultErrorMap:()=>br,discriminatedUnion:()=>Qw,effect:()=>dx,enum:()=>ux,function:()=>ix,getErrorMap:()=>Ds,getParsedType:()=>Ht,instanceof:()=>Lw,intersection:()=>ex,isAborted:()=>wo,isAsync:()=>Us,isDirty:()=>xo,isValid:()=>Hr,late:()=>zw,lazy:()=>ax,literal:()=>ox,makeIssue:()=>ca,map:()=>nx,nan:()=>Dw,nativeEnum:()=>cx,never:()=>Vw,null:()=>qw,nullable:()=>px,number:()=>bp,object:()=>Ww,objectUtil:()=>Fc,oboolean:()=>yx,onumber:()=>_x,optional:()=>fx,ostring:()=>gx,pipeline:()=>mx,preprocess:()=>hx,promise:()=>lx,quotelessJson:()=>dw,record:()=>rx,set:()=>sx,setErrorMap:()=>pw,strictObject:()=>Yw,string:()=>yp,symbol:()=>Bw,transformer:()=>dx,tuple:()=>tx,undefined:()=>Zw,union:()=>Xw,unknown:()=>Hw,util:()=>se,void:()=>Kw});var se;(function(r){r.assertEqual=s=>{};function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{let i={};for(let a of s)i[a]=a;return i},r.getValidEnumValues=s=>{let i=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(let o of i)a[o]=s[o];return r.objectValues(a)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let i=[];for(let a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},r.find=(s,i)=>{for(let a of s)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(se||(se={}));var Fc;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Fc||(Fc={}));var T=se.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ht=r=>{switch(typeof r){case"undefined":return T.undefined;case"string":return T.string;case"number":return Number.isNaN(r)?T.nan:T.number;case"boolean":return T.boolean;case"function":return T.function;case"bigint":return T.bigint;case"symbol":return T.symbol;case"object":return Array.isArray(r)?T.array:r===null?T.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?T.promise:typeof Map<"u"&&r instanceof Map?T.map:typeof Set<"u"&&r instanceof Set?T.set:typeof Date<"u"&&r instanceof Date?T.date:T.object;default:return T.unknown}};var v=se.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),dw=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),Ye=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(let a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)n._errors.push(t(a));else{let o=n,u=0;for(;u<a.path.length;){let c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return s(this),n}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,se.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let s of this.issues)if(s.path.length>0){let i=s.path[0];t[i]=t[i]||[],t[i].push(e(s))}else n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};Ye.create=r=>new Ye(r);var fw=(r,e)=>{let t;switch(r.code){case v.invalid_type:r.received===T.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case v.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,se.jsonStringifyReplacer)}`;break;case v.unrecognized_keys:t=`Unrecognized key(s) in object: ${se.joinValues(r.keys,", ")}`;break;case v.invalid_union:t="Invalid input";break;case v.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${se.joinValues(r.options)}`;break;case v.invalid_enum_value:t=`Invalid enum value. Expected ${se.joinValues(r.options)}, received '${r.received}'`;break;case v.invalid_arguments:t="Invalid function arguments";break;case v.invalid_return_type:t="Invalid function return type";break;case v.invalid_date:t="Invalid date";break;case v.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:se.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case v.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case v.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case v.custom:t="Invalid input";break;case v.invalid_intersection_types:t="Intersection results could not be merged";break;case v.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case v.not_finite:t="Number must be finite";break;default:t=e.defaultError,se.assertNever(r)}return{message:t}},br=fw;var lp=br;function pw(r){lp=r}function Ds(){return lp}var ca=r=>{let{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}},hw=[];function O(r,e){let t=Ds(),n=ca({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===br?void 0:br].filter(s=>!!s)});r.common.issues.push(n)}var Ne=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let s of t){if(s.status==="aborted")return U;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let s of t){let i=await s.key,a=await s.value;n.push({key:i,value:a})}return r.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let s of t){let{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return U;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(n[i.value]=a.value)}return{status:e.value,value:n}}},U=Object.freeze({status:"aborted"}),$n=r=>({status:"dirty",value:r}),ze=r=>({status:"valid",value:r}),wo=r=>r.status==="aborted",xo=r=>r.status==="dirty",Hr=r=>r.status==="valid",Us=r=>typeof Promise<"u"&&r instanceof Promise;var $;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})($||($={}));var yt=class{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},dp=(r,e)=>{if(Hr(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Ye(r.common.issues);return this._error=t,this._error}}};function Q(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{let{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??n??o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:s}}var te=class{get description(){return this._def.description}_getType(e){return Ht(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Ht(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Us(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){let n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ht(e)},s=this._parseSync({data:e,path:n.path,parent:n});return dp(n,s)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ht(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:t});return Hr(n)?{value:n.value}:{issues:t.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(n=>Hr(n)?{value:n.value}:{issues:t.common.issues})}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ht(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(Us(s)?s:Promise.resolve(s));return dp(n,i)}refine(e,t){let n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{let a=e(s),o=()=>i.addIssue({code:v.custom,...n(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new bt({schema:this,typeName:b.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return _t.create(this,this._def)}nullable(){return Kt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return vr.create(this)}promise(){return Jr.create(this,this._def)}or(e){return Fn.create([this,e],this._def)}and(e){return Bn.create(this,e,this._def)}transform(e){return new bt({...Q(this._def),schema:this,typeName:b.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Vn({...Q(this._def),innerType:this,defaultValue:t,typeName:b.ZodDefault})}brand(){return new la({typeName:b.ZodBranded,type:this,...Q(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Kn({...Q(this._def),innerType:this,catchValue:t,typeName:b.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return da.create(this,e)}readonly(){return Jn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mw=/^c[^\s-]{8,}$/i,gw=/^[0-9a-z]+$/,_w=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yw=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,bw=/^[a-z0-9_-]{21}$/i,ww=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,xw=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,vw=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Aw="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Bc,Ew=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ow=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Iw=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Tw=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Pw=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Sw=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,pp="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",kw=new RegExp(`^${pp}$`);function hp(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Rw(r){return new RegExp(`^${hp(r)}$`)}function mp(r){let e=`${pp}T${hp(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Nw(r,e){return!!((e==="v4"||!e)&&Ew.test(r)||(e==="v6"||!e)&&Iw.test(r))}function Cw(r,e){if(!ww.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function $w(r,e){return!!((e==="v4"||!e)&&Ow.test(r)||(e==="v6"||!e)&&Tw.test(r))}var Vr=class r extends te{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==T.string){let i=this._getOrReturnCtx(e);return O(i,{code:v.invalid_type,expected:T.string,received:i.parsedType}),U}let n=new Ne,s;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),O(s,{code:v.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),O(s,{code:v.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?O(s,{code:v.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&O(s,{code:v.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")vw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"email",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")Bc||(Bc=new RegExp(Aw,"u")),Bc.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"emoji",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")yw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"uuid",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")bw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"nanoid",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")mw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"cuid",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")gw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"cuid2",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")_w.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"ulid",code:v.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),O(s,{validation:"url",code:v.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"regex",code:v.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),O(s,{code:v.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),O(s,{code:v.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),O(s,{code:v.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?mp(i).test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{code:v.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?kw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{code:v.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?Rw(i).test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{code:v.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?xw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"duration",code:v.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?Nw(e.data,i.version)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"ip",code:v.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?Cw(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"jwt",code:v.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?$w(e.data,i.version)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"cidr",code:v.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?Pw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"base64",code:v.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?Sw.test(e.data)||(s=this._getOrReturnCtx(e,s),O(s,{validation:"base64url",code:v.invalid_string,message:i.message}),n.dirty()):se.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:v.invalid_string,...$.errToObj(n)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...$.errToObj(e)})}url(e){return this._addCheck({kind:"url",...$.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...$.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...$.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...$.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...$.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...$.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...$.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...$.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...$.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...$.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...$.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...$.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...$.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...$.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...$.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...$.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...$.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...$.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...$.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...$.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...$.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...$.errToObj(t)})}nonempty(e){return this.min(1,$.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Vr.create=r=>new Vr({checks:[],typeName:b.ZodString,coerce:r?.coerce??!1,...Q(r)});function jw(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=Number.parseInt(r.toFixed(s).replace(".","")),a=Number.parseInt(e.toFixed(s).replace(".",""));return i%a/10**s}var jn=class r extends te{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==T.number){let i=this._getOrReturnCtx(e);return O(i,{code:v.invalid_type,expected:T.number,received:i.parsedType}),U}let n,s=new Ne;for(let i of this._def.checks)i.kind==="int"?se.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{code:v.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),O(n,{code:v.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),O(n,{code:v.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?jw(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),O(n,{code:v.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),O(n,{code:v.not_finite,message:i.message}),s.dirty()):se.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,$.toString(t))}gt(e,t){return this.setLimit("min",e,!1,$.toString(t))}lte(e,t){return this.setLimit("max",e,!0,$.toString(t))}lt(e,t){return this.setLimit("max",e,!1,$.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:$.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:$.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:$.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:$.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:$.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:$.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:$.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:$.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:$.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:$.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&se.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};jn.create=r=>new jn({checks:[],typeName:b.ZodNumber,coerce:r?.coerce||!1,...Q(r)});var Mn=class r extends te{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==T.bigint)return this._getInvalidInput(e);let n,s=new Ne;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),O(n,{code:v.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),O(n,{code:v.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),O(n,{code:v.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):se.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return O(t,{code:v.invalid_type,expected:T.bigint,received:t.parsedType}),U}gte(e,t){return this.setLimit("min",e,!0,$.toString(t))}gt(e,t){return this.setLimit("min",e,!1,$.toString(t))}lte(e,t){return this.setLimit("max",e,!0,$.toString(t))}lt(e,t){return this.setLimit("max",e,!1,$.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:$.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:$.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:$.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:$.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:$.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:$.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Mn.create=r=>new Mn({checks:[],typeName:b.ZodBigInt,coerce:r?.coerce??!1,...Q(r)});var zn=class extends te{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==T.boolean){let n=this._getOrReturnCtx(e);return O(n,{code:v.invalid_type,expected:T.boolean,received:n.parsedType}),U}return ze(e.data)}};zn.create=r=>new zn({typeName:b.ZodBoolean,coerce:r?.coerce||!1,...Q(r)});var Ln=class r extends te{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==T.date){let i=this._getOrReturnCtx(e);return O(i,{code:v.invalid_type,expected:T.date,received:i.parsedType}),U}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return O(i,{code:v.invalid_date}),U}let n=new Ne,s;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),O(s,{code:v.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),O(s,{code:v.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):se.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:$.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:$.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Ln.create=r=>new Ln({checks:[],coerce:r?.coerce||!1,typeName:b.ZodDate,...Q(r)});var Bs=class extends te{_parse(e){if(this._getType(e)!==T.symbol){let n=this._getOrReturnCtx(e);return O(n,{code:v.invalid_type,expected:T.symbol,received:n.parsedType}),U}return ze(e.data)}};Bs.create=r=>new Bs({typeName:b.ZodSymbol,...Q(r)});var Dn=class extends te{_parse(e){if(this._getType(e)!==T.undefined){let n=this._getOrReturnCtx(e);return O(n,{code:v.invalid_type,expected:T.undefined,received:n.parsedType}),U}return ze(e.data)}};Dn.create=r=>new Dn({typeName:b.ZodUndefined,...Q(r)});var Un=class extends te{_parse(e){if(this._getType(e)!==T.null){let n=this._getOrReturnCtx(e);return O(n,{code:v.invalid_type,expected:T.null,received:n.parsedType}),U}return ze(e.data)}};Un.create=r=>new Un({typeName:b.ZodNull,...Q(r)});var Kr=class extends te{constructor(){super(...arguments),this._any=!0}_parse(e){return ze(e.data)}};Kr.create=r=>new Kr({typeName:b.ZodAny,...Q(r)});var xr=class extends te{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ze(e.data)}};xr.create=r=>new xr({typeName:b.ZodUnknown,...Q(r)});var Pt=class extends te{_parse(e){let t=this._getOrReturnCtx(e);return O(t,{code:v.invalid_type,expected:T.never,received:t.parsedType}),U}};Pt.create=r=>new Pt({typeName:b.ZodNever,...Q(r)});var Zs=class extends te{_parse(e){if(this._getType(e)!==T.undefined){let n=this._getOrReturnCtx(e);return O(n,{code:v.invalid_type,expected:T.void,received:n.parsedType}),U}return ze(e.data)}};Zs.create=r=>new Zs({typeName:b.ZodVoid,...Q(r)});var vr=class r extends te{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==T.array)return O(t,{code:v.invalid_type,expected:T.array,received:t.parsedType}),U;if(s.exactLength!==null){let a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(O(t,{code:a?v.too_big:v.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(O(t,{code:v.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(O(t,{code:v.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new yt(t,a,t.path,o)))).then(a=>Ne.mergeArray(n,a));let i=[...t.data].map((a,o)=>s.type._parseSync(new yt(t,a,t.path,o)));return Ne.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:$.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:$.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:$.toString(t)}})}nonempty(e){return this.min(1,e)}};vr.create=(r,e)=>new vr({type:r,minLength:null,maxLength:null,exactLength:null,typeName:b.ZodArray,...Q(e)});function Fs(r){if(r instanceof Xe){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=_t.create(Fs(n))}return new Xe({...r._def,shape:()=>e})}else return r instanceof vr?new vr({...r._def,type:Fs(r.element)}):r instanceof _t?_t.create(Fs(r.unwrap())):r instanceof Kt?Kt.create(Fs(r.unwrap())):r instanceof Vt?Vt.create(r.items.map(e=>Fs(e))):r}var Xe=class r extends te{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=se.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==T.object){let c=this._getOrReturnCtx(e);return O(c,{code:v.invalid_type,expected:T.object,received:c.parsedType}),U}let{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Pt&&this._def.unknownKeys==="strip"))for(let c in s.data)a.includes(c)||o.push(c);let u=[];for(let c of a){let d=i[c],l=s.data[c];u.push({key:{status:"valid",value:c},value:d._parse(new yt(s,l,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof Pt){let c=this._def.unknownKeys;if(c==="passthrough")for(let d of o)u.push({key:{status:"valid",value:d},value:{status:"valid",value:s.data[d]}});else if(c==="strict")o.length>0&&(O(s,{code:v.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let d of o){let l=s.data[d];u.push({key:{status:"valid",value:d},value:c._parse(new yt(s,l,s.path,d)),alwaysSet:d in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let c=[];for(let d of u){let l=await d.key,f=await d.value;c.push({key:l,value:f,alwaysSet:d.alwaysSet})}return c}).then(c=>Ne.mergeObjectSync(n,c)):Ne.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return $.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{let s=this._def.errorMap?.(t,n).message??n.defaultError;return t.code==="unrecognized_keys"?{message:$.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:b.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};for(let n of se.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new r({...this._def,shape:()=>t})}omit(e){let t={};for(let n of se.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new r({...this._def,shape:()=>t})}deepPartial(){return Fs(this)}partial(e){let t={};for(let n of se.objectKeys(this.shape)){let s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}return new r({...this._def,shape:()=>t})}required(e){let t={};for(let n of se.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof _t;)i=i._def.innerType;t[n]=i}return new r({...this._def,shape:()=>t})}keyof(){return gp(se.objectKeys(this.shape))}};Xe.create=(r,e)=>new Xe({shape:()=>r,unknownKeys:"strip",catchall:Pt.create(),typeName:b.ZodObject,...Q(e)});Xe.strictCreate=(r,e)=>new Xe({shape:()=>r,unknownKeys:"strict",catchall:Pt.create(),typeName:b.ZodObject,...Q(e)});Xe.lazycreate=(r,e)=>new Xe({shape:r,unknownKeys:"strip",catchall:Pt.create(),typeName:b.ZodObject,...Q(e)});var Fn=class extends te{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let a=i.map(o=>new Ye(o.ctx.common.issues));return O(t,{code:v.invalid_union,unionErrors:a}),U}if(t.common.async)return Promise.all(n.map(async i=>{let a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i,a=[];for(let u of n){let c={...t,common:{...t.common,issues:[]},parent:null},d=u._parseSync({data:t.data,path:t.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!i&&(i={result:d,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let o=a.map(u=>new Ye(u));return O(t,{code:v.invalid_union,unionErrors:o}),U}}get options(){return this._def.options}};Fn.create=(r,e)=>new Fn({options:r,typeName:b.ZodUnion,...Q(e)});var wr=r=>r instanceof Zn?wr(r.schema):r instanceof bt?wr(r.innerType()):r instanceof qn?[r.value]:r instanceof Gn?r.options:r instanceof Hn?se.objectValues(r.enum):r instanceof Vn?wr(r._def.innerType):r instanceof Dn?[void 0]:r instanceof Un?[null]:r instanceof _t?[void 0,...wr(r.unwrap())]:r instanceof Kt?[null,...wr(r.unwrap())]:r instanceof la||r instanceof Jn?wr(r.unwrap()):r instanceof Kn?wr(r._def.innerType):[],vo=class r extends te{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==T.object)return O(t,{code:v.invalid_type,expected:T.object,received:t.parsedType}),U;let n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(O(t,{code:v.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),U)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let s=new Map;for(let i of t){let a=wr(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new r({typeName:b.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...Q(n)})}};function Zc(r,e){let t=Ht(r),n=Ht(e);if(r===e)return{valid:!0,data:r};if(t===T.object&&n===T.object){let s=se.objectKeys(e),i=se.objectKeys(r).filter(o=>s.indexOf(o)!==-1),a={...r,...e};for(let o of i){let u=Zc(r[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===T.array&&n===T.array){if(r.length!==e.length)return{valid:!1};let s=[];for(let i=0;i<r.length;i++){let a=r[i],o=e[i],u=Zc(a,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===T.date&&n===T.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var Bn=class extends te{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=(i,a)=>{if(wo(i)||wo(a))return U;let o=Zc(i.value,a.value);return o.valid?((xo(i)||xo(a))&&t.dirty(),{status:t.value,value:o.data}):(O(n,{code:v.invalid_intersection_types}),U)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Bn.create=(r,e,t)=>new Bn({left:r,right:e,typeName:b.ZodIntersection,...Q(t)});var Vt=class r extends te{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.array)return O(n,{code:v.invalid_type,expected:T.array,received:n.parsedType}),U;if(n.data.length<this._def.items.length)return O(n,{code:v.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),U;!this._def.rest&&n.data.length>this._def.items.length&&(O(n,{code:v.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...n.data].map((a,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new yt(n,a,n.path,o)):null}).filter(a=>!!a);return n.common.async?Promise.all(i).then(a=>Ne.mergeArray(t,a)):Ne.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};Vt.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Vt({items:r,typeName:b.ZodTuple,rest:null,...Q(e)})};var Ao=class r extends te{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.object)return O(n,{code:v.invalid_type,expected:T.object,received:n.parsedType}),U;let s=[],i=this._def.keyType,a=this._def.valueType;for(let o in n.data)s.push({key:i._parse(new yt(n,o,n.path,o)),value:a._parse(new yt(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?Ne.mergeObjectAsync(t,s):Ne.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof te?new r({keyType:e,valueType:t,typeName:b.ZodRecord,...Q(n)}):new r({keyType:Vr.create(),valueType:e,typeName:b.ZodRecord,...Q(t)})}},qs=class extends te{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.map)return O(n,{code:v.invalid_type,expected:T.map,received:n.parsedType}),U;let s=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([o,u],c)=>({key:s._parse(new yt(n,o,n.path,[c,"key"])),value:i._parse(new yt(n,u,n.path,[c,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of a){let c=await u.key,d=await u.value;if(c.status==="aborted"||d.status==="aborted")return U;(c.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(c.value,d.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let u of a){let c=u.key,d=u.value;if(c.status==="aborted"||d.status==="aborted")return U;(c.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(c.value,d.value)}return{status:t.value,value:o}}}};qs.create=(r,e,t)=>new qs({valueType:e,keyType:r,typeName:b.ZodMap,...Q(t)});var Gs=class r extends te{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.set)return O(n,{code:v.invalid_type,expected:T.set,received:n.parsedType}),U;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(O(n,{code:v.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(O(n,{code:v.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let i=this._def.valueType;function a(u){let c=new Set;for(let d of u){if(d.status==="aborted")return U;d.status==="dirty"&&t.dirty(),c.add(d.value)}return{status:t.value,value:c}}let o=[...n.data.values()].map((u,c)=>i._parse(new yt(n,u,n.path,c)));return n.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new r({...this._def,minSize:{value:e,message:$.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:$.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Gs.create=(r,e)=>new Gs({valueType:r,minSize:null,maxSize:null,typeName:b.ZodSet,...Q(e)});var Eo=class r extends te{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==T.function)return O(t,{code:v.invalid_type,expected:T.function,received:t.parsedType}),U;function n(o,u){return ca({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ds(),br].filter(c=>!!c),issueData:{code:v.invalid_arguments,argumentsError:u}})}function s(o,u){return ca({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ds(),br].filter(c=>!!c),issueData:{code:v.invalid_return_type,returnTypeError:u}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Jr){let o=this;return ze(async function(...u){let c=new Ye([]),d=await o._def.args.parseAsync(u,i).catch(p=>{throw c.addIssue(n(u,p)),c}),l=await Reflect.apply(a,this,d);return await o._def.returns._def.type.parseAsync(l,i).catch(p=>{throw c.addIssue(s(l,p)),c})})}else{let o=this;return ze(function(...u){let c=o._def.args.safeParse(u,i);if(!c.success)throw new Ye([n(u,c.error)]);let d=Reflect.apply(a,this,c.data),l=o._def.returns.safeParse(d,i);if(!l.success)throw new Ye([s(d,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:Vt.create(e).rest(xr.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r({args:e||Vt.create([]).rest(xr.create()),returns:t||xr.create(),typeName:b.ZodFunction,...Q(n)})}},Zn=class extends te{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Zn.create=(r,e)=>new Zn({getter:r,typeName:b.ZodLazy,...Q(e)});var qn=class extends te{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return O(t,{received:t.data,code:v.invalid_literal,expected:this._def.value}),U}return{status:"valid",value:e.data}}get value(){return this._def.value}};qn.create=(r,e)=>new qn({value:r,typeName:b.ZodLiteral,...Q(e)});function gp(r,e){return new Gn({values:r,typeName:b.ZodEnum,...Q(e)})}var Gn=class r extends te{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return O(t,{expected:se.joinValues(n),received:t.parsedType,code:v.invalid_type}),U}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return O(t,{received:t.data,code:v.invalid_enum_value,options:n}),U}return ze(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}};Gn.create=gp;var Hn=class extends te{_parse(e){let t=se.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==T.string&&n.parsedType!==T.number){let s=se.objectValues(t);return O(n,{expected:se.joinValues(s),received:n.parsedType,code:v.invalid_type}),U}if(this._cache||(this._cache=new Set(se.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let s=se.objectValues(t);return O(n,{received:n.data,code:v.invalid_enum_value,options:s}),U}return ze(e.data)}get enum(){return this._def.values}};Hn.create=(r,e)=>new Hn({values:r,typeName:b.ZodNativeEnum,...Q(e)});var Jr=class extends te{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==T.promise&&t.common.async===!1)return O(t,{code:v.invalid_type,expected:T.promise,received:t.parsedType}),U;let n=t.parsedType===T.promise?t.data:Promise.resolve(t.data);return ze(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Jr.create=(r,e)=>new Jr({type:r,typeName:b.ZodPromise,...Q(e)});var bt=class extends te{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===b.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{O(n,a),a.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){let a=s.transform(n.data,i);if(n.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return U;let u=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return u.status==="aborted"?U:u.status==="dirty"?$n(u.value):t.value==="dirty"?$n(u.value):u});{if(t.value==="aborted")return U;let o=this._def.schema._parseSync({data:a,path:n.path,parent:n});return o.status==="aborted"?U:o.status==="dirty"?$n(o.value):t.value==="dirty"?$n(o.value):o}}if(s.type==="refinement"){let a=o=>{let u=s.refinement(o,i);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?U:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?U:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Hr(a))return U;let o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>Hr(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):U);se.assertNever(s)}};bt.create=(r,e,t)=>new bt({schema:r,typeName:b.ZodEffects,effect:e,...Q(t)});bt.createWithPreprocess=(r,e,t)=>new bt({schema:e,effect:{type:"preprocess",transform:r},typeName:b.ZodEffects,...Q(t)});var _t=class extends te{_parse(e){return this._getType(e)===T.undefined?ze(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};_t.create=(r,e)=>new _t({innerType:r,typeName:b.ZodOptional,...Q(e)});var Kt=class extends te{_parse(e){return this._getType(e)===T.null?ze(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Kt.create=(r,e)=>new Kt({innerType:r,typeName:b.ZodNullable,...Q(e)});var Vn=class extends te{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===T.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Vn.create=(r,e)=>new Vn({innerType:r,typeName:b.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Q(e)});var Kn=class extends te{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Us(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ye(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ye(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Kn.create=(r,e)=>new Kn({innerType:r,typeName:b.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Q(e)});var Hs=class extends te{_parse(e){if(this._getType(e)!==T.nan){let n=this._getOrReturnCtx(e);return O(n,{code:v.invalid_type,expected:T.nan,received:n.parsedType}),U}return{status:"valid",value:e.data}}};Hs.create=r=>new Hs({typeName:b.ZodNaN,...Q(r)});var Mw=Symbol("zod_brand"),la=class extends te{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},da=class r extends te{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?U:i.status==="dirty"?(t.dirty(),$n(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?U:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:b.ZodPipeline})}},Jn=class extends te{_parse(e){let t=this._def.innerType._parse(e),n=s=>(Hr(s)&&(s.value=Object.freeze(s.value)),s);return Us(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}};Jn.create=(r,e)=>new Jn({innerType:r,typeName:b.ZodReadonly,...Q(e)});function fp(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function _p(r,e={},t){return r?Kr.create().superRefine((n,s)=>{let i=r(n);if(i instanceof Promise)return i.then(a=>{if(!a){let o=fp(e,n),u=o.fatal??t??!0;s.addIssue({code:"custom",...o,fatal:u})}});if(!i){let a=fp(e,n),o=a.fatal??t??!0;s.addIssue({code:"custom",...a,fatal:o})}}):Kr.create()}var zw={object:Xe.lazycreate},b;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(b||(b={}));var Lw=(r,e={message:`Input not instance of ${r.name}`})=>_p(t=>t instanceof r,e),yp=Vr.create,bp=jn.create,Dw=Hs.create,Uw=Mn.create,wp=zn.create,Fw=Ln.create,Bw=Bs.create,Zw=Dn.create,qw=Un.create,Gw=Kr.create,Hw=xr.create,Vw=Pt.create,Kw=Zs.create,Jw=vr.create,Ww=Xe.create,Yw=Xe.strictCreate,Xw=Fn.create,Qw=vo.create,ex=Bn.create,tx=Vt.create,rx=Ao.create,nx=qs.create,sx=Gs.create,ix=Eo.create,ax=Zn.create,ox=qn.create,ux=Gn.create,cx=Hn.create,lx=Jr.create,dx=bt.create,fx=_t.create,px=Kt.create,hx=bt.createWithPreprocess,mx=da.create,gx=()=>yp().optional(),_x=()=>bp().optional(),yx=()=>wp().optional(),bx={string:r=>Vr.create({...r,coerce:!0}),number:r=>jn.create({...r,coerce:!0}),boolean:r=>zn.create({...r,coerce:!0}),bigint:r=>Mn.create({...r,coerce:!0}),date:r=>Ln.create({...r,coerce:!0})};var wx=U;var vd=It(To(),1);var Tp=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Ix(r){return typeof r=="string"&&Tp.test(r)}var Wr=Ix;function Tx(r){if(!Wr(r))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Pp=Tx;var Ce=[];for(Po=0;Po<256;++Po)Ce.push((Po+256).toString(16).slice(1));var Po;function So(r,e=0){return(Ce[r[e+0]]+Ce[r[e+1]]+Ce[r[e+2]]+Ce[r[e+3]]+"-"+Ce[r[e+4]]+Ce[r[e+5]]+"-"+Ce[r[e+6]]+Ce[r[e+7]]+"-"+Ce[r[e+8]]+Ce[r[e+9]]+"-"+Ce[r[e+10]]+Ce[r[e+11]]+Ce[r[e+12]]+Ce[r[e+13]]+Ce[r[e+14]]+Ce[r[e+15]]).toLowerCase()}var ko,Px=new Uint8Array(16);function qc(){if(!ko&&(ko=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ko))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ko(Px)}function Sx(r){r=unescape(encodeURIComponent(r));for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}var kx="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Rx="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Gc(r,e,t){function n(s,i,a,o){var u;if(typeof s=="string"&&(s=Sx(s)),typeof i=="string"&&(i=Pp(i)),((u=i)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+s.length);if(c.set(i),c.set(s,i.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,a){o=o||0;for(var d=0;d<16;++d)a[o+d]=c[d];return a}return So(c)}try{n.name=r}catch{}return n.DNS=kx,n.URL=Rx,n}var Nx=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Hc={randomUUID:Nx};function Cx(r,e,t){if(Hc.randomUUID&&!e&&!r)return Hc.randomUUID();r=r||{};var n=r.random||(r.rng||qc)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=n[s];return e}return So(n)}var ye=Cx;function $x(r,e,t,n){switch(r){case 0:return e&t^~e&n;case 1:return e^t^n;case 2:return e&t^e&n^t&n;case 3:return e^t^n}}function Vc(r,e){return r<<e|r>>>32-e}function jx(r){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){var n=unescape(encodeURIComponent(r));r=[];for(var s=0;s<n.length;++s)r.push(n.charCodeAt(s))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);for(var i=r.length/4+2,a=Math.ceil(i/16),o=new Array(a),u=0;u<a;++u){for(var c=new Uint32Array(16),d=0;d<16;++d)c[d]=r[u*64+d*4]<<24|r[u*64+d*4+1]<<16|r[u*64+d*4+2]<<8|r[u*64+d*4+3];o[u]=c}o[a-1][14]=(r.length-1)*8/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=(r.length-1)*8&4294967295;for(var l=0;l<a;++l){for(var f=new Uint32Array(80),p=0;p<16;++p)f[p]=o[l][p];for(var h=16;h<80;++h)f[h]=Vc(f[h-3]^f[h-8]^f[h-14]^f[h-16],1);for(var m=t[0],g=t[1],y=t[2],_=t[3],w=t[4],A=0;A<80;++A){var E=Math.floor(A/20),L=Vc(m,5)+$x(E,g,y,_)+w+e[E]+f[A]>>>0;w=_,_=y,y=Vc(g,30)>>>0,g=m,m=L}t[0]=t[0]+m>>>0,t[1]=t[1]+g>>>0,t[2]=t[2]+y>>>0,t[3]=t[3]+_>>>0,t[4]=t[4]+w>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var Sp=jx;var Mx=Gc("v5",80,Sp),Ro=Mx;var Wc=class{getStore(){}run(e,t){return t()}},Jc=Symbol.for("ls:tracing_async_local_storage"),zx=new Wc,Yc=class{getInstance(){return globalThis[Jc]??zx}initializeGlobalInstance(e){globalThis[Jc]===void 0&&(globalThis[Jc]=e)}},Lx=new Yc;function kp(r=!1){let e=Lx.getInstance().getStore();if(!r&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}var $S=Symbol.for("langsmith:traceable:root");function No(r){return typeof r=="function"&&"langsmith:traceable"in r}var Xc={};Cc(Xc,{JsonPatchError:()=>be,_areEquals:()=>pa,applyOperation:()=>Xn,applyPatch:()=>Yr,applyReducer:()=>Bx,deepClone:()=>Ux,getValueByPointer:()=>zo,validate:()=>Np,validator:()=>Lo});var Dx=Object.prototype.hasOwnProperty;function $o(r,e){return Dx.call(r,e)}function jo(r){if(Array.isArray(r)){let t=new Array(r.length);for(let n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(r);let e=[];for(let t in r)$o(r,t)&&e.push(t);return e}function Le(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function Mo(r){let e=0,t=r.length,n;for(;e<t;){if(n=r.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function Jt(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function fa(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function Co(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(Co(r[t]))return!0}else if(typeof r=="object"){let t=jo(r),n=t.length;for(var e=0;e<n;e++)if(Co(r[t[e]]))return!0}}return!1}function Rp(r,e){let t=[r];for(let n in e){let s=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof s<"u"&&t.push(`${n}: ${s}`)}return t.join(`
`)}var Yn=class extends Error{constructor(e,t,n,s,i){super(Rp(e,{name:t,index:n,operation:s,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=Rp(e,{name:t,index:n,operation:s,tree:i})}};var be=Yn,Ux=Le,Vs={add:function(r,e,t){return r[e]=this.value,{newDocument:t}},remove:function(r,e,t){var n=r[e];return delete r[e],{newDocument:t,removed:n}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:function(r,e,t){let n=zo(t,this.path);n&&(n=Le(n));let s=Xn(t,{op:"remove",path:this.from}).removed;return Xn(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:n}},copy:function(r,e,t){let n=zo(t,this.from);return Xn(t,{op:"add",path:this.path,value:Le(n)}),{newDocument:t}},test:function(r,e,t){return{newDocument:t,test:pa(r[e],this.value)}},_get:function(r,e,t){return this.value=r[e],{newDocument:t}}},Fx={add:function(r,e,t){return Mo(e)?r.splice(e,0,this.value):r[e]=this.value,{newDocument:t,index:e}},remove:function(r,e,t){var n=r.splice(e,1);return{newDocument:t,removed:n[0]}},replace:function(r,e,t){var n=r[e];return r[e]=this.value,{newDocument:t,removed:n}},move:Vs.move,copy:Vs.copy,test:Vs.test,_get:Vs._get};function zo(r,e){if(e=="")return r;var t={op:"_get",path:e};return Xn(r,t),t.value}function Xn(r,e,t=!1,n=!0,s=!0,i=0){if(t&&(typeof t=="function"?t(e,0,r,e.path):Lo(e,0)),e.path===""){let a={newDocument:r};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=r,a;if(e.op==="move"||e.op==="copy")return a.newDocument=zo(r,e.from),e.op==="move"&&(a.removed=r),a;if(e.op==="test"){if(a.test=pa(r,e.value),a.test===!1)throw new be("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return a.newDocument=r,a}else{if(e.op==="remove")return a.removed=r,a.newDocument=null,a;if(e.op==="_get")return e.value=r,a;if(t)throw new be("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,r);return a}}else{n||(r=Le(r));let o=(e.path||"").split("/"),u=r,c=1,d=o.length,l,f,p;for(typeof t=="function"?p=t:p=Lo;;){if(f=o[c],f&&f.indexOf("~")!=-1&&(f=fa(f)),s&&(f=="__proto__"||f=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&l===void 0&&(u[f]===void 0?l=o.slice(0,c).join("/"):c==d-1&&(l=e.path),l!==void 0&&p(e,0,r,l)),c++,Array.isArray(u)){if(f==="-")f=u.length;else{if(t&&!Mo(f))throw new be("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,r);Mo(f)&&(f=~~f)}if(c>=d){if(t&&e.op==="add"&&f>u.length)throw new be("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,r);let h=Fx[e.op].call(e,u,f,r);if(h.test===!1)throw new be("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return h}}else if(c>=d){let h=Vs[e.op].call(e,u,f,r);if(h.test===!1)throw new be("Test operation failed","TEST_OPERATION_FAILED",i,e,r);return h}if(u=u[f],t&&c<d&&(!u||typeof u!="object"))throw new be("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,r)}}}function Yr(r,e,t,n=!0,s=!0){if(t&&!Array.isArray(e))throw new be("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(r=Le(r));let i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=Xn(r,e[a],t,!0,s,a),r=i[a].newDocument;return i.newDocument=r,i}function Bx(r,e,t){let n=Xn(r,e);if(n.test===!1)throw new be("Test operation failed","TEST_OPERATION_FAILED",t,e,r);return n.newDocument}function Lo(r,e,t,n){if(typeof r!="object"||r===null||Array.isArray(r))throw new be("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,r,t);if(Vs[r.op]){if(typeof r.path!="string")throw new be("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,r,t);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new be('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,r,t);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new be("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new be("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,r,t);if((r.op==="add"||r.op==="replace"||r.op==="test")&&Co(r.value))throw new be("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,r,t);if(t){if(r.op=="add"){var s=r.path.split("/").length,i=n.split("/").length;if(s!==i+1&&s!==i)throw new be("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,r,t)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==n)throw new be("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,r,t)}else if(r.op==="move"||r.op==="copy"){var a={op:"_get",path:r.from,value:void 0},o=Np([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new be("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,r,t)}}}else throw new be("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,r,t)}function Np(r,e,t){try{if(!Array.isArray(r))throw new be("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Yr(Le(e),Le(r),t||!0);else{t=t||Lo;for(var n=0;n<r.length;n++)t(r[n],n,e,void 0)}}catch(s){if(s instanceof be)return s;throw s}}function pa(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){var t=Array.isArray(r),n=Array.isArray(e),s,i,a;if(t&&n){if(i=r.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!pa(r[s],e[s]))return!1;return!0}if(t!=n)return!1;var o=Object.keys(r);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!pa(r[a],e[a]))return!1;return!0}return r!==r&&e!==e}function Cp(r,e,t,n,s){if(e!==r){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=jo(e),a=jo(r),o=!1,u=!1,c=a.length-1;c>=0;c--){var d=a[c],l=r[d];if($o(e,d)&&!(e[d]===void 0&&l!==void 0&&Array.isArray(e)===!1)){var f=e[d];typeof l=="object"&&l!=null&&typeof f=="object"&&f!=null&&Array.isArray(l)===Array.isArray(f)?Cp(l,f,t,n+"/"+Jt(d),s):l!==f&&(o=!0,s&&t.push({op:"test",path:n+"/"+Jt(d),value:Le(l)}),t.push({op:"replace",path:n+"/"+Jt(d),value:Le(f)}))}else Array.isArray(r)===Array.isArray(e)?(s&&t.push({op:"test",path:n+"/"+Jt(d),value:Le(l)}),t.push({op:"remove",path:n+"/"+Jt(d)}),u=!0):(s&&t.push({op:"test",path:n,value:r}),t.push({op:"replace",path:n,value:e}),o=!0)}if(!(!u&&i.length==a.length))for(var c=0;c<i.length;c++){var d=i[c];!$o(r,d)&&e[d]!==void 0&&t.push({op:"add",path:n+"/"+Jt(d),value:Le(e[d])})}}}function Do(r,e,t=!1){var n=[];return Cp(r,e,n,"",t),n}var qS={...Xc,JsonPatchError:Yn,deepClone:Le,escapePathComponent:Jt,unescapePathComponent:fa};var $p="gen_ai.operation.name",jp="gen_ai.system",Qc="gen_ai.request.model",Mp="gen_ai.response.model",el="gen_ai.usage.input_tokens",tl="gen_ai.usage.output_tokens",rl="gen_ai.usage.total_tokens",zp="gen_ai.request.max_tokens",Lp="gen_ai.request.temperature",Dp="gen_ai.request.top_p",Up="gen_ai.request.frequency_penalty",Fp="gen_ai.request.presence_penalty",Bp="gen_ai.response.finish_reasons",Zp="gen_ai.prompt",qp="gen_ai.completion",Gp="gen_ai.request.extra_query",Hp="gen_ai.request.extra_body",Vp="gen_ai.serialized.name",Kp="gen_ai.serialized.signature",Jp="gen_ai.serialized.doc",Wp="gen_ai.response.id",Yp="gen_ai.response.service_tier",Xp="gen_ai.response.system_fingerprint",Qp="gen_ai.usage.input_token_details",eh="gen_ai.usage.output_token_details",th="langsmith.trace.session_id",rh="langsmith.trace.session_name",nh="langsmith.span.kind",sh="langsmith.trace.name",ih="langsmith.metadata",nl="langsmith.span.tags";var ah="langsmith.request.streaming",oh="langsmith.request.headers";var qx=(...r)=>fetch(...r),uh=Symbol.for("ls:fetch_implementation");var ch=()=>{let r=globalThis[uh];return r?typeof r=="function"&&"Headers"in r&&"Request"in r&&"Response"in r:!1},lh=r=>async(...e)=>{if(r||ve("DEBUG")==="true"){let[n,s]=e;console.log(`\u2192 ${s?.method||"GET"} ${n}`)}let t=await(globalThis[uh]??qx)(...e);return(r||ve("DEBUG")==="true")&&console.log(`\u2190 ${t.status} ${t.statusText} ${t.url}`),t};var ha=()=>ve("PROJECT")??ot("LANGCHAIN_SESSION")??"default";var Uo="0.3.77";var Wt,Gx=()=>typeof window<"u"&&typeof window.document<"u",Hx=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Vx=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),dh=()=>typeof Deno<"u",Kx=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!dh(),al=()=>Wt||(typeof Bun<"u"?Wt="bun":Gx()?Wt="browser":Kx()?Wt="node":Hx()?Wt="webworker":Vx()?Wt="jsdom":dh()?Wt="deno":Wt="other",Wt),sl;function Fo(){if(sl===void 0){let r=al(),e=Wx();sl={library:"langsmith",runtime:r,sdk:"langsmith-js",sdk_version:Uo,...e}}return sl}function ol(){let r=Jx(),e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[n,s]of Object.entries(r))typeof s=="string"&&!t.includes(n)&&!n.toLowerCase().includes("key")&&!n.toLowerCase().includes("secret")&&!n.toLowerCase().includes("token")&&(n==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[n]=s);return e}function Jx(){let r={};try{if(typeof process<"u"&&process.env)for(let[e,t]of Object.entries(process.env))(e.startsWith("LANGCHAIN_")||e.startsWith("LANGSMITH_"))&&t!=null&&((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&typeof t=="string"?r[e]=t.slice(0,2)+"*".repeat(t.length-4)+t.slice(-2):r[e]=t)}catch{}return r}function ot(r){try{return typeof process<"u"?process.env?.[r]:void 0}catch{return}}function ve(r){return ot(`LANGSMITH_${r}`)||ot(`LANGCHAIN_${r}`)}var il;function Wx(){if(il!==void 0)return il;let r=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of r){let n=ot(t);n!==void 0&&(e[t]=n)}return il=e,e}function Bo(){return ot("OTEL_ENABLED")==="true"||ve("OTEL_ENABLED")==="true"}var ll=class{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){!this.hasWarned&&Bo()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let n;if(t.length===1&&typeof t[0]=="function"?n=t[0]:t.length===2&&typeof t[1]=="function"?n=t[1]:t.length===3&&typeof t[2]=="function"&&(n=t[2]),typeof n=="function")return n()}},dl=class{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new ll})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}},fl=class{active(){return{}}with(e,t){return t()}},ul=Symbol.for("ls:otel_trace"),cl=Symbol.for("ls:otel_context"),fh=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),Yx=new dl,Xx=new fl,pl=class{getTraceInstance(){return globalThis[ul]??Yx}getContextInstance(){return globalThis[cl]??Xx}initializeGlobalInstances(e){globalThis[ul]===void 0&&(globalThis[ul]=e.trace),globalThis[cl]===void 0&&(globalThis[cl]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[fh]=e}getDefaultOTLPTracerComponents(){return globalThis[fh]??void 0}},hl=new pl;function Zo(){return hl.getTraceInstance()}function ph(){return hl.getContextInstance()}function hh(){return hl.getDefaultOTLPTracerComponents()}var Qx={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function ev(r){return Qx[r]||r}var qo=class{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(let n of e)try{if(!n.run)continue;if(n.operation==="post"){let s=this.createSpanForRun(n,n.run,t.get(n.id));s&&!n.run.end_time&&this.spans.set(n.id,s)}else this.updateSpanForRun(n,n.run)}catch(s){console.error(`Error processing operation ${n.id}:`,s)}}createSpanForRun(e,t,n){let s=n&&Zo().getSpan(n);if(s)try{return this.finishSpanSetup(s,t,e)}catch(i){console.error(`Failed to create span for run ${e.id}:`,i);return}}finishSpanSetup(e,t,n){return this.setSpanAttributes(e,t,n),t.error?(e.setStatus({code:2}),e.recordException(new Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{let n=this.spans.get(e.id);if(!n){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(n,t,e),t.error?(n.setStatus({code:2}),n.recordException(new Error(t.error))):n.setStatus({code:1});let s=t.end_time;s&&(n.end(new Date(s)),this.spans.delete(e.id))}catch(n){console.error(`Failed to update span for run ${e.id}:`,n)}}extractModelName(e){if(e.extra?.metadata){let t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){let n=t.invocation_params;if(n.model)return n.model;if(n.model_name)return n.model_name}}}setSpanAttributes(e,t,n){if("run_type"in t&&t.run_type){e.setAttribute(nh,t.run_type);let o=ev(t.run_type||"chain");e.setAttribute($p,o)}"name"in t&&t.name&&e.setAttribute(sh,t.name),"session_id"in t&&t.session_id&&e.setAttribute(th,t.session_id),"session_name"in t&&t.session_name&&e.setAttribute(rh,t.session_name),this.setGenAiSystem(e,t);let s=this.extractModelName(t);s&&e.setAttribute(Qc,s),"prompt_tokens"in t&&typeof t.prompt_tokens=="number"&&e.setAttribute(el,t.prompt_tokens),"completion_tokens"in t&&typeof t.completion_tokens=="number"&&e.setAttribute(tl,t.completion_tokens),"total_tokens"in t&&typeof t.total_tokens=="number"&&e.setAttribute(rl,t.total_tokens),this.setInvocationParameters(e,t);let i=t.extra?.metadata||{};for(let[o,u]of Object.entries(i))u!=null&&e.setAttribute(`${ih}.${o}`,String(u));let a=t.tags;if(a&&Array.isArray(a)?e.setAttribute(nl,a.join(", ")):a&&e.setAttribute(nl,String(a)),"serialized"in t&&typeof t.serialized=="object"){let o=t.serialized;o.name&&e.setAttribute(Vp,String(o.name)),o.signature&&e.setAttribute(Kp,String(o.signature)),o.doc&&e.setAttribute(Jp,String(o.doc))}this.setIOAttributes(e,n)}setGenAiSystem(e,t){let n="langchain",s=this.extractModelName(t);if(s){let i=s.toLowerCase();i.includes("anthropic")||i.startsWith("claude")?n="anthropic":i.includes("bedrock")?n="aws.bedrock":i.includes("azure")&&i.includes("openai")?n="az.ai.openai":i.includes("azure")&&i.includes("inference")?n="az.ai.inference":i.includes("cohere")?n="cohere":i.includes("deepseek")?n="deepseek":i.includes("gemini")?n="gemini":i.includes("groq")?n="groq":i.includes("watson")||i.includes("ibm")?n="ibm.watsonx.ai":i.includes("mistral")?n="mistral_ai":i.includes("gpt")||i.includes("openai")?n="openai":i.includes("perplexity")||i.includes("sonar")?n="perplexity":i.includes("vertex")?n="vertex_ai":(i.includes("xai")||i.includes("grok"))&&(n="xai")}e.setAttribute(jp,n)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;let n=t.extra.metadata.invocation_params;n.max_tokens!==void 0&&e.setAttribute(zp,n.max_tokens),n.temperature!==void 0&&e.setAttribute(Lp,n.temperature),n.top_p!==void 0&&e.setAttribute(Dp,n.top_p),n.frequency_penalty!==void 0&&e.setAttribute(Up,n.frequency_penalty),n.presence_penalty!==void 0&&e.setAttribute(Fp,n.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{let n=t.run.inputs;typeof n=="object"&&n!==null&&(n.model&&Array.isArray(n.messages)&&e.setAttribute(Qc,n.model),n.stream!==void 0&&e.setAttribute(ah,n.stream),n.extra_headers&&e.setAttribute(oh,JSON.stringify(n.extra_headers)),n.extra_query&&e.setAttribute(Gp,JSON.stringify(n.extra_query)),n.extra_body&&e.setAttribute(Hp,JSON.stringify(n.extra_body))),e.setAttribute(Zp,JSON.stringify(n))}catch(n){console.debug(`Failed to process inputs for run ${t.id}`,n)}if(t.run.outputs)try{let n=t.run.outputs,s=this.getUnifiedRunTokens(n);if(s&&(e.setAttribute(el,s[0]),e.setAttribute(tl,s[1]),e.setAttribute(rl,s[0]+s[1])),n&&typeof n=="object"){if(n.model&&e.setAttribute(Mp,String(n.model)),n.id&&e.setAttribute(Wp,n.id),n.choices&&Array.isArray(n.choices)){let i=n.choices.map(a=>a.finish_reason).filter(a=>a).map(String);i.length>0&&e.setAttribute(Bp,i.join(", "))}if(n.service_tier&&e.setAttribute(Yp,n.service_tier),n.system_fingerprint&&e.setAttribute(Xp,n.system_fingerprint),n.usage_metadata&&typeof n.usage_metadata=="object"){let i=n.usage_metadata;i.input_token_details&&e.setAttribute(Qp,JSON.stringify(i.input_token_details)),i.output_token_details&&e.setAttribute(eh,JSON.stringify(i.output_token_details))}}e.setAttribute(qp,JSON.stringify(n))}catch(n){console.debug(`Failed to process outputs for run ${t.id}`,n)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;let n=Object.keys(e);for(let a of n){let o=e[a];if(!(!o||typeof o!="object")&&(t=this.extractUnifiedRunTokens(o.usage_metadata),t||o.lc===1&&o.kwargs&&typeof o.kwargs=="object"&&(t=this.extractUnifiedRunTokens(o.kwargs.usage_metadata),t)))return t}let s=e.generations||[];if(!Array.isArray(s))return null;let i=Array.isArray(s[0])?s.flat():s;for(let a of i)if(typeof a=="object"&&a.message&&typeof a.message=="object"&&a.message.kwargs&&typeof a.message.kwargs=="object"&&(t=this.extractUnifiedRunTokens(a.message.kwargs.usage_metadata),t))return t;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}};var Eh=It(To(),1),Wo=It(Jo(),1),cv=[429,500,502,503,504],ga=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Wo.default?this.queue=new Wo.default.default({concurrency:this.maxConcurrency}):this.queue=new Wo.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let n=this.onFailedResponseHook;return this.queue.add(()=>(0,Eh.default)(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.name==="TimeoutError"||s.message.startsWith("AbortError")||s?.code==="ECONNABORTED")throw s;let i=s?.response;if(n&&await n(i))return;let a=i?.status??s?.status;if(a&&!cv.includes(+a))throw s},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{e.signal?.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}};function xl(r){return typeof r?._getType=="function"}function vl(r){let e={type:r._getType(),data:{content:r.content}};return r?.additional_kwargs&&Object.keys(r.additional_kwargs).length>0&&(e.data.additional_kwargs={...r.additional_kwargs}),e}var lv=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function W(r,e){if(!lv.test(r)){let t=e!==void 0?`Invalid UUID for ${e}: ${r}`:`Invalid UUID: ${r}`;throw new Error(t)}return r}var Oh={};function _a(r){Oh[r]||(console.warn(r),Oh[r]=!0)}var aE=It(hg(),1);function Ar(r){if(!r||r.split("/").length>2||r.startsWith("/")||r.endsWith("/")||r.split(":").length>2)throw new Error(`Invalid identifier format: ${r}`);let[e,t]=r.split(":"),n=t||"latest";if(e.includes("/")){let[s,i]=e.split("/",2);if(!s||!i)throw new Error(`Invalid identifier format: ${r}`);return[s,i,n]}else{if(!e)throw new Error(`Invalid identifier format: ${r}`);return["-",e,n]}}var Bl=class extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}};async function M(r,e,t){let n;if(r.ok){t&&(n=await r.text());return}if(r.status===403)try{(await r.json())?.error==="org_scoped_key_requires_workspace"&&(n="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch{let o=new Error(`${r.status} ${r.statusText}`);throw o.status=r?.status,o}if(n===void 0)try{n=await r.text()}catch{n=""}let s=`Failed to ${e}. Received status [${r.status}]: ${r.statusText}. Message: ${n}`;if(r.status===409)throw new Bl(s);let i=new Error(s);throw i.status=r.status,i}var mg="ERR_CONFLICTING_ENDPOINTS",cu=class extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:mg}),this.name="ConflictingEndpointsError"}};function gg(r){return typeof r=="object"&&r!==null&&r.code===mg}var _g="[...]",oE={result:"[Circular]"},du=[],Js=[],uE=new TextEncoder;function cE(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function lu(r){return uE.encode(r)}function yg(r){if(r&&typeof r=="object"&&r!==null){if(r instanceof Map)return Object.fromEntries(r);if(r instanceof Set)return Array.from(r);if(r instanceof Date)return r.toISOString();if(r instanceof RegExp)return r.toString();if(r instanceof Error)return{name:r.name,message:r.message}}else if(typeof r=="bigint")return r.toString();return r}function lE(r){return function(e,t){if(r){let n=r.call(this,e,t);if(n!==void 0)return n}return yg(t)}}function Qe(r,e,t,n,s){try{let i=JSON.stringify(r,lE(t),n);return lu(i)}catch(i){if(!i.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),lu("[Unserializable]");ve("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof s>"u"&&(s=cE()),ql(r,"",0,[],void 0,0,s);let a;try{Js.length===0?a=JSON.stringify(r,t,n):a=JSON.stringify(r,dE(t),n)}catch{return lu("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;du.length!==0;){let o=du.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return lu(a)}}function Zl(r,e,t,n){var s=Object.getOwnPropertyDescriptor(n,t);s.get!==void 0?s.configurable?(Object.defineProperty(n,t,{value:r}),du.push([n,t,e,s])):Js.push([e,t,r]):(n[t]=r,du.push([n,t,e]))}function ql(r,e,t,n,s,i,a){i+=1;var o;if(typeof r=="object"&&r!==null){for(o=0;o<n.length;o++)if(n[o]===r){Zl(oE,r,e,s);return}if(typeof a.depthLimit<"u"&&i>a.depthLimit){Zl(_g,r,e,s);return}if(typeof a.edgesLimit<"u"&&t+1>a.edgesLimit){Zl(_g,r,e,s);return}if(n.push(r),Array.isArray(r))for(o=0;o<r.length;o++)ql(r[o],o,o,n,r,i,a);else{r=yg(r);var u=Object.keys(r);for(o=0;o<u.length;o++){var c=u[o];ql(r[c],c,o,n,r,i,a)}}n.pop()}}function dE(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(Js.length>0)for(var n=0;n<Js.length;n++){var s=Js[n];if(s[1]===e&&s[0]===t){t=s[2],Js.splice(n,1);break}}return r.call(this,e,t)}}function bg(r,e){let t=Fo(),n=e??ol(),s=r.extra??{},i=s.metadata;return r.extra={...s,runtime:{...t,...s?.runtime},metadata:{...n,...n.revision_id||"revision_id"in r&&r.revision_id?{revision_id:("revision_id"in r?r.revision_id:void 0)??n.revision_id}:{},...i}},r}var fE=r=>{let e=r?.toString()??ve("TRACING_SAMPLING_RATE");if(e===void 0)return;let t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},pE=r=>{let t=r.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function hE(r){let e=[];for await(let t of r)e.push(t);return e}function fu(r){if(r!==void 0)return r.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var mE=async r=>{if(r?.status===429){let e=parseInt(r.headers.get("retry-after")??"10",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function wg(r){return typeof r=="number"?Number(r.toFixed(4)):r}var Gl=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t,n=new Promise(i=>{t=i}),s=Qe(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:n,size:s}),this.sizeBytes+=s,n}pop({upToSizeBytes:e,upToSize:t}){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let n=[],s=0;for(;s+(this.peek()?.size??0)<e&&this.items.length>0&&n.length<t;){let i=this.items.shift();i&&(n.push(i),s+=i.size,this.sizeBytes-=i.size)}if(n.length===0&&this.items.length>0){let i=this.items.shift();n.push(i),s+=i.size,this.sizeBytes-=i.size}return[n.map(i=>({action:i.action,item:i.payload,otelContext:i.otelContext,apiKey:i.apiKey,apiUrl:i.apiUrl})),()=>n.forEach(i=>i.itemPromiseResolve())]}},gE=24*1024*1024,_E=1e4,yE=100,xg="https://api.smith.langchain.com",Qn=class r{get _fetch(){return this.fetchImplementation||lh(this.debug)}constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Gl}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:ot("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:ot("LANGSMITH_DEBUG")==="true"});let t=r.getDefaultClientConfig();if(this.tracingSampleRate=fE(e.tracingSamplingRate),this.apiUrl=fu(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=fu(e.apiKey??t.apiKey),this.webUrl=fu(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=fu(e.workspaceId??ve("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new ga({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation,this.batchIngestCaller=new ga({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:mE,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,Bo()&&(this.langSmithToOTELTranslator=new qo),this.cachedLSEnvVarsForMetadata=ol()}static getDefaultClientConfig(){let e=ve("API_KEY"),t=ve("ENDPOINT")??xg,n=ve("HIDE_INPUTS")==="true",s=ve("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:n,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:pE(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${Uo}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let t={...e};return t.inputs!==void 0&&(t.inputs=await this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){let n=t?.toString()??"",s=`${this.apiUrl}${e}?${n}`;return await this.caller.call(async()=>{let a=await this._fetch(s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(a,`fetch ${e}`),a})}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,n){let s=Number(t.get("offset"))||0,i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(i));let a=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(async()=>{let c=await this._fetch(a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(c,`fetch ${e}`),c}),u=n?n(await o.json()):await o.json();if(u.length===0||(yield u,u.length<i))break;s+=u.length}}async*_getCursorPaginatedList(e,t=null,n="POST",s="runs"){let i=t?{...t}:{};for(;;){let a=JSON.stringify(i),u=await(await this.caller.call(async()=>{let d=await this._fetch(`${this.apiUrl}${e}`,{method:n,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(d,`fetch ${e}`),d})).json();if(!u||!u[s])break;yield u[s];let c=u.cursors;if(!c||!c.next)break;i.cursor=c.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let n=[];for(let s of e)this.filteredPostUuids.has(s.trace_id)?s.id===s.trace_id&&this.filteredPostUuids.delete(s.trace_id):n.push(s);return n}else{let n=[];for(let s of e){let i=s.trace_id??s.id;this.filteredPostUuids.has(i)||(s.id===i?this._shouldSample()?n.push(s):this.filteredPostUuids.add(i):n.push(s))}return n}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??gE}async _getBatchSizeLimit(){let e=await this._ensureServerInfo();return this.batchSizeLimit??e.batch_ingest_config?.size_limit??yE}async _getDatasetExamplesMultiPartSupport(){return(await this._ensureServerInfo()).instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t}){let n=[];for(;this.autoBatchQueue.items.length>0;){let[s,i]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:t});if(!s.length){i();break}let a=s.reduce((c,d)=>{let l=d.apiUrl??this.apiUrl,f=d.apiKey??this.apiKey,h=d.apiKey===this.apiKey&&d.apiUrl===this.apiUrl?"default":`${l}|${f}`;return c[h]||(c[h]=[]),c[h].push(d),c},{}),o=[];for(let[c,d]of Object.entries(a)){let l=this._processBatch(d,{apiUrl:c==="default"?void 0:c.split("|")[0],apiKey:c==="default"?void 0:c.split("|")[1]});o.push(l)}let u=Promise.all(o).finally(i);n.push(u)}return Promise.all(n)}async _processBatch(e,t){if(e.length)try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{let n={runCreates:e.filter(i=>i.action==="create").map(i=>i.item),runUpdates:e.filter(i=>i.action==="update").map(i=>i.item)},s=await this._ensureServerInfo();if(s?.batch_ingest_config?.use_multipart_endpoint){let i=s?.instance_flags?.gzip_body_enabled;await this.multipartIngestRuns(n,{...t,useGzip:i})}else await this.batchIngestRuns(n,t)}}catch(n){console.error("Error exporting batch:",n)}}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){let t=new Map,n=[];for(let s of e)s.item.id&&s.otelContext&&(t.set(s.item.id,s.otelContext),s.action==="create"?n.push({operation:"post",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}):n.push({operation:"patch",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}));this.langSmithToOTELTranslator.exportBatch(n,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=bg(e.item,this.cachedLSEnvVarsForMetadata);let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let n=await this._getBatchSizeLimitBytes(),s=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>n||this.autoBatchQueue.items.length>s)&&this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:s}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:n,batchSizeLimit:s})},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){let t=await(await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(_E),...this.fetchOptions});return await M(n,"get server info"),n})).json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes(),t=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t})}_cloneCurrentOTELContext(){let e=Zo(),t=ph();if(this.langSmithToOTELTranslator!==void 0){let n=e.getActiveSpan();if(n)return e.setSpan(t.active(),n)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;let n={...this.headers,"Content-Type":"application/json"},s=e.project_name;delete e.project_name;let i=await this.prepareRunCreateOrUpdateInputs({session_name:s,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){let u=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:i,otelContext:u,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}let a=bg(i,this.cachedLSEnvVarsForMetadata);t?.apiKey!==void 0&&(n["x-api-key"]=t.apiKey),t?.workspaceId!==void 0&&(n["x-tenant-id"]=t.workspaceId);let o=Qe(a,`Creating run with id: ${a.id}`);await this.caller.call(async()=>{let u=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await M(u,"create run",!0),u})}async batchIngestRuns({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let s=await Promise.all(e?.map(u=>this.prepareRunCreateOrUpdateInputs(u))??[]),i=await Promise.all(t?.map(u=>this.prepareRunCreateOrUpdateInputs(u))??[]);if(s.length>0&&i.length>0){let u=s.reduce((d,l)=>(l.id&&(d[l.id]=l),d),{}),c=[];for(let d of i)d.id!==void 0&&u[d.id]?u[d.id]={...u[d.id],...d}:c.push(d);s=Object.values(u),i=c}let a={post:s,patch:i};if(!a.post.length&&!a.patch.length)return;let o={post:[],patch:[]};for(let u of["post","patch"]){let c=u,d=a[c].reverse(),l=d.pop();for(;l!==void 0;)o[c].push(l),l=d.pop()}if(o.post.length>0||o.patch.length>0){let u=o.post.map(c=>c.id).concat(o.patch.map(c=>c.id)).join(",");await this._postBatchIngestRuns(Qe(o,`Ingesting runs with ids: ${u}`),n)}}async _postBatchIngestRuns(e,t){let n={...this.headers,"Content-Type":"application/json",Accept:"application/json"};t?.apiKey!==void 0&&(n["x-api-key"]=t.apiKey),await this.batchIngestCaller.call(async()=>{let s=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:n,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await M(s,"batch create run",!0),s})}async multipartIngestRuns({runCreates:e,runUpdates:t},n){if(e===void 0&&t===void 0)return;let s={},i=[];for(let l of e??[]){let f=await this.prepareRunCreateOrUpdateInputs(l);f.id!==void 0&&f.attachments!==void 0&&(s[f.id]=f.attachments),delete f.attachments,i.push(f)}let a=[];for(let l of t??[])a.push(await this.prepareRunCreateOrUpdateInputs(l));if(i.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&a.length>0){let l=i.reduce((p,h)=>(h.id&&(p[h.id]=h),p),{}),f=[];for(let p of a)p.id!==void 0&&l[p.id]?l[p.id]={...l[p.id],...p}:f.push(p);i=Object.values(l),a=f}if(i.length===0&&a.length===0)return;let c=[],d=[];for(let[l,f]of[["post",i],["patch",a]])for(let p of f){let{inputs:h,outputs:m,events:g,extra:y,error:_,serialized:w,attachments:A,...E}=p,L={inputs:h,outputs:m,events:g,extra:y,error:_,serialized:w},G=Qe(E,`Serializing for multipart ingestion of run with id: ${E.id}`);d.push({name:`${l}.${E.id}`,payload:new Blob([G],{type:`application/json; length=${G.length}`})});for(let[q,ee]of Object.entries(L)){if(ee===void 0)continue;let ue=Qe(ee,`Serializing ${q} for multipart ingestion of run with id: ${E.id}`);d.push({name:`${l}.${E.id}.${q}`,payload:new Blob([ue],{type:`application/json; length=${ue.length}`})})}if(E.id!==void 0){let q=s[E.id];if(q){delete s[E.id];for(let[ee,ue]of Object.entries(q)){let ce,Gt;if(Array.isArray(ue)?[ce,Gt]=ue:(ce=ue.mimeType,Gt=ue.data),ee.includes(".")){console.warn(`Skipping attachment '${ee}' for run ${E.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}d.push({name:`attachment.${E.id}.${ee}`,payload:new Blob([Gt],{type:`${ce}; length=${Gt.byteLength}`})})}}}c.push(`trace=${E.trace_id},id=${E.id}`)}await this._sendMultipartRequest(d,c.join("; "),n)}async _createNodeFetchBody(e,t){let n=[];for(let a of e)n.push(new Blob([`--${t}\r
`])),n.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r
`,`Content-Type: ${a.payload.type}\r
\r
`])),n.push(a.payload),n.push(new Blob([`\r
`]));return n.push(new Blob([`--${t}--\r
`])),await new Blob(n).arrayBuffer()}async _createMultipartStream(e,t){let n=new TextEncoder;return new ReadableStream({async start(i){let a=async o=>{typeof o=="string"?i.enqueue(n.encode(o)):i.enqueue(o)};for(let o of e){await a(`--${t}\r
`),await a(`Content-Disposition: form-data; name="${o.name}"\r
`),await a(`Content-Type: ${o.payload.type}\r
\r
`);let c=o.payload.stream().getReader();try{let d;for(;!(d=await c.read()).done;)i.enqueue(d.value)}finally{c.releaseLock()}await a(`\r
`)}await a(`--${t}--\r
`),i.close()}})}async _sendMultipartRequest(e,t,n){let s="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),i=ch(),a=()=>this._createNodeFetchBody(e,s),o=()=>this._createMultipartStream(e,s),u=async c=>this.batchIngestCaller.call(async()=>{let d=await c(),l={...this.headers,"Content-Type":`multipart/form-data; boundary=${s}`};n?.apiKey!==void 0&&(l["x-api-key"]=n.apiKey);let f=d;n?.useGzip&&typeof d=="object"&&"pipeThrough"in d&&(f=d.pipeThrough(new CompressionStream("gzip")),l["Content-Encoding"]="gzip");let p=await this._fetch(`${n?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:l,body:f,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(p,"Failed to send multipart request",!0),p});try{let c,d=!1;!i&&!this.multipartStreamingDisabled&&al()!=="bun"?(d=!0,c=await u(o)):c=await u(a),(!this.multipartStreamingDisabled||d)&&c.status===422&&(n?.apiUrl??this.apiUrl)!==xg&&(console.warn(`Streaming multipart upload to ${n?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,c=await u(a))}catch(c){console.warn(`${c.message.trim()}

Context: ${t}`)}}async updateRun(e,t,n){W(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));let s={...t,id:e};if(!this._filterForSampling([s],!0).length)return;if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){let o=this._cloneCurrentOTELContext();if(t.end_time!==void 0&&s.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:n?.apiKey,apiUrl:n?.apiUrl}).catch(console.error);return}let i={...this.headers,"Content-Type":"application/json"};n?.apiKey!==void 0&&(i["x-api-key"]=n.apiKey),n?.workspaceId!==void 0&&(i["x-tenant-id"]=n.workspaceId);let a=Qe(t,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{let o=await this._fetch(`${n?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(o,"update run",!0),o})}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){W(e);let n=await this._get(`/runs/${e}`);return t&&(n=await this._loadChildRuns(n)),n}async getRunUrl({runId:e,run:t,projectOpts:n}){if(t!==void 0){let s;t.session_id?s=t.session_id:n?.projectName?s=(await this.readProject({projectName:n?.projectName})).id:n?.projectId?s=n?.projectId:s=(await this.readProject({projectName:ve("PROJECT")||"default"})).id;let i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){let s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await hE(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),n={},s={};t.sort((i,a)=>(i?.dotted_order??"").localeCompare(a?.dotted_order??""));for(let i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.dotted_order?.startsWith(e.dotted_order??"")&&i.id!==e.id&&(i.parent_run_id in n||(n[i.parent_run_id]=[]),n[i.parent_run_id].push(i),s[i.id]=i)}e.child_runs=n[e.id]||[];for(let i in n)i!==e.id&&(s[i].child_runs=n[i]);return e}async*listRuns(e){let{projectId:t,projectName:n,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:u,isRoot:c,runType:d,error:l,id:f,query:p,filter:h,traceFilter:m,treeFilter:g,limit:y,select:_,order:w}=e,A=[];if(t&&(A=Array.isArray(t)?t:[t]),n){let q=Array.isArray(n)?n:[n],ee=await Promise.all(q.map(ue=>this.readProject({projectName:ue}).then(ce=>ce.id)));A.push(...ee)}let E=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],L={session:A.length?A:null,run_type:d,reference_example:a,query:p,filter:h,trace_filter:m,tree_filter:g,execution_order:u,parent_run:s,start_time:o?o.toISOString():null,error:l,id:f,limit:y,trace:i,select:_||E,is_root:c,order:w};L.select.includes("child_run_ids")&&_a("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let G=0;for await(let q of this._getCursorPaginatedList("/runs/query",L))if(y){if(G>=y)break;if(q.length+G>y){yield*q.slice(0,y-G);break}G+=q.length,yield*q}else yield*q}async*listGroupRuns(e){let{projectId:t,projectName:n,groupBy:s,filter:i,startTime:a,endTime:o,limit:u,offset:c}=e,l={session_id:t||(await this.readProject({projectName:n})).id,group_by:s,filter:i,start_time:a?a.toISOString():null,end_time:o?o.toISOString():null,limit:Number(u)||100},f=Number(c)||0,p="/runs/group",h=`${this.apiUrl}${p}`;for(;;){let m={...l,offset:f},g=Object.fromEntries(Object.entries(m).filter(([L,G])=>G!==void 0)),y=JSON.stringify(g),w=await(await this.caller.call(async()=>{let L=await this._fetch(h,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:y});return await M(L,`Failed to fetch ${p}`),L})).json(),{groups:A,total:E}=w;if(A.length===0)break;for(let L of A)yield L;if(f+=A.length,f>=E)break}}async getRunStats({id:e,trace:t,parentRun:n,runType:s,projectNames:i,projectIds:a,referenceExampleIds:o,startTime:u,endTime:c,error:d,query:l,filter:f,traceFilter:p,treeFilter:h,isRoot:m,dataSourceType:g}){let y=a||[];i&&(y=[...a||[],...await Promise.all(i.map(G=>this.readProject({projectName:G}).then(q=>q.id)))]);let w=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:n,run_type:s,session:y,reference_example:o,start_time:u,end_time:c,error:d,query:l,filter:f,trace_filter:p,tree_filter:h,is_root:m,data_source_type:g}).filter(([G,q])=>q!==void 0)),A=JSON.stringify(w);return await(await this.caller.call(async()=>{let G=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:A});return await M(G,"get run stats"),G})).json()}async shareRun(e,{shareId:t}={}){let n={run_id:e,share_token:t||ye()};W(e);let s=JSON.stringify(n),a=await(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await M(o,"share run"),o})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){W(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(t,"unshare run",!0),t})}async readRunSharedLink(e){W(e);let n=await(await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(s,"read run shared link"),s})).json();if(!(n===null||!("share_token"in n)))return`${this.getHostUrl()}/public/${n.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let n=new URLSearchParams({share_token:e});if(t!==void 0)for(let a of t)n.append("id",a);return W(e),await(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/public/${e}/runs${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(a,"list shared runs"),a})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),W(e);let s=await(await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(i,"read dataset shared schema"),i})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let n={dataset_id:e};W(e);let s=JSON.stringify(n),a=await(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await M(o,"share dataset"),o})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){W(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(t,"unshare dataset",!0),t})}async readSharedDataset(e){return W(e),await(await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(s,"read shared dataset"),s})).json()}async listSharedExamples(e,t){let n={};t?.exampleIds&&(n.id=t.exampleIds);let s=new URLSearchParams;Object.entries(n).forEach(([o,u])=>{Array.isArray(u)?u.forEach(c=>s.append(o,c)):s.append(o,u)});let i=await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(o,"list shared examples"),o}),a=await i.json();if(!i.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${Array.isArray(a.detail)?a.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`);return a.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:n=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){let o=s?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,c=i||{};n&&(c.metadata=n);let d={name:e,extra:c,description:t};a!==null&&(d.reference_dataset_id=a);let l=JSON.stringify(d);return await(await this.caller.call(async()=>{let h=await this._fetch(u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await M(h,"create project"),h})).json()}async updateProject(e,{name:t=null,description:n=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){let o=`${this.apiUrl}/sessions/${e}`,u=i;s&&(u={...u||{},metadata:s});let c=JSON.stringify({name:t,extra:u,description:n,end_time:a?new Date(a).toISOString():null});return await(await this.caller.call(async()=>{let f=await this._fetch(o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await M(f,"update project"),f})).json()}async hasProject({projectId:e,projectName:t}){let n="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)W(e),n+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");let i=await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}${n}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(a,"has project"),a});try{let a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:n}){let s="/sessions",i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)W(e),s+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");n!==void 0&&i.append("include_stats",n.toString());let a=await this._get(s,i),o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");let n=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${n.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");let n=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${n.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:n,referenceDatasetId:s,referenceDatasetName:i,includeStats:a,datasetVersion:o,referenceFree:u,metadata:c}={}){let d=new URLSearchParams;if(e!==void 0)for(let l of e)d.append("id",l);if(t!==void 0&&d.append("name",t),n!==void 0&&d.append("name_contains",n),s!==void 0)d.append("reference_dataset",s);else if(i!==void 0){let l=await this.readDataset({datasetName:i});d.append("reference_dataset",l.id)}a!==void 0&&d.append("include_stats",a.toString()),o!==void 0&&d.append("dataset_version",o),u!==void 0&&d.append("reference_free",u.toString()),c!==void 0&&d.append("metadata",JSON.stringify(c));for await(let l of this._getPaginated("/sessions",d))yield*l}async deleteProject({projectId:e,projectName:t}){let n;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?n=(await this.readProject({projectName:t})).id:n=e,W(n),await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/sessions/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(s,`delete session ${n} (${t})`,!0),s})}async uploadCsv({csvFile:e,fileName:t,inputKeys:n,outputKeys:s,description:i,dataType:a,name:o}){let u=`${this.apiUrl}/datasets/upload`,c=new FormData;return c.append("file",e,t),n.forEach(f=>{c.append("input_keys",f)}),s.forEach(f=>{c.append("output_keys",f)}),i&&c.append("description",i),a&&c.append("data_type",a),o&&c.append("name",o),await(await this.caller.call(async()=>{let f=await this._fetch(u,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await M(f,"upload CSV"),f})).json()}async createDataset(e,{description:t,dataType:n,inputsSchema:s,outputsSchema:i,metadata:a}={}){let o={name:e,description:t,extra:a?{metadata:a}:void 0};n&&(o.data_type=n),s&&(o.inputs_schema_definition=s),i&&(o.outputs_schema_definition=i);let u=JSON.stringify(o);return await(await this.caller.call(async()=>{let l=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await M(l,"create dataset"),l})).json()}async readDataset({datasetId:e,datasetName:t}){let n="/datasets",s=new URLSearchParams({limit:"1"});if(e&&t)throw new Error("Must provide either datasetName or datasetId, not both");if(e)W(e),n+=`/${e}`;else if(t)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");let i=await this._get(n,s),a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(n){if(n instanceof Error&&n.message.toLocaleLowerCase().includes("not found"))return!1;throw n}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:n,toVersion:s}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:t})).id);let a=new URLSearchParams({from_version:typeof n=="string"?n:n.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){let n="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${n}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:n,datasetName:s,datasetNameContains:i,metadata:a}={}){let o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(n!==void 0)for(let c of n)u.append("id",c);s!==void 0&&u.append("name",s),i!==void 0&&u.append("name_contains",i),a!==void 0&&u.append("metadata",JSON.stringify(a));for await(let c of this._getPaginated(o,u))yield*c}async updateDataset(e){let{datasetId:t,datasetName:n,...s}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");let i=t??(await this.readDataset({datasetName:n})).id;W(i);let a=JSON.stringify(s);return await(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(u,"update dataset"),u})).json()}async updateDatasetTag(e){let{datasetId:t,datasetName:n,asOf:s,tag:i}=e;if(!t&&!n)throw new Error("Must provide either datasetName or datasetId");let a=t??(await this.readDataset({datasetName:n})).id;W(a);let o=JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:i});await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await M(u,"update dataset tags",!0),u})}async deleteDataset({datasetId:e,datasetName:t}){let n="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)W(s),n+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{let i=await this._fetch(this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(i,`delete ${n}`,!0),i})}async indexDataset({datasetId:e,datasetName:t,tag:n}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),W(s);let a=JSON.stringify({tag:n});await(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(u,"index dataset"),u})).json()}async similarExamples(e,t,n,{filter:s}={}){let i={limit:n,inputs:e};s!==void 0&&(i.filter=s),W(t);let a=JSON.stringify(i);return(await(await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/datasets/${t}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:a});return await M(c,"fetch similar examples"),c})).json()).examples}async createExample(e,t,n){if(vg(e)&&(t!==void 0||n!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=t?n?.datasetId:e.dataset_id,i=t?n?.datasetName:e.dataset_name;if(s===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:i})).id);let a=(t?n?.createdAt:e.created_at)||new Date,o;vg(e)?o=e:o={inputs:e,outputs:t,created_at:a?.toISOString(),id:n?.exampleId,metadata:n?.metadata,split:n?.split,source_run_id:n?.sourceRunId,use_source_run_io:n?.useSourceRunIO,use_source_run_attachments:n?.useSourceRunAttachments,attachments:n?.attachments};let u=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(u.example_ids?.[0]??ye())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];let _=e,w=_[0].dataset_id,A=_[0].dataset_name;if(w===void 0&&A===void 0)throw new Error("Must provide either datasetName or datasetId");if(w!==void 0&&A!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");w===void 0&&(w=(await this.readDataset({datasetName:A})).id);let E=await this._uploadExamplesMultipart(w,_);return await Promise.all(E.example_ids.map(G=>this.readExample(G)))}let{inputs:t,outputs:n,metadata:s,splits:i,sourceRunIds:a,useSourceRunIOs:o,useSourceRunAttachments:u,attachments:c,exampleIds:d,datasetId:l,datasetName:f}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let p=l,h=f;if(p===void 0&&h===void 0)throw new Error("Must provide either datasetName or datasetId");if(p!==void 0&&h!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");p===void 0&&(p=(await this.readDataset({datasetName:h})).id);let m=t.map((_,w)=>({dataset_id:p,inputs:_,outputs:n?.[w],metadata:s?.[w],split:i?.[w],id:d?.[w],attachments:c?.[w],source_run_id:a?.[w],use_source_run_io:o?.[w],use_source_run_attachments:u?.[w]})),g=await this._uploadExamplesMultipart(p,m);return await Promise.all(g.example_ids.map(_=>this.readExample(_)))}async createLLMExample(e,t,n){return this.createExample({input:e},{output:t},n)}async createChatExample(e,t,n){let s=e.map(a=>xl(a)?vl(a):a),i=xl(t)?vl(t):t;return this.createExample({input:s},{output:i},n)}async readExample(e){W(e);let t=`/examples/${e}`,n=await this._get(t),{attachment_urls:s,...i}=n,a=i;return s&&(a.attachments=Object.entries(s).reduce((o,[u,c])=>(o[u.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},o),{})),a}async*listExamples({datasetId:e,datasetName:t,exampleIds:n,asOf:s,splits:i,inlineS3Urls:a,metadata:o,limit:u,offset:c,filter:d,includeAttachments:l}={}){let f;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)f=e;else if(t!==void 0)f=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");let p=new URLSearchParams({dataset:f}),h=s?typeof s=="string"?s:s?.toISOString():void 0;h&&p.append("as_of",h);let m=a??!0;if(p.append("inline_s3_urls",m.toString()),n!==void 0)for(let y of n)p.append("id",y);if(i!==void 0)for(let y of i)p.append("splits",y);if(o!==void 0){let y=JSON.stringify(o);p.append("metadata",y)}u!==void 0&&p.append("limit",u.toString()),c!==void 0&&p.append("offset",c.toString()),d!==void 0&&p.append("filter",d),l===!0&&["attachment_urls","outputs","metadata"].forEach(y=>p.append("select",y));let g=0;for await(let y of this._getPaginated("/examples",p)){for(let _ of y){let{attachment_urls:w,...A}=_,E=A;w&&(E.attachments=Object.entries(w).reduce((L,[G,q])=>(L[G.slice(11)]={presigned_url:q.presigned_url,mime_type:q.mime_type||void 0},L),{})),yield E,g++}if(u!==void 0&&g>=u)break}}async deleteExample(e){W(e);let t=`/examples/${e}`;await this.caller.call(async()=>{let n=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(n,`delete ${t}`,!0),n})}async updateExample(e,t){let n;t?n=e:n=e.id,W(n);let s;t?s={id:n,...t}:s=e;let i;return s.dataset_id!==void 0?i=s.dataset_id:i=(await this.readExample(n)).dataset_id,this._updateExamplesMultipart(i,[s])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:n,tag:s}){let i;if(e?i=e:i=(await this.readDataset({datasetName:t})).id,W(i),n&&s||!n&&!s)throw new Error("Exactly one of asOf and tag must be specified.");let a=new URLSearchParams;return n!==void 0&&a.append("as_of",typeof n=="string"?n:n.toISOString()),s!==void 0&&a.append("tag",s),await(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/datasets/${i}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(u,"read dataset version"),u})).json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:n}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,W(s);let i=new URLSearchParams,a=n?typeof n=="string"?n:n?.toISOString():void 0;return a&&i.append("as_of",a),await this._get(`/datasets/${s}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:n,exampleIds:s,remove:i=!1}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,W(a);let o={split_name:n,examples:s.map(c=>(W(c),c)),remove:i},u=JSON.stringify(o);await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await M(c,"update dataset splits",!0),c})}async evaluateRun(e,t,{sourceInfo:n,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){_a("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));let o=await t.evaluateRun(a,i),[u,c]=await this._logEvaluationFeedback(o,a,n);return c[0]}async createFeedback(e,t,{score:n,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:d,feedbackConfig:l,projectId:f,comparativeExperimentId:p}){if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");let h={type:u??"api",metadata:o??{}};c!==void 0&&h?.metadata!==void 0&&!h.metadata.__run&&(h.metadata.__run={run_id:c}),h?.metadata!==void 0&&h.metadata.__run?.run_id!==void 0&&W(h.metadata.__run.run_id);let m={id:d??ye(),run_id:e,key:t,score:wg(n),value:s,correction:i,comment:a,feedback_source:h,comparative_experiment_id:p,feedbackConfig:l,session_id:f},g=JSON.stringify(m),y=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{let _=await this._fetch(y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:g});return await M(_,"create feedback",!0),_}),m}async updateFeedback(e,{score:t,value:n,correction:s,comment:i}){let a={};t!=null&&(a.score=wg(t)),n!=null&&(a.value=n),s!=null&&(a.correction=s),i!=null&&(a.comment=i),W(e);let o=JSON.stringify(a);await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await M(u,"update feedback",!0),u})}async readFeedback(e){W(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){W(e);let t=`/feedback/${e}`;await this.caller.call(async()=>{let n=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(n,`delete ${t}`,!0),n})}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:n}={}){let s=new URLSearchParams;if(e)for(let i of e)W(i),s.append("run",i);if(t)for(let i of t)s.append("key",i);if(n)for(let i of n)s.append("source",i);for await(let i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,t,{expiration:n,feedbackConfig:s}={}){let i={run_id:e,feedback_key:t,feedback_config:s};n?typeof n=="string"?i.expires_at=n:(n?.hours||n?.minutes||n?.days)&&(i.expires_in=n):i.expires_in={hours:3};let a=JSON.stringify(i);return await(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(u,"create presigned feedback token"),u})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:n,createdAt:s,description:i,metadata:a,id:o}){if(t.length===0)throw new Error("At least one experiment is required");if(n||(n=(await this.readProject({projectId:t[0]})).reference_dataset_id),!n==null)throw new Error("A reference dataset is required");let u={id:o,name:e,experiment_ids:t,reference_dataset_id:n,description:i,created_at:(s??new Date)?.toISOString(),extra:{}};a&&(u.extra.metadata=a);let c=JSON.stringify(u);return(await this.caller.call(async()=>{let l=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await M(l,"create comparative experiment"),l})).json()}async*listPresignedFeedbackTokens(e){W(e);let t=new URLSearchParams({run_id:e});for await(let n of this._getPaginated("/feedback/tokens",t))yield*n}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,n){let s=this._selectEvalResults(e),i=[];for(let a of s){let o=n||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let u=null;a.targetRunId?u=a.targetRunId:t&&(u=t.id),i.push(await this.createFeedback(u,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[s,i]}async logEvaluationFeedback(e,t,n){let[s]=await this._logEvaluationFeedback(e,t,n);return s}async*listAnnotationQueues(e={}){let{queueIds:t,name:n,nameContains:s,limit:i}=e,a=new URLSearchParams;t&&t.forEach((u,c)=>{W(u,`queueIds[${c}]`),a.append("ids",u)}),n&&a.append("name",n),s&&a.append("name_contains",s),a.append("limit",(i!==void 0?Math.min(i,100):100).toString());let o=0;for await(let u of this._getPaginated("/annotation-queues",a))if(yield*u,o++,i!==void 0&&o>=i)break}async createAnnotationQueue(e){let{name:t,description:n,queueId:s,rubricInstructions:i}=e,a={name:t,description:n,id:s||ye(),rubric_instructions:i},o=JSON.stringify(Object.fromEntries(Object.entries(a).filter(([c,d])=>d!==void 0)));return(await this.caller.call(async()=>{let c=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await M(c,"create annotation queue"),c})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/annotation-queues/${W(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(n,"read annotation queue"),n})).json()}async updateAnnotationQueue(e,t){let{name:n,description:s,rubricInstructions:i}=t,a=JSON.stringify({name:n,description:s,rubric_instructions:i});await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/annotation-queues/${W(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(o,"update annotation queue",!0),o})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${W(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(t,"delete annotation queue",!0),t})}async addRunsToAnnotationQueue(e,t){let n=JSON.stringify(t.map((s,i)=>W(s,`runIds[${i}]`).toString()));await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/annotation-queues/${W(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await M(s,"add runs to annotation queue",!0),s})}async getRunFromAnnotationQueue(e,t){let n=`/annotation-queues/${W(e,"queueId")}/run`;return(await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}${n}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(i,"get run from annotation queue"),i})).json()}async deleteRunFromAnnotationQueue(e,t){await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/annotation-queues/${W(e,"queueId")}/runs/${W(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(n,"delete run from annotation queue",!0),n})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{let n=await this._fetch(`${this.apiUrl}/annotation-queues/${W(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(n,"get size from annotation queue"),n})).json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){let n=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${n.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let n=await(await this.caller.call(async()=>{let s=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(s,"get latest commit hash"),s})).json();if(n.commits.length!==0)return n.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[n,s,i]=Ar(e),a=JSON.stringify({like:t});return(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/likes/${n}/${s}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(u,`${t?"like":"unlike"} prompt`),u})).json()}async _getPromptUrl(e){let[t,n,s]=Ar(e);if(await this._currentTenantIsOwner(t)){let i=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${n}/${s.substring(0,8)}?organizationId=${i.id}`:`${this.getHostUrl()}/prompts/${n}?organizationId=${i.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${n}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${n}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,n=>n.commits))yield*t}async*listPrompts(e){let t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);for await(let n of this._getPaginated("/repos",t,s=>s.repos))yield*n}async getPrompt(e){let[t,n,s]=Ar(e),a=await(await this.caller.call(async()=>{let o=await this._fetch(`${this.apiUrl}/repos/${t}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return o?.status===404?null:(await M(o,"get prompt"),o)}))?.json();return a?.repo?a.repo:null}async createPrompt(e,t){let n=await this._getSettings();if(t?.isPublic&&!n.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[s,i,a]=Ar(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);let o={repo_handle:i,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},u=JSON.stringify(o),c=await this.caller.call(async()=>{let l=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await M(l,"create prompt"),l}),{repo:d}=await c.json();return d}async createCommit(e,t,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[s,i,a]=Ar(e),o=n?.parentCommitHash==="latest"||!n?.parentCommitHash?await this._getLatestCommitHash(`${s}/${i}`):n?.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=JSON.stringify(u),l=await(await this.caller.call(async()=>{let f=await this._fetch(`${this.apiUrl}/commits/${s}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await M(f,"create commit"),f})).json();return this._getPromptUrl(`${s}/${i}${l.commit_hash?`:${l.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let n=new FormData;for(let a of t){let o=a.id,u={...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split}},c=Qe(u,`Serializing body for example with id: ${o}`),d=new Blob([c],{type:"application/json"});if(n.append(o,d),a.inputs){let l=Qe(a.inputs,`Serializing inputs for example with id: ${o}`),f=new Blob([l],{type:"application/json"});n.append(`${o}.inputs`,f)}if(a.outputs){let l=Qe(a.outputs,`Serializing outputs whle updating example with id: ${o}`),f=new Blob([l],{type:"application/json"});n.append(`${o}.outputs`,f)}if(a.attachments)for(let[l,f]of Object.entries(a.attachments)){let p,h;Array.isArray(f)?[p,h]=f:(p=f.mimeType,h=f.data);let m=new Blob([h],{type:`${p}; length=${h.byteLength}`});n.append(`${o}.attachment.${l}`,m)}if(a.attachments_operations){let l=Qe(a.attachments_operations,`Serializing attachments while updating example with id: ${o}`),f=new Blob([l],{type:"application/json"});n.append(`${o}.attachments_operations`,f)}}let s=e??t[0]?.dataset_id;return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${s}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await M(a,"update examples"),a})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let n=new FormData;for(let i of t){let a=(i.id??ye()).toString(),o={created_at:i.created_at,...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split},...i.source_run_id&&{source_run_id:i.source_run_id},...i.use_source_run_io&&{use_source_run_io:i.use_source_run_io},...i.use_source_run_attachments&&{use_source_run_attachments:i.use_source_run_attachments}},u=Qe(o,`Serializing body for uploaded example with id: ${a}`),c=new Blob([u],{type:"application/json"});if(n.append(a,c),i.inputs){let d=Qe(i.inputs,`Serializing inputs for uploaded example with id: ${a}`),l=new Blob([d],{type:"application/json"});n.append(`${a}.inputs`,l)}if(i.outputs){let d=Qe(i.outputs,`Serializing outputs for uploaded example with id: ${a}`),l=new Blob([d],{type:"application/json"});n.append(`${a}.outputs`,l)}if(i.attachments)for(let[d,l]of Object.entries(i.attachments)){let f,p;Array.isArray(l)?[f,p]=l:(f=l.mimeType,p=l.data);let h=new Blob([p],{type:`${f}; length=${p.byteLength}`});n.append(`${a}.attachment.${d}`,h)}}return(await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await M(i,"upload examples"),i})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[n,s]=Ar(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("update a prompt",n);let i={};if(t?.description!==void 0&&(i.description=t.description),t?.readme!==void 0&&(i.readme=t.readme),t?.tags!==void 0&&(i.tags=t.tags),t?.isPublic!==void 0&&(i.is_public=t.isPublic),t?.isArchived!==void 0&&(i.is_archived=t.isArchived),Object.keys(i).length===0)throw new Error("No valid update options provided");let a=JSON.stringify(i);return(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/repos/${n}/${s}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await M(u,"update prompt"),u})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[t,n,s]=Ar(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return(await this.caller.call(async()=>{let a=await this._fetch(`${this.apiUrl}/repos/${t}/${n}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(a,"delete prompt"),a})).json()}async pullPromptCommit(e,t){let[n,s,i]=Ar(e),o=await(await this.caller.call(async()=>{let u=await this._fetch(`${this.apiUrl}/commits/${n}/${s}/${i}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await M(u,"pull prompt commit"),u})).json();return{owner:n,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){let n=await this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(n.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:n=this.apiUrl,datasetName:s}=t,[i,a]=this.parseTokenOrUrl(e,n),o=new r({apiUrl:i,apiKey:"placeholder"}),u=await o.readSharedDataset(a),c=s||u.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}let d=await o.listSharedExamples(a),l=await this.createDataset(c,{description:u.description,dataType:u.data_type||"kv",inputsSchema:u.inputs_schema_definition??void 0,outputsSchema:u.outputs_schema_definition??void 0});try{await this.createExamples({inputs:d.map(f=>f.inputs),outputs:d.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:l.id})}catch(f){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,n=2,s="dataset"){try{return W(e),[t,e]}catch{}try{let a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=n){let o=a[a.length-n];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await hh()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}};function vg(r){return"dataset_id"in r||"dataset_name"in r}var Ag=r=>r!==void 0?r:!!["TRACING_V2","TRACING"].find(t=>ve(t)==="true");var pu=Symbol.for("lc:context_variables");function bE(r){return r.replace(/[-:.]/g,"")}function Hl(r,e,t=1){let n=t.toFixed(0).slice(0,3).padStart(3,"0"),s=`${new Date(r).toISOString().slice(0,-1)}${n}Z`;return{dottedOrder:bE(s)+e,microsecondPrecisionDatestring:s}}var hu=class r{constructor(e,t,n,s){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=n,this.replicas=s}static fromHeader(e){let t=e.split(","),n={},s=[],i,a;for(let o of t){let[u,c]=o.split("="),d=decodeURIComponent(c);u==="langsmith-metadata"?n=JSON.parse(d):u==="langsmith-tags"?s=d.split(","):u==="langsmith-project"?i=d:u==="langsmith-replicas"&&(a=JSON.parse(d))}return new r(n,s,i,a)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}},St=class r{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Og(e)){Object.assign(this,{...e});return}let t=r.getDefaultConfig(),{metadata:n,...s}=e,i=s.client??r.getSharedClient(),a={...n,...s?.extra?.metadata};if(s.extra={...s.extra,metadata:a},Object.assign(this,{...t,...s,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=EE(this.replicas),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){let{dottedOrder:o,microsecondPrecisionDatestring:u}=Hl(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+o:this.dotted_order=o,this._serialized_start_time=u}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:ye(),run_type:"chain",project_name:ha(),child_runs:[],api_url:ot("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:ot("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return r.sharedClient||(r.sharedClient=new Qn),r.sharedClient}createChild(e){let t=this.child_execution_order+1,n=new r({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});pu in this&&(n[pu]=this[pu]);let s=Symbol.for("lc:child_config"),i=e.extra?.[s]??this.extra[s];if(xE(i)){let u={...i},c=wE(u.callbacks)?u.callbacks.copy?.():void 0;c&&(Object.assign(c,{_parentRunId:n.id}),c.handlers?.find(Ig)?.updateFromRunTree?.(n),u.callbacks=c),n.extra[s]=u}let a=new Set,o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(n),n}async end(e,t,n=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??n,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,n=!0){let s=e.extra??{};if(s?.runtime?.library===void 0&&(s.runtime||(s.runtime={}),t))for(let[o,u]of Object.entries(t))s.runtime[o]||(s.runtime[o]=u);let i,a;return n?(a=e.parent_run?.id??e.parent_run_id,i=[]):(i=e.child_runs.map(o=>this._convertToCreate(o,t,n)),a=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,n=!0){let s=this._convertToCreate(this,t,n);if(e===this.project_name)return s;let i=l=>Ro(`${l}:${e}`,Ro.DNS),a=i(s.id),o=s.trace_id?i(s.trace_id):void 0,u=s.parent_run_id?i(s.parent_run_id):void 0,c;if(s.dotted_order){let l=vE(s.dotted_order),f=[];for(let h=0;h<l.length-1;h++){let[m,g]=l[h],y=i(g);f.push(m.toISOString().replace(/[-:]/g,"").replace(".","")+y)}let[p]=l[l.length-1];f.push(p.toISOString().replace(/[-:]/g,"").replace(".","")+a),c=f.join(".")}else c=void 0;return{...s,id:a,trace_id:o,parent_run_id:u,dotted_order:c,session_name:e}}async postRun(e=!0){try{let t=Fo();if(this.replicas&&this.replicas.length>0)for(let{projectName:n,apiKey:s,apiUrl:i,workspaceId:a}of this.replicas){let o=this._remapForProject(n??this.project_name,t,!0);await this.client.createRun(o,{apiKey:s,apiUrl:i,workspaceId:a})}else{let n=this._convertToCreate(this,t,e);await this.client.createRun(n)}if(!e){_a("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let n of this.child_runs)await n.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(e){if(this.replicas&&this.replicas.length>0)for(let{projectName:t,apiKey:n,apiUrl:s,workspaceId:i,updates:a}of this.replicas){let o=this._remapForProject(t??this.project_name),u={id:o.id,outputs:o.outputs,error:o.error,parent_run_id:o.parent_run_id,session_name:o.session_name,reference_example_id:o.reference_example_id,end_time:o.end_time,dotted_order:o.dotted_order,trace_id:o.trace_id,events:o.events,tags:o.tags,extra:o.extra,attachments:this.attachments,...a};e?.excludeInputs||(u.inputs=o.inputs),await this.client.updateRun(o.id,u,{apiKey:n,apiUrl:s,workspaceId:i})}else try{let t={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e?.excludeInputs||(t.inputs=this.inputs),await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){let n=e?.callbacks,s,i,a,o=Ag();if(n){let c=n?.getParentRunId?.()??"",d=n?.handlers?.find(l=>l?.name=="langchain_tracer");s=d?.getRun?.(c),i=d?.projectName,a=d?.client,o=o||!!d}return s?new r({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:a,tracingEnabled:o,project_name:i,tags:[...new Set((s?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...s?.extra?.metadata,...e?.metadata}}}).createChild(t):new r({...t,client:a,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let n="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=n["langsmith-trace"];if(!s||typeof s!="string")return;let i=s.trim(),a=i.split(".").map(c=>{let[d,l]=c.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:l}}),o=a[0].uuid,u={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:a.at(-1)?.uuid,trace_id:o,dotted_order:i};if(n.baggage&&typeof n.baggage=="string"){let c=hu.fromHeader(n.baggage);u.metadata=c.metadata,u.tags=c.tags,u.project_name=c.project_name,u.replicas=c.replicas}return new r(u)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new hu(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[n,s]of Object.entries(t))e.set(n,s);return t}};Object.defineProperty(St,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function Og(r){return r!=null&&typeof r.createChild=="function"&&typeof r.postRun=="function"}function Ig(r){return typeof r=="object"&&r!=null&&typeof r.name=="string"&&r.name==="langchain_tracer"}function Eg(r){return Array.isArray(r)&&r.some(e=>Ig(e))}function wE(r){return typeof r=="object"&&r!=null&&Array.isArray(r.handlers)}function xE(r){return r!=null&&typeof r.callbacks=="object"&&(Eg(r.callbacks?.handlers)||Eg(r.callbacks))}function vE(r){return r.split(".").map(t=>{let n=t.slice(0,-36),s=t.slice(-36),i=parseInt(n.slice(0,4)),a=parseInt(n.slice(4,6))-1,o=parseInt(n.slice(6,8)),u=parseInt(n.slice(9,11)),c=parseInt(n.slice(11,13)),d=parseInt(n.slice(13,15)),l=parseInt(n.slice(15,21));return[new Date(i,a,o,u,c,d,l/1e3),s]})}function AE(){let r=ot("LANGSMITH_RUNS_ENDPOINTS");if(!r)return[];try{let e=JSON.parse(r);if(Array.isArray(e)){let t=[];for(let n of e){if(typeof n!="object"||n===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof n}`);continue}if(typeof n.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_url}`);continue}if(typeof n.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof n.api_key}`);continue}t.push({apiUrl:n.api_url.replace(/\/$/,""),apiKey:n.api_key})}return t}else if(typeof e=="object"&&e!==null){OE(e);let t=[];for(let[n,s]of Object.entries(e)){let i=n.replace(/\/$/,"");if(typeof s=="string")t.push({apiUrl:i,apiKey:s});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${n}: expected string, got ${typeof s}`);continue}}return t}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof e}`),[]}catch(e){if(gg(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS \u2013 must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function EE(r){return r?r.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):AE()}function OE(r){if(Object.keys(r).length>0&&ve("ENDPOINT"))throw new cu}var IE=()=>typeof window<"u"&&typeof window.document<"u",TE=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",PE=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Kl=()=>typeof Deno<"u",SE=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Kl(),kE=()=>{let r;return IE()?r="browser":SE()?r="node":TE()?r="webworker":PE()?r="jsdom":Kl()?r="deno":r="other",r},Vl;function Tg(){return Vl===void 0&&(Vl={library:"langchain-js",runtime:kE()}),Vl}function pe(r){try{return typeof process<"u"?process.env?.[r]:Kl()?Deno?.env.get(r):void 0}catch{return}}var Jl=class{};function Wl(r){return"lc_prefer_streaming"in r&&r.lc_prefer_streaming}var ts=class r extends Jl{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Mc(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:pe("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Tt.prototype.toJSON.call(this)}toJSONNotImplemented(){return Tt.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends r{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ye()}),Object.assign(this,e)}}return new t}},Pg=r=>{let e=r;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};var RE=r=>{if(r)return r.events=r.events??[],r.child_runs=r.child_runs??[],r};function Xl(r,e){if(r)return new St({...r,start_time:r._serialized_start_time??r.start_time,parent_run:Xl(e),child_runs:r.child_runs.map(t=>Xl(t)).filter(t=>t!==void 0),extra:{...r.extra,runtime:Tg()},tracingEnabled:!1})}function Yl(r,e){return r&&!Array.isArray(r)&&typeof r=="object"?r:{[e]:r}}function Ws(r){return typeof r._addRunToRunMap=="function"}var At=class extends ts{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?RE(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let{dottedOrder:t,microsecondPrecisionDatestring:n}=Hl(new Date(e.start_time).getTime(),e.id,e.execution_order),s={...e},i=this.getRunById(s.parent_run_id);if(s.parent_run_id!==void 0?i&&(this._addChildRun(i,s),i.child_execution_order=Math.max(i.child_execution_order,s.child_execution_order),s.trace_id=i.trace_id,i.dotted_order!==void 0&&(s.dotted_order=[i.dotted_order,t].join("."),s._serialized_start_time=n)):(s.trace_id=s.id,s.dotted_order=t,s._serialized_start_time=n),this.usesRunTreeMap){let a=Xl(s,i);a!==void 0&&this.runTreeMap.set(s.id,a)}else this.runMap.set(s.id,s);return s}async _endTrace(e){let t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){let t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,n,s,i,a,o,u){let c=this._getExecutionOrder(s),d=Date.now(),l=o?{...i,metadata:o}:i,f={id:n,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:l??{},tags:a||[]};return this._addRunToRunMap(f)}async handleLLMStart(e,t,n,s,i,a,o,u){let c=this.getRunById(n)??this._createRunForLLMStart(e,t,n,s,i,a,o,u);return await this.onRunCreate?.(c),await this.onLLMStart?.(c),c}_createRunForChatModelStart(e,t,n,s,i,a,o,u){let c=this._getExecutionOrder(s),d=Date.now(),l=o?{...i,metadata:o}:i,f={id:n,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:l??{},tags:a||[]};return this._addRunToRunMap(f)}async handleChatModelStart(e,t,n,s,i,a,o,u){let c=this.getRunById(n)??this._createRunForChatModelStart(e,t,n,s,i,a,o,u);return await this.onRunCreate?.(c),await this.onLLMStart?.(c),c}async handleLLMEnd(e,t,n,s,i){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await this.onLLMEnd?.(a),await this._endTrace(a),a}async handleLLMError(e,t,n,s,i){let a=this.getRunById(t);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await this.onLLMError?.(a),await this._endTrace(a),a}_createRunForChainStart(e,t,n,s,i,a,o,u){let c=this._getExecutionOrder(s),d=Date.now(),l={id:n,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(l)}async handleChainStart(e,t,n,s,i,a,o,u){let c=this.getRunById(n)??this._createRunForChainStart(e,t,n,s,i,a,o,u);return await this.onRunCreate?.(c),await this.onChainStart?.(c),c}async handleChainEnd(e,t,n,s,i){let a=this.getRunById(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=Yl(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),i?.inputs!==void 0&&(a.inputs=Yl(i.inputs,"input")),await this.onChainEnd?.(a),await this._endTrace(a),a}async handleChainError(e,t,n,s,i){let a=this.getRunById(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),i?.inputs!==void 0&&(a.inputs=Yl(i.inputs,"input")),await this.onChainError?.(a),await this._endTrace(a),a}_createRunForToolStart(e,t,n,s,i,a,o){let u=this._getExecutionOrder(s),c=Date.now(),d={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(d)}async handleToolStart(e,t,n,s,i,a,o){let u=this.getRunById(n)??this._createRunForToolStart(e,t,n,s,i,a,o);return await this.onRunCreate?.(u),await this.onToolStart?.(u),u}async handleToolEnd(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.outputs={output:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await this.onToolEnd?.(n),await this._endTrace(n),n}async handleToolError(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="tool")throw new Error("No tool run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await this.onToolError?.(n),await this._endTrace(n),n}async handleAgentAction(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="chain")return;let s=n;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(n)}async handleAgentEnd(e,t){let n=this.getRunById(t);!n||n?.run_type!=="chain"||(n.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(n))}_createRunForRetrieverStart(e,t,n,s,i,a,o){let u=this._getExecutionOrder(s),c=Date.now(),d={id:n,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(d)}async handleRetrieverStart(e,t,n,s,i,a,o){let u=this.getRunById(n)??this._createRunForRetrieverStart(e,t,n,s,i,a,o);return await this.onRunCreate?.(u),await this.onRetrieverStart?.(u),u}async handleRetrieverEnd(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.outputs={documents:e},n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),await this.onRetrieverEnd?.(n),await this._endTrace(n),n}async handleRetrieverError(e,t){let n=this.getRunById(t);if(!n||n?.run_type!=="retriever")throw new Error("No retriever run to end");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),await this.onRetrieverError?.(n),await this._endTrace(n),n}async handleText(e,t){let n=this.getRunById(t);!n||n?.run_type!=="chain"||(n.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(n))}async handleLLMNewToken(e,t,n,s,i,a){let o=this.getRunById(n);if(!o||o?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a?.chunk}}),await this.onLLMNewToken?.(o,e,{chunk:a?.chunk}),o}};var Ql=It(Ng(),1);function Ve(r,e){return`${r.open}${e}${r.close}`}function Et(r,e){try{return JSON.stringify(r,null,2)}catch{return e}}function Cg(r){return typeof r=="string"?r.trim():r==null?r:Et(r,r.toString())}function Xr(r){if(!r.end_time)return"";let e=r.end_time-r.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var{color:et}=Ql.default,Oa=class extends At{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],n=e;for(;n.parent_run_id;){let s=this.runMap.get(n.parent_run_id);if(s)t.push(s),n=s;else break}return t}getBreadcrumbs(e){let n=[...this.getParents(e).reverse(),e].map((s,i,a)=>{let o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?Ve(Ql.default.bold,o):o}).join(" > ");return Ve(et.grey,n)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Et(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.cyan,"[chain/end]")} [${t}] [${Xr(e)}] Exiting Chain run with output: ${Et(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.red,"[chain/error]")} [${t}] [${Xr(e)}] Chain run errored with error: ${Et(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),n="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${Ve(et.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Et(n,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.cyan,"[llm/end]")} [${t}] [${Xr(e)}] Exiting LLM run with output: ${Et(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.red,"[llm/error]")} [${t}] [${Xr(e)}] LLM run errored with error: ${Et(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Cg(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.cyan,"[tool/end]")} [${t}] [${Xr(e)}] Exiting Tool run with output: "${Cg(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.red,"[tool/error]")} [${t}] [${Xr(e)}] Tool run errored with error: ${Et(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Et(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.cyan,"[retriever/end]")} [${t}] [${Xr(e)}] Exiting Retriever run with output: ${Et(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${Ve(et.red,"[retriever/error]")} [${t}] [${Xr(e)}] Retriever run errored with error: ${Et(e.error,"[error]")}`)}onAgentAction(e){let t=e,n=this.getBreadcrumbs(e);console.log(`${Ve(et.blue,"[agent/action]")} [${n}] Agent selected action: ${Et(t.actions[t.actions.length-1],"[action]")}`)}};var ed,td=()=>{if(ed===void 0){let r=pe("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};ed=new Qn(r)}return ed};var Ys=class r extends At{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});let{exampleId:t,projectName:n,client:s,replicas:i}=e;this.projectName=n??ha(),this.replicas=i,this.exampleId=t,this.client=s??td();let a=r.getTraceableRunTree();a&&this.updateFromRunTree(a)}async persistRun(e){}async onRunCreate(e){await this.getRunTreeWithTracingConfig(e.id)?.postRun()}async onRunUpdate(e){await this.getRunTreeWithTracingConfig(e.id)?.patchRun()}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){this.runTreeMap.set(e.id,e);let t=e,n=new Set;for(;t.parent_run&&!(n.has(t.id)||(n.add(t.id),!t.parent_run));)t=t.parent_run;n.clear();let s=[t];for(;s.length>0;){let i=s.shift();!i||n.has(i.id)||(n.add(i.id),this.runTreeMap.set(i.id,i),i.child_runs&&s.push(...i.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){let t=this.runTreeMap.get(e);if(t)return new St({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return kp(!0)}catch{return}}};var mu=It(Jo(),1);var $g=Symbol.for("ls:tracing_async_local_storage"),rs=Symbol.for("lc:context_variables"),jg=r=>{globalThis[$g]=r},Qr=()=>globalThis[$g];var Ia;function CE(){let r="default"in mu.default?mu.default.default:mu.default;return new r({autoStart:!0,concurrency:1})}function $E(){return typeof Ia>"u"&&(Ia=CE()),Ia}async function xe(r,e){if(e===!0){let t=Qr();t!==void 0?await t.run(void 0,async()=>r()):await r()}else Ia=$E(),Ia.add(async()=>{let t=Qr();t!==void 0?await t.run(void 0,async()=>r()):await r()})}var Mg=r=>r!==void 0?r:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>pe(t)==="true");function rd(r){let e=Qr();return e===void 0?void 0:e.getStore()?.[rs]?.[r]}var jE=Symbol("lc:configure_hooks"),zg=()=>rd(jE)||[];function Lg(r){return r?Array.isArray(r)||"name"in r?{callbacks:r}:r:{}}var nd=class{setHandler(e){return this.setHandlers([e])}},Xs=class{constructor(e,t,n,s,i,a,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>xe(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleCustomEvent(e,t,n,s,i){await Promise.all(this.handlers.map(a=>xe(async()=>{try{await a.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}},sd=class extends Xs{getChild(e){let t=new $e(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>xe(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw n}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>xe(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${n}`),t.raiseError)throw e}},t.awaitHandlers)))}},gu=class extends Xs{async handleLLMNewToken(e,t,n,s,i,a){await Promise.all(this.handlers.map(o=>xe(async()=>{if(!o.ignoreLLM)try{await o.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a)}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}async handleLLMError(e,t,n,s,i){await Promise.all(this.handlers.map(a=>xe(async()=>{if(!a.ignoreLLM)try{await a.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,i)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleLLMEnd(e,t,n,s,i){await Promise.all(this.handlers.map(a=>xe(async()=>{if(!a.ignoreLLM)try{await a.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,i)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}},id=class extends Xs{getChild(e){let t=new $e(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,n,s,i){await Promise.all(this.handlers.map(a=>xe(async()=>{if(!a.ignoreChain)try{await a.handleChainError?.(e,this.runId,this._parentRunId,this.tags,i)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleChainEnd(e,t,n,s,i){await Promise.all(this.handlers.map(a=>xe(async()=>{if(!a.ignoreChain)try{await a.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,i)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>xe(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>xe(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}},ad=class extends Xs{getChild(e){let t=new $e(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>xe(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>xe(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(n){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${n}`),t.raiseError)throw n}},t.awaitHandlers)))}},$e=class r extends nd{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(c,d)=>{let l=d===0&&n?n:ye();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Ws(f)&&f._createRunForLLMStart(e,[c],l,this._parentRunId,i,this.tags,this.metadata,u),xe(async()=>{try{await f.handleLLMStart?.(e,[c],l,this._parentRunId,i,this.tags,this.metadata,u)}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new gu(l,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,n=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(c,d)=>{let l=d===0&&n?n:ye();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Ws(f)&&f._createRunForChatModelStart(e,[c],l,this._parentRunId,i,this.tags,this.metadata,u),xe(async()=>{try{if(f.handleChatModelStart)await f.handleChatModelStart?.(e,[c],l,this._parentRunId,i,this.tags,this.metadata,u);else if(f.handleLLMStart){let p=ua(c);await f.handleLLMStart?.(e,[p],l,this._parentRunId,i,this.tags,this.metadata,u)}}catch(p){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers)})),new gu(l,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,n=ye(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return Ws(u)&&u._createRunForChainStart(e,t,n,this._parentRunId,this.tags,this.metadata,s,o),xe(async()=>{try{await u.handleChainStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,s,o)}catch(c){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${c}`),u.raiseError)throw c}},u.awaitHandlers)})),new id(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,n=ye(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return Ws(u)&&u._createRunForToolStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),xe(async()=>{try{await u.handleToolStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o)}catch(c){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${c}`),u.raiseError)throw c}},u.awaitHandlers)})),new ad(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,n=ye(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return Ws(u)&&u._createRunForRetrieverStart(e,t,n,this._parentRunId,this.tags,this.metadata,o),xe(async()=>{try{await u.handleRetrieverStart?.(e,t,n,this._parentRunId,this.tags,this.metadata,o)}catch(c){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${c}`),u.raiseError)throw c}},u.awaitHandlers)})),new sd(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,n,s,i){await Promise.all(this.handlers.map(a=>xe(async()=>{if(!a.ignoreCustomEvent)try{await a.handleCustomEvent?.(e,t,n,this.tags,this.metadata)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let n of e)this.addHandler(n,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let n=new r(this._parentRunId);for(let s of this.handlers){let i=this.inheritableHandlers.includes(s);n.addHandler(s,i)}for(let s of this.tags){let i=this.inheritableTags.includes(s);n.addTags([s],i)}for(let s of Object.keys(this.metadata)){let i=Object.keys(this.inheritableMetadata).includes(s);n.addMetadata({[s]:this.metadata[s]},i)}for(let s of e)n.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||n.addHandler(s,t);return n}static fromHandlers(e){class t extends ts{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ye()}),Object.assign(this,e)}}let n=new this;return n.addHandler(new t),n}static configure(e,t,n,s,i,a,o){return this._configureSync(e,t,n,s,i,a,o)}static _configureSync(e,t,n,s,i,a,o){let u;(e||t)&&(Array.isArray(e)||!e?(u=new r,u.setHandlers(e?.map(Ta)??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(Ta):t?.handlers,!1));let c=pe("LANGCHAIN_VERBOSE")==="true"||o?.verbose,d=Ys.getTraceableRunTree()?.tracingEnabled||Mg(),l=d||(pe("LANGCHAIN_TRACING")??!1);if(c||l){if(u||(u=new r),c&&!u.handlers.some(f=>f.name===Oa.prototype.name)){let f=new Oa;u.addHandler(f,!0)}if(l&&!u.handlers.some(f=>f.name==="langchain_tracer")&&d){let f=new Ys;u.addHandler(f,!0)}if(d){let f=Ys.getTraceableRunTree();f&&u._parentRunId===void 0&&(u._parentRunId=f.id,u.handlers.find(h=>h.name==="langchain_tracer")?.updateFromRunTree(f))}}for(let{contextVar:f,inheritable:p=!0,handlerClass:h,envVar:m}of zg()){let g=m&&pe(m)==="true"&&h,y,_=f!==void 0?rd(f):void 0;_&&Pg(_)?y=_:g&&(y=new h({})),y!==void 0&&(u||(u=new r),u.handlers.some(w=>w.name===y.name)||u.addHandler(y,p))}return(n||s)&&u&&(u.addTags(n??[]),u.addTags(s??[],!1)),(i||a)&&u&&(u.addMetadata(i??{}),u.addMetadata(a??{},!1)),u}};function Ta(r){return"name"in r?r:ts.fromMethods(r)}var _u=class{getStore(){}run(e,t){return t()}enterWith(e){}},ME=new _u,Dg=Symbol.for("lc:child_config"),od=class{getInstance(){return Qr()??ME}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[Dg]}runWithConfig(e,t,n){let s=$e._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),i=this.getInstance(),a=i.getStore(),o=s?.getParentRunId(),u=s?.handlers?.find(d=>d?.name==="langchain_tracer"),c;return u&&o?c=u.getRunTreeWithTracingConfig(o):n||(c=new St({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[Dg]:e}),a!==void 0&&a[rs]!==void 0&&(c===void 0&&(c={}),c[rs]=a[rs]),i.run(c,t)}initializeGlobalInstance(e){Qr()===void 0&&jg(e)}},tt=new od;var yu=25;async function rt(r){return $e._configureSync(r?.callbacks,void 0,r?.tags,void 0,r?.metadata)}function Qs(...r){let e={};for(let t of r.filter(n=>!!n))for(let n of Object.keys(t))if(n==="metadata")e[n]={...e[n],...t[n]};else if(n==="tags"){let s=e[n]??[];e[n]=[...new Set(s.concat(t[n]??[]))]}else if(n==="configurable")e[n]={...e[n],...t[n]};else if(n==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(n==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(n==="callbacks"){let s=e.callbacks,i=t.callbacks;if(Array.isArray(i))if(!s)e.callbacks=i;else if(Array.isArray(s))e.callbacks=s.concat(i);else{let a=s.copy();for(let o of i)a.addHandler(Ta(o),!0);e.callbacks=a}else if(i)if(!s)e.callbacks=i;else if(Array.isArray(s)){let a=i.copy();for(let o of s)a.addHandler(Ta(o),!0);e.callbacks=a}else e.callbacks=new $e(i._parentRunId,{handlers:s.handlers.concat(i.handlers),inheritableHandlers:s.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(i.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(i.inheritableTags))),metadata:{...s.metadata,...i.metadata}})}else{let s=n;e[s]=t[s]??e[s]}return e}var zE=new Set(["string","number","boolean"]);function ie(r){let e=tt.getRunnableConfig(),t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let{runId:n,runName:s,...i}=e;t=Object.entries(i).reduce((a,[o,u])=>(u!==void 0&&(a[o]=u),a),t)}if(r&&(t=Object.entries(r).reduce((n,[s,i])=>(i!==void 0&&(n[s]=i),n),t)),t?.configurable)for(let n of Object.keys(t.configurable))zE.has(typeof t.configurable[n])&&!t.metadata?.[n]&&(t.metadata||(t.metadata={}),t.metadata[n]=t.configurable[n]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");let n=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,n])):t.signal=n,delete t.timeout}return t}function Ae(r={},{callbacks:e,maxConcurrency:t,recursionLimit:n,runName:s,configurable:i,runId:a}={}){let o=ie(r);return e!==void 0&&(delete o.runName,o.callbacks=e),n!==void 0&&(o.recursionLimit=n),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),i!==void 0&&(o.configurable={...o.configurable,...i}),a!==void 0&&delete o.runId,o}function kt(r){return r?{configurable:r.configurable,recursionLimit:r.recursionLimit,callbacks:r.callbacks,tags:r.tags,metadata:r.metadata,maxConcurrency:r.maxConcurrency,timeout:r.timeout,signal:r.signal}:void 0}async function Xt(r,e){if(e===void 0)return r;let t;return Promise.race([r.catch(n=>{if(!e?.aborted)throw n}),new Promise((n,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}var Be=class r extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let t=e.getReader();return new r({start(n){return s();function s(){return t.read().then(({done:i,value:a})=>{if(i){n.close();return}return n.enqueue(a),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new r({async pull(t){let{value:n,done:s}=await e.next();s&&t.close(),t.enqueue(n)},async cancel(t){await e.return(t)}})}};function ud(r,e=2){let t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){let i=await r.next();for(let a of t)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function Or(r,e){if(Array.isArray(r)&&Array.isArray(e))return r.concat(e);if(typeof r=="string"&&typeof e=="string")return r+e;if(typeof r=="number"&&typeof e=="number")return r+e;if("concat"in r&&typeof r.concat=="function")return r.concat(e);if(typeof r=="object"&&typeof e=="object"){let t={...r};for(let[n,s]of Object.entries(e))n in t&&!Array.isArray(t[n])?t[n]=Or(t[n],s):t[n]=s;return t}else throw new Error(`Cannot concat ${typeof r} and ${typeof e}`)}var Er=class{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,n)=>{tt.runWithConfig(kt(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,n):this.firstResult.then(s=>t(void 0),n)},!0)})}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?tt.runWithConfig(kt(this.config),this.signal?async()=>Xt(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}};async function Ug(r,e,t,n,...s){let i=new Er({generator:e,startSetup:t,signal:n}),a=await i.setup;return{output:r(i,a,...s),setup:a}}var Rt=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),n=Yr({},t);return new Pa({ops:t,state:n[n.length-1].newDocument})}},Pa=class r extends Rt{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),n=Yr(this.state,e.ops);return new r({ops:t,state:n[n.length-1].newDocument})}static fromRunLogPatch(e){let t=Yr({},e.ops);return new r({ops:e.ops,state:t[t.length-1].newDocument})}},Zg=r=>r.name==="log_stream_tracer";async function Fg(r,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=r;if(["retriever","llm","prompt"].includes(r.run_type))return t;if(!(Object.keys(t).length===1&&t?.input===""))return t.input}async function Bg(r,e){let{outputs:t}=r;return e==="original"||["retriever","llm","prompt"].includes(r.run_type)?t:t!==void 0&&Object.keys(t).length===1&&t?.output!==void 0?t.output:t}function LE(r){return r!==void 0&&r.message!==void 0}var Sa=class extends At{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Be.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(n=n||t.find(s=>this.includeTags?.includes(s))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(n=n&&t.every(s=>!this.excludeTags?.includes(s))),n}async*tapOutputIterable(e,t){for await(let n of t){if(e!==this.rootId){let s=this.keyMapByRunId[e];s&&await this.writer.write(new Rt({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:n}]}))}yield n}}async onRunCreate(e){if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Rt({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let n={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(n.inputs=await Fg(e,this._schemaFormat)),await this.writer.write(new Rt({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:n}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let n=[];this._schemaFormat==="streaming_events"&&n.push({op:"replace",path:`/logs/${t}/inputs`,value:await Fg(e,this._schemaFormat)}),n.push({op:"add",path:`/logs/${t}/final_output`,value:await Bg(e,this._schemaFormat)}),e.end_time!==void 0&&n.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let s=new Rt({ops:n});await this.writer.write(s)}finally{if(e.id===this.rootId){let t=new Rt({ops:[{op:"replace",path:"/final_output",value:await Bg(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,n){let s=this.keyMapByRunId[e.id];if(s===void 0)return;let i=e.inputs.messages!==void 0,a;i?LE(n?.chunk)?a=n?.chunk:a=new gt({id:`run-${e.id}`,content:t}):a=t;let o=new Rt({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}};var bu="__run",Nt=class r{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new r({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},en=class r extends Nt{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new r({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}};function wu({name:r,serialized:e}){return r!==void 0?r:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var qg=r=>r.name==="event_stream_tracer",xu=class extends At{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Be.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],n=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(n=n||t.find(s=>this.includeTags?.includes(s))!==void 0),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(n=n&&t.every(s=>!this.excludeTags?.includes(s))),n}async*tapOutputIterable(e,t){let n=await t.next();if(n.done)return;let s=this.runInfoMap.get(e);if(s===void 0){yield n.value;return}function i(o,u){return o==="llm"&&typeof u=="string"?new Nt({text:u}):u}let a=this.tappedPromises.get(e);if(a===void 0){let o;a=new Promise(u=>{o=u}),this.tappedPromises.set(e,a);try{let u={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...u,data:{chunk:i(s.runType,n.value)}},s),yield n.value;for await(let c of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...u,data:{chunk:i(s.runType,c)}},s),yield c}finally{o()}}else{yield n.value;for await(let o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let n=this.tappedPromises.get(e.run_id);n!==void 0?n.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=wu(e),n=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:n,inputs:e.inputs};this.runInfoMap.set(e.id,s);let i=`on_${n}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onLLMNewToken(e,t,n){let s=this.runInfoMap.get(e.id),i,a;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")a="on_chat_model_stream",n?.chunk===void 0?i=new gt({content:t,id:`run-${e.id}`}):i=n.chunk.message;else if(s.runType==="llm")a="on_llm_stream",n?.chunk===void 0?i=new Nt({text:t}):i=n.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:a,data:{chunk:i},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){let t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let n;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let s=e.outputs?.generations,i;if(t.runType==="chat_model"){for(let a of s??[]){if(i!==void 0)break;i=a[0]?.message}n="on_chat_model_end"}else if(t.runType==="llm")i={generations:s?.map(a=>a.map(o=>({text:o.text,generationInfo:o.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},n="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:n,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){let t=wu(e),n=e.run_type??"chain",s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},s.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,s.inputs=e.inputs.input):(i.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${n}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let n=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},a={output:e.outputs?.output??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(a.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:n,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=wu(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,n),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},n)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let n=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:n,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=wu(e),s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,n){let s=this.runInfoMap.get(n);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${n} not found in run map.`);await this.send({event:"on_custom_event",run_id:n,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}};var Gg=It(To(),1),vu=It(Jo(),1),DE=[400,401,402,403,404,405,406,407,409],UE=r=>{if(r.message.startsWith("Cancel")||r.message.startsWith("AbortError")||r.name==="AbortError"||r?.code==="ECONNABORTED")throw r;let e=r?.response?.status??r?.status;if(e&&DE.includes(+e))throw r;if(r?.error?.code==="insufficient_quota"){let t=new Error(r?.message);throw t.name="InsufficientQuotaError",t}},Ir=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??UE;let t="default"in vu.default?vu.default.default:vu.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,Gg.default)(()=>e(...t).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...n){return e.signal?Promise.race([this.call(t,...n),new Promise((s,i)=>{e.signal?.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...n)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};var ka=class extends At{constructor({config:e,onStart:t,onEnd:n,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=n,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function Ra(r){return r?r.lc_runnable:!1}var Au=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,s=e.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(t)),this.includeTags!==void 0&&(n=n||s.some(i=>this.includeTags?.includes(i))),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(n=n&&s.every(i=>!this.excludeTags?.includes(i))),n}};function cd(r){return r.replace(/[^a-zA-Z-_0-9]/g,"_")}var FE=["*","_","`"];function BE(r){let e="";for(let[t,n]of Object.entries(r))e+=`	classDef ${t} ${n};
`;return e}function Hg(r,e,t){let{firstNode:n,lastNode:s,nodeColors:i,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{},c=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){let p="default",h={[p]:"{0}({1})"};n!==void 0&&(h[n]="{0}([{1}]):::first"),s!==void 0&&(h[s]="{0}([{1}]):::last");for(let[m,g]of Object.entries(r)){let y=g.name.split(":").pop()??"",w=FE.some(E=>y.startsWith(E)&&y.endsWith(E))?`<p>${y}</p>`:y;Object.keys(g.metadata??{}).length&&(w+=`<hr/><small><em>${Object.entries(g.metadata??{}).map(([E,L])=>`${E} = ${L}`).join(`
`)}</em></small>`);let A=(h[m]??h[p]).replace("{0}",cd(m)).replace("{1}",w);c+=`	${A}
`}}let d={};for(let p of e){let h=p.source.split(":"),m=p.target.split(":"),g=h.filter((y,_)=>y===m[_]).join(":");d[g]||(d[g]=[]),d[g].push(p)}let l=new Set;function f(p,h){let m=p.length===1&&p[0].source===p[0].target;if(h&&!m){let g=h.split(":").pop();if(l.has(g))throw new Error(`Found duplicate subgraph '${g}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);l.add(g),c+=`	subgraph ${g}
`}for(let g of p){let{source:y,target:_,data:w,conditional:A}=g,E="";if(w!==void 0){let L=w,G=L.split(" ");G.length>u&&(L=Array.from({length:Math.ceil(G.length/u)},(q,ee)=>G.slice(ee*u,(ee+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),E=A?` -. &nbsp;${L}&nbsp; .-> `:` -- &nbsp;${L}&nbsp; --> `}else E=A?" -.-> ":" --> ";c+=`	${cd(y)}${E}${cd(_)};
`}for(let g in d)g.startsWith(`${h}:`)&&g!==h&&f(d[g],g);h&&!m&&(c+=`	end
`)}f(d[""]??[],"");for(let p in d)!p.includes(":")&&p!==""&&f(d[p],p);return a&&(c+=BE(i??{})),c}async function Vg(r,e){return ZE(r,{...e,imageType:"png"})}async function ZE(r,e){let t=e?.backgroundColor??"white",n=e?.imageType??"png",s=btoa(r);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));let i=`https://mermaid.ink/img/${s}?bgColor=${t}&type=${n}`,a=await fetch(i);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}var lC=Object.freeze({status:"aborted"});function ei(r,e,t){function n(o,u){var c;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(c=o._zod).traits??(c.traits=new Set),o._zod.traits.add(r),e(o,u);for(let d in a.prototype)d in o||Object.defineProperty(o,d,{value:a.prototype[d].bind(o)});o._zod.constr=a,o._zod.def=u}let s=t?.Parent??Object;class i extends s{}Object.defineProperty(i,"name",{value:r});function a(o){var u;let c=t?.Parent?new i:this;n(c,o),(u=c._zod).deferred??(u.deferred=[]);for(let d of c._zod.deferred)d();return c}return Object.defineProperty(a,"init",{value:n}),Object.defineProperty(a,Symbol.hasInstance,{value:o=>t?.Parent&&o instanceof t.Parent?!0:o?._zod?.traits?.has(r)}),Object.defineProperty(a,"name",{value:r}),a}var dC=Symbol("zod_brand"),tn=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},ld={};function ti(r){return r&&Object.assign(ld,r),ld}function dd(r){let e=Object.values(r).filter(n=>typeof n=="number");return Object.entries(r).filter(([n,s])=>e.indexOf(+n)===-1).map(([n,s])=>s)}function Jg(r,e){return typeof e=="bigint"?e.toString():e}function Wg(r){return{get value(){{let t=r();return Object.defineProperty(this,"value",{value:t}),t}throw new Error("cached value already set")}}}var fd=Error.captureStackTrace?Error.captureStackTrace:(...r)=>{};var qE=Wg(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{let r=Function;return new r(""),!0}catch{return!1}});function ri(r,e,t){let n=new r._zod.constr(e??r._zod.def);return(!e||t?.parent)&&(n._zod.parent=r),n}function Yg(r){let e=r;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}var fC={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Ou(r,e=0){for(let t=e;t<r.issues.length;t++)if(r.issues[t]?.continue!==!0)return!0;return!1}function Eu(r){return typeof r=="string"?r:r?.message}function ni(r,e,t){let n={...r,path:r.path??[]};if(!r.message){let s=Eu(r.inst?._zod.def?.error?.(r))??Eu(e?.error?.(r))??Eu(t.customError?.(r))??Eu(t.localeError?.(r))??"Invalid input";n.message=s}return delete n.inst,delete n.continue,e?.reportInput||delete n.input,n}var Xg=(r,e)=>{r.name="$ZodError",Object.defineProperty(r,"_zod",{value:r._zod,enumerable:!1}),Object.defineProperty(r,"issues",{value:e,enumerable:!1}),Object.defineProperty(r,"message",{get(){return JSON.stringify(e,Jg,2)},enumerable:!0}),Object.defineProperty(r,"toString",{value:()=>r.message,enumerable:!1})},Qg=ei("$ZodError",Xg),Ca=ei("$ZodError",Xg,{Parent:Error});var HE=r=>(e,t,n,s)=>{let i=n?Object.assign(n,{async:!1}):{async:!1},a=e._zod.run({value:t,issues:[]},i);if(a instanceof Promise)throw new tn;if(a.issues.length){let o=new(s?.Err??r)(a.issues.map(u=>ni(u,i,ti())));throw fd(o,s?.callee),o}return a.value},e_=HE(Ca),VE=r=>async(e,t,n,s)=>{let i=n?Object.assign(n,{async:!0}):{async:!0},a=e._zod.run({value:t,issues:[]},i);if(a instanceof Promise&&(a=await a),a.issues.length){let o=new(s?.Err??r)(a.issues.map(u=>ni(u,i,ti())));throw fd(o,s?.callee),o}return a.value},t_=VE(Ca),KE=r=>(e,t,n)=>{let s=n?{...n,async:!1}:{async:!1},i=e._zod.run({value:t,issues:[]},s);if(i instanceof Promise)throw new tn;return i.issues.length?{success:!1,error:new(r??Qg)(i.issues.map(a=>ni(a,s,ti())))}:{success:!0,data:i.value}},r_=KE(Ca),JE=r=>async(e,t,n)=>{let s=n?Object.assign(n,{async:!0}):{async:!0},i=e._zod.run({value:t,issues:[]},s);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new r(i.issues.map(a=>ni(a,s,ti())))}:{success:!0,data:i.value}},n_=JE(Ca);var s_={major:4,minor:0,patch:0};var WE=ei("$ZodType",(r,e)=>{var t;r??(r={}),r._zod.def=e,r._zod.bag=r._zod.bag||{},r._zod.version=s_;let n=[...r._zod.def.checks??[]];r._zod.traits.has("$ZodCheck")&&n.unshift(r);for(let s of n)for(let i of s._zod.onattach)i(r);if(n.length===0)(t=r._zod).deferred??(t.deferred=[]),r._zod.deferred?.push(()=>{r._zod.run=r._zod.parse});else{let s=(i,a,o)=>{let u=Ou(i),c;for(let d of a){if(d._zod.def.when){if(!d._zod.def.when(i))continue}else if(u)continue;let l=i.issues.length,f=d._zod.check(i);if(f instanceof Promise&&o?.async===!1)throw new tn;if(c||f instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await f,i.issues.length!==l&&(u||(u=Ou(i,l)))});else{if(i.issues.length===l)continue;u||(u=Ou(i,l))}}return c?c.then(()=>i):i};r._zod.run=(i,a)=>{let o=r._zod.parse(i,a);if(o instanceof Promise){if(a.async===!1)throw new tn;return o.then(u=>s(u,n,a))}return s(o,n,a)}}r["~standard"]={validate:s=>{try{let i=r_(r,s);return i.success?{value:i.data}:{issues:i.error?.issues}}catch{return n_(r,s).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}});var i_=ei("$ZodNever",(r,e)=>{WE.init(r,e),r._zod.parse=(t,n)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:r}),t)});var RC=Symbol("ZodOutput"),NC=Symbol("ZodInput"),$a=class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){let n=t[0];if(this._map.set(e,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&typeof t=="object"&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let n={...this.get(t)??{}};return delete n.id,{...n,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}};function YE(){return new $a}var Qt=YE();function a_(r,e){return new r({type:"never",...Yg(e)})}var Iu=class{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??Qt,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var n;let s=e._zod.def,i={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},a=this.seen.get(e);if(a)return a.count++,t.schemaPath.includes(e)&&(a.cycle=t.path),a.schema;let o={schema:{},count:1,cycle:void 0,path:t.path};this.seen.set(e,o);let u=e._zod.toJSONSchema?.();if(u)o.schema=u;else{let l={...t,schemaPath:[...t.schemaPath,e],path:t.path},f=e._zod.parent;if(f)o.ref=f,this.process(f,l),this.seen.get(f).isParent=!0;else{let p=o.schema;switch(s.type){case"string":{let h=p;h.type="string";let{minimum:m,maximum:g,format:y,patterns:_,contentEncoding:w}=e._zod.bag;if(typeof m=="number"&&(h.minLength=m),typeof g=="number"&&(h.maxLength=g),y&&(h.format=i[y]??y,h.format===""&&delete h.format),w&&(h.contentEncoding=w),_&&_.size>0){let A=[..._];A.length===1?h.pattern=A[0].source:A.length>1&&(o.schema.allOf=[...A.map(E=>({...this.target==="draft-7"?{type:"string"}:{},pattern:E.source}))])}break}case"number":{let h=p,{minimum:m,maximum:g,format:y,multipleOf:_,exclusiveMaximum:w,exclusiveMinimum:A}=e._zod.bag;typeof y=="string"&&y.includes("int")?h.type="integer":h.type="number",typeof A=="number"&&(h.exclusiveMinimum=A),typeof m=="number"&&(h.minimum=m,typeof A=="number"&&(A>=m?delete h.minimum:delete h.exclusiveMinimum)),typeof w=="number"&&(h.exclusiveMaximum=w),typeof g=="number"&&(h.maximum=g,typeof w=="number"&&(w<=g?delete h.maximum:delete h.exclusiveMaximum)),typeof _=="number"&&(h.multipleOf=_);break}case"boolean":{let h=p;h.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{p.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{p.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{let h=p,{minimum:m,maximum:g}=e._zod.bag;typeof m=="number"&&(h.minItems=m),typeof g=="number"&&(h.maxItems=g),h.type="array",h.items=this.process(s.element,{...l,path:[...l.path,"items"]});break}case"object":{let h=p;h.type="object",h.properties={};let m=s.shape;for(let _ in m)h.properties[_]=this.process(m[_],{...l,path:[...l.path,"properties",_]});let g=new Set(Object.keys(m)),y=new Set([...g].filter(_=>{let w=s.shape[_]._zod;return this.io==="input"?w.optin===void 0:w.optout===void 0}));y.size>0&&(h.required=Array.from(y)),s.catchall?._zod.def.type==="never"?h.additionalProperties=!1:s.catchall?s.catchall&&(h.additionalProperties=this.process(s.catchall,{...l,path:[...l.path,"additionalProperties"]})):this.io==="output"&&(h.additionalProperties=!1);break}case"union":{let h=p;h.anyOf=s.options.map((m,g)=>this.process(m,{...l,path:[...l.path,"anyOf",g]}));break}case"intersection":{let h=p,m=this.process(s.left,{...l,path:[...l.path,"allOf",0]}),g=this.process(s.right,{...l,path:[...l.path,"allOf",1]}),y=w=>"allOf"in w&&Object.keys(w).length===1,_=[...y(m)?m.allOf:[m],...y(g)?g.allOf:[g]];h.allOf=_;break}case"tuple":{let h=p;h.type="array";let m=s.items.map((_,w)=>this.process(_,{...l,path:[...l.path,"prefixItems",w]}));if(this.target==="draft-2020-12"?h.prefixItems=m:h.items=m,s.rest){let _=this.process(s.rest,{...l,path:[...l.path,"items"]});this.target==="draft-2020-12"?h.items=_:h.additionalItems=_}s.rest&&(h.items=this.process(s.rest,{...l,path:[...l.path,"items"]}));let{minimum:g,maximum:y}=e._zod.bag;typeof g=="number"&&(h.minItems=g),typeof y=="number"&&(h.maxItems=y);break}case"record":{let h=p;h.type="object",h.propertyNames=this.process(s.keyType,{...l,path:[...l.path,"propertyNames"]}),h.additionalProperties=this.process(s.valueType,{...l,path:[...l.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{let h=p,m=dd(s.entries);m.every(g=>typeof g=="number")&&(h.type="number"),m.every(g=>typeof g=="string")&&(h.type="string"),h.enum=m;break}case"literal":{let h=p,m=[];for(let g of s.values)if(g===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof g=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");m.push(Number(g))}else m.push(g);if(m.length!==0)if(m.length===1){let g=m[0];h.type=g===null?"null":typeof g,h.const=g}else m.every(g=>typeof g=="number")&&(h.type="number"),m.every(g=>typeof g=="string")&&(h.type="string"),m.every(g=>typeof g=="boolean")&&(h.type="string"),m.every(g=>g===null)&&(h.type="null"),h.enum=m;break}case"file":{let h=p,m={type:"string",format:"binary",contentEncoding:"binary"},{minimum:g,maximum:y,mime:_}=e._zod.bag;g!==void 0&&(m.minLength=g),y!==void 0&&(m.maxLength=y),_?_.length===1?(m.contentMediaType=_[0],Object.assign(h,m)):h.anyOf=_.map(w=>({...m,contentMediaType:w})):Object.assign(h,m);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{let h=this.process(s.innerType,l);p.anyOf=[h,{type:"null"}];break}case"nonoptional":{this.process(s.innerType,l),o.ref=s.innerType;break}case"success":{let h=p;h.type="boolean";break}case"default":{this.process(s.innerType,l),o.ref=s.innerType,p.default=JSON.parse(JSON.stringify(s.defaultValue));break}case"prefault":{this.process(s.innerType,l),o.ref=s.innerType,this.io==="input"&&(p._prefault=JSON.parse(JSON.stringify(s.defaultValue)));break}case"catch":{this.process(s.innerType,l),o.ref=s.innerType;let h;try{h=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}p.default=h;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{let h=p,m=e._zod.pattern;if(!m)throw new Error("Pattern not found in template literal");h.type="string",h.pattern=m.source;break}case"pipe":{let h=this.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;this.process(h,l),o.ref=h;break}case"readonly":{this.process(s.innerType,l),o.ref=s.innerType,p.readOnly=!0;break}case"promise":{this.process(s.innerType,l),o.ref=s.innerType;break}case"optional":{this.process(s.innerType,l),o.ref=s.innerType;break}case"lazy":{let h=e._zod.innerType;this.process(h,l),o.ref=h;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}default:}}}let c=this.metadataRegistry.get(e);return c&&Object.assign(o.schema,c),this.io==="input"&&Oe(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((n=o.schema).default??(n.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,t){let n={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},s=this.seen.get(e);if(!s)throw new Error("Unprocessed schema. This is a bug in Zod.");let i=d=>{let l=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){let m=n.external.registry.get(d[0])?.id,g=n.external.uri??(_=>_);if(m)return{ref:g(m)};let y=d[1].defId??d[1].schema.id??`schema${this.counter++}`;return d[1].defId=y,{defId:y,ref:`${g("__shared")}#/${l}/${y}`}}if(d[1]===s)return{ref:"#"};let p=`#/${l}/`,h=d[1].schema.id??`__schema${this.counter++}`;return{defId:h,ref:p+h}},a=d=>{if(d[1].schema.$ref)return;let l=d[1],{ref:f,defId:p}=i(d);l.def={...l.schema},p&&(l.defId=p);let h=l.schema;for(let m in h)delete h[m];h.$ref=f};if(n.cycles==="throw")for(let d of this.seen.entries()){let l=d[1];if(l.cycle)throw new Error(`Cycle detected: #/${l.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let d of this.seen.entries()){let l=d[1];if(e===d[0]){a(d);continue}if(n.external){let p=n.external.registry.get(d[0])?.id;if(e!==d[0]&&p){a(d);continue}}if(this.metadataRegistry.get(d[0])?.id){a(d);continue}if(l.cycle){a(d);continue}if(l.count>1&&n.reused==="ref"){a(d);continue}}let o=(d,l)=>{let f=this.seen.get(d),p=f.def??f.schema,h={...p};if(f.ref===null)return;let m=f.ref;if(f.ref=null,m){o(m,l);let g=this.seen.get(m).schema;g.$ref&&l.target==="draft-7"?(p.allOf=p.allOf??[],p.allOf.push(g)):(Object.assign(p,g),Object.assign(p,h))}f.isParent||this.override({zodSchema:d,jsonSchema:p,path:f.path??[]})};for(let d of[...this.seen.entries()].reverse())o(d[0],{target:this.target});let u={};if(this.target==="draft-2020-12"?u.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?u.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),n.external?.uri){let d=n.external.registry.get(e)?.id;if(!d)throw new Error("Schema is missing an `id` property");u.$id=n.external.uri(d)}Object.assign(u,s.def);let c=n.external?.defs??{};for(let d of this.seen.entries()){let l=d[1];l.def&&l.defId&&(c[l.defId]=l.def)}n.external||Object.keys(c).length>0&&(this.target==="draft-2020-12"?u.$defs=c:u.definitions=c);try{return JSON.parse(JSON.stringify(u))}catch{throw new Error("Error converting schema to JSON.")}}};function pd(r,e){if(r instanceof $a){let n=new Iu(e),s={};for(let o of r._idmap.entries()){let[u,c]=o;n.process(c)}let i={},a={registry:r,uri:e?.uri,defs:s};for(let o of r._idmap.entries()){let[u,c]=o;i[u]=n.emit(c,{...e,external:a})}if(Object.keys(s).length>0){let o=n.target==="draft-2020-12"?"$defs":"definitions";i.__shared={[o]:s}}return{schemas:i}}let t=new Iu(e);return t.process(r),t.emit(r,e)}function Oe(r,e){let t=e??{seen:new Set};if(t.seen.has(r))return!1;t.seen.add(r);let s=r._zod.def;switch(s.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return Oe(s.element,t);case"object":{for(let i in s.shape)if(Oe(s.shape[i],t))return!0;return!1}case"union":{for(let i of s.options)if(Oe(i,t))return!0;return!1}case"intersection":return Oe(s.left,t)||Oe(s.right,t);case"tuple":{for(let i of s.items)if(Oe(i,t))return!0;return!!(s.rest&&Oe(s.rest,t))}case"record":return Oe(s.keyType,t)||Oe(s.valueType,t);case"map":return Oe(s.keyType,t)||Oe(s.valueType,t);case"set":return Oe(s.valueType,t);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return Oe(s.innerType,t);case"lazy":return Oe(s.getter(),t);case"default":return Oe(s.innerType,t);case"prefault":return Oe(s.innerType,t);case"custom":return!1;case"transform":return!0;case"pipe":return Oe(s.in,t)||Oe(s.out,t);case"success":return!1;case"catch":return!1;default:}throw new Error(`Unknown schema type: ${s.type}`)}var u_=Symbol("Let zodToJsonSchema decide on which parser to use");var o_={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},c_=r=>typeof r=="string"?{...o_,name:r}:{...o_,...r};var l_=r=>{let e=c_(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function hd(r,e,t,n){n?.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function ae(r,e,t,n,s){r[e]=t,hd(r,e,n,s)}var Tu=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")};function me(r){if(r.target!=="openAi")return{};let e=[...r.basePath,r.definitionPath,r.openAiAnyTypeName];return r.flags.hasReferencedOpenAiAnyType=!0,{$ref:r.$refStrategy==="relative"?Tu(e,r.currentPath):e.join("/")}}function d_(r,e){let t={type:"array"};return r.type?._def&&r.type?._def?.typeName!==b.ZodAny&&(t.items=B(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&ae(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&ae(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(ae(t,"minItems",r.exactLength.value,r.exactLength.message,e),ae(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function f_(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?ae(t,"minimum",n.value,n.message,e):ae(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),ae(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?ae(t,"maximum",n.value,n.message,e):ae(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),ae(t,"maximum",n.value,n.message,e));break;case"multipleOf":ae(t,"multipleOf",n.value,n.message,e);break}return t}function p_(){return{type:"boolean"}}function Pu(r,e){return B(r.type._def,e)}var h_=(r,e)=>B(r.innerType._def,e);function md(r,e,t){let n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,i)=>md(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return XE(r,e)}}var XE=(r,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let n of r.checks)switch(n.kind){case"min":ae(t,"minimum",n.value,n.message,e);break;case"max":ae(t,"maximum",n.value,n.message,e);break}return t};function m_(r,e){return{...B(r.innerType._def,e),default:r.defaultValue()}}function g_(r,e){return e.effectStrategy==="input"?B(r.schema._def,e):me(e)}function __(r){return{type:"string",enum:Array.from(r.values)}}var QE=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function y_(r,e){let t=[B(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),B(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return t.forEach(i=>{if(QE(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){let{additionalProperties:o,...u}=i;a=u}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function b_(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var gd,Ct={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(gd===void 0&&(gd=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),gd),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Su(r,e){let t={type:"string"};if(r.checks)for(let n of r.checks)switch(n.kind){case"min":ae(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":ae(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":$t(t,"email",n.message,e);break;case"format:idn-email":$t(t,"idn-email",n.message,e);break;case"pattern:zod":Ke(t,Ct.email,n.message,e);break}break;case"url":$t(t,"uri",n.message,e);break;case"uuid":$t(t,"uuid",n.message,e);break;case"regex":Ke(t,n.regex,n.message,e);break;case"cuid":Ke(t,Ct.cuid,n.message,e);break;case"cuid2":Ke(t,Ct.cuid2,n.message,e);break;case"startsWith":Ke(t,RegExp(`^${_d(n.value,e)}`),n.message,e);break;case"endsWith":Ke(t,RegExp(`${_d(n.value,e)}$`),n.message,e);break;case"datetime":$t(t,"date-time",n.message,e);break;case"date":$t(t,"date",n.message,e);break;case"time":$t(t,"time",n.message,e);break;case"duration":$t(t,"duration",n.message,e);break;case"length":ae(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),ae(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{Ke(t,RegExp(_d(n.value,e)),n.message,e);break}case"ip":{n.version!=="v6"&&$t(t,"ipv4",n.message,e),n.version!=="v4"&&$t(t,"ipv6",n.message,e);break}case"base64url":Ke(t,Ct.base64url,n.message,e);break;case"jwt":Ke(t,Ct.jwt,n.message,e);break;case"cidr":{n.version!=="v6"&&Ke(t,Ct.ipv4Cidr,n.message,e),n.version!=="v4"&&Ke(t,Ct.ipv6Cidr,n.message,e);break}case"emoji":Ke(t,Ct.emoji(),n.message,e);break;case"ulid":{Ke(t,Ct.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{$t(t,"binary",n.message,e);break}case"contentEncoding:base64":{ae(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{Ke(t,Ct.base64,n.message,e);break}}break}case"nanoid":Ke(t,Ct.nanoid,n.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}function _d(r,e){return e.patternStrategy==="escape"?tO(r):r}var eO=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function tO(r){let e="";for(let t=0;t<r.length;t++)eO.has(r[t])||(e+="\\"),e+=r[t];return e}function $t(r,e,t,n){r.format||r.anyOf?.some(s=>s.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):ae(r,"format",e,t,n)}function Ke(r,e,t,n){r.pattern||r.allOf?.some(s=>s.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:w_(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):ae(r,"pattern",w_(e,n),t,n)}function w_(r,e){if(!e.applyRegexFlags||!r.flags)return r.source;let t={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},n=t.i?r.source.toLowerCase():r.source,s="",i=!1,a=!1,o=!1;for(let u=0;u<n.length;u++){if(i){s+=n[u],i=!1;continue}if(t.i){if(a){if(n[u].match(/[a-z]/)){o?(s+=n[u],s+=`${n[u-2]}-${n[u]}`.toUpperCase(),o=!1):n[u+1]==="-"&&n[u+2]?.match(/[a-z]/)?(s+=n[u],o=!0):s+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){s+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(t.m){if(n[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&n[u]==="."){s+=a?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}s+=n[u],n[u]==="\\"?i=!0:a&&n[u]==="]"?a=!1:!a&&n[u]==="["&&(a=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return s}function ku(r,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&r.keyType?._def.typeName===b.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((n,s)=>({...n,[s]:B(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",s]})??me(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let t={type:"object",additionalProperties:B(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(r.keyType?._def.typeName===b.ZodString&&r.keyType._def.checks?.length){let{type:n,...s}=Su(r.keyType._def,e);return{...t,propertyNames:s}}else{if(r.keyType?._def.typeName===b.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};if(r.keyType?._def.typeName===b.ZodBranded&&r.keyType._def.type._def.typeName===b.ZodString&&r.keyType._def.type._def.checks?.length){let{type:n,...s}=Pu(r.keyType._def,e);return{...t,propertyNames:s}}}return t}function x_(r,e){if(e.mapStrategy==="record")return ku(r,e);let t=B(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||me(e),n=B(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||me(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function v_(r){let e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function A_(r){return r.target==="openAi"?void 0:{not:me({...r,currentPath:[...r.currentPath,"not"]})}}function E_(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var ja={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function I_(r,e){if(e.target==="openApi3")return O_(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in ja&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((s,i)=>{let a=ja[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((s,i)=>{let a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){let s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return O_(r,e)}var O_=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>B(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function T_(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:ja[r.innerType._def.typeName],nullable:!0}:{type:[ja[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=B(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let t=B(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function P_(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",hd(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?ae(t,"minimum",n.value,n.message,e):ae(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),ae(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?ae(t,"maximum",n.value,n.message,e):ae(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),ae(t,"maximum",n.value,n.message,e));break;case"multipleOf":ae(t,"multipleOf",n.value,n.message,e);break}return t}function S_(r,e){let t=e.target==="openAi",n={type:"object",properties:{}},s=[],i=r.shape();for(let o in i){let u=i[o];if(u===void 0||u._def===void 0)continue;let c=nO(u);c&&t&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),c=!1);let d=B(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});d!==void 0&&(n.properties[o]=d,c||s.push(o))}s.length&&(n.required=s);let a=rO(r,e);return a!==void 0&&(n.additionalProperties=a),n}function rO(r,e){if(r.catchall._def.typeName!=="ZodNever")return B(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function nO(r){try{return r.isOptional()}catch{return!0}}var k_=(r,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return B(r.innerType._def,e);let t=B(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:me(e)},t]}:me(e)};var R_=(r,e)=>{if(e.pipeStrategy==="input")return B(r.in._def,e);if(e.pipeStrategy==="output")return B(r.out._def,e);let t=B(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=B(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function N_(r,e){return B(r.type._def,e)}function C_(r,e){let n={type:"array",uniqueItems:!0,items:B(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&ae(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&ae(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function $_(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>B(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:B(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>B(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function j_(r){return{not:me(r)}}function M_(r){return me(r)}var z_=(r,e)=>B(r.innerType._def,e);var L_=(r,e,t)=>{switch(e){case b.ZodString:return Su(r,t);case b.ZodNumber:return P_(r,t);case b.ZodObject:return S_(r,t);case b.ZodBigInt:return f_(r,t);case b.ZodBoolean:return p_();case b.ZodDate:return md(r,t);case b.ZodUndefined:return j_(t);case b.ZodNull:return E_(t);case b.ZodArray:return d_(r,t);case b.ZodUnion:case b.ZodDiscriminatedUnion:return I_(r,t);case b.ZodIntersection:return y_(r,t);case b.ZodTuple:return $_(r,t);case b.ZodRecord:return ku(r,t);case b.ZodLiteral:return b_(r,t);case b.ZodEnum:return __(r);case b.ZodNativeEnum:return v_(r);case b.ZodNullable:return T_(r,t);case b.ZodOptional:return k_(r,t);case b.ZodMap:return x_(r,t);case b.ZodSet:return C_(r,t);case b.ZodLazy:return()=>r.getter()._def;case b.ZodPromise:return N_(r,t);case b.ZodNaN:case b.ZodNever:return A_(t);case b.ZodEffects:return g_(r,t);case b.ZodAny:return me(t);case b.ZodUnknown:return M_(t);case b.ZodDefault:return m_(r,t);case b.ZodBranded:return Pu(r,t);case b.ZodReadonly:return z_(r,t);case b.ZodCatch:return h_(r,t);case b.ZodPipeline:return R_(r,t);case b.ZodFunction:case b.ZodVoid:case b.ZodSymbol:return;default:return(n=>{})(e)}};function B(r,e,t=!1){let n=e.seen.get(r);if(e.override){let o=e.override?.(r,e,n,t);if(o!==u_)return o}if(n&&!t){let o=sO(n,e);if(o!==void 0)return o}let s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);let i=L_(r,r.typeName,e),a=typeof i=="function"?B(i(),e):i;if(a&&iO(r,e,a),e.postProcess){let o=e.postProcess(a,r,e);return s.jsonSchema=a,o}return s.jsonSchema=a,a}var sO=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:Tu(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((t,n)=>e.currentPath[n]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),me(e)):e.$refStrategy==="seen"?me(e):void 0}},iO=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var si=(r,e)=>{let t=l_(e),n=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[c,d])=>({...u,[c]:B(d._def,{...t,currentPath:[...t.basePath,t.definitionPath,c]},!0)??me(t)}),{}):void 0,s=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,i=B(r._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1)??me(t),a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(i.title=a),t.flags.hasReferencedOpenAiAnyType&&(n||(n={}),n[t.openAiAnyTypeName]||(n[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));let o=s===void 0?n?{...i,[t.definitionPath]:n}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...n,[s]:i}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};function Tr(r,e){let t=typeof r;if(t!==typeof e)return!1;if(Array.isArray(r)){if(!Array.isArray(e))return!1;let n=r.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(!Tr(r[s],e[s]))return!1;return!0}if(t==="object"){if(!r||!e)return r===e;let n=Object.keys(r),s=Object.keys(e);if(n.length!==s.length)return!1;for(let a of n)if(!Tr(r[a],e[a]))return!1;return!0}return r===e}function ut(r){return encodeURI(aO(r))}function aO(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}var oO={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},uO={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},cO={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},lO=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function rn(r,e=Object.create(null),t=lO,n=""){if(r&&typeof r=="object"&&!Array.isArray(r)){let i=r.$id||r.id;if(i){let a=new URL(i,t.href);a.hash.length>1?e[a.href]=r:(a.hash="",n===""?t=a:rn(r,e,t))}}else if(r!==!0&&r!==!1)return e;let s=t.href+(n?"#"+n:"");if(e[s]!==void 0)throw new Error(`Duplicate schema URI "${s}".`);if(e[s]=r,r===!0||r===!1)return e;if(r.__absolute_uri__===void 0&&Object.defineProperty(r,"__absolute_uri__",{enumerable:!1,value:s}),r.$ref&&r.__absolute_ref__===void 0){let i=new URL(r.$ref,t.href);i.hash=i.hash,Object.defineProperty(r,"__absolute_ref__",{enumerable:!1,value:i.href})}if(r.$recursiveRef&&r.__absolute_recursive_ref__===void 0){let i=new URL(r.$recursiveRef,t.href);i.hash=i.hash,Object.defineProperty(r,"__absolute_recursive_ref__",{enumerable:!1,value:i.href})}if(r.$anchor){let i=new URL("#"+r.$anchor,t.href);e[i.href]=r}for(let i in r){if(cO[i])continue;let a=`${n}/${ut(i)}`,o=r[i];if(Array.isArray(o)){if(oO[i]){let u=o.length;for(let c=0;c<u;c++)rn(o[c],e,t,`${a}/${c}`)}}else if(uO[i])for(let u in o)rn(o[u],e,t,`${a}/${ut(u)}`);else rn(o,e,t,a)}return e}var dO=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,fO=[0,31,28,31,30,31,30,31,31,30,31,30,31],pO=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,hO=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,mO=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,gO=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,_O=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,yO=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,bO=/^(?:\/(?:[^~/]|~0|~1)*)*$/,wO=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,xO=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,vO=r=>{if(r[0]==='"')return!1;let[e,t,...n]=r.split("@");return!e||!t||n.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},AO=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,EO=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,OO=r=>r.length>1&&r.length<80&&(/^P\d+([.,]\d+)?W$/.test(r)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(r)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(r));function er(r){return r.test.bind(r)}var yd={date:D_,time:U_.bind(void 0,!1),"date-time":PO,duration:OO,uri:RO,"uri-reference":er(mO),"uri-template":er(gO),url:er(_O),email:vO,hostname:er(hO),ipv4:er(AO),ipv6:er(EO),regex:CO,uuid:er(yO),"json-pointer":er(bO),"json-pointer-uri-fragment":er(wO),"relative-json-pointer":er(xO)};function IO(r){return r%4===0&&(r%100!==0||r%400===0)}function D_(r){let e=r.match(dO);if(!e)return!1;let t=+e[1],n=+e[2],s=+e[3];return n>=1&&n<=12&&s>=1&&s<=(n==2&&IO(t)?29:fO[n])}function U_(r,e){let t=e.match(pO);if(!t)return!1;let n=+t[1],s=+t[2],i=+t[3],a=!!t[5];return(n<=23&&s<=59&&i<=59||n==23&&s==59&&i==60)&&(!r||a)}var TO=/t|\s/i;function PO(r){let e=r.split(TO);return e.length==2&&D_(e[0])&&U_(!0,e[1])}var SO=/\/|:/,kO=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function RO(r){return SO.test(r)&&kO.test(r)}var NO=/[^\\]\\Z/;function CO(r){if(NO.test(r))return!1;try{return new RegExp(r,"u"),!0}catch{return!1}}var F_;(function(r){r[r.Flag=1]="Flag",r[r.Basic=2]="Basic",r[r.Detailed=4]="Detailed"})(F_||(F_={}));function B_(r){let e=0,t=r.length,n=0,s;for(;n<t;)e++,s=r.charCodeAt(n++),s>=55296&&s<=56319&&n<t&&(s=r.charCodeAt(n),(s&64512)==56320&&n++);return e}function he(r,e,t="2019-09",n=rn(e),s=!0,i=null,a="#",o="#",u=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:a,keyword:"false",keywordLocation:a,error:"False boolean schema."}]};let c=typeof r,d;switch(c){case"boolean":case"number":case"string":d=c;break;case"object":r===null?d="null":Array.isArray(r)?d="array":d="object";break;default:throw new Error(`Instances of "${c}" type are not supported.`)}let{$ref:l,$recursiveRef:f,$recursiveAnchor:p,type:h,const:m,enum:g,required:y,not:_,anyOf:w,allOf:A,oneOf:E,if:L,then:G,else:q,format:ee,properties:ue,patternProperties:ce,additionalProperties:Gt,unevaluatedProperties:$s,minProperties:ta,maxProperties:js,propertyNames:$f,dependentRequired:Tc,dependentSchemas:Pc,dependencies:Sc,prefixItems:kc,items:ra,additionalItems:jf,unevaluatedItems:Mf,contains:zf,minContains:gr,maxContains:po,minItems:Rc,maxItems:Nc,uniqueItems:qb,minimum:In,maximum:Tn,exclusiveMinimum:na,exclusiveMaximum:sa,multipleOf:ho,minLength:mo,maxLength:go,pattern:Lf,__absolute_ref__:_o,__absolute_recursive_ref__:Gb}=e,k=[];if(p===!0&&i===null&&(i=e),f==="#"){let H=i===null?n[Gb]:i,D=`${o}/$recursiveRef`,J=he(r,i===null?e:i,t,n,s,H,a,D,u);J.valid||k.push({instanceLocation:a,keyword:"$recursiveRef",keywordLocation:D,error:"A subschema had errors."},...J.errors)}if(l!==void 0){let D=n[_o||l];if(D===void 0){let I=`Unresolved $ref "${l}".`;throw _o&&_o!==l&&(I+=`  Absolute URI "${_o}".`),I+=`
Known schemas:
- ${Object.keys(n).join(`
- `)}`,new Error(I)}let J=`${o}/$ref`,R=he(r,D,t,n,s,i,a,J,u);if(R.valid||k.push({instanceLocation:a,keyword:"$ref",keywordLocation:J,error:"A subschema had errors."},...R.errors),t==="4"||t==="7")return{valid:k.length===0,errors:k}}if(Array.isArray(h)){let H=h.length,D=!1;for(let J=0;J<H;J++)if(d===h[J]||h[J]==="integer"&&d==="number"&&r%1===0&&r===r){D=!0;break}D||k.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${h.join('", "')}".`})}else h==="integer"?(d!=="number"||r%1||r!==r)&&k.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${h}".`}):h!==void 0&&d!==h&&k.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${h}".`});if(m!==void 0&&(d==="object"||d==="array"?Tr(r,m)||k.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`}):r!==m&&k.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(m)}.`})),g!==void 0&&(d==="object"||d==="array"?g.some(H=>Tr(r,H))||k.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`}):g.some(H=>r===H)||k.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(g)}.`})),_!==void 0){let H=`${o}/not`;he(r,_,t,n,s,i,a,H).valid&&k.push({instanceLocation:a,keyword:"not",keywordLocation:H,error:'Instance matched "not" schema.'})}let yo=[];if(w!==void 0){let H=`${o}/anyOf`,D=k.length,J=!1;for(let R=0;R<w.length;R++){let I=w[R],K=Object.create(u),V=he(r,I,t,n,s,p===!0?i:null,a,`${H}/${R}`,K);k.push(...V.errors),J=J||V.valid,V.valid&&yo.push(K)}J?k.length=D:k.splice(D,0,{instanceLocation:a,keyword:"anyOf",keywordLocation:H,error:"Instance does not match any subschemas."})}if(A!==void 0){let H=`${o}/allOf`,D=k.length,J=!0;for(let R=0;R<A.length;R++){let I=A[R],K=Object.create(u),V=he(r,I,t,n,s,p===!0?i:null,a,`${H}/${R}`,K);k.push(...V.errors),J=J&&V.valid,V.valid&&yo.push(K)}J?k.length=D:k.splice(D,0,{instanceLocation:a,keyword:"allOf",keywordLocation:H,error:"Instance does not match every subschema."})}if(E!==void 0){let H=`${o}/oneOf`,D=k.length,J=E.filter((R,I)=>{let K=Object.create(u),V=he(r,R,t,n,s,p===!0?i:null,a,`${H}/${I}`,K);return k.push(...V.errors),V.valid&&yo.push(K),V.valid}).length;J===1?k.length=D:k.splice(D,0,{instanceLocation:a,keyword:"oneOf",keywordLocation:H,error:`Instance does not match exactly one subschema (${J} matches).`})}if((d==="object"||d==="array")&&Object.assign(u,...yo),L!==void 0){let H=`${o}/if`;if(he(r,L,t,n,s,i,a,H,u).valid){if(G!==void 0){let J=he(r,G,t,n,s,i,a,`${o}/then`,u);J.valid||k.push({instanceLocation:a,keyword:"if",keywordLocation:H,error:'Instance does not match "then" schema.'},...J.errors)}}else if(q!==void 0){let J=he(r,q,t,n,s,i,a,`${o}/else`,u);J.valid||k.push({instanceLocation:a,keyword:"if",keywordLocation:H,error:'Instance does not match "else" schema.'},...J.errors)}}if(d==="object"){if(y!==void 0)for(let R of y)R in r||k.push({instanceLocation:a,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${R}".`});let H=Object.keys(r);if(ta!==void 0&&H.length<ta&&k.push({instanceLocation:a,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${ta} properties.`}),js!==void 0&&H.length>js&&k.push({instanceLocation:a,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${js} properties.`}),$f!==void 0){let R=`${o}/propertyNames`;for(let I in r){let K=`${a}/${ut(I)}`,V=he(I,$f,t,n,s,i,K,R);V.valid||k.push({instanceLocation:a,keyword:"propertyNames",keywordLocation:R,error:`Property name "${I}" does not match schema.`},...V.errors)}}if(Tc!==void 0){let R=`${o}/dependantRequired`;for(let I in Tc)if(I in r){let K=Tc[I];for(let V of K)V in r||k.push({instanceLocation:a,keyword:"dependentRequired",keywordLocation:R,error:`Instance has "${I}" but does not have "${V}".`})}}if(Pc!==void 0)for(let R in Pc){let I=`${o}/dependentSchemas`;if(R in r){let K=he(r,Pc[R],t,n,s,i,a,`${I}/${ut(R)}`,u);K.valid||k.push({instanceLocation:a,keyword:"dependentSchemas",keywordLocation:I,error:`Instance has "${R}" but does not match dependant schema.`},...K.errors)}}if(Sc!==void 0){let R=`${o}/dependencies`;for(let I in Sc)if(I in r){let K=Sc[I];if(Array.isArray(K))for(let V of K)V in r||k.push({instanceLocation:a,keyword:"dependencies",keywordLocation:R,error:`Instance has "${I}" but does not have "${V}".`});else{let V=he(r,K,t,n,s,i,a,`${R}/${ut(I)}`);V.valid||k.push({instanceLocation:a,keyword:"dependencies",keywordLocation:R,error:`Instance has "${I}" but does not match dependant schema.`},...V.errors)}}}let D=Object.create(null),J=!1;if(ue!==void 0){let R=`${o}/properties`;for(let I in ue){if(!(I in r))continue;let K=`${a}/${ut(I)}`,V=he(r[I],ue[I],t,n,s,i,K,`${R}/${ut(I)}`);if(V.valid)u[I]=D[I]=!0;else if(J=s,k.push({instanceLocation:a,keyword:"properties",keywordLocation:R,error:`Property "${I}" does not match schema.`},...V.errors),J)break}}if(!J&&ce!==void 0){let R=`${o}/patternProperties`;for(let I in ce){let K=new RegExp(I,"u"),V=ce[I];for(let Je in r){if(!K.test(Je))continue;let Df=`${a}/${ut(Je)}`,Uf=he(r[Je],V,t,n,s,i,Df,`${R}/${ut(I)}`);Uf.valid?u[Je]=D[Je]=!0:(J=s,k.push({instanceLocation:a,keyword:"patternProperties",keywordLocation:R,error:`Property "${Je}" matches pattern "${I}" but does not match associated schema.`},...Uf.errors))}}}if(!J&&Gt!==void 0){let R=`${o}/additionalProperties`;for(let I in r){if(D[I])continue;let K=`${a}/${ut(I)}`,V=he(r[I],Gt,t,n,s,i,K,R);V.valid?u[I]=!0:(J=s,k.push({instanceLocation:a,keyword:"additionalProperties",keywordLocation:R,error:`Property "${I}" does not match additional properties schema.`},...V.errors))}}else if(!J&&$s!==void 0){let R=`${o}/unevaluatedProperties`;for(let I in r)if(!u[I]){let K=`${a}/${ut(I)}`,V=he(r[I],$s,t,n,s,i,K,R);V.valid?u[I]=!0:k.push({instanceLocation:a,keyword:"unevaluatedProperties",keywordLocation:R,error:`Property "${I}" does not match unevaluated properties schema.`},...V.errors)}}}else if(d==="array"){Nc!==void 0&&r.length>Nc&&k.push({instanceLocation:a,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${r.length} > ${Nc}).`}),Rc!==void 0&&r.length<Rc&&k.push({instanceLocation:a,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${r.length} < ${Rc}).`});let H=r.length,D=0,J=!1;if(kc!==void 0){let R=`${o}/prefixItems`,I=Math.min(kc.length,H);for(;D<I;D++){let K=he(r[D],kc[D],t,n,s,i,`${a}/${D}`,`${R}/${D}`);if(u[D]=!0,!K.valid&&(J=s,k.push({instanceLocation:a,keyword:"prefixItems",keywordLocation:R,error:"Items did not match schema."},...K.errors),J))break}}if(ra!==void 0){let R=`${o}/items`;if(Array.isArray(ra)){let I=Math.min(ra.length,H);for(;D<I;D++){let K=he(r[D],ra[D],t,n,s,i,`${a}/${D}`,`${R}/${D}`);if(u[D]=!0,!K.valid&&(J=s,k.push({instanceLocation:a,keyword:"items",keywordLocation:R,error:"Items did not match schema."},...K.errors),J))break}}else for(;D<H;D++){let I=he(r[D],ra,t,n,s,i,`${a}/${D}`,R);if(u[D]=!0,!I.valid&&(J=s,k.push({instanceLocation:a,keyword:"items",keywordLocation:R,error:"Items did not match schema."},...I.errors),J))break}if(!J&&jf!==void 0){let I=`${o}/additionalItems`;for(;D<H;D++){let K=he(r[D],jf,t,n,s,i,`${a}/${D}`,I);u[D]=!0,K.valid||(J=s,k.push({instanceLocation:a,keyword:"additionalItems",keywordLocation:I,error:"Items did not match additional items schema."},...K.errors))}}}if(zf!==void 0)if(H===0&&gr===void 0)k.push({instanceLocation:a,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(gr!==void 0&&H<gr)k.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${H}) than minContains (${gr}).`});else{let R=`${o}/contains`,I=k.length,K=0;for(let V=0;V<H;V++){let Je=he(r[V],zf,t,n,s,i,`${a}/${V}`,R);Je.valid?(u[V]=!0,K++):k.push(...Je.errors)}K>=(gr||0)&&(k.length=I),gr===void 0&&po===void 0&&K===0?k.splice(I,0,{instanceLocation:a,keyword:"contains",keywordLocation:R,error:"Array does not contain item matching schema."}):gr!==void 0&&K<gr?k.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${gr} items matching schema. Only ${K} items were found.`}):po!==void 0&&K>po&&k.push({instanceLocation:a,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${po} items matching schema. ${K} items were found.`})}if(!J&&Mf!==void 0){let R=`${o}/unevaluatedItems`;for(D;D<H;D++){if(u[D])continue;let I=he(r[D],Mf,t,n,s,i,`${a}/${D}`,R);u[D]=!0,I.valid||k.push({instanceLocation:a,keyword:"unevaluatedItems",keywordLocation:R,error:"Items did not match unevaluated items schema."},...I.errors)}}if(qb)for(let R=0;R<H;R++){let I=r[R],K=typeof I=="object"&&I!==null;for(let V=0;V<H;V++){if(R===V)continue;let Je=r[V];(I===Je||K&&(typeof Je=="object"&&Je!==null)&&Tr(I,Je))&&(k.push({instanceLocation:a,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${R} and ${V}.`}),R=Number.MAX_SAFE_INTEGER,V=Number.MAX_SAFE_INTEGER)}}}else if(d==="number"){if(t==="4"?(In!==void 0&&(na===!0&&r<=In||r<In)&&k.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${na?"or equal to ":""} ${In}.`}),Tn!==void 0&&(sa===!0&&r>=Tn||r>Tn)&&k.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${sa?"or equal to ":""} ${Tn}.`})):(In!==void 0&&r<In&&k.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${r} is less than ${In}.`}),Tn!==void 0&&r>Tn&&k.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${r} is greater than ${Tn}.`}),na!==void 0&&r<=na&&k.push({instanceLocation:a,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${r} is less than ${na}.`}),sa!==void 0&&r>=sa&&k.push({instanceLocation:a,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${r} is greater than or equal to ${sa}.`})),ho!==void 0){let H=r%ho;Math.abs(0-H)>=11920929e-14&&Math.abs(ho-H)>=11920929e-14&&k.push({instanceLocation:a,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${r} is not a multiple of ${ho}.`})}}else if(d==="string"){let H=mo===void 0&&go===void 0?0:B_(r);mo!==void 0&&H<mo&&k.push({instanceLocation:a,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${H} < ${mo}).`}),go!==void 0&&H>go&&k.push({instanceLocation:a,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${H} > ${go}).`}),Lf!==void 0&&!new RegExp(Lf,"u").test(r)&&k.push({instanceLocation:a,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),ee!==void 0&&yd[ee]&&!yd[ee](r)&&k.push({instanceLocation:a,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${ee}".`})}return{valid:k.length===0,errors:k}}function jt(r){if(typeof r!="object"||r===null)return!1;let e=r;if(!("_zod"in e))return!1;let t=e._zod;return typeof t=="object"&&t!==null&&"def"in t}function tr(r){if(typeof r!="object"||r===null)return!1;let e=r;if(!("_def"in e)||"_zod"in e)return!1;let t=e._def;return typeof t=="object"&&t!=null&&"typeName"in t}function ns(r){return!r||typeof r!="object"||Array.isArray(r)?!1:!!(jt(r)||tr(r))}async function Z_(r,e){if(jt(r))try{return{success:!0,data:await t_(r,e)}}catch(t){return{success:!1,error:t}}if(tr(r))return r.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function oi(r,e){if(jt(r))return e_(r,e);if(tr(r))return r.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Ma(r){if(jt(r))return Qt.get(r)?.description;if(tr(r)||"description"in r&&typeof r.description=="string")return r.description}function bd(r){return ns(r)?tr(r)?r._def.typeName==="ZodString":jt(r)?r._zod.def.type==="string":!1:!1}function ai(r){return jt(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="object":!1}function q_(r){return jt(r)?typeof r=="object"&&r!==null&&"_zod"in r&&typeof r._zod=="object"&&r._zod!==null&&"def"in r._zod&&typeof r._zod.def=="object"&&r._zod.def!==null&&"type"in r._zod.def&&r._zod.def.type==="array":!1}function Ru(r,e=!1){if(tr(r))return r.strict();if(ai(r)){let t=r._zod.def.shape;if(e)for(let[i,a]of Object.entries(r._zod.def.shape)){if(ai(a)){let u=Ru(a,e);t[i]=u}else if(q_(a)){let u=a._zod.def.element;ai(u)&&(u=Ru(u,e)),t[i]=ri(a,{...a._zod.def,element:u})}else t[i]=a;let o=Qt.get(a);o&&Qt.add(t[i],o)}let n=ri(r,{...r._zod.def,shape:t,catchall:a_(i_)}),s=Qt.get(r);return s&&Qt.add(n,s),n}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function $O(r){return tr(r)&&"typeName"in r._def&&r._def.typeName==="ZodEffects"}function jO(r){return jt(r)&&r._zod.def.type==="pipe"}function ii(r,e=!1){if(tr(r))return $O(r)?ii(r._def.schema,e):r;if(jt(r)){let t=r;if(jO(r)&&(t=ii(r._zod.def.in,e)),e){if(ai(t)){let s=t._zod.def.shape;for(let[i,a]of Object.entries(t._zod.def.shape))s[i]=ii(a,e);t=ri(t,{...t._zod.def,shape:s})}else if(q_(t)){let s=ii(t._zod.def.element,e);t=ri(t,{...t._zod.def,element:s})}}let n=Qt.get(r);return n&&Qt.add(t,n),t}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function nn(r){if(jt(r)){let e=ii(r,!0);if(ai(e)){let t=Ru(e,!0);return pd(t)}else return pd(r)}return tr(r)?si(r):r}function MO(r,e){if(r!==void 0&&!Wr(r))return r;if(Ra(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function zO(r){return Ra(r.data)?{type:"runnable",data:{id:r.data.lc_id,name:r.data.getName()}}:{type:"schema",data:{...nn(r.data.schema),title:r.data.name}}}var za=class r{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((t,n)=>{e[t.id]=Wr(t.id)?n:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...zO(t)})),edges:this.edges.map(t=>{let n={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(n.data=t.data),typeof t.conditional<"u"&&(n.conditional=t.conditional),n})}}addNode(e,t,n){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let s=t??ye(),i={id:s,data:e,name:MO(t,e),metadata:n};return this.nodes[s]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,n,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let i={source:e.id,target:t.id,data:n,conditional:s};return this.edges.push(i),i}firstNode(){return G_(this)}lastNode(){return H_(this)}extend(e,t=""){let n=t;Object.values(e.nodes).map(c=>c.id).every(Wr)&&(n="");let i=c=>n?`${n}:${c}`:c;Object.entries(e.nodes).forEach(([c,d])=>{this.nodes[i(c)]={...d,id:i(c)}});let a=e.edges.map(c=>({...c,source:i(c.source),target:i(c.target)}));this.edges=[...this.edges,...a];let o=e.firstNode(),u=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,u?{id:i(u.id),data:u.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&G_(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&H_(this,[e.id])&&this.removeNode(e)}reid(){let e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),t=new Map;Object.values(e).forEach(s=>{t.set(s,(t.get(s)||0)+1)});let n=s=>{let i=e[s];return Wr(s)&&t.get(i)===1?i:s};return new r({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,i])=>[n(s),{...i,id:n(s)}])),edges:this.edges.map(s=>({...s,source:n(s.source),target:n(s.target)}))})}drawMermaid(e){let{withStyles:t,curveStyle:n,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},a=this.reid(),o=a.firstNode(),u=a.lastNode();return Hg(a.nodes,a.edges,{firstNode:o?.id,lastNode:u?.id,withStyles:t,curveStyle:n,nodeColors:s,wrapLabelNWords:i})}async drawMermaidPng(e){let t=this.drawMermaid(e);return Vg(t,{backgroundColor:e?.backgroundColor})}};function G_(r,e=[]){let t=new Set(r.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),n=[];for(let s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function H_(r,e=[]){let t=new Set(r.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),n=[];for(let s of Object.values(r.nodes))!e.includes(s.id)&&!t.has(s.id)&&n.push(s);return n.length===1?n[0]:void 0}function V_(r){let e=new TextEncoder,t=new ReadableStream({async start(n){for await(let s of r)n.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));n.enqueue(e.encode(`event: end

`)),n.close()}});return Be.fromReadableStream(t)}function wd(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.iterator]=="function"&&typeof r.next=="function"}var K_=r=>r!=null&&typeof r=="object"&&"next"in r&&typeof r.next=="function";function Nu(r){return typeof r=="object"&&r!==null&&typeof r[Symbol.asyncIterator]=="function"}function*xd(r,e){for(;;){let{value:t,done:n}=tt.runWithConfig(kt(r),e.next.bind(e),!0);if(n)break;yield t}}async function*Cu(r,e){let t=e[Symbol.asyncIterator]();for(;;){let{value:n,done:s}=await tt.runWithConfig(kt(r),t.next.bind(e),!0);if(s)break;yield n}}function Ie(r,e){return r&&!Array.isArray(r)&&!(r instanceof Date)&&typeof r=="object"?r:{[e]:r}}var de=class extends Tt{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new Sr({bound:this,kwargs:e,config:{}})}map(){return new $u({bound:this})}withRetry(e){return new La({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new Sr({bound:this,config:e,kwargs:{}})}withFallbacks(e){let t=Array.isArray(e)?e:e.fallbacks;return new ju({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(ie);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let n=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,i)=>ie(i===0?e:n))}return Array.from({length:t},()=>ie(e))}async batch(e,t,n){let s=this._getOptionsList(t??{},e.length),i=s[0]?.maxConcurrency??n?.maxConcurrency,a=new Ir({maxConcurrency:i,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>a.call(async()=>{try{return await this.invoke(u,s[c])}catch(d){if(n?.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let n=ie(t),s=new Er({generator:this._streamIterator(e,n),config:n});return await s.setup,Be.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=ie(e):t=ie({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let n={...e};return delete n.callbacks,delete n.tags,delete n.metadata,delete n.runName,delete n.configurable,delete n.recursionLimit,delete n.maxConcurrency,delete n.runId,delete n.timeout,delete n.signal,[t,n]}async _callWithConfig(e,t,n){let s=ie(n),a=await(await rt(s))?.handleChainStart(this.toJSON(),Ie(t,"input"),s.runId,s?.runType,void 0,void 0,s?.runName??this.getName());delete s.runId;let o;try{let u=e.call(this,t,s,a);o=await Xt(u,n?.signal)}catch(u){throw await a?.handleChainError(u),u}return await a?.handleChainEnd(Ie(o,"output")),o}async _batchWithConfig(e,t,n,s){let i=this._getOptionsList(n??{},t.length),a=await Promise.all(i.map(rt)),o=await Promise.all(a.map(async(c,d)=>{let l=await c?.handleChainStart(this.toJSON(),Ie(t[d],"input"),i[d].runId,i[d].runType,void 0,void 0,i[d].runName??this.getName());return delete i[d].runId,l})),u;try{let c=e.call(this,t,i,o,s);u=await Xt(c,i?.[0]?.signal)}catch(c){throw await Promise.all(o.map(d=>d?.handleChainError(c))),c}return await Promise.all(o.map(c=>c?.handleChainEnd(Ie(u,"output")))),u}_concatOutputChunks(e,t){return Or(e,t)}async*_transformStreamWithConfig(e,t,n){let s,i=!0,a,o=!0,u=ie(n),c=await rt(u),d=this;async function*l(){for await(let p of e){if(i)if(s===void 0)s=p;else try{s=d._concatOutputChunks(s,p)}catch{s=void 0,i=!1}yield p}}let f;try{let p=await Ug(t.bind(this),l(),async()=>c?.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),n?.signal,u);delete u.runId,f=p.setup;let h=f?.handlers.find(qg),m=p.output;h!==void 0&&f!==void 0&&(m=h.tapOutputIterable(f.runId,m));let g=f?.handlers.find(Zg);g!==void 0&&f!==void 0&&(m=g.tapOutputIterable(f.runId,m));for await(let y of m)if(yield y,o)if(a===void 0)a=y;else try{a=this._concatOutputChunks(a,y)}catch{a=void 0,o=!1}}catch(p){throw await f?.handleChainError(p,void 0,void 0,void 0,{inputs:Ie(s,"input")}),p}await f?.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:Ie(s,"input")})}getGraph(e){let t=new za,n=t.addNode({name:`${this.getName()}Input`,schema:at.any()}),s=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:at.any()});return t.addEdge(n,s),t.addEdge(s,i),t}pipe(e){return new kr({first:this,last:Pr(e)})}pick(e){return this.pipe(new Mu(e))}assign(e){return this.pipe(new ui(new sn({steps:e})))}async*transform(e,t){let n;for await(let s of e)n===void 0?n=s:n=this._concatOutputChunks(n,s);yield*this._streamIterator(n,ie(t))}async*streamLog(e,t,n){let s=new Sa({...n,autoClose:!1,_schemaFormat:"original"}),i=ie(t);yield*this._streamLog(e,s,i)}async*_streamLog(e,t,n){let{callbacks:s}=n;if(s===void 0)n.callbacks=[t];else if(Array.isArray(s))n.callbacks=s.concat([t]);else{let u=s.copy();u.addHandler(t,!0),n.callbacks=u}let i=this.stream(e,n);async function a(){try{let u=await i;for await(let c of u){let d=new Rt({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(d)}}finally{await t.writer.close()}}let o=a();try{for await(let u of t)yield u}finally{await o}}streamEvents(e,t,n){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,n);else if(t.version==="v2")s=this._streamEventsV2(e,t,n);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?V_(s):Be.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,n){let s=new xu({...n,autoClose:!1}),i=ie(t),a=i.runId??ye();i.runId=a;let o=i.callbacks;if(o===void 0)i.callbacks=[s];else if(Array.isArray(o))i.callbacks=o.concat(s);else{let h=o.copy();h.addHandler(s,!0),i.callbacks=h}let u=new AbortController,c=this;async function d(){let h,m=null;try{t?.signal?"any"in AbortSignal?h=AbortSignal.any([u.signal,t.signal]):(h=t.signal,m=()=>{u.abort()},t.signal.addEventListener("abort",m,{once:!0})):h=u.signal;let g=await c.stream(e,{...i,signal:h}),y=s.tapOutputIterable(a,g);for await(let _ of y)if(u.signal.aborted)break}finally{await s.finish(),h&&m&&h.removeEventListener("abort",m)}}let l=d(),f=!1,p;try{for await(let h of s){if(!f){h.data.input=e,f=!0,p=h.run_id,yield h;continue}h.run_id===p&&h.event.endsWith("_end")&&h.data?.input&&delete h.data.input,yield h}}finally{u.abort(),await l}}async*_streamEventsV1(e,t,n){let s,i=!1,a=ie(t),o=a.tags??[],u=a.metadata??{},c=a.runName??this.getName(),d=new Sa({...n,autoClose:!1,_schemaFormat:"streaming_events"}),l=new Au({...n}),f=this._streamLog(e,d,a);for await(let h of f){if(s?s=s.concat(h):s=Pa.fromRunLogPatch(h),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;let _={...s.state},w={run_id:_.id,event:`on_${_.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};l.includeEvent(w,_.type)&&(yield w)}let m=h.ops.filter(_=>_.path.startsWith("/logs/")).map(_=>_.path.split("/")[2]),g=[...new Set(m)];for(let _ of g){let w,A={},E=s.state.logs[_];if(E.end_time===void 0?E.streamed_output.length>0?w="stream":w="start":w="end",w==="start")E.inputs!==void 0&&(A.input=E.inputs);else if(w==="end")E.inputs!==void 0&&(A.input=E.inputs),A.output=E.final_output;else if(w==="stream"){let L=E.streamed_output.length;if(L!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${L} instead. Encountered in: "${E.name}"`);A={chunk:E.streamed_output[0]},E.streamed_output=[]}yield{event:`on_${E.type}_${w}`,name:E.name,run_id:E.id,tags:E.tags,metadata:E.metadata,data:A}}let{state:y}=s;if(y.streamed_output.length>0){let _=y.streamed_output.length;if(_!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${_} instead. Encountered in: "${y.name}"`);let w={chunk:y.streamed_output[0]};y.streamed_output=[];let A={event:`on_${y.type}_stream`,run_id:y.id,tags:o,metadata:u,name:c,data:w};l.includeEvent(A,y.type)&&(yield A)}}let p=s?.state;if(p!==void 0){let h={event:`on_${p.type}_end`,name:c,run_id:p.id,tags:o,metadata:u,data:{output:p.final_output}};l.includeEvent(h,p.type)&&(yield h)}}static isRunnable(e){return Ra(e)}withListeners({onStart:e,onEnd:t,onError:n}){return new Sr({bound:this,config:{},configFactories:[s=>({callbacks:[new ka({config:s,onStart:e,onEnd:t,onError:n})]})]})}asTool(e){return DO(this,e)}},Sr=class r extends de{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=Qs(this.config,...e);return Qs(t,...this.configFactories?await Promise.all(this.configFactories.map(async n=>await n(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new La({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(ie(t),this.kwargs))}async batch(e,t,n){let s=Array.isArray(t)?await Promise.all(t.map(async i=>this._mergeConfig(ie(i),this.kwargs))):await this._mergeConfig(ie(t),this.kwargs);return this.bound.batch(e,s,n)}_concatOutputChunks(e,t){return this.bound._concatOutputChunks(e,t)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(ie(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(ie(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(ie(t),this.kwargs))}streamEvents(e,t,n){let s=this,i=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(ie(t),s.kwargs),version:t.version},n)};return Be.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&de.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new ka({config:s,onStart:e,onEnd:t,onError:n})]})]})}},$u=class r extends de{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new r({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,n){return this.bound.batch(e,Ae(t,{callbacks:n?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:n}){return new r({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:n})})}},La=class extends Sr{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,n){let s=e>1?`retry:attempt:${e}`:void 0;return Ae(t,{callbacks:n?.getChild(s)})}async _invoke(e,t,n){return(0,vd.default)(s=>super.invoke(e,this._patchConfigForRetry(s,t,n)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,n,s){let i={};try{await(0,vd.default)(async a=>{let o=e.map((f,p)=>p).filter(f=>i[f.toString()]===void 0||i[f.toString()]instanceof Error),u=o.map(f=>e[f]),c=o.map(f=>this._patchConfigForRetry(a,t?.[f],n?.[f])),d=await super.batch(u,c,{...s,returnExceptions:!0}),l;for(let f=0;f<d.length;f+=1){let p=d[f],h=o[f];p instanceof Error&&l===void 0&&(l=p,l.input=u[f]),i[h.toString()]=p}if(l)throw l;return d},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if(s?.returnExceptions!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,t,n){return this._batchWithConfig(this._batch.bind(this),e,t,n)}},kr=class r extends de{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let n=ie(t),i=await(await rt(n))?.handleChainStart(this.toJSON(),Ie(e,"input"),n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let a=e,o;try{let u=[this.first,...this.middle];for(let c=0;c<u.length;c+=1){let l=u[c].invoke(a,Ae(n,{callbacks:i?.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));a=await Xt(l,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");o=await this.last.invoke(a,Ae(n,{callbacks:i?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(u){throw await i?.handleChainError(u),u}return await i?.handleChainEnd(Ie(o,"output")),o}async batch(e,t,n){let s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(rt)),a=await Promise.all(i.map(async(u,c)=>{let d=await u?.handleChainStart(this.toJSON(),Ie(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName);return delete s[c].runId,d})),o=e;try{for(let u=0;u<this.steps.length;u+=1){let d=this.steps[u].batch(o,a.map((l,f)=>{let p=l?.getChild(this.omitSequenceTags?void 0:`seq:step:${u+1}`);return Ae(s[f],{callbacks:p})}),n);o=await Xt(d,s[0]?.signal)}}catch(u){throw await Promise.all(a.map(c=>c?.handleChainError(u))),u}return await Promise.all(a.map(u=>u?.handleChainEnd(Ie(o,"output")))),o}_concatOutputChunks(e,t){return this.last._concatOutputChunks(e,t)}async*_streamIterator(e,t){let n=await rt(t),{runId:s,...i}=t??{},a=await n?.handleChainStart(this.toJSON(),Ie(e,"input"),s,void 0,void 0,void 0,i?.runName),o=[this.first,...this.middle,this.last],u=!0,c;async function*d(){yield e}try{let l=o[0].transform(d(),Ae(i,{callbacks:a?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let f=1;f<o.length;f+=1)l=await o[f].transform(l,Ae(i,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${f+1}`)}));for await(let f of l)if(t?.signal?.throwIfAborted(),yield f,u)if(c===void 0)c=f;else try{c=this._concatOutputChunks(c,f)}catch{c=void 0,u=!1}}catch(l){throw await a?.handleChainError(l),l}await a?.handleChainEnd(Ie(c,"output"))}getGraph(e){let t=new za,n=null;return this.steps.forEach((s,i)=>{let a=s.getGraph(e);i!==0&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);let o=a.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);n&&t.addEdge(n,o),n=a.lastNode()}),t}pipe(e){return r.isRunnableSequence(e)?new r({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new r({first:this.first,middle:[...this.middle,this.last],last:Pr(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&de.isRunnable(e)}static from([e,...t],n){let s={};return typeof n=="string"?s.name=n:n!==void 0&&(s=n),new r({...s,first:Pr(e),middle:t.slice(0,-1).map(Pr),last:Pr(t[t.length-1])})}},sn=class r extends de{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,n]of Object.entries(e.steps))this.steps[t]=Pr(n)}static from(e){return new r({steps:e})}async invoke(e,t){let n=ie(t),i=await(await rt(n))?.handleChainStart(this.toJSON(),{input:e},n.runId,void 0,void 0,void 0,n?.runName);delete n.runId;let a={};try{let o=Object.entries(this.steps).map(async([u,c])=>{a[u]=await c.invoke(e,Ae(n,{callbacks:i?.getChild(`map:key:${u}`)}))});await Xt(Promise.all(o),t?.signal)}catch(o){throw await i?.handleChainError(o),o}return await i?.handleChainEnd(a),a}async*_transform(e,t,n){let s={...this.steps},i=ud(e,Object.keys(s).length),a=new Map(Object.entries(s).map(([o,u],c)=>{let d=u.transform(i[c],Ae(n,{callbacks:t?.getChild(`map:key:${o}`)}));return[o,d.next().then(l=>({key:o,gen:d,result:l}))]}));for(;a.size;){let o=Promise.race(a.values()),{key:u,result:c,gen:d}=await Xt(o,n?.signal);a.delete(u),c.done||(yield{[u]:c.value},a.set(u,d.next().then(l=>({key:u,gen:d,result:l}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=ie(t),i=new Er({generator:this.transform(n(),s),config:s});return await i.setup,Be.fromAsyncGenerator(i)}},Ad=class r extends de{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!No(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[n]=this._getOptionsList(t??{},1),s=await rt(n),i=this.func(Ae(n,{callbacks:s}),e);return Xt(i,n?.signal)}async*_streamIterator(e,t){let[n]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(Nu(s)){for await(let i of s)n?.signal?.throwIfAborted(),yield i;return}if(K_(s)){for(;;){n?.signal?.throwIfAborted();let i=s.next();if(i.done)break;yield i.value}return}yield s}static from(e){return new r({func:e})}};function LO(r){if(No(r))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var Rr=class r extends de{static lc_name(){return"RunnableLambda"}constructor(e){if(No(e.func))return Ad.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),LO(e.func),this.func=e.func}static from(e){return new r({func:e})}async _invoke(e,t,n){return new Promise((s,i)=>{let a=Ae(t,{callbacks:n?.getChild(),recursionLimit:(t?.recursionLimit??yu)-1});tt.runWithConfig(kt(a),async()=>{try{let o=await this.func(e,{...a});if(o&&de.isRunnable(o)){if(t?.recursionLimit===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...a,recursionLimit:(a.recursionLimit??yu)-1})}else if(Nu(o)){let u;for await(let c of Cu(a,o))if(t?.signal?.throwIfAborted(),u===void 0)u=c;else try{u=this._concatOutputChunks(u,c)}catch{u=c}o=u}else if(wd(o)){let u;for(let c of xd(a,o))if(t?.signal?.throwIfAborted(),u===void 0)u=c;else try{u=this._concatOutputChunks(u,c)}catch{u=c}o=u}s(o)}catch(o){i(o)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,n){let s;for await(let o of e)if(s===void 0)s=o;else try{s=this._concatOutputChunks(s,o)}catch{s=o}let i=Ae(n,{callbacks:t?.getChild(),recursionLimit:(n?.recursionLimit??yu)-1}),a=await new Promise((o,u)=>{tt.runWithConfig(kt(i),async()=>{try{let c=await this.func(s,{...i,config:i});o(c)}catch(c){u(c)}})});if(a&&de.isRunnable(a)){if(n?.recursionLimit===0)throw new Error("Recursion limit reached.");let o=await a.stream(s,i);for await(let u of o)yield u}else if(Nu(a))for await(let o of Cu(i,a))n?.signal?.throwIfAborted(),yield o;else if(wd(a))for(let o of xd(i,a))n?.signal?.throwIfAborted(),yield o;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=ie(t),i=new Er({generator:this.transform(n(),s),config:s});return await i.setup,Be.fromAsyncGenerator(i)}};var ju=class extends de{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}async invoke(e,t){let n=ie(t),s=await rt(n),{runId:i,...a}=n,o=await s?.handleChainStart(this.toJSON(),Ie(e,"input"),i,void 0,void 0,void 0,a?.runName),u=Ae(a,{callbacks:o?.getChild()});return await tt.runWithConfig(u,async()=>{let d;for(let l of this.runnables()){n?.signal?.throwIfAborted();try{let f=await l.invoke(e,u);return await o?.handleChainEnd(Ie(f,"output")),f}catch(f){d===void 0&&(d=f)}}throw d===void 0?new Error("No error stored at end of fallback."):(await o?.handleChainError(d),d)})}async*_streamIterator(e,t){let n=ie(t),s=await rt(n),{runId:i,...a}=n,o=await s?.handleChainStart(this.toJSON(),Ie(e,"input"),i,void 0,void 0,void 0,a?.runName),u,c;for(let l of this.runnables()){n?.signal?.throwIfAborted();let f=Ae(a,{callbacks:o?.getChild()});try{let p=await l.stream(e,f);c=Cu(f,p);break}catch(p){u===void 0&&(u=p)}}if(c===void 0){let l=u??new Error("No error stored at end of fallback.");throw await o?.handleChainError(l),l}let d;try{for await(let l of c){yield l;try{d=d===void 0?d:this._concatOutputChunks(d,l)}catch{d=void 0}}}catch(l){throw await o?.handleChainError(l),l}await o?.handleChainEnd(Ie(d,"output"))}async batch(e,t,n){if(n?.returnExceptions)throw new Error("Not implemented.");let s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(u=>rt(u))),a=await Promise.all(i.map(async(u,c)=>{let d=await u?.handleChainStart(this.toJSON(),Ie(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName);return delete s[c].runId,d})),o;for(let u of this.runnables()){s[0].signal?.throwIfAborted();try{let c=await u.batch(e,a.map((d,l)=>Ae(s[l],{callbacks:d?.getChild()})),n);return await Promise.all(a.map((d,l)=>d?.handleChainEnd(Ie(c[l],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(await Promise.all(a.map(u=>u?.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};function Pr(r){if(typeof r=="function")return new Rr({func:r});if(de.isRunnable(r))return r;if(!Array.isArray(r)&&typeof r=="object"){let e={};for(let[t,n]of Object.entries(r))e[t]=Pr(n);return new sn({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var ui=class extends de{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof sn&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let n=await this.mapper.invoke(e,t);return{...e,...n}}async*_transform(e,t,n){let s=this.mapper.getStepsKeys(),[i,a]=ud(e),o=this.mapper.transform(a,Ae(n,{callbacks:t?.getChild()})),u=o.next();for await(let c of i){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);let d=Object.fromEntries(Object.entries(c).filter(([l])=>!s.includes(l)));Object.keys(d).length>0&&(yield d)}yield(await u).value;for await(let c of o)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=ie(t),i=new Er({generator:this.transform(n(),s),config:s});return await i.setup,Be.fromAsyncGenerator(i)}},Mu=class extends de{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(n=>[n,e[n]]).filter(n=>n[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(let t of e){let n=await this._pick(t);n!==void 0&&(yield n)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*n(){yield e}let s=ie(t),i=new Er({generator:this.transform(n(),s),config:s});return await i.setup,Be.fromAsyncGenerator(i)}},Da=class extends Sr{constructor(e){let t=kr.from([Rr.from(async n=>{let s;if(Gr(n))try{s=await oi(this.schema,n.args)}catch{throw new Nn("Received tool input did not match expected schema",JSON.stringify(n.args))}else s=n;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function DO(r,e){let t=e.name??r.getName(),n=e.description??Ma(e.schema);return bd(e.schema)?new Da({name:t,description:n,schema:at.object({input:at.string()}).transform(s=>s.input),bound:r}):new Da({name:t,description:n,schema:e.schema,bound:r})}var zu="RFC3986",Lu={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},J_="RFC1738";var UO=Array.isArray,rr=(()=>{let r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})();var Ed=1024,W_=(r,e,t,n,s)=>{if(r.length===0)return r;let i=r;if(typeof r=="symbol"?i=Symbol.prototype.toString.call(r):typeof r!="string"&&(i=String(r)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=Ed){let u=i.length>=Ed?i.slice(o,o+Ed):i,c=[];for(let d=0;d<u.length;++d){let l=u.charCodeAt(d);if(l===45||l===46||l===95||l===126||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||s===J_&&(l===40||l===41)){c[c.length]=u.charAt(d);continue}if(l<128){c[c.length]=rr[l];continue}if(l<2048){c[c.length]=rr[192|l>>6]+rr[128|l&63];continue}if(l<55296||l>=57344){c[c.length]=rr[224|l>>12]+rr[128|l>>6&63]+rr[128|l&63];continue}d+=1,l=65536+((l&1023)<<10|u.charCodeAt(d)&1023),c[c.length]=rr[240|l>>18]+rr[128|l>>12&63]+rr[128|l>>6&63]+rr[128|l&63]}a+=c.join("")}return a};function Y_(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function Od(r,e){if(UO(r)){let t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}var FO=Object.prototype.hasOwnProperty,X_={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},nr=Array.isArray,BO=Array.prototype.push,Q_=function(r,e){BO.apply(r,nr(e)?e:[e])},ZO=Date.prototype.toISOString,Te={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:W_,encodeValuesOnly:!1,format:zu,formatter:Lu[zu],indices:!1,serializeDate(r){return ZO.call(r)},skipNulls:!1,strictNullHandling:!1};function qO(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}var Id={};function ey(r,e,t,n,s,i,a,o,u,c,d,l,f,p,h,m,g,y){let _=r,w=y,A=0,E=!1;for(;(w=w.get(Id))!==void 0&&!E;){let ue=w.get(r);if(A+=1,typeof ue<"u"){if(ue===A)throw new RangeError("Cyclic object value");E=!0}typeof w.get(Id)>"u"&&(A=0)}if(typeof c=="function"?_=c(e,_):_ instanceof Date?_=f?.(_):t==="comma"&&nr(_)&&(_=Od(_,function(ue){return ue instanceof Date?f?.(ue):ue})),_===null){if(i)return u&&!m?u(e,Te.encoder,g,"key",p):e;_=""}if(qO(_)||Y_(_)){if(u){let ue=m?e:u(e,Te.encoder,g,"key",p);return[h?.(ue)+"="+h?.(u(_,Te.encoder,g,"value",p))]}return[h?.(e)+"="+h?.(String(_))]}let L=[];if(typeof _>"u")return L;let G;if(t==="comma"&&nr(_))m&&u&&(_=Od(_,u)),G=[{value:_.length>0?_.join(",")||null:void 0}];else if(nr(c))G=c;else{let ue=Object.keys(_);G=d?ue.sort(d):ue}let q=o?String(e).replace(/\./g,"%2E"):String(e),ee=n&&nr(_)&&_.length===1?q+"[]":q;if(s&&nr(_)&&_.length===0)return ee+"[]";for(let ue=0;ue<G.length;++ue){let ce=G[ue],Gt=typeof ce=="object"&&typeof ce.value<"u"?ce.value:_[ce];if(a&&Gt===null)continue;let $s=l&&o?ce.replace(/\./g,"%2E"):ce,ta=nr(_)?typeof t=="function"?t(ee,$s):ee:ee+(l?"."+$s:"["+$s+"]");y.set(r,A);let js=new WeakMap;js.set(Id,y),Q_(L,ey(Gt,ta,t,n,s,i,a,o,t==="comma"&&m&&nr(_)?null:u,c,d,l,f,p,h,m,g,js))}return L}function GO(r=Te){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=r.charset||Te.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=zu;if(typeof r.format<"u"){if(!FO.call(Lu,r.format))throw new TypeError("Unknown format option provided.");t=r.format}let n=Lu[t],s=Te.filter;(typeof r.filter=="function"||nr(r.filter))&&(s=r.filter);let i;if(r.arrayFormat&&r.arrayFormat in X_?i=r.arrayFormat:"indices"in r?i=r.indices?"indices":"repeat":i=Te.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let a=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:Te.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:Te.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:Te.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:Te.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?Te.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:Te.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:Te.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:Te.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:Te.encodeValuesOnly,filter:s,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:Te.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:Te.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:Te.strictNullHandling}}function Td(r,e={}){let t=r,n=GO(e),s,i;typeof n.filter=="function"?(i=n.filter,t=i("",t)):nr(n.filter)&&(i=n.filter,s=i);let a=[];if(typeof t!="object"||t===null)return"";let o=X_[n.arrayFormat],u=o==="comma"&&n.commaRoundTrip;s||(s=Object.keys(t)),n.sort&&s.sort(n.sort);let c=new WeakMap;for(let f=0;f<s.length;++f){let p=s[f];n.skipNulls&&t[p]===null||Q_(a,ey(t[p],p,o,u,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}let d=a.join(n.delimiter),l=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?l+="utf8=%26%2310003%3B&":l+="utf8=%E2%9C%93&"),d.length>0?l+d:""}var ss="4.104.0";var ty=!1,is,Pd,VO,KO,JO,Sd,WO,Du,kd,Rd,Nd,Uu,Cd;function ry(r,e={auto:!1}){if(ty)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(is)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${is}'\``);ty=e.auto,is=r.kind,Pd=r.fetch,VO=r.Request,KO=r.Response,JO=r.Headers,Sd=r.FormData,WO=r.Blob,Du=r.File,kd=r.ReadableStream,Rd=r.getMultipartRequestOptions,Nd=r.getDefaultAgent,Uu=r.fileFromPath,Cd=r.isFsReadStream}var Fu=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function ny({manuallyImported:r}={}){let e=r?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,n,s,i;try{t=fetch,n=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Fu(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}var $d=()=>{is||ry(ny(),{auto:!0})};$d();var C=class extends Error{},Ee=class r extends C{constructor(e,t,n,s){super(`${r.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s?.["x-request-id"],this.error=t;let i=t;this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(e,t,n){let s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new Nr({message:n,cause:Bu(t)});let i=t?.error;return e===400?new ci(e,i,n,s):e===401?new li(e,i,n,s):e===403?new di(e,i,n,s):e===404?new fi(e,i,n,s):e===409?new pi(e,i,n,s):e===422?new hi(e,i,n,s):e===429?new mi(e,i,n,s):e>=500?new gi(e,i,n,s):new r(e,i,n,s)}},ge=class extends Ee{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Nr=class extends Ee{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Mt=class extends Nr{constructor({message:e}={}){super({message:e??"Request timed out."})}},ci=class extends Ee{},li=class extends Ee{},di=class extends Ee{},fi=class extends Ee{},pi=class extends Ee{},hi=class extends Ee{},mi=class extends Ee{},gi=class extends Ee{},_i=class extends C{constructor(){super("Could not parse response content as the length limit was reached")}},yi=class extends C{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var Zu=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},as=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},ct,os=class{constructor(){ct.set(this,void 0),this.buffer=new Uint8Array,Zu(this,ct,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e,n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;let s=[],i;for(;(i=QO(this.buffer,as(this,ct,"f")))!=null;){if(i.carriage&&as(this,ct,"f")==null){Zu(this,ct,i.index,"f");continue}if(as(this,ct,"f")!=null&&(i.index!==as(this,ct,"f")+1||i.carriage)){s.push(this.decodeText(this.buffer.slice(0,as(this,ct,"f")-1))),this.buffer=this.buffer.slice(as(this,ct,"f")),Zu(this,ct,null,"f");continue}let a=as(this,ct,"f")!==null?i.preceding-1:i.preceding,o=this.decodeText(this.buffer.slice(0,a));s.push(o),this.buffer=this.buffer.slice(i.index),Zu(this,ct,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new C(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new C(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new C("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};ct=new WeakMap;os.NEWLINE_CHARS=new Set([`
`,"\r"]);os.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function QO(r,e){for(let s=e??0;s<r.length;s++){if(r[s]===10)return{preceding:s,index:s+1,carriage:!1};if(r[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function sy(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}function jd(r){if(r[Symbol.asyncIterator])return r;let e=r.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var sr=class r{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(let a of eI(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null||a.event.startsWith("response.")||a.event.startsWith("transcript.")){let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(o&&o.error)throw new Ee(void 0,o.error,void 0,zd(e.headers));yield o}else{let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(a.event=="error")throw new Ee(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new r(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){let a=new os,o=jd(e);for await(let u of o)for(let c of a.decode(u))yield c;for(let u of a.flush())yield u}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new r(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),s=i=>({next:()=>{if(i.length===0){let a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new r(()=>s(e),this.controller),new r(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,n=new TextEncoder;return new kd({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:i,done:a}=await t.next();if(a)return s.close();let o=n.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){await t.return?.()}})}};async function*eI(r,e){if(!r.body)throw e.abort(),new C("Attempted to iterate over a response with no body");let t=new Md,n=new os,s=jd(r.body);for await(let i of tI(s))for(let a of n.decode(i)){let o=t.decode(a);o&&(yield o)}for(let i of n.flush()){let a=t.decode(i);a&&(yield a)}}async function*tI(r){let e=new Uint8Array;for await(let t of r){if(t==null)continue;let n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let i;for(;(i=sy(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}var Md=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=rI(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function rI(r,e){let t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}var iy=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",ay=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&Ua(r),Ua=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",nI=r=>ay(r)||iy(r)||Cd(r);async function Ud(r,e,t){if(r=await r,ay(r))return r;if(iy(r)){let s=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");let i=Ua(s)?[await s.arrayBuffer()]:[s];return new Du(i,e,t)}let n=await sI(r);if(e||(e=aI(r)??"unknown_file"),!t?.type){let s=n[0]?.type;typeof s=="string"&&(t={...t,type:s})}return new Du(n,e,t)}async function sI(r){let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(Ua(r))e.push(await r.arrayBuffer());else if(oI(r))for await(let t of r)e.push(t);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${r?.constructor?.name}; props: ${iI(r)}`);return e}function iI(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function aI(r){return Ld(r.name)||Ld(r.filename)||Ld(r.path)?.split(/[\\/]/).pop()}var Ld=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},oI=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Fd=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody";var nt=async r=>{let e=await oy(r.body);return Rd(e,r)},oy=async r=>{let e=new Sd;return await Promise.all(Object.entries(r||{}).map(([t,n])=>Dd(e,t,n))),e};var Dd=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(nI(t)){let n=await Ud(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>Dd(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>Dd(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var cI=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},lI=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},qu;$d();async function py(r){let{response:e}=r;if(r.options.stream)return Cr("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):sr.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;let n=e.headers.get("content-type")?.split(";")[0]?.trim();if(n?.includes("application/json")||n?.endsWith("+json")){let a=await e.json();return Cr("response",e.status,e.url,e.headers,a),hy(a,e)}let i=await e.text();return Cr("response",e.status,e.url,e.headers,i),i}function hy(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Hu=class r extends Promise{constructor(e,t=py){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new r(this.responsePromise,async t=>hy(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Vu=class{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Bd("maxRetries",t),this.timeout=Bd("timeout",n),this.httpAgent=s,this.fetch=i??Pd}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...hI(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${yI()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{let i=s&&Ua(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){let n={...e},{method:s,path:i,query:a,headers:o={}}=n,u=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:Fd(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,c=this.calculateContentLength(u),d=this.buildURL(i,a);"timeout"in n&&Bd("timeout",n.timeout),n.timeout=n.timeout??this.timeout;let l=n.httpAgent??this.httpAgent??Nd(d),f=n.timeout+1e3;typeof l?.options?.timeout=="number"&&f>(l.options.timeout??0)&&(l.options.timeout=f),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let p=this.buildHeaders({options:n,headers:o,contentLength:c,retryCount:t});return{req:{method:s,...u&&{body:u},headers:p,...l&&{agent:l},signal:n.signal??null},url:d,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){let i={};n&&(i["content-length"]=n);let a=this.defaultHeaders(e);return dy(i,a),dy(i,t),Fd(e.body)&&is!=="node"&&delete i["content-type"],Gu(a,"x-stainless-retry-count")===void 0&&Gu(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),Gu(a,"x-stainless-timeout")===void 0&&Gu(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return Ee.generate(e,t,n,s)}request(e,t=null){return new Hu(this.makeRequest(e,t))}async makeRequest(e,t){let n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);let{req:i,url:a,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:n}),Cr("request",a,n,i.headers),n.signal?.aborted)throw new ge;let u=new AbortController,c=await this.fetchWithTimeout(a,i,o,u).catch(Bu);if(c instanceof Error){if(n.signal?.aborted)throw new ge;if(t)return this.retryRequest(n,t);throw c.name==="AbortError"?new Mt:new Nr({cause:c})}let d=zd(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){let g=`retrying, ${t} attempts remaining`;return Cr(`response (error; ${g})`,c.status,a,d),this.retryRequest(n,t,d)}let l=await c.text().catch(g=>Bu(g).message),f=mI(l),p=f?void 0:l;throw Cr(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,d,p),this.makeStatusError(c.status,f,p,d)}return{response:c,options:n,controller:u}}requestAPIList(e,t){let n=this.makeRequest(t,null);return new Zd(this,n,e)}buildURL(e,t){let n=_I(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return my(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new C(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){let{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),n),u={signal:s.signal,...a};return u.method&&(u.method=u.method.toUpperCase()),this.fetch.call(void 0,e,u).finally(()=>{clearTimeout(o)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s,i=n?.["retry-after-ms"];if(i){let o=parseFloat(i);Number.isNaN(o)||(s=o)}let a=n?.["retry-after"];if(a&&!s){let o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){let o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await $r(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${ss}`}},Fa=class{constructor(e,t,n,s){qu.set(this,void 0),cI(this,qu,e,"f"),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new C("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,i]of n)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await lI(this,qu,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(qu=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Zd=class extends Hu{constructor(e,t,n){super(t,async s=>new n(e,s.response,await py(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},zd=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){let n=t.toString();return e[n.toLowerCase()]||e[n]}}),dI={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Y=r=>typeof r=="object"&&r!==null&&!my(r)&&Object.keys(r).every(e=>gy(dI,e)),fI=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ss,"X-Stainless-OS":cy(Deno.build.os),"X-Stainless-Arch":uy(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ss,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ss,"X-Stainless-OS":cy(process.platform),"X-Stainless-Arch":uy(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let r=pI();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ss,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ss,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function pI(){if(typeof navigator>"u"||!navigator)return null;let r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of r){let n=t.exec(navigator.userAgent);if(n){let s=n[1]||0,i=n[2]||0,a=n[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}var uy=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",cy=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown"),ly,hI=()=>ly??(ly=fI()),mI=r=>{try{return JSON.parse(r)}catch{return}},gI=/^[a-z][a-z0-9+.-]*:/i,_I=r=>gI.test(r),$r=r=>new Promise(e=>setTimeout(e,r)),Bd=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new C(`${r} must be an integer`);if(e<0)throw new C(`${r} must be a positive integer`);return e},Bu=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)};var Ba=r=>{if(typeof process<"u")return process.env?.[r]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(r)?.trim()};function my(r){if(!r)return!0;for(let e in r)return!1;return!0}function gy(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function dy(r,e){for(let t in e){if(!gy(e,t))continue;let n=t.toLowerCase();if(!n)continue;let s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}var fy=new Set(["authorization","api-key"]);function Cr(r,...e){if(typeof process<"u"&&process?.env?.DEBUG==="true"){let t=e.map(n=>{if(!n)return n;if(n.headers){let i={...n,headers:{...n.headers}};for(let a in n.headers)fy.has(a.toLowerCase())&&(i.headers[a]="REDACTED");return i}let s=null;for(let i in n)fy.has(i.toLowerCase())&&(s??(s={...n}),s[i]="REDACTED");return s??n});console.log(`OpenAI:DEBUG:${r}`,...t)}}var yI=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{let e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),_y=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",bI=r=>typeof r?.get=="function";var Gu=(r,e)=>{let t=e.toLowerCase();if(bI(r)){let n=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(s,i,a)=>i+a.toUpperCase());for(let s of[e,t,e.toUpperCase(),n]){let i=r.get(s);if(i)return i}}for(let[n,s]of Object.entries(r))if(n.toLowerCase()===t)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${e} header, using the first entry.`),s[0]):s};var yy=r=>{if(typeof Buffer<"u"){let e=Buffer.from(r,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(r),t=e.length,n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);return Array.from(new Float32Array(n.buffer))}};function Za(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}var ir=class extends Fa{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}},ne=class extends Fa{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let t=e[e.length-1]?.id;return t?{params:{after:t}}:null}};var x=class{constructor(e){this._client=e}};var bi=class extends x{list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,Ku,{query:t,...n})}};var an=class extends x{constructor(){super(...arguments),this.messages=new bi(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/chat/completions",on,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}},on=class extends ne{},Ku=class extends ne{};an.ChatCompletionsPage=on;an.Messages=bi;var Mr=class extends x{constructor(){super(...arguments),this.completions=new an(this._client)}};Mr.Completions=an;Mr.ChatCompletionsPage=on;var wi=class extends x{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}};var xi=class extends x{create(e,t){return this._client.post("/audio/transcriptions",nt({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}};var vi=class extends x{create(e,t){return this._client.post("/audio/translations",nt({body:e,...t,__metadata:{model:e.model}}))}};var ar=class extends x{constructor(){super(...arguments),this.transcriptions=new xi(this._client),this.translations=new vi(this._client),this.speech=new wi(this._client)}};ar.Transcriptions=xi;ar.Translations=vi;ar.Speech=wi;var un=class extends x{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/batches",us,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}},us=class extends ne{};un.BatchesPage=us;var zt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},_e=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},qd,Ju,Wu,qa,Ga,Yu,Ha,zr,Va,Xu,Qu,Ai,by,cn=class{constructor(){qd.add(this),this.controller=new AbortController,Ju.set(this,void 0),Wu.set(this,()=>{}),qa.set(this,()=>{}),Ga.set(this,void 0),Yu.set(this,()=>{}),Ha.set(this,()=>{}),zr.set(this,{}),Va.set(this,!1),Xu.set(this,!1),Qu.set(this,!1),Ai.set(this,!1),zt(this,Ju,new Promise((e,t)=>{zt(this,Wu,e,"f"),zt(this,qa,t,"f")}),"f"),zt(this,Ga,new Promise((e,t)=>{zt(this,Yu,e,"f"),zt(this,Ha,t,"f")}),"f"),_e(this,Ju,"f").catch(()=>{}),_e(this,Ga,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},_e(this,qd,"m",by).bind(this))},0)}_connected(){this.ended||(_e(this,Wu,"f").call(this),this._emit("connect"))}get ended(){return _e(this,Va,"f")}get errored(){return _e(this,Xu,"f")}get aborted(){return _e(this,Qu,"f")}abort(){this.controller.abort()}on(e,t){return(_e(this,zr,"f")[e]||(_e(this,zr,"f")[e]=[])).push({listener:t}),this}off(e,t){let n=_e(this,zr,"f")[e];if(!n)return this;let s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(_e(this,zr,"f")[e]||(_e(this,zr,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{zt(this,Ai,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){zt(this,Ai,!0,"f"),await _e(this,Ga,"f")}_emit(e,...t){if(_e(this,Va,"f"))return;e==="end"&&(zt(this,Va,!0,"f"),_e(this,Yu,"f").call(this));let n=_e(this,zr,"f")[e];if(n&&(_e(this,zr,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!_e(this,Ai,"f")&&!n?.length&&Promise.reject(s),_e(this,qa,"f").call(this,s),_e(this,Ha,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!_e(this,Ai,"f")&&!n?.length&&Promise.reject(s),_e(this,qa,"f").call(this,s),_e(this,Ha,"f").call(this,s),this._emit("end")}}_emitFinal(){}};Ju=new WeakMap,Wu=new WeakMap,qa=new WeakMap,Ga=new WeakMap,Yu=new WeakMap,Ha=new WeakMap,zr=new WeakMap,Va=new WeakMap,Xu=new WeakMap,Qu=new WeakMap,Ai=new WeakMap,qd=new WeakSet,by=function(e){if(zt(this,Xu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ge),e instanceof ge)return zt(this,Qu,!0,"f"),this._emit("abort",e);if(e instanceof C)return this._emit("error",e);if(e instanceof Error){let t=new C(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new C(String(e)))};var z=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},lt=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},je,Gd,or,ec,Lt,ls,Ei,cs,nc,dt,tc,rc,Wa,Ka,Ja,wy,xy,vy,Ay,Ey,Oy,Iy,ur=class r extends cn{constructor(){super(...arguments),je.add(this),Gd.set(this,[]),or.set(this,{}),ec.set(this,{}),Lt.set(this,void 0),ls.set(this,void 0),Ei.set(this,void 0),cs.set(this,void 0),nc.set(this,void 0),dt.set(this,void 0),tc.set(this,void 0),rc.set(this,void 0),Wa.set(this,void 0)}[(Gd=new WeakMap,or=new WeakMap,ec=new WeakMap,Lt=new WeakMap,ls=new WeakMap,Ei=new WeakMap,cs=new WeakMap,nc=new WeakMap,dt=new WeakMap,tc=new WeakMap,rc=new WeakMap,Wa=new WeakMap,je=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new r;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=sr.fromReadableStream(e,this.controller);for await(let i of s)z(this,je,"m",Ka).call(this,i);if(s.controller.signal?.aborted)throw new ge;return this._addRun(z(this,je,"m",Ja).call(this))}toReadableStream(){return new sr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,i){let a=new r;return a._run(()=>a._runToolAssistantStream(e,t,n,s,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,s,i){let a=i?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let o={...s,stream:!0},u=await e.submitToolOutputs(t,n,o,{...i,signal:this.controller.signal});this._connected();for await(let c of u)z(this,je,"m",Ka).call(this,c);if(u.controller.signal?.aborted)throw new ge;return this._addRun(z(this,je,"m",Ja).call(this))}static createThreadAssistantStream(e,t,n){let s=new r;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){let i=new r;return i._run(()=>i._runAssistantStream(e,t,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return z(this,tc,"f")}currentRun(){return z(this,rc,"f")}currentMessageSnapshot(){return z(this,Lt,"f")}currentRunStepSnapshot(){return z(this,Wa,"f")}async finalRunSteps(){return await this.done(),Object.values(z(this,or,"f"))}async finalMessages(){return await this.done(),Object.values(z(this,ec,"f"))}async finalRun(){if(await this.done(),!z(this,ls,"f"))throw Error("Final run was not received.");return z(this,ls,"f")}async _createThreadAssistantStream(e,t,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},a=await e.createAndRun(i,{...n,signal:this.controller.signal});this._connected();for await(let o of a)z(this,je,"m",Ka).call(this,o);if(a.controller.signal?.aborted)throw new ge;return this._addRun(z(this,je,"m",Ja).call(this))}async _createAssistantStream(e,t,n,s){let i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...n,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(let u of o)z(this,je,"m",Ka).call(this,u);if(o.controller.signal?.aborted)throw new ge;return this._addRun(z(this,je,"m",Ja).call(this))}static accumulateDelta(e,t){for(let[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let i=e[n];if(i==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Za(i)&&Za(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(let a of s){if(!Za(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let u=i[o];u==null?i.push(a):i[o]=this.accumulateDelta(u,a)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${i}`);e[n]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,i){return await this._createToolAssistantStream(n,e,t,s,i)}};Ka=function(e){if(!this.ended)switch(lt(this,tc,e,"f"),z(this,je,"m",vy).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":z(this,je,"m",Iy).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":z(this,je,"m",xy).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":z(this,je,"m",wy).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},Ja=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");if(!z(this,ls,"f"))throw Error("Final run has not been received");return z(this,ls,"f")},wy=function(e){let[t,n]=z(this,je,"m",Ey).call(this,e,z(this,Lt,"f"));lt(this,Lt,t,"f"),z(this,ec,"f")[t.id]=t;for(let s of n){let i=t.content[s.index];i?.type=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=z(this,Ei,"f")){if(z(this,cs,"f"))switch(z(this,cs,"f").type){case"text":this._emit("textDone",z(this,cs,"f").text,z(this,Lt,"f"));break;case"image_file":this._emit("imageFileDone",z(this,cs,"f").image_file,z(this,Lt,"f"));break}lt(this,Ei,s.index,"f")}lt(this,cs,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(z(this,Ei,"f")!==void 0){let s=e.data.content[z(this,Ei,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,z(this,Lt,"f"));break;case"text":this._emit("textDone",s.text,z(this,Lt,"f"));break}}z(this,Lt,"f")&&this._emit("messageDone",e.data),lt(this,Lt,void 0,"f")}},xy=function(e){let t=z(this,je,"m",Ay).call(this,e);switch(lt(this,Wa,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let i of n.step_details.tool_calls)i.index==z(this,nc,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(z(this,dt,"f")&&this._emit("toolCallDone",z(this,dt,"f")),lt(this,nc,i.index,"f"),lt(this,dt,t.step_details.tool_calls[i.index],"f"),z(this,dt,"f")&&this._emit("toolCallCreated",z(this,dt,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":lt(this,Wa,void 0,"f"),e.data.step_details.type=="tool_calls"&&z(this,dt,"f")&&(this._emit("toolCallDone",z(this,dt,"f")),lt(this,dt,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},vy=function(e){z(this,Gd,"f").push(e),this._emit("event",e)},Ay=function(e){switch(e.event){case"thread.run.step.created":return z(this,or,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=z(this,or,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let s=ur.accumulateDelta(t,n.delta);z(this,or,"f")[e.data.id]=s}return z(this,or,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":z(this,or,"f")[e.data.id]=e.data;break}if(z(this,or,"f")[e.data.id])return z(this,or,"f")[e.data.id];throw new Error("No snapshot available")},Ey=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=z(this,je,"m",Oy).call(this,i,a)}else t.content[i.index]=i,n.push(i);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Oy=function(e,t){return ur.accumulateDelta(t,e)},Iy=function(e){switch(lt(this,rc,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":lt(this,ls,e.data,"f"),z(this,dt,"f")&&(this._emit("toolCallDone",z(this,dt,"f")),lt(this,dt,void 0,"f"));break;case"thread.run.cancelling":break}};var ds=class extends x{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/assistants",Oi,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}},Oi=class extends ne{};ds.AssistantsPage=Oi;function Hd(r){return typeof r.parse=="function"}var ln=r=>r?.role==="assistant",Vd=r=>r?.role==="function",Kd=r=>r?.role==="tool";function Ty(r,e){let t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Ya(r){return r?.$brand==="auto-parseable-response-format"}function Py(r,{parser:e,callback:t}){let n={...r};return Object.defineProperties(n,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),n}function fs(r){return r?.$brand==="auto-parseable-tool"}function Sy(r,e){return!e||!Jd(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Xa(r,e)}function Xa(r,e){let t=r.choices.map(n=>{if(n.finish_reason==="length")throw new _i;if(n.finish_reason==="content_filter")throw new yi;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:n.message.tool_calls?.map(s=>TI(e,s))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?II(e,n.message.content):null}}});return{...r,choices:t}}function II(r,e){return r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function TI(r,e){let t=r.tools?.find(n=>n.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:fs(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function ky(r,e){if(!r)return!1;let t=r.tools?.find(n=>n.function?.name===e.function.name);return fs(t)||t?.function.strict||!1}function Jd(r){return Ya(r.response_format)?!0:r.tools?.some(e=>fs(e)||e.type==="function"&&e.function.strict===!0)??!1}function Ry(r){for(let e of r??[]){if(e.type!=="function")throw new C(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new C(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var st=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ze,Wd,sc,Yd,Xd,Qd,Cy,ef,Ny=10,Ii=class extends cn{constructor(){super(...arguments),Ze.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Vd(e)||Kd(e))&&e.content)this._emit("functionCallResult",e.content);else if(ln(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ln(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new C("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),st(this,Ze,"m",Wd).call(this)}async finalMessage(){return await this.done(),st(this,Ze,"m",sc).call(this)}async finalFunctionCall(){return await this.done(),st(this,Ze,"m",Yd).call(this)}async finalFunctionCallResult(){return await this.done(),st(this,Ze,"m",Xd).call(this)}async totalUsage(){return await this.done(),st(this,Ze,"m",Qd).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=st(this,Ze,"m",sc).call(this);t&&this._emit("finalMessage",t);let n=st(this,Ze,"m",Wd).call(this);n&&this._emit("finalContent",n);let s=st(this,Ze,"m",Yd).call(this);s&&this._emit("finalFunctionCall",s);let i=st(this,Ze,"m",Xd).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",st(this,Ze,"m",Qd).call(this))}async _createChatCompletion(e,t,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),st(this,Ze,"m",Cy).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Xa(i,t))}async _runChatCompletion(e,t,n){for(let s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){let s="function",{function_call:i="auto",stream:a,...o}=t,u=typeof i!="string"&&i?.name,{maxChatCompletions:c=Ny}=n||{},d={};for(let f of t.functions)d[f.name||f.function.name]=f;let l=t.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(let f of t.messages)this._addMessage(f,!1);for(let f=0;f<c;++f){let h=(await this._createChatCompletion(e,{...o,function_call:i,functions:l,messages:[...this.messages]},n)).choices[0]?.message;if(!h)throw new C("missing message in ChatCompletion response");if(!h.function_call)return;let{name:m,arguments:g}=h.function_call,y=d[m];if(y){if(u&&u!==m){let E=`Invalid function_call: ${JSON.stringify(m)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,name:m,content:E});continue}}else{let E=`Invalid function_call: ${JSON.stringify(m)}. Available options are: ${l.map(L=>JSON.stringify(L.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:m,content:E});continue}let _;try{_=Hd(y)?await y.parse(g):g}catch(E){this._addMessage({role:s,name:m,content:E instanceof Error?E.message:String(E)});continue}let w=await y.function(_,this),A=st(this,Ze,"m",ef).call(this,w);if(this._addMessage({role:s,name:m,content:A}),u)return}}async _runTools(e,t,n){let s="tool",{tool_choice:i="auto",stream:a,...o}=t,u=typeof i!="string"&&i?.function?.name,{maxChatCompletions:c=Ny}=n||{},d=t.tools.map(p=>{if(fs(p)){if(!p.$callback)throw new C("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:p.$callback,name:p.function.name,description:p.function.description||"",parameters:p.function.parameters,parse:p.$parseRaw,strict:!0}}}return p}),l={};for(let p of d)p.type==="function"&&(l[p.function.name||p.function.function.name]=p.function);let f="tools"in t?d.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description,strict:p.function.strict}}:p):void 0;for(let p of t.messages)this._addMessage(p,!1);for(let p=0;p<c;++p){let m=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:f,messages:[...this.messages]},n)).choices[0]?.message;if(!m)throw new C("missing message in ChatCompletion response");if(!m.tool_calls?.length)return;for(let g of m.tool_calls){if(g.type!=="function")continue;let y=g.id,{name:_,arguments:w}=g.function,A=l[_];if(A){if(u&&u!==_){let q=`Invalid tool_call: ${JSON.stringify(_)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:y,content:q});continue}}else{let q=`Invalid tool_call: ${JSON.stringify(_)}. Available options are: ${Object.keys(l).map(ee=>JSON.stringify(ee)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:y,content:q});continue}let E;try{E=Hd(A)?await A.parse(w):w}catch(q){let ee=q instanceof Error?q.message:String(q);this._addMessage({role:s,tool_call_id:y,content:ee});continue}let L=await A.function(E,this),G=st(this,Ze,"m",ef).call(this,L);if(this._addMessage({role:s,tool_call_id:y,content:G}),u)return}}}};Ze=new WeakSet,Wd=function(){return st(this,Ze,"m",sc).call(this).content??null},sc=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(ln(t)){let{function_call:n,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return n&&(i.function_call=n),i}}throw new C("stream ended without producing a ChatCompletionMessage with role=assistant")},Yd=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(ln(t)&&t?.function_call)return t.function_call;if(ln(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},Xd=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Vd(t)&&t.content!=null||Kd(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(s=>s.type==="function"&&s.id===t.tool_call_id)))return t.content}},Qd=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Cy=function(e){if(e.n!=null&&e.n>1)throw new C("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ef=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var Qa=class r extends Ii{static runFunctions(e,t,n){let s=new r,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){let s=new r,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),ln(e)&&e.content&&this._emit("content",e.content)}};var Se={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},tf=class extends Error{},rf=class extends Error{};function PI(r,e=Se.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return SI(r.trim(),e)}var SI=(r,e)=>{let t=r.length,n=0,s=f=>{throw new tf(`${f} at position ${n}`)},i=f=>{throw new rf(`${f} at position ${n}`)},a=()=>(l(),n>=t&&s("Unexpected end of input"),r[n]==='"'?o():r[n]==="{"?u():r[n]==="["?c():r.substring(n,n+4)==="null"||Se.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||Se.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||Se.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||Se.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||Se.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||Se.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):d()),o=()=>{let f=n,p=!1;for(n++;n<t&&(r[n]!=='"'||p&&r[n-1]==="\\");)p=r[n]==="\\"?!p:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(f,++n-Number(p)))}catch(h){i(String(h))}else if(Se.STR&e)try{return JSON.parse(r.substring(f,n-Number(p))+'"')}catch{return JSON.parse(r.substring(f,r.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},u=()=>{n++,l();let f={};try{for(;r[n]!=="}";){if(l(),n>=t&&Se.OBJ&e)return f;let p=o();l(),n++;try{let h=a();Object.defineProperty(f,p,{value:h,writable:!0,enumerable:!0,configurable:!0})}catch(h){if(Se.OBJ&e)return f;throw h}l(),r[n]===","&&n++}}catch{if(Se.OBJ&e)return f;s("Expected '}' at end of object")}return n++,f},c=()=>{n++;let f=[];try{for(;r[n]!=="]";)f.push(a()),l(),r[n]===","&&n++}catch{if(Se.ARR&e)return f;s("Expected ']' at end of array")}return n++,f},d=()=>{if(n===0){r==="-"&&Se.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r)}catch(p){if(Se.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}i(String(p))}}let f=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(Se.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(r.substring(f,n))}catch{r.substring(f,n)==="-"&&Se.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r.substring(f,r.lastIndexOf("e")))}catch(h){i(String(h))}}},l=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return a()},nf=r=>PI(r,Se.ALL^Se.NUM);var Ti=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},le=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Pe,Lr,Pi,dn,sf,ic,af,of,uf,ac,cf,$y,Si=class r extends Ii{constructor(e){super(),Pe.add(this),Lr.set(this,void 0),Pi.set(this,void 0),dn.set(this,void 0),Ti(this,Lr,e,"f"),Ti(this,Pi,[],"f")}get currentChatCompletionSnapshot(){return le(this,dn,"f")}static fromReadableStream(e){let t=new r(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){let s=new r(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){super._createChatCompletion;let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),le(this,Pe,"m",sf).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let a of i)le(this,Pe,"m",af).call(this,a);if(i.controller.signal?.aborted)throw new ge;return this._addChatCompletion(le(this,Pe,"m",ac).call(this))}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),le(this,Pe,"m",sf).call(this),this._connected();let s=sr.fromReadableStream(e,this.controller),i;for await(let a of s)i&&i!==a.id&&this._addChatCompletion(le(this,Pe,"m",ac).call(this)),le(this,Pe,"m",af).call(this,a),i=a.id;if(s.controller.signal?.aborted)throw new ge;return this._addChatCompletion(le(this,Pe,"m",ac).call(this))}[(Lr=new WeakMap,Pi=new WeakMap,dn=new WeakMap,Pe=new WeakSet,sf=function(){this.ended||Ti(this,dn,void 0,"f")},ic=function(t){let n=le(this,Pi,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},le(this,Pi,"f")[t.index]=n,n)},af=function(t){if(this.ended)return;let n=le(this,Pe,"m",$y).call(this,t);this._emit("chunk",t,n);for(let s of t.choices){let i=n.choices[s.index];s.delta.content!=null&&i.message?.role==="assistant"&&i.message?.content&&(this._emit("content",s.delta.content,i.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:i.message.content,parsed:i.message.parsed})),s.delta.refusal!=null&&i.message?.role==="assistant"&&i.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:i.message.refusal}),s.logprobs?.content!=null&&i.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:i.logprobs?.content??[]}),s.logprobs?.refusal!=null&&i.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:i.logprobs?.refusal??[]});let a=le(this,Pe,"m",ic).call(this,i);i.finish_reason&&(le(this,Pe,"m",uf).call(this,i),a.current_tool_call_index!=null&&le(this,Pe,"m",of).call(this,i,a.current_tool_call_index));for(let o of s.delta.tool_calls??[])a.current_tool_call_index!==o.index&&(le(this,Pe,"m",uf).call(this,i),a.current_tool_call_index!=null&&le(this,Pe,"m",of).call(this,i,a.current_tool_call_index)),a.current_tool_call_index=o.index;for(let o of s.delta.tool_calls??[]){let u=i.message.tool_calls?.[o.index];u?.type&&(u?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:u.function?.name,index:o.index,arguments:u.function.arguments,parsed_arguments:u.function.parsed_arguments,arguments_delta:o.function?.arguments??""}):(u?.type,void 0))}}},of=function(t,n){if(le(this,Pe,"m",ic).call(this,t).done_tool_calls.has(n))return;let i=t.message.tool_calls?.[n];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){let a=le(this,Lr,"f")?.tools?.find(o=>o.type==="function"&&o.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:n,arguments:i.function.arguments,parsed_arguments:fs(a)?a.$parseRaw(i.function.arguments):a?.function.strict?JSON.parse(i.function.arguments):null})}else i.type},uf=function(t){let n=le(this,Pe,"m",ic).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;let s=le(this,Pe,"m",cf).call(this);this._emit("content.done",{content:t.message.content,parsed:s?s.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},ac=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");let t=le(this,dn,"f");if(!t)throw new C("request ended without sending any chunks");return Ti(this,dn,void 0,"f"),Ti(this,Pi,[],"f"),kI(t,le(this,Lr,"f"))},cf=function(){let t=le(this,Lr,"f")?.response_format;return Ya(t)?t:null},$y=function(t){var n,s,i,a;let o=le(this,dn,"f"),{choices:u,...c}=t;o?Object.assign(o,c):o=Ti(this,dn,{...c,choices:[]},"f");for(let{delta:d,finish_reason:l,index:f,logprobs:p=null,...h}of t.choices){let m=o.choices[f];if(m||(m=o.choices[f]={finish_reason:l,index:f,message:{},logprobs:p,...h}),p)if(!m.logprobs)m.logprobs=Object.assign({},p);else{let{content:L,refusal:G,...q}=p;Object.assign(m.logprobs,q),L&&((n=m.logprobs).content??(n.content=[]),m.logprobs.content.push(...L)),G&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...G))}if(l&&(m.finish_reason=l,le(this,Lr,"f")&&Jd(le(this,Lr,"f")))){if(l==="length")throw new _i;if(l==="content_filter")throw new yi}if(Object.assign(m,h),!d)continue;let{content:g,refusal:y,function_call:_,role:w,tool_calls:A,...E}=d;if(Object.assign(m.message,E),y&&(m.message.refusal=(m.message.refusal||"")+y),w&&(m.message.role=w),_&&(m.message.function_call?(_.name&&(m.message.function_call.name=_.name),_.arguments&&((i=m.message.function_call).arguments??(i.arguments=""),m.message.function_call.arguments+=_.arguments)):m.message.function_call=_),g&&(m.message.content=(m.message.content||"")+g,!m.message.refusal&&le(this,Pe,"m",cf).call(this)&&(m.message.parsed=nf(m.message.content))),A){m.message.tool_calls||(m.message.tool_calls=[]);for(let{index:L,id:G,type:q,function:ee,...ue}of A){let ce=(a=m.message.tool_calls)[L]??(a[L]={});Object.assign(ce,ue),G&&(ce.id=G),q&&(ce.type=q),ee&&(ce.function??(ce.function={name:ee.name??"",arguments:""})),ee?.name&&(ce.function.name=ee.name),ee?.arguments&&(ce.function.arguments+=ee.arguments,ky(le(this,Lr,"f"),ce)&&(ce.function.parsed_arguments=nf(ce.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("chunk",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new sr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function kI(r,e){let{id:t,choices:n,created:s,model:i,system_fingerprint:a,...o}=r,u={...o,id:t,choices:n.map(({message:c,finish_reason:d,index:l,logprobs:f,...p})=>{if(!d)throw new C(`missing finish_reason for choice ${l}`);let{content:h=null,function_call:m,tool_calls:g,...y}=c,_=c.role;if(!_)throw new C(`missing role for choice ${l}`);if(m){let{arguments:w,name:A}=m;if(w==null)throw new C(`missing function_call.arguments for choice ${l}`);if(!A)throw new C(`missing function_call.name for choice ${l}`);return{...p,message:{content:h,function_call:{arguments:w,name:A},role:_,refusal:c.refusal??null},finish_reason:d,index:l,logprobs:f}}return g?{...p,index:l,finish_reason:d,logprobs:f,message:{...y,role:_,content:h,refusal:c.refusal??null,tool_calls:g.map((w,A)=>{let{function:E,type:L,id:G,...q}=w,{arguments:ee,name:ue,...ce}=E||{};if(G==null)throw new C(`missing choices[${l}].tool_calls[${A}].id
${oc(r)}`);if(L==null)throw new C(`missing choices[${l}].tool_calls[${A}].type
${oc(r)}`);if(ue==null)throw new C(`missing choices[${l}].tool_calls[${A}].function.name
${oc(r)}`);if(ee==null)throw new C(`missing choices[${l}].tool_calls[${A}].function.arguments
${oc(r)}`);return{...q,id:G,type:L,function:{...ce,name:ue,arguments:ee}}})}}:{...p,message:{...y,content:h,role:_,refusal:c.refusal??null},finish_reason:d,index:l,logprobs:f}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return Sy(u,e)}function oc(r){return JSON.stringify(r)}var eo=class r extends Si{static fromReadableStream(e){let t=new r(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){let s=new r(null),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){let s=new r(t),i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}};var to=class extends x{parse(e,t){return Ry(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>Xa(n,e))}runFunctions(e,t){return e.stream?eo.runFunctions(this._client,e,t):Qa.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?eo.runTools(this._client,e,t):Qa.runTools(this._client,e,t)}stream(e,t){return Si.createChatCompletion(this._client,e,t)}};var ki=class extends x{constructor(){super(...arguments),this.completions=new to(this._client)}};(function(r){r.Completions=to})(ki||(ki={}));var Ri=class extends x{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}};var Ni=class extends x{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}};var fn=class extends x{constructor(){super(...arguments),this.sessions=new Ri(this._client),this.transcriptionSessions=new Ni(this._client)}};fn.Sessions=Ri;fn.TranscriptionSessions=Ni;var ps=class extends x{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Ci,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}},Ci=class extends ne{};ps.MessagesPage=Ci;var hs=class extends x{retrieve(e,t,n,s={},i){return Y(s)?this.retrieve(e,t,n,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}list(e,t,n={},s){return Y(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,$i,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}},$i=class extends ne{};hs.RunStepsPage=$i;var Dr=class extends x{constructor(){super(...arguments),this.steps=new hs(this._client)}create(e,t,n){let{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,ji,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){let s=await this.create(e,t,n);return await this.poll(e,s.id,n)}createAndStream(e,t,n){return ur.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){let s={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let{data:i,response:a}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let u=a.headers.get("openai-poll-after-ms");if(u){let c=parseInt(u);isNaN(c)||(o=c)}}await $r(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return ur.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,s){let i=await this.submitToolOutputs(e,t,n,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,n,s){return ur.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}},ji=class extends ne{};Dr.RunsPage=ji;Dr.Steps=hs;Dr.RunStepsPage=$i;var cr=class extends x{constructor(){super(...arguments),this.runs=new Dr(this._client),this.messages=new ps(this._client)}create(e={},t){return Y(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){let n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return ur.createThreadAssistantStream(e,this._client.beta.threads,t)}};cr.Runs=Dr;cr.RunsPage=ji;cr.Messages=ps;cr.MessagesPage=Ci;var Dt=class extends x{constructor(){super(...arguments),this.realtime=new fn(this._client),this.chat=new ki(this._client),this.assistants=new ds(this._client),this.threads=new cr(this._client)}};Dt.Realtime=fn;Dt.Assistants=ds;Dt.AssistantsPage=Oi;Dt.Threads=cr;var ms=class extends x{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};var Mi=class extends x{retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}/content`,{...n,headers:{Accept:"application/binary",...n?.headers},__binaryResponse:!0})}};var pn=class extends x{constructor(){super(...arguments),this.content=new Mi(this._client)}create(e,t,n){return this._client.post(`/containers/${e}/files`,nt({body:t,...n}))}retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}`,n)}list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,zi,{query:t,...n})}del(e,t,n){return this._client.delete(`/containers/${e}/files/${t}`,{...n,headers:{Accept:"*/*",...n?.headers}})}},zi=class extends ne{};pn.FileListResponsesPage=zi;pn.Content=Mi;var lr=class extends x{constructor(){super(...arguments),this.files=new pn(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/containers",gs,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}},gs=class extends ne{};lr.ContainerListResponsesPage=gs;lr.Files=pn;lr.FileListResponsesPage=zi;var _s=class extends x{create(e,t){let n=!!e.encoding_format,s=n?e.encoding_format:"base64";n&&Cr("Request","User defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return n?i:(Cr("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{let u=o.embedding;o.embedding=yy(u)}),a)))}};var ys=class extends x{retrieve(e,t,n,s){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,s)}list(e,t,n={},s){return Y(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,Li,{query:n,...s})}},Li=class extends ne{};ys.OutputItemListResponsesPage=Li;var Ur=class extends x{constructor(){super(...arguments),this.outputItems=new ys(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,Di,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}},Di=class extends ne{};Ur.RunListResponsesPage=Di;Ur.OutputItems=ys;Ur.OutputItemListResponsesPage=Li;var dr=class extends x{constructor(){super(...arguments),this.runs=new Ur(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/evals",bs,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}},bs=class extends ne{};dr.EvalListResponsesPage=bs;dr.Runs=Ur;dr.RunListResponsesPage=Di;var hn=class extends x{create(e,t){return this._client.post("/files",nt({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/files",ws,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await $r(t),a=await this.retrieve(e),Date.now()-i>n)throw new Mt({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}},ws=class extends ne{};hn.FileObjectsPage=ws;var Ui=class extends x{};var Fi=class extends x{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var xs=class extends x{constructor(){super(...arguments),this.graders=new Fi(this._client)}};xs.Graders=Fi;var vs=class extends x{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Bi,{body:t,method:"post",...n})}retrieve(e,t={},n){return Y(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,n)}},Bi=class extends ir{};vs.PermissionCreateResponsesPage=Bi;var mn=class extends x{constructor(){super(...arguments),this.permissions=new vs(this._client)}};mn.Permissions=vs;mn.PermissionCreateResponsesPage=Bi;var As=class extends x{list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Zi,{query:t,...n})}},Zi=class extends ne{};As.FineTuningJobCheckpointsPage=Zi;var fr=class extends x{constructor(){super(...arguments),this.checkpoints=new As(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",qi,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return Y(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Gi,{query:t,...n})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}},qi=class extends ne{},Gi=class extends ne{};fr.FineTuningJobsPage=qi;fr.FineTuningJobEventsPage=Gi;fr.Checkpoints=As;fr.FineTuningJobCheckpointsPage=Zi;var ft=class extends x{constructor(){super(...arguments),this.methods=new Ui(this._client),this.jobs=new fr(this._client),this.checkpoints=new mn(this._client),this.alpha=new xs(this._client)}};ft.Methods=Ui;ft.Jobs=fr;ft.FineTuningJobsPage=qi;ft.FineTuningJobEventsPage=Gi;ft.Checkpoints=mn;ft.Alpha=xs;var Hi=class extends x{};var gn=class extends x{constructor(){super(...arguments),this.graderModels=new Hi(this._client)}};gn.GraderModels=Hi;var Es=class extends x{createVariation(e,t){return this._client.post("/images/variations",nt({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",nt({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};var _n=class extends x{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Os,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},Os=class extends ir{};_n.ModelsPage=Os;var Is=class extends x{create(e,t){return this._client.post("/moderations",{body:e,...t})}};function jy(r,e){return!e||!QI(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:lf(r,e)}function lf(r,e){let t=r.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:rT(e,s)};if(s.type==="message"){let i=s.content.map(a=>a.type==="output_text"?{...a,parsed:XI(e,a.text)}:a);return{...s,content:i}}return s}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||df(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let s of n.output)if(s.type==="message"){for(let i of s.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),n}function XI(r,e){return r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(e):JSON.parse(e)}function QI(r){return!!Ya(r.text?.format)}function eT(r){return r?.$brand==="auto-parseable-tool"}function tT(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function rT(r,e){let t=tT(r.tools??[],e.name);return{...e,...e,parsed_arguments:eT(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function df(r){let e=[];for(let t of r.output)if(t.type==="message")for(let n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}var Vi=class extends x{list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,uc,{query:t,...n})}};var Ki=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},yn=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ji,cc,bn,lc,My,zy,Ly,Dy,dc=class r extends cn{constructor(e){super(),Ji.add(this),cc.set(this,void 0),bn.set(this,void 0),lc.set(this,void 0),Ki(this,cc,e,"f")}static createResponse(e,t,n){let s=new r(t);return s._run(()=>s._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,t,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),yn(this,Ji,"m",My).call(this);let i,a=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let o of i)yn(this,Ji,"m",zy).call(this,o,a);if(i.controller.signal?.aborted)throw new ge;return yn(this,Ji,"m",Ly).call(this)}[(cc=new WeakMap,bn=new WeakMap,lc=new WeakMap,Ji=new WeakSet,My=function(){this.ended||Ki(this,bn,void 0,"f")},zy=function(t,n){if(this.ended)return;let s=(a,o)=>{(n==null||o.sequence_number>n)&&this._emit(a,o)},i=yn(this,Ji,"m",Dy).call(this,t);switch(s("event",t),t.type){case"response.output_text.delta":{let a=i.output[t.output_index];if(!a)throw new C(`missing output at index ${t.output_index}`);if(a.type==="message"){let o=a.content[t.content_index];if(!o)throw new C(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new C(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let a=i.output[t.output_index];if(!a)throw new C(`missing output at index ${t.output_index}`);a.type==="function_call"&&s("response.function_call_arguments.delta",{...t,snapshot:a.arguments});break}default:s(t.type,t);break}},Ly=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");let t=yn(this,bn,"f");if(!t)throw new C("request ended without sending any events");Ki(this,bn,void 0,"f");let n=sT(t,yn(this,cc,"f"));return Ki(this,lc,n,"f"),n},Dy=function(t){let n=yn(this,bn,"f");if(!n){if(t.type!=="response.created")throw new C(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=Ki(this,bn,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{let s=n.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{let s=n.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);if(s.type==="message"){let i=s.content[t.content_index];if(!i)throw new C(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new C(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{let s=n.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{Ki(this,bn,t.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=yn(this,lc,"f");if(!e)throw new C("stream ended without producing a ChatCompletion");return e}};function sT(r,e){return jy(r,e)}var wn=class extends x{constructor(){super(...arguments),this.inputItems=new Vi(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&df(n),n))}retrieve(e,t={},n){return this._client.get(`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>lf(n,e))}stream(e,t){return dc.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t?.headers}})}},uc=class extends ne{};wn.InputItems=Vi;var Wi=class extends x{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,nt({body:t,...n}))}};var xn=class extends x{constructor(){super(...arguments),this.parts=new Wi(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}};xn.Parts=Wi;var Uy=async r=>{let e=await Promise.allSettled(r),t=e.filter(s=>s.status==="rejected");if(t.length){for(let s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let n=[];for(let s of e)s.status==="fulfilled"&&n.push(s.value);return n};var vn=class extends x{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},n){return Y(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,An,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){let s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){let s={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let i=await this.retrieve(e,t,{...n,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let u=i.response.headers.get("openai-poll-after-ms");if(u){let c=parseInt(u);isNaN(c)||(o=c)}}await $r(o);break;case"failed":case"completed":return a}}}async upload(e,t,n){let s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){let s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Yi,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}},An=class extends ne{},Yi=class extends ir{};vn.VectorStoreFilesPage=An;vn.FileContentResponsesPage=Yi;var Xi=class extends x{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async createAndPoll(e,t,n){let s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n={},s){return Y(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,An,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async poll(e,t,n){let s={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){let{data:i,response:a}=await this.retrieve(e,t,{...n,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(n?.pollIntervalMs)o=n.pollIntervalMs;else{let u=a.headers.get("openai-poll-after-ms");if(u){let c=parseInt(u);isNaN(c)||(o=c)}}await $r(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=s?.maxConcurrency??5,a=Math.min(i,t.length),o=this._client,u=t.values(),c=[...n];async function d(f){for(let p of f){let h=await o.files.create({file:p,purpose:"assistants"},s);c.push(h.id)}}let l=Array(a).fill(u).map(d);return await Uy(l),await this.createAndPoll(e,{file_ids:c})}};var pt=class extends x{constructor(){super(...arguments),this.files=new vn(this._client),this.fileBatches=new Xi(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return Y(e)?this.list({},e):this._client.getAPIList("/vector_stores",Ts,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,Ps,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}},Ts=class extends ne{},Ps=class extends ir{};pt.VectorStoresPage=Ts;pt.VectorStoreSearchResponsesPage=Ps;pt.Files=vn;pt.VectorStoreFilesPage=An;pt.FileContentResponsesPage=Yi;pt.FileBatches=Xi;var Fy,Z=class extends Vu{constructor({baseURL:e=Ba("OPENAI_BASE_URL"),apiKey:t=Ba("OPENAI_API_KEY"),organization:n=Ba("OPENAI_ORG_ID")??null,project:s=Ba("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new C("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let a={apiKey:t,organization:n,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&_y())throw new C(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new ms(this),this.chat=new Mr(this),this.embeddings=new _s(this),this.files=new hn(this),this.images=new Es(this),this.audio=new ar(this),this.moderations=new Is(this),this.models=new _n(this),this.fineTuning=new ft(this),this.graders=new gn(this),this.vectorStores=new pt(this),this.beta=new Dt(this),this.batches=new un(this),this.uploads=new xn(this),this.responses=new wn(this),this.evals=new dr(this),this.containers=new lr(this),this._options=a,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Td(e,{arrayFormat:"brackets"})}};Fy=Z;Z.OpenAI=Fy;Z.DEFAULT_TIMEOUT=6e5;Z.OpenAIError=C;Z.APIError=Ee;Z.APIConnectionError=Nr;Z.APIConnectionTimeoutError=Mt;Z.APIUserAbortError=ge;Z.NotFoundError=fi;Z.ConflictError=pi;Z.RateLimitError=mi;Z.BadRequestError=ci;Z.AuthenticationError=li;Z.InternalServerError=gi;Z.PermissionDeniedError=di;Z.UnprocessableEntityError=hi;Z.toFile=Ud;Z.fileFromPath=Uu;Z.Completions=ms;Z.Chat=Mr;Z.ChatCompletionsPage=on;Z.Embeddings=_s;Z.Files=hn;Z.FileObjectsPage=ws;Z.Images=Es;Z.Audio=ar;Z.Moderations=Is;Z.Models=_n;Z.ModelsPage=Os;Z.FineTuning=ft;Z.Graders=gn;Z.VectorStores=pt;Z.VectorStoresPage=Ts;Z.VectorStoreSearchResponsesPage=Ps;Z.Beta=Dt;Z.Batches=un;Z.BatchesPage=us;Z.Uploads=xn;Z.Responses=wn;Z.Evals=dr;Z.EvalListResponsesPage=bs;Z.Containers=lr;Z.ContainerListResponsesPage=gs;var cT=typeof window=="object"?window:{},re="0123456789abcdef".split(""),lT=[-2147483648,8388608,32768,128],Ut=[24,16,8,0];var ke=[];function Ft(r){r?(ke[0]=ke[16]=ke[1]=ke[2]=ke[3]=ke[4]=ke[5]=ke[6]=ke[7]=ke[8]=ke[9]=ke[10]=ke[11]=ke[12]=ke[13]=ke[14]=ke[15]=0,this.blocks=ke):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Ft.prototype.update=function(r){if(!this.finalized){var e=typeof r!="string";e&&r.constructor===cT.ArrayBuffer&&(r=new Uint8Array(r));for(var t,n=0,s,i=r.length||0,a=this.blocks;n<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;n<i&&s<64;++n)a[s>>2]|=r[n]<<Ut[s++&3];else for(s=this.start;n<i&&s<64;++n)t=r.charCodeAt(n),t<128?a[s>>2]|=t<<Ut[s++&3]:t<2048?(a[s>>2]|=(192|t>>6)<<Ut[s++&3],a[s>>2]|=(128|t&63)<<Ut[s++&3]):t<55296||t>=57344?(a[s>>2]|=(224|t>>12)<<Ut[s++&3],a[s>>2]|=(128|t>>6&63)<<Ut[s++&3],a[s>>2]|=(128|t&63)<<Ut[s++&3]):(t=65536+((t&1023)<<10|r.charCodeAt(++n)&1023),a[s>>2]|=(240|t>>18)<<Ut[s++&3],a[s>>2]|=(128|t>>12&63)<<Ut[s++&3],a[s>>2]|=(128|t>>6&63)<<Ut[s++&3],a[s>>2]|=(128|t&63)<<Ut[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Ft.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>2]|=lT[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};Ft.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i,a,o,u=this.blocks;for(a=16;a<80;++a)o=u[a-3]^u[a-8]^u[a-14]^u[a-16],u[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)i=e&t|~e&n,o=r<<5|r>>>27,s=o+i+s+1518500249+u[a]<<0,e=e<<30|e>>>2,i=r&e|~r&t,o=s<<5|s>>>27,n=o+i+n+1518500249+u[a+1]<<0,r=r<<30|r>>>2,i=s&r|~s&e,o=n<<5|n>>>27,t=o+i+t+1518500249+u[a+2]<<0,s=s<<30|s>>>2,i=n&s|~n&r,o=t<<5|t>>>27,e=o+i+e+1518500249+u[a+3]<<0,n=n<<30|n>>>2,i=t&n|~t&s,o=e<<5|e>>>27,r=o+i+r+1518500249+u[a+4]<<0,t=t<<30|t>>>2;for(;a<40;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s+1859775393+u[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n+1859775393+u[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t+1859775393+u[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e+1859775393+u[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r+1859775393+u[a+4]<<0,t=t<<30|t>>>2;for(;a<60;a+=5)i=e&t|e&n|t&n,o=r<<5|r>>>27,s=o+i+s-1894007588+u[a]<<0,e=e<<30|e>>>2,i=r&e|r&t|e&t,o=s<<5|s>>>27,n=o+i+n-1894007588+u[a+1]<<0,r=r<<30|r>>>2,i=s&r|s&e|r&e,o=n<<5|n>>>27,t=o+i+t-1894007588+u[a+2]<<0,s=s<<30|s>>>2,i=n&s|n&r|s&r,o=t<<5|t>>>27,e=o+i+e-1894007588+u[a+3]<<0,n=n<<30|n>>>2,i=t&n|t&s|n&s,o=e<<5|e>>>27,r=o+i+r-1894007588+u[a+4]<<0,t=t<<30|t>>>2;for(;a<80;a+=5)i=e^t^n,o=r<<5|r>>>27,s=o+i+s-899497514+u[a]<<0,e=e<<30|e>>>2,i=r^e^t,o=s<<5|s>>>27,n=o+i+n-899497514+u[a+1]<<0,r=r<<30|r>>>2,i=s^r^e,o=n<<5|n>>>27,t=o+i+t-899497514+u[a+2]<<0,s=s<<30|s>>>2,i=n^s^r,o=t<<5|t>>>27,e=o+i+e-899497514+u[a+3]<<0,n=n<<30|n>>>2,i=t^n^s,o=e<<5|e>>>27,r=o+i+r-899497514+u[a+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0};Ft.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return re[r>>28&15]+re[r>>24&15]+re[r>>20&15]+re[r>>16&15]+re[r>>12&15]+re[r>>8&15]+re[r>>4&15]+re[r&15]+re[e>>28&15]+re[e>>24&15]+re[e>>20&15]+re[e>>16&15]+re[e>>12&15]+re[e>>8&15]+re[e>>4&15]+re[e&15]+re[t>>28&15]+re[t>>24&15]+re[t>>20&15]+re[t>>16&15]+re[t>>12&15]+re[t>>8&15]+re[t>>4&15]+re[t&15]+re[n>>28&15]+re[n>>24&15]+re[n>>20&15]+re[n>>16&15]+re[n>>12&15]+re[n>>8&15]+re[n>>4&15]+re[n&15]+re[s>>28&15]+re[s>>24&15]+re[s>>20&15]+re[s>>16&15]+re[s>>12&15]+re[s>>8&15]+re[s>>4&15]+re[s&15]};Ft.prototype.toString=Ft.prototype.hex;Ft.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4;return[r>>24&255,r>>16&255,r>>8&255,r&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,s>>24&255,s>>16&255,s>>8&255,s&255]};Ft.prototype.array=Ft.prototype.digest;Ft.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(20),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),r};var By=!1,ff=r=>(By||(console.warn(["The default method for hashing keys is insecure and will be replaced in a future version,","but hasn't been replaced yet as to not break existing caches. It's recommended that you use","a more secure hashing algorithm to avoid cache poisoning.","","See this page for more information:","|","\u2514> https://js.langchain.com/docs/troubleshooting/warnings/insecure-cache-algorithm"].join(`
`)),By=!0),new Ft(!0).update(r).hex());var N="0123456789abcdef".split(""),dT=[-2147483648,8388608,32768,128],Bt=[24,16,8,0],fc=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];var Re=[];function pr(r,e){e?(Re[0]=Re[16]=Re[1]=Re[2]=Re[3]=Re[4]=Re[5]=Re[6]=Re[7]=Re[8]=Re[9]=Re[10]=Re[11]=Re[12]=Re[13]=Re[14]=Re[15]=0,this.blocks=Re):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=r}pr.prototype.update=function(r){if(!this.finalized){var e,t=typeof r;if(t!=="string"){if(t==="object"){if(r===null)throw new Error(ERROR);if(ARRAY_BUFFER&&r.constructor===ArrayBuffer)r=new Uint8Array(r);else if(!Array.isArray(r)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(r)))throw new Error(ERROR)}else throw new Error(ERROR);e=!0}for(var n,s=0,i,a=r.length,o=this.blocks;s<a;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),e)for(i=this.start;s<a&&i<64;++s)o[i>>>2]|=r[s]<<Bt[i++&3];else for(i=this.start;s<a&&i<64;++s)n=r.charCodeAt(s),n<128?o[i>>>2]|=n<<Bt[i++&3]:n<2048?(o[i>>>2]|=(192|n>>>6)<<Bt[i++&3],o[i>>>2]|=(128|n&63)<<Bt[i++&3]):n<55296||n>=57344?(o[i>>>2]|=(224|n>>>12)<<Bt[i++&3],o[i>>>2]|=(128|n>>>6&63)<<Bt[i++&3],o[i>>>2]|=(128|n&63)<<Bt[i++&3]):(n=65536+((n&1023)<<10|r.charCodeAt(++s)&1023),o[i>>>2]|=(240|n>>>18)<<Bt[i++&3],o[i>>>2]|=(128|n>>>12&63)<<Bt[i++&3],o[i>>>2]|=(128|n>>>6&63)<<Bt[i++&3],o[i>>>2]|=(128|n&63)<<Bt[i++&3]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=o[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};pr.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var r=this.blocks,e=this.lastByteIndex;r[16]=this.block,r[e>>>2]|=dT[e&3],this.block=r[16],e>=56&&(this.hashed||this.hash(),r[0]=this.block,r[16]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=r[9]=r[10]=r[11]=r[12]=r[13]=r[14]=r[15]=0),r[14]=this.hBytes<<3|this.bytes>>>29,r[15]=this.bytes<<3,this.hash()}};pr.prototype.hash=function(){var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i=this.h5,a=this.h6,o=this.h7,u=this.blocks,c,d,l,f,p,h,m,g,y,_,w;for(c=16;c<64;++c)p=u[c-15],d=(p>>>7|p<<25)^(p>>>18|p<<14)^p>>>3,p=u[c-2],l=(p>>>17|p<<15)^(p>>>19|p<<13)^p>>>10,u[c]=u[c-16]+d+u[c-7]+l<<0;for(w=e&t,c=0;c<64;c+=4)this.first?(this.is224?(g=300032,p=u[0]-1413257819,o=p-150054599<<0,n=p+24177077<<0):(g=704751109,p=u[0]-210244248,o=p-1521486534<<0,n=p+143694565<<0),this.first=!1):(d=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),l=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),g=r&e,f=g^r&t^w,m=s&i^~s&a,p=o+l+m+fc[c]+u[c],h=d+f,o=n+p<<0,n=p+h<<0),d=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),l=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),y=n&r,f=y^n&e^g,m=a&o^~a&s,p=i+l+m+fc[c+1]+u[c+1],h=d+f,a=t+p<<0,t=p+h<<0,d=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),l=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),_=t&n,f=_^t&r^y,m=i&a^~i&o,p=s+l+m+fc[c+2]+u[c+2],h=d+f,i=e+p<<0,e=p+h<<0,d=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),l=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),w=e&t,f=w^e&n^_,m=i&a^~i&o,p=s+l+m+fc[c+3]+u[c+3],h=d+f,s=r+p<<0,r=p+h<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+r<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+n<<0,this.h4=this.h4+s<<0,this.h5=this.h5+i<<0,this.h6=this.h6+a<<0,this.h7=this.h7+o<<0};pr.prototype.hex=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i=this.h5,a=this.h6,o=this.h7,u=N[r>>>28&15]+N[r>>>24&15]+N[r>>>20&15]+N[r>>>16&15]+N[r>>>12&15]+N[r>>>8&15]+N[r>>>4&15]+N[r&15]+N[e>>>28&15]+N[e>>>24&15]+N[e>>>20&15]+N[e>>>16&15]+N[e>>>12&15]+N[e>>>8&15]+N[e>>>4&15]+N[e&15]+N[t>>>28&15]+N[t>>>24&15]+N[t>>>20&15]+N[t>>>16&15]+N[t>>>12&15]+N[t>>>8&15]+N[t>>>4&15]+N[t&15]+N[n>>>28&15]+N[n>>>24&15]+N[n>>>20&15]+N[n>>>16&15]+N[n>>>12&15]+N[n>>>8&15]+N[n>>>4&15]+N[n&15]+N[s>>>28&15]+N[s>>>24&15]+N[s>>>20&15]+N[s>>>16&15]+N[s>>>12&15]+N[s>>>8&15]+N[s>>>4&15]+N[s&15]+N[i>>>28&15]+N[i>>>24&15]+N[i>>>20&15]+N[i>>>16&15]+N[i>>>12&15]+N[i>>>8&15]+N[i>>>4&15]+N[i&15]+N[a>>>28&15]+N[a>>>24&15]+N[a>>>20&15]+N[a>>>16&15]+N[a>>>12&15]+N[a>>>8&15]+N[a>>>4&15]+N[a&15];return this.is224||(u+=N[o>>>28&15]+N[o>>>24&15]+N[o>>>20&15]+N[o>>>16&15]+N[o>>>12&15]+N[o>>>8&15]+N[o>>>4&15]+N[o&15]),u};pr.prototype.toString=pr.prototype.hex;pr.prototype.digest=function(){this.finalize();var r=this.h0,e=this.h1,t=this.h2,n=this.h3,s=this.h4,i=this.h5,a=this.h6,o=this.h7,u=[r>>>24&255,r>>>16&255,r>>>8&255,r&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255];return this.is224||u.push(o>>>24&255,o>>>16&255,o>>>8&255,o&255),u};pr.prototype.array=pr.prototype.digest;pr.prototype.arrayBuffer=function(){this.finalize();var r=new ArrayBuffer(this.is224?28:32),e=new DataView(r);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),r};var fT=(...r)=>ff(r.join("_"));var pf=class{constructor(){Object.defineProperty(this,"keyEncoder",{enumerable:!0,configurable:!0,writable:!0,value:fT})}makeDefaultKeyEncoder(e){this.keyEncoder=e}},pT=new Map,pc=class r extends pf{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(this.keyEncoder(e,t))??null)}async update(e,t,n){this.cache.set(this.keyEncoder(e,t),n)}static global(){return new r(pT)}};var hc=class extends Tt{},mc=class extends hc{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new it(this.value)]}},gc=class extends hc{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return ua(this.messages)}toChatMessages(){return this.messages}};var Hy=It(Gy(),1);var xT=Object.defineProperty,vT=(r,e,t)=>e in r?xT(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,AT=(r,e,t)=>(vT(r,typeof e!="symbol"?e+"":e,t),t);function ET(r,e){let t=Array.from({length:r.length},(n,s)=>({start:s,end:s+1}));for(;t.length>1;){let n=null;for(let s=0;s<t.length-1;s++){let i=r.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(n==null||a<n[0])&&(n=[a,s])}if(n!=null){let s=n[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function OT(r,e){return r.length===1?[e.get(r.join(","))]:ET(r,e).map(t=>e.get(r.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function IT(r){return r.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var mf=class{constructor(r,e){_r(this,"specialTokens");_r(this,"inverseSpecialTokens");_r(this,"patStr");_r(this,"textEncoder",new TextEncoder);_r(this,"textDecoder",new TextDecoder("utf-8"));_r(this,"rankMap",new Map);_r(this,"textMap",new Map);this.patStr=r.pat_str;let t=r.bpe_ranks.split(`
`).filter(Boolean).reduce((n,s)=>{let[i,a,...o]=s.split(" "),u=Number.parseInt(a,10);return o.forEach((c,d)=>n[c]=u+d),n},{});for(let[n,s]of Object.entries(t)){let i=Hy.default.toByteArray(n);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...r.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((n,[s,i])=>(n[i]=this.textEncoder.encode(s),n),{})}encode(r,e=[],t="all"){let n=new RegExp(this.patStr,"ug"),s=mf.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!a.has(c)):t);if(o.size>0){let c=mf.specialTokenRegex([...o]),d=r.match(c);if(d!=null)throw new Error(`The text contains a special token that is not allowed: ${d[0]}`)}let u=0;for(;;){let c=null,d=u;for(;s.lastIndex=d,c=s.exec(r),!(c==null||a.has(c[0]));)d=c.index+1;let l=c?.index??r.length;for(let p of r.substring(u,l).matchAll(n)){let h=this.textEncoder.encode(p[0]),m=this.rankMap.get(h.join(","));if(m!=null){i.push(m);continue}i.push(...OT(h,this.rankMap))}if(c==null)break;let f=this.specialTokens[c[0]];i.push(f),u=c.index+c[0].length}return i}decode(r){let e=[],t=0;for(let i=0;i<r.length;++i){let a=r[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}let n=new Uint8Array(t),s=0;for(let i of e)n.set(i,s),s+=i.length;return this.textDecoder.decode(n)}},yc=mf;AT(yc,"specialTokenRegex",r=>new RegExp(r.map(e=>IT(e)).join("|"),"g"));function gf(r){switch(r){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}var bc={},TT=new Ir({});async function PT(r){return r in bc||(bc[r]=TT.fetch(`https://tiktoken.pages.dev/js/${r}.json`).then(e=>e.json()).then(e=>new yc(e)).catch(e=>{throw delete bc[r],e})),await bc[r]}async function Vy(r){return PT(gf(r))}var ST=r=>r.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":r.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":r.startsWith("gpt-4-32k")?"gpt-4-32k":r.startsWith("gpt-4-")?"gpt-4":r.startsWith("gpt-4o")?"gpt-4o":r;function Ky(r){return typeof r!="object"||!r?!1:!!("type"in r&&r.type==="function"&&"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"parameters"in r.function)}var kT=()=>!1,ro=class extends de{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??kT(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},no=class extends ro{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...n}){let{cache:s,...i}=n;super({callbacks:e??t,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=pc.global():this.cache=void 0,this.caller=new Ir(n??{})}async getNumTokens(e){let t;typeof e=="string"?t=e:t=e.map(s=>typeof s=="string"?s:s.type==="text"&&"text"in s?s.text:"").join("");let n=Math.ceil(t.length/4);if(!this._encoding)try{this._encoding=await Vy("modelName"in this?ST(this.modelName):"gpt2")}catch(s){console.warn("Failed to calculate number of tokens, falling back to approximate count",s)}if(this._encoding)try{n=this._encoding.encode(t).length}catch(s){console.warn("Failed to calculate number of tokens, falling back to approximate count",s)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new mc(e):Array.isArray(e)?new gc(e.map(Cn)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){let n={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(n).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}};var mr=class extends de{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){let n=ie(t);return this.func&&await this.func(e,n),this._callWithConfig(s=>Promise.resolve(s),e,n)}async*transform(e,t){let n=ie(t),s,i=!0;for await(let a of this._transformStreamWithConfig(e,o=>o,n))if(yield a,i)if(s===void 0)s=a;else try{s=Or(s,a)}catch{s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,n)}static assign(e){return new ui(new sn({steps:e}))}};function _f(r){let e=[];for(let t of r){let n=t;if(Array.isArray(t.content))for(let s=0;s<t.content.length;s++){let i=t.content[s];(tp(i)||rp(i))&&n===t&&(n=new t.constructor({...n,content:[...t.content.slice(0,s),np(i),...t.content.slice(s+1)]}))}e.push(n)}return e}var wc=class r extends no{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){let[t,n]=super._separateRunnableConfigFromCallOptions(e);return n.signal=t.signal,[t,n]}async invoke(e,t){let n=r._convertInputToPromptValue(e);return(await this.generatePrompt([n],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,n){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===r.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{let s=r._convertInputToPromptValue(e).toChatMessages(),[i,a]=this._separateRunnableConfigFromCallOptionsCompat(t),o={...i.metadata,...this.getLsParams(a)},u=await $e.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:a,invocation_params:this?.invocationParams(a),batch_size:1},d=await u?.handleChatModelStart(this.toJSON(),[_f(s)],i.runId,void 0,c,void 0,void 0,i.runName),l,f;try{for await(let p of this._streamResponseChunks(s,a,d?.[0])){if(p.message.id==null){let h=d?.at(0)?.runId;h!=null&&p.message._updateId(`run-${h}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},yield p.message,l?l=l.concat(p):l=p,Lc(p.message)&&p.message.usage_metadata!==void 0&&(f={tokenUsage:{promptTokens:p.message.usage_metadata.input_tokens,completionTokens:p.message.usage_metadata.output_tokens,totalTokens:p.message.usage_metadata.total_tokens}})}}catch(p){throw await Promise.all((d??[]).map(h=>h?.handleLLMError(p))),p}await Promise.all((d??[]).map(p=>p?.handleLLMEnd({generations:[[l]],llmOutput:f})))}}getLsParams(e){let t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,n,s){let i=e.map(l=>l.map(Cn)),a;if(s!==void 0&&s.length===i.length)a=s;else{let l={...n.metadata,...this.getLsParams(t)},f=await $e.configure(n.callbacks,this.callbacks,n.tags,this.tags,l,this.metadata,{verbose:this.verbose}),p={options:t,invocation_params:this?.invocationParams(t),batch_size:1};a=await f?.handleChatModelStart(this.toJSON(),i.map(_f),n.runId,void 0,p,void 0,void 0,n.runName)}let o=[],u=[];if(!!a?.[0].handlers.find(Wl)&&!this.disableStreaming&&i.length===1&&this._streamResponseChunks!==r.prototype._streamResponseChunks)try{let l=await this._streamResponseChunks(i[0],t,a?.[0]),f,p;for await(let h of l){if(h.message.id==null){let m=a?.at(0)?.runId;m!=null&&h.message._updateId(`run-${m}`)}f===void 0?f=h:f=Or(f,h),Lc(h.message)&&h.message.usage_metadata!==void 0&&(p={tokenUsage:{promptTokens:h.message.usage_metadata.input_tokens,completionTokens:h.message.usage_metadata.output_tokens,totalTokens:h.message.usage_metadata.total_tokens}})}if(f===void 0)throw new Error("Received empty response from chat model call.");o.push([f]),await a?.[0].handleLLMEnd({generations:o,llmOutput:p})}catch(l){throw await a?.[0].handleLLMError(l),l}else{let l=await Promise.allSettled(i.map((f,p)=>this._generate(f,{...t,promptIndex:p},a?.[p])));await Promise.all(l.map(async(f,p)=>{if(f.status==="fulfilled"){let h=f.value;for(let m of h.generations){if(m.message.id==null){let g=a?.at(0)?.runId;g!=null&&m.message._updateId(`run-${g}`)}m.message.response_metadata={...m.generationInfo,...m.message.response_metadata}}return h.generations.length===1&&(h.generations[0].message.response_metadata={...h.llmOutput,...h.generations[0].message.response_metadata}),o[p]=h.generations,u[p]=h.llmOutput,a?.[p]?.handleLLMEnd({generations:[h.generations],llmOutput:h.llmOutput})}else return await a?.[p]?.handleLLMError(f.reason),Promise.reject(f.reason)}))}let d={generations:o,llmOutput:u.length?this._combineLLMOutput?.(...u):void 0};return Object.defineProperty(d,bu,{value:a?{runIds:a?.map(l=>l.runId)}:void 0,configurable:!0}),d}async _generateCached({messages:e,cache:t,llmStringKey:n,parsedOptions:s,handledOptions:i}){let a=e.map(g=>g.map(Cn)),o={...i.metadata,...this.getLsParams(s)},u=await $e.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this?.invocationParams(s),batch_size:1},d=await u?.handleChatModelStart(this.toJSON(),a.map(_f),i.runId,void 0,c,void 0,void 0,i.runName),l=[],p=(await Promise.allSettled(a.map(async(g,y)=>{let _=r._convertInputToPromptValue(g).toString(),w=await t.lookup(_,n);return w==null&&l.push(y),w}))).map((g,y)=>({result:g,runManager:d?.[y]})).filter(({result:g})=>g.status==="fulfilled"&&g.value!=null||g.status==="rejected"),h=[];await Promise.all(p.map(async({result:g,runManager:y},_)=>{if(g.status==="fulfilled"){let w=g.value;return h[_]=w.map(A=>("message"in A&&Fr(A.message)&&Pn(A.message)&&(A.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),A.generationInfo={...A.generationInfo,tokenUsage:{}},A)),w.length&&await y?.handleLLMNewToken(w[0].text),y?.handleLLMEnd({generations:[w]},void 0,void 0,void 0,{cached:!0})}else return await y?.handleLLMError(g.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(g.reason)}));let m={generations:h,missingPromptIndices:l,startedRunManagers:d};return Object.defineProperty(m,bu,{value:d?{runIds:d?.map(g=>g.runId)}:void 0,configurable:!0}),m}async generate(e,t,n){let s;Array.isArray(t)?s={stop:t}:s=t;let i=e.map(h=>h.map(Cn)),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(a.callbacks=a.callbacks??n,!this.cache)return this._generateUncached(i,o,a);let{cache:u}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:d,missingPromptIndices:l,startedRunManagers:f}=await this._generateCached({messages:i,cache:u,llmStringKey:c,parsedOptions:o,handledOptions:a}),p={};if(l.length>0){let h=await this._generateUncached(l.map(m=>i[m]),o,a,f!==void 0?l.map(m=>f?.[m]):void 0);await Promise.all(h.generations.map(async(m,g)=>{let y=l[g];d[y]=m;let _=r._convertInputToPromptValue(i[y]).toString();return u.update(_,c,m)})),p=h.llmOutput??{}}return{generations:d,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,n){let s=e.map(i=>i.toChatMessages());return this.generate(s,t,n)}async call(e,t,n){return(await this.generate([e.map(Cn)],t,n)).generations[0][0].message}async callPrompt(e,t,n){let s=e.toChatMessages();return this.call(s,t,n)}async predictMessages(e,t,n){return this.call(e,t,n)}async predict(e,t,n){let s=new it(e),i=await this.call([s],t,n);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t?.strict)throw new Error('"strict" mode is not supported for this model by default.');let n=e,s=t?.name,i=Ma(n)??"A function available to call.",a=t?.method,o=t?.includeRaw;if(a==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=s??"extract",c;ns(n)?c=[{type:"function",function:{name:u,description:i,parameters:nn(n)}}]:("name"in n&&(u=n.name),c=[{type:"function",function:{name:u,description:i,parameters:n}}]);let d=this.bindTools(c),l=Rr.from(m=>{if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");let g=m.tool_calls.find(y=>y.name===u);if(!g)throw new Error(`No tool call found with name ${u}.`);return g.args});if(!o)return d.pipe(l).withConfig({runName:"StructuredOutput"});let f=mr.assign({parsed:(m,g)=>l.invoke(m.raw,g)}),p=mr.assign({parsed:()=>null}),h=f.withFallbacks({fallbacks:[p]});return kr.from([{raw:d},h]).withConfig({runName:"StructuredOutputRunnable"})}};var yf=class extends de{parseResultWithPrompt(e,t,n){return this.parseResult(e,n)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(n,s)=>this.parseResult([{text:n}],s?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(n,s)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],s?.callbacks),e,{...t,runType:"parser"})}},Qi=class extends yf{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,n){return this.parse(e,n)}_type(){throw new Error("_type not implemented")}},En=class extends Error{constructor(e,t,n,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=n,this.sendToLLM=s,s&&(n===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");bo(this,"OUTPUT_PARSING_FAILURE")}};var ea=class extends Qi{async*_transform(e){for await(let t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}},ks=class extends ea{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async*_transform(e){let t,n;for await(let s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(zc(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new en({message:s,text:s.content})}else if(Fr(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new en({message:Uc(s),text:s.content})}else i=new Nt({text:s});n===void 0?n=i:n=n.concat(i);let a=await this.parsePartialResult([n]);a!=null&&!Tr(a,t)&&(this.diff?yield this._diff(t,a):yield a,t=a)}}getFormatInstructions(){return""}};var so=class extends Qi{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){let t=at.object(Object.fromEntries(Object.entries(e).map(([n,s])=>[n,at.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(nn(this.schema))}
\`\`\`
`}async parse(e){try{let t=e.trim(),s=(t.match(/^```(?:json)?\s*([\s\S]*?)```/)?.[1]||t.match(/```json\s*([\s\S]*?)```/)?.[1]||t).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(i,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await oi(this.schema,JSON.parse(s))}catch(t){throw new En(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}};var io=class extends ks{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_concatOutputChunks(e,t){return this.diff?super._concatOutputChunks(e,t):t}_diff(e,t){if(t)return e?Do(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return $c(e[0].text)}async parse(e){return $c(e,JSON.parse)}getFormatInstructions(){return""}};function wf(r,e){if(r.function===void 0)return;let t;if(e?.partial)try{t=Ms(r.function.arguments??"{}")}catch{return}else try{t=JSON.parse(r.function.arguments)}catch(s){throw new En([`Function "${r.function.name}" arguments:`,"",r.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}let n={name:r.function.name,args:t,type:"tool_call"};return e?.returnId&&(n.id=r.id),n}function Jy(r){if(r.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.args)}}}function Wy(r,e){return{name:r.function?.name,args:r.function?.arguments,id:r.id,error:e,type:"invalid_tool_call"}}var bf=class extends ks{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){let n=e[0].message,s;if(Pn(n)&&n.tool_calls?.length?s=n.tool_calls.map(a=>{let{id:o,...u}=a;return this.returnId?{id:o,...u}:u}):n.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(n.additional_kwargs.tool_calls)).map(o=>wf(o,{returnId:this.returnId,partial:t}))),!s)return[];let i=[];for(let a of s)if(a!==void 0){let o={type:a.name,args:a.args,id:a.id};i.push(o)}return i}},ao=class extends bf{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;let t=await Z_(this.zodSchema,e);if(t.success)return t.data;throw new En(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error?.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let n=(await super.parsePartialResult(e)).filter(i=>i.type===this.keyName),s=n;if(n.length)return this.returnId||(s=n.map(i=>i.args)),this.returnSingle?s[0]:s}async parseResult(e){let n=(await super.parsePartialResult(e,!1)).filter(a=>a.type===this.keyName),s=n;return n.length?(this.returnId||(s=n.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))):void 0}};var Xy=Symbol("Let zodToJsonSchema decide on which parser to use"),Yy={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Qy=r=>typeof r=="string"?{...Yy,basePath:["#"],definitions:{},name:r}:{...Yy,basePath:["#"],definitions:{},...r};var oo=r=>"_def"in r?r._def:r;function eb(r){if(!r)return!0;for(let e in r)return!1;return!0}var tb=r=>{let e=Qy(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([n,s])=>[oo(s),{def:oo(s),path:[...e.basePath,e.definitionPath,n],jsonSchema:void 0}]))}};function xf(r,e,t,n){n?.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function oe(r,e,t,n,s){r[e]=t,xf(r,e,n,s)}function rb(){return{}}function nb(r,e){let t={type:"array"};return r.type?._def?.typeName!==b.ZodAny&&(t.items=F(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&oe(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&oe(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(oe(t,"minItems",r.exactLength.value,r.exactLength.message,e),oe(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function sb(r,e){let t={type:"integer",format:"int64"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"min":e.target==="jsonSchema7"?n.inclusive?oe(t,"minimum",n.value,n.message,e):oe(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),oe(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?oe(t,"maximum",n.value,n.message,e):oe(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),oe(t,"maximum",n.value,n.message,e));break;case"multipleOf":oe(t,"multipleOf",n.value,n.message,e);break}return t}function ib(){return{type:"boolean"}}function ab(r,e){return F(r.type._def,e)}var ob=(r,e)=>F(r.innerType._def,e);function vf(r,e,t){let n=t??e.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,i)=>vf(r,e,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return RT(r,e)}}var RT=(r,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let n of r.checks)switch(n.kind){case"min":oe(t,"minimum",n.value,n.message,e);break;case"max":oe(t,"maximum",n.value,n.message,e);break}return t};function ub(r,e){return{...F(r.innerType._def,e),default:r.defaultValue()}}function cb(r,e,t){return e.effectStrategy==="input"?F(r.schema._def,e,t):{}}function lb(r){return{type:"string",enum:[...r.values]}}var NT=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function db(r,e){let t=[F(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),F(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i),n=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return t.forEach(i=>{if(NT(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(n=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){let{additionalProperties:o,...u}=i;a=u}else n=void 0;s.push(a)}}),s.length?{allOf:s,...n}:void 0}function fb(r,e){let t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}var Af,Rs={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Af===void 0&&(Af=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Af),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function xc(r,e){let t={type:"string"};function n(s){return e.patternStrategy==="escape"?CT(s):s}if(r.checks)for(let s of r.checks)switch(s.kind){case"min":oe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":oe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Zt(t,"email",s.message,e);break;case"format:idn-email":Zt(t,"idn-email",s.message,e);break;case"pattern:zod":qt(t,Rs.email,s.message,e);break}break;case"url":Zt(t,"uri",s.message,e);break;case"uuid":Zt(t,"uuid",s.message,e);break;case"regex":qt(t,s.regex,s.message,e);break;case"cuid":qt(t,Rs.cuid,s.message,e);break;case"cuid2":qt(t,Rs.cuid2,s.message,e);break;case"startsWith":qt(t,RegExp(`^${n(s.value)}`),s.message,e);break;case"endsWith":qt(t,RegExp(`${n(s.value)}$`),s.message,e);break;case"datetime":Zt(t,"date-time",s.message,e);break;case"date":Zt(t,"date",s.message,e);break;case"time":Zt(t,"time",s.message,e);break;case"duration":Zt(t,"duration",s.message,e);break;case"length":oe(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),oe(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{qt(t,RegExp(n(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&Zt(t,"ipv4",s.message,e),s.version!=="v4"&&Zt(t,"ipv6",s.message,e);break}case"emoji":qt(t,Rs.emoji,s.message,e);break;case"ulid":{qt(t,Rs.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Zt(t,"binary",s.message,e);break}case"contentEncoding:base64":{oe(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{qt(t,Rs.base64,s.message,e);break}}break}case"nanoid":qt(t,Rs.nanoid,s.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}var CT=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Zt=(r,e,t,n)=>{r.format||r.anyOf?.some(s=>s.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&n.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&n.errorMessages&&{errorMessage:{format:t}}})):oe(r,"format",e,t,n)},qt=(r,e,t,n)=>{r.pattern||r.allOf?.some(s=>s.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&n.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:pb(e,n),...t&&n.errorMessages&&{errorMessage:{pattern:t}}})):oe(r,"pattern",pb(e,n),t,n)},pb=(r,e)=>{let t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;let n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=n.i?t.source.toLowerCase():t.source,i="",a=!1,o=!1,u=!1;for(let c=0;c<s.length;c++){if(a){i+=s[c],a=!1;continue}if(n.i){if(o){if(s[c].match(/[a-z]/)){u?(i+=s[c],i+=`${s[c-2]}-${s[c]}`.toUpperCase(),u=!1):s[c+1]==="-"&&s[c+2]?.match(/[a-z]/)?(i+=s[c],u=!0):i+=`${s[c]}${s[c].toUpperCase()}`;continue}}else if(s[c].match(/[a-z]/)){i+=`[${s[c]}${s[c].toUpperCase()}]`;continue}}if(n.m){if(s[c]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(s[c]==="$"){i+=`($|(?=[\r
]))`;continue}}if(n.s&&s[c]==="."){i+=o?`${s[c]}\r
`:`[${s[c]}\r
]`;continue}i+=s[c],s[c]==="\\"?a=!0:o&&s[c]==="]"?o=!1:!o&&s[c]==="["&&(o=!0)}try{let c=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function vc(r,e){if(e.target==="openApi3"&&r.keyType?._def.typeName===b.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((n,s)=>({...n,[s]:F(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",s]})??{}}),{}),additionalProperties:!1};let t={type:"object",additionalProperties:F(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(r.keyType?._def.typeName===b.ZodString&&r.keyType._def.checks?.length){let n=Object.entries(xc(r.keyType._def,e)).reduce((s,[i,a])=>i==="type"?s:{...s,[i]:a},{});return{...t,propertyNames:n}}else if(r.keyType?._def.typeName===b.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function hb(r,e){if(e.mapStrategy==="record")return vc(r,e);let t=F(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},n=F(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,n],minItems:2,maxItems:2}}}function mb(r){let e=r.values,n=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(n.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:n}}function gb(){return{not:{}}}function _b(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var uo={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function bb(r,e){if(e.target==="openApi3")return yb(r,e);let t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(n=>n._def.typeName in uo&&(!n._def.checks||!n._def.checks.length))){let n=t.reduce((s,i)=>{let a=uo[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:n.length>1?n:n[0]}}else if(t.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){let n=t.reduce((s,i)=>{let a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(n.length===t.length){let s=n.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((n,s)=>[...n,...s._def.values.filter(i=>!n.includes(i))],[])};return yb(r,e)}var yb=(r,e)=>{let t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((n,s)=>F(n._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(n=>!!n&&(!e.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return t.length?{anyOf:t}:void 0};function wb(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:uo[r.innerType._def.typeName],nullable:!0}:{type:[uo[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let n=F(r.innerType._def,{...e,currentPath:[...e.currentPath]});return n&&"$ref"in n?{allOf:[n],nullable:!0}:n&&{...n,nullable:!0}}let t=F(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function xb(r,e){let t={type:"number"};if(!r.checks)return t;for(let n of r.checks)switch(n.kind){case"int":t.type="integer",xf(t,"type",n.message,e);break;case"min":e.target==="jsonSchema7"?n.inclusive?oe(t,"minimum",n.value,n.message,e):oe(t,"exclusiveMinimum",n.value,n.message,e):(n.inclusive||(t.exclusiveMinimum=!0),oe(t,"minimum",n.value,n.message,e));break;case"max":e.target==="jsonSchema7"?n.inclusive?oe(t,"maximum",n.value,n.message,e):oe(t,"exclusiveMaximum",n.value,n.message,e):(n.inclusive||(t.exclusiveMaximum=!0),oe(t,"maximum",n.value,n.message,e));break;case"multipleOf":oe(t,"multipleOf",n.value,n.message,e);break}return t}function $T(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":F(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":F(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function vb(r,e){let t={type:"object",...Object.entries(r.shape()).reduce((n,[s,i])=>{if(i===void 0||i._def===void 0)return n;let a=[...e.currentPath,"properties",s],o=F(i._def,{...e,currentPath:a,propertyPath:a});return o===void 0?n:(e.openaiStrictMode&&i.isOptional()&&!i.isNullable()&&console.warn(`Zod field at \`${a.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required
This will become an error in a future version of the SDK.`),{properties:{...n.properties,[s]:o},required:i.isOptional()&&!e.openaiStrictMode?n.required:[...n.required,s]})},{properties:{},required:[]}),additionalProperties:$T(r,e)};return t.required.length||delete t.required,t}var Ab=(r,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return F(r.innerType._def,e);let t=F(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}};var Eb=(r,e)=>{if(e.pipeStrategy==="input")return F(r.in._def,e);if(e.pipeStrategy==="output")return F(r.out._def,e);let t=F(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),n=F(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,n].filter(s=>s!==void 0)}};function Ob(r,e){return F(r.type._def,e)}function Ib(r,e){let n={type:"array",uniqueItems:!0,items:F(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&oe(n,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&oe(n,"maxItems",r.maxSize.value,r.maxSize.message,e),n}function Tb(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,n)=>F(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[]),additionalItems:F(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,n)=>F(t._def,{...e,currentPath:[...e.currentPath,"items",`${n}`]})).reduce((t,n)=>n===void 0?t:[...t,n],[])}}function Pb(){return{not:{}}}function Sb(){return{}}var kb=(r,e)=>F(r.innerType._def,e);function F(r,e,t=!1){let n=e.seen.get(r);if(e.override){let a=e.override?.(r,e,n,t);if(a!==Xy)return a}if(n&&!t){let a=jT(n,e);if(a!==void 0)return"$ref"in a&&e.seenRefs.add(a.$ref),a}let s={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,s);let i=zT(r,r.typeName,e,t);return i&&LT(r,e,i),s.jsonSchema=i,i}var jT=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":let t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:MT(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,s)=>e.currentPath[s]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},MT=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},zT=(r,e,t,n)=>{switch(e){case b.ZodString:return xc(r,t);case b.ZodNumber:return xb(r,t);case b.ZodObject:return vb(r,t);case b.ZodBigInt:return sb(r,t);case b.ZodBoolean:return ib();case b.ZodDate:return vf(r,t);case b.ZodUndefined:return Pb();case b.ZodNull:return _b(t);case b.ZodArray:return nb(r,t);case b.ZodUnion:case b.ZodDiscriminatedUnion:return bb(r,t);case b.ZodIntersection:return db(r,t);case b.ZodTuple:return Tb(r,t);case b.ZodRecord:return vc(r,t);case b.ZodLiteral:return fb(r,t);case b.ZodEnum:return lb(r);case b.ZodNativeEnum:return mb(r);case b.ZodNullable:return wb(r,t);case b.ZodOptional:return Ab(r,t);case b.ZodMap:return hb(r,t);case b.ZodSet:return Ib(r,t);case b.ZodLazy:return F(r.getter()._def,t);case b.ZodPromise:return Ob(r,t);case b.ZodNaN:case b.ZodNever:return gb();case b.ZodEffects:return cb(r,t,n);case b.ZodAny:return rb();case b.ZodUnknown:return Sb();case b.ZodDefault:return ub(r,t);case b.ZodBranded:return ab(r,t);case b.ZodReadonly:return kb(r,t);case b.ZodCatch:return ob(r,t);case b.ZodPipeline:return Eb(r,t);case b.ZodFunction:case b.ZodVoid:case b.ZodSymbol:return;default:return(s=>{})(e)}},LT=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t);var Rb=(r,e)=>{let t=tb(e),n=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=F(r._def,n===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,n]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i);let a=(()=>{if(eb(t.definitions))return;let u={},c=new Set;for(let d=0;d<500;d++){let l=Object.entries(t.definitions).filter(([f])=>!c.has(f));if(l.length===0)break;for(let[f,p]of l)u[f]=F(oo(p),{...t,currentPath:[...t.basePath,t.definitionPath,f]},!0)??{},c.add(f)}return u})(),o=n===void 0?a?{...s,[t.definitionPath]:a}:s:t.nameStrategy==="duplicate-ref"?{...s,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[n]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,n].join("/"),[t.definitionPath]:{...a,[n]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function Nb(r,e){return Rb(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function Cb(r,e,t){return Ty({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:Nb(r,{name:e})}},n=>r.parse(JSON.parse(n)))}function $b(r){return Py({type:"function",function:{name:r.name,parameters:Nb(r.parameters,{name:r.name}),strict:!0,...r.description?{description:r.description}:void 0}},{callback:r.function,parser:e=>r.parameters.parse(JSON.parse(e))})}function On(r){let{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:n,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=r;if((n||a)&&s&&e)return`${s}/${e}`;if((n||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(n||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function Ef(r){return r!==void 0&&Array.isArray(r.lc_namespace)}function Of(r){return r!==void 0&&de.isRunnable(r)&&"lc_name"in r.constructor&&typeof r.constructor.lc_name=="function"&&r.constructor.lc_name()==="RunnableToolLike"}function If(r){return!!r&&typeof r=="object"&&"name"in r&&"schema"in r&&(ns(r.schema)||r.schema!=null&&typeof r.schema=="object"&&"type"in r.schema&&typeof r.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(r.schema.type))}function co(r){return If(r)||Of(r)||Ef(r)}function Tf(r,e){let t=typeof e=="number"?void 0:e;return{name:r.name,description:r.description,parameters:nn(r.schema),...t?.strict!==void 0?{strict:t.strict}:{}}}function lo(r,e){return r.lc_error_code=e,r.message=`${r.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,r}function Ns(r){let e;return r.constructor.name===Mt.name?(e=new Error(r.message),e.name="TimeoutError"):r.constructor.name===ge.name?(e=new Error(r.message),e.name="AbortError"):r.status===400&&r.message.includes("tool_calls")?e=lo(r,"INVALID_TOOL_RESULTS"):r.status===401?e=lo(r,"MODEL_AUTHENTICATION"):r.status===429?e=lo(r,"MODEL_RATE_LIMIT"):r.status===404?e=lo(r,"MODEL_NOT_FOUND"):e=r,e}function jb(r){if(r)return r==="any"||r==="required"?"required":r==="auto"?"auto":r==="none"?"none":typeof r=="string"?{type:"function",function:{name:r}}:r}function DT(r){return r.anyOf!==void 0&&Array.isArray(r.anyOf)}function Mb(r){let e=["namespace functions {",""];for(let t of r)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(zb(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function zb(r,e){let t=[];for(let[n,s]of Object.entries(r.properties??{}))s.description&&e<2&&t.push(`// ${s.description}`),r.required?.includes(n)?t.push(`${n}: ${Ac(s,e)},`):t.push(`${n}?: ${Ac(s,e)},`);return t.map(n=>" ".repeat(e)+n).join(`
`)}function Ac(r,e){if(DT(r))return r.anyOf.map(t=>Ac(t,e)).join(" | ");switch(r.type){case"string":return r.enum?r.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return r.enum?r.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",zb(r,e+2),"}"].join(`
`);case"array":return r.items?`${Ac(r.items,e)}[]`:"any[]";default:return""}}function Lb(r,e){let t;if(co(r)){let n=$b({name:r.name,parameters:r.schema,description:r.description});n.function.parameters?t={type:n.type,function:{name:n.function.name,description:n.function.description,parameters:n.function.parameters,...e?.strict!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:Tf(r,e)}}else t=r;return e?.strict!==void 0&&(t.function.strict=e.strict),t}function UT(r){return r.role!=="system"&&r.role!=="developer"&&r.role!=="assistant"&&r.role!=="user"&&r.role!=="function"&&r.role!=="tool"&&console.warn(`Unknown message role: ${r.role}`),r.role}function Ub(r){let e=r._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Br.isInstance(r))throw new Error("Invalid generic chat message");return UT(r)}default:throw new Error(`Unknown message type: ${e}`)}}function FT(r,e,t){let n=r.tool_calls;switch(r.role){case"assistant":{let s=[],i=[];for(let u of n??[])try{s.push(wf(u,{returnId:!0}))}catch(c){i.push(Wy(u,c.message))}let a={function_call:r.function_call,tool_calls:n};t!==void 0&&(a.__raw_response=e);let o={model_name:e.model,...e.system_fingerprint?{usage:{...e.usage},system_fingerprint:e.system_fingerprint}:{}};return r.audio&&(a.audio=r.audio),new mt({content:r.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:e.id})}default:return new Br(r.content||"",r.role??"unknown")}}function BT(r,e,t,n){let s=r.role??t,i=r.content??"",a;r.function_call?a={function_call:r.function_call}:r.tool_calls?a={tool_calls:r.tool_calls}:a={},n&&(a.__raw_response=e),r.audio&&(a.audio={...r.audio,index:e.choices[0].index});let o={usage:{...e.usage}};if(s==="user")return new Rn({content:i,response_metadata:o});if(s==="assistant"){let u=[];if(Array.isArray(r.tool_calls))for(let c of r.tool_calls)u.push({name:c.function?.name,args:c.function?.arguments,id:c.id,index:c.index,type:"tool_call_chunk"});return new gt({content:i,tool_call_chunks:u,additional_kwargs:a,id:e.id,response_metadata:o})}else return s==="system"?new qr({content:i,response_metadata:o}):s==="developer"?new qr({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new kn({content:i,additional_kwargs:a,name:r.name,response_metadata:o}):s==="tool"?new Ls({content:i,additional_kwargs:a,tool_call_id:r.tool_call_id,response_metadata:o}):new Sn({content:i,role:s,response_metadata:o})}function Pf(r,e){return r.flatMap(t=>{let n=Ub(t);n==="system"&&e?.startsWith("o1")&&(n="developer");let s={role:n,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=null),Pn(t)&&t.tool_calls?.length?(s.tool_calls=t.tool_calls.map(Jy),s.content=null):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){let i={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,i]}return s})}function Db(r,e){return Ky(r)?e?.strict!==void 0?{...r,function:{...r.function,strict:e.strict}}:r:Lb(r,e)}var fo=class extends wc{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIEndpoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.apiKey??e?.openAIApiKey??e?.configuration?.apiKey??pe("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=e?.azureOpenAIApiKey??pe("AZURE_OPENAI_API_KEY"),this.azureADTokenProvider=e?.azureADTokenProvider??void 0,!this.azureOpenAIApiKey&&!this.apiKey&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??pe("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??pe("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??pe("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??pe("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??pe("OPENAI_ORGANIZATION"),this.azureOpenAIEndpoint=e?.azureOpenAIEndpoint??pe("AZURE_OPENAI_ENDPOINT"),this.modelName=e?.model??e?.modelName??this.model,this.model=this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this?.stop,this.user=e?.user,this.__includeRawResponse=e?.__includeRawResponse,this.audio=e?.audio,this.modalities=e?.modalities,this.reasoningEffort=e?.reasoningEffort,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath&&!this.azureOpenAIEndpoint)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName&&this.azureOpenAIBasePath){let n=this.azureOpenAIBasePath.split("/openai/deployments/");if(n.length===2){let[,s]=n;this.azureOpenAIApiDeploymentName=s}}if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??"",this.streamUsage=!1}this.model==="o1"&&(this.disableStreaming=!0),this.streaming=e?.streaming??!1,this.streamUsage=e?.streamUsage??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration},e?.supportsStrictToolCalling!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let n;return t?.strict!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>Db(s,{strict:n})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Ec(e.json_schema.schema)?Cb(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){let n;e?.strict!==void 0?n=e.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling);let s={};e?.stream_options!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t?.streaming)&&(s={stream_options:{include_usage:!0}});let i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:e?.tools?.length?e.tools.map(o=>Db(o,{strict:n})):void 0,tool_choice:jb(e?.tool_choice),response_format:this.createResponseFormat(e?.response_format),seed:e?.seed,...s,parallel_tool_calls:e?.parallel_tool_calls,...this.audio||e?.audio?{audio:this.audio||e?.audio}:{},...this.modalities||e?.modalities?{modalities:this.modalities||e?.modalities}:{},...this.modelKwargs};e?.prediction!==void 0&&(i.prediction=e.prediction);let a=e?.reasoning_effort??this.reasoningEffort;return a!==void 0&&(i.reasoning_effort=a),i}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,n){let s=Pf(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0},a,o=await this.completionWithRetry(i,t),u;for await(let c of o){let d=c?.choices?.[0];if(c.usage&&(u=c.usage),!d)continue;let{delta:l}=d;if(!l)continue;let f=BT(l,c,a,this.__includeRawResponse);a=l.role??a;let p={prompt:t.promptIndex??0,completion:d.index??0};if(typeof f.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let h={...p};d.finish_reason!=null&&(h.finish_reason=d.finish_reason,h.system_fingerprint=c.system_fingerprint,h.model_name=c.model),this.logprobs&&(h.logprobs=d.logprobs);let m=new en({message:f,text:f.content,generationInfo:h});yield m,await n?.handleLLMNewToken(m.text??"",p,void 0,void 0,void 0,{chunk:m})}if(u){let c={...u.prompt_tokens_details?.audio_tokens!==null&&{audio:u.prompt_tokens_details?.audio_tokens},...u.prompt_tokens_details?.cached_tokens!==null&&{cache_read:u.prompt_tokens_details?.cached_tokens}},d={...u.completion_tokens_details?.audio_tokens!==null&&{audio:u.completion_tokens_details?.audio_tokens},...u.completion_tokens_details?.reasoning_tokens!==null&&{reasoning:u.completion_tokens_details?.reasoning_tokens}};yield new en({message:new gt({content:"",response_metadata:{usage:{...u}},usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens,...Object.keys(c).length>0&&{input_token_details:c},...Object.keys(d).length>0&&{output_token_details:d}}}),text:""})}if(t.signal?.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,n){let s={},i=this.invocationParams(t),a=Pf(e,this.model);if(i.stream){let o=this._streamResponseChunks(e,t,n),u={};for await(let h of o){h.message.response_metadata={...h.generationInfo,...h.message.response_metadata};let m=h.generationInfo?.completion??0;u[m]===void 0?u[m]=h:u[m]=u[m].concat(h)}let c=Object.entries(u).sort(([h],[m])=>parseInt(h,10)-parseInt(m,10)).map(([h,m])=>m),{functions:d,function_call:l}=this.invocationParams(t),f=await this.getEstimatedTokenCountFromPrompt(e,d,l),p=await this.getNumTokensFromGenerations(c);return s.input_tokens=f,s.output_tokens=p,s.total_tokens=f+p,{generations:c,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let o;t.response_format&&t.response_format.type==="json_schema"?o=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:a},{signal:t?.signal,...t?.options}):o=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t?.signal,...t?.options});let{completion_tokens:u,prompt_tokens:c,total_tokens:d,prompt_tokens_details:l,completion_tokens_details:f}=o?.usage??{};u&&(s.output_tokens=(s.output_tokens??0)+u),c&&(s.input_tokens=(s.input_tokens??0)+c),d&&(s.total_tokens=(s.total_tokens??0)+d),(l?.audio_tokens!==null||l?.cached_tokens!==null)&&(s.input_token_details={...l?.audio_tokens!==null&&{audio:l?.audio_tokens},...l?.cached_tokens!==null&&{cache_read:l?.cached_tokens}}),(f?.audio_tokens!==null||f?.reasoning_tokens!==null)&&(s.output_token_details={...f?.audio_tokens!==null&&{audio:f?.audio_tokens},...f?.reasoning_tokens!==null&&{reasoning:f?.reasoning_tokens}});let p=[];for(let h of o?.choices??[]){let g={text:h.message?.content??"",message:FT(h.message??{role:"assistant"},o,this.__includeRawResponse)};g.generationInfo={...h.finish_reason?{finish_reason:h.finish_reason}:{},...h.logprobs?{logprobs:h.logprobs}:{}},Pn(g.message)&&(g.message.usage_metadata=s),g.message=new mt(Object.fromEntries(Object.entries(g.message).filter(([y])=>!y.startsWith("lc_")))),p.push(g)}return{generations:p,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,n){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&n!=="auto"){let i=Mb(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),n==="none"?s+=1:typeof n=="object"&&(s+=await this.getNumTokens(n.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async n=>n.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([n.message])).countPerMessage[0]:await this.getNumTokens(n.message.content)))).reduce((n,s)=>n+s,0)}async getNumTokensFromMessages(e){let t=0,n=0,s=0;this.model==="gpt-3.5-turbo-0301"?(n=4,s=-1):(n=3,s=1);let i=await Promise.all(e.map(async a=>{let o=await this.getNumTokens(a.content),u=await this.getNumTokens(Ub(a)),c=a.name!==void 0?s+await this.getNumTokens(a.name):0,d=o+n+u+c,l=a;if(l._getType()==="function"&&(d-=2),l.additional_kwargs?.function_call&&(d+=3),l?.additional_kwargs.function_call?.name&&(d+=await this.getNumTokens(l.additional_kwargs.function_call?.name)),l.additional_kwargs.function_call?.arguments)try{d+=await this.getNumTokens(JSON.stringify(JSON.parse(l.additional_kwargs.function_call?.arguments)))}catch(f){console.error("Error parsing function arguments",f,JSON.stringify(l.additional_kwargs.function_call)),d+=await this.getNumTokens(l.additional_kwargs.function_call?.arguments)}return t+=d,d}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){let n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,n)}catch(s){throw Ns(s)}})}async betaParsedCompletionWithRetry(e,t){let n=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,n)}catch(s){throw Ns(s)}})}_getClientOptions(e){if(!this.client){let n={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL,azureOpenAIEndpoint:this.azureOpenAIEndpoint},s=On(n),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new Z(i)}let t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,n)=>(n&&n.tokenUsage&&(t.tokenUsage.completionTokens+=n.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=n.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=n.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let n,s,i,a;ZT(e)?(n=e.schema,s=e.name,i=e.method,a=e.includeRaw):(n=e,s=t?.name,i=t?.method,a=t?.includeRaw);let o,u;if(t?.strict!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Ec(n)?u=so.fromZodSchema(n):u=new io;else if(i==="jsonSchema")o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:n.description,schema:n,strict:t?.strict}}}),Ec(n)?u=so.fromZodSchema(n):u=new io;else{let f=s??"extract";if(Ec(n)){let p=si(n);o=this.bind({tools:[{type:"function",function:{name:f,description:p.description,parameters:p}}],tool_choice:{type:"function",function:{name:f}},...t?.strict!==void 0?{strict:t.strict}:{}}),u=new ao({returnSingle:!0,keyName:f,zodSchema:n})}else{let p;typeof n.name=="string"&&typeof n.parameters=="object"&&n.parameters!=null?(p=n,f=n.name):(f=n.title??f,p={name:f,description:n.description??"",parameters:n}),o=this.bind({tools:[{type:"function",function:p}],tool_choice:{type:"function",function:{name:f}},...t?.strict!==void 0?{strict:t.strict}:{}}),u=new ao({returnSingle:!0,keyName:f})}}if(!a)return o.pipe(u);let c=mr.assign({parsed:(f,p)=>u.invoke(f.raw,p)}),d=mr.assign({parsed:()=>null}),l=c.withFallbacks({fallbacks:[d]});return kr.from([{raw:o},l])}};function Ec(r){return typeof r?.parse=="function"}function ZT(r){return r!==void 0&&typeof r.schema=="object"}var Sf=class extends ro{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),Object.defineProperty(this,"defaultConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat,this.defaultConfig=e?.defaultConfig??this.defaultConfig,this.metadata=e?.metadata??this.metadata}async invoke(e,t){let n,s=ie(Qs(this.defaultConfig,t));return Gr(e)?(n=e.args,s={...s,toolCall:e}):n=e,this.call(n,s)}async call(e,t,n){let s=Gr(e)?e.args:e,i;if(ns(this.schema))try{i=await oi(this.schema,s)}catch(h){let m="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(m=`${m}
Details: ${h.message}`),new Nn(m,JSON.stringify(e))}else{let h=he(s,this.schema);if(!h.valid){let m="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(m=`${m}
Details: ${h.errors.map(g=>`${g.keywordLocation}: ${g.error}`).join(`
`)}`),new Nn(m,JSON.stringify(e))}i=s}let a=Lg(t),u=await $e.configure(a.callbacks,this.callbacks,a.tags||n,this.tags,a.metadata,this.metadata,{verbose:this.verbose})?.handleToolStart(this.toJSON(),typeof e=="string"?e:JSON.stringify(e),a.runId,void 0,void 0,void 0,a.runName);delete a.runId;let c;try{c=await this._call(i,u,a)}catch(h){throw await u?.handleToolError(h),h}let d,l;if(this.responseFormat==="content_and_artifact")if(Array.isArray(c)&&c.length===2)[d,l]=c;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(c)}`);else d=c;let f;Gr(e)&&(f=e.id),!f&&cp(a)&&(f=a.toolCall.id);let p=GT({content:d,artifact:l,toolCallId:f,name:this.name,metadata:this.metadata});return await u?.handleToolEnd(p),p}},Oc=class extends Sf{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:at.object({input:at.string().optional()}).transform(t=>t.input)})}call(e,t){let n=typeof e=="string"||e==null?{input:e}:e;return super.call(n,t)}};function GT(r){let{content:e,artifact:t,toolCallId:n,metadata:s}=r;return n&&!op(e)?typeof e=="string"||Array.isArray(e)&&e.every(i=>typeof i=="object")?new yr({status:"success",content:e,artifact:t,tool_call_id:n,name:r.name,metadata:s}):new yr({status:"success",content:HT(e),artifact:t,tool_call_id:n,name:r.name,metadata:s}):e}function HT(r){try{return JSON.stringify(r,null,2)??""}catch{return`${r}`}}var kf=class extends Oc{static lc_name(){return"DallEAPIWrapper"}constructor(e){e?.responseFormat!==void 0&&["url","b64_json"].includes(e.responseFormat)&&(e.dallEResponseFormat=e.responseFormat,e.responseFormat="content"),super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"dallEResponseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=e?.apiKey??e?.openAIApiKey??pe("OPENAI_API_KEY"),n=e?.organization??pe("OPENAI_ORGANIZATION"),s={apiKey:t,organization:n,dangerouslyAllowBrowser:!0,baseUrl:e?.baseUrl};this.client=new Z(s),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.dallEResponseFormat=e?.dallEResponseFormat??this.dallEResponseFormat,this.user=e?.user}processMultipleGeneratedUrls(e){return this.dallEResponseFormat==="url"?e.flatMap(t=>t.data.flatMap(s=>s.url?{type:"image_url",image_url:s.url}:[]).filter(s=>s!==void 0&&s.type==="image_url"&&typeof s.image_url=="string"&&s.image_url!==void 0)):e.flatMap(t=>t.data.flatMap(s=>s.b64_json?{type:"image_url",image_url:{url:s.b64_json}}:[]).filter(s=>s!==void 0&&s.type==="image_url"&&typeof s.image_url=="object"&&"url"in s.image_url&&typeof s.image_url.url=="string"&&s.image_url.url!==void 0))}async _call(e){let t={model:this.model,prompt:e,n:1,size:this.size,response_format:this.dallEResponseFormat,style:this.style,quality:this.quality,user:this.user};if(this.n>1){let i=await Promise.all(Array.from({length:this.n}).map(()=>this.client.images.generate(t)));return this.processMultipleGeneratedUrls(i)}let n=await this.client.images.generate(t),s="";return this.dallEResponseFormat==="url"?[s]=n.data.map(i=>i.url).filter(i=>i!=="undefined"):[s]=n.data.map(i=>i.b64_json).filter(i=>i!=="undefined"),s}};Object.defineProperty(kf,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});var Fb={GAP_PENALTY:-.3,TAIL_GUARD_SIZE:5,LENGTH_TOLERANCE:.1};function Bb(r,e){if(!r||!e)return 0;let[t,n]=r.length>e.length?[r,e]:[e,r];if(!t.length)return 1;let s=0;for(let l=0;l<n.length;l++)t.includes(n[l])&&s++;let i=s/t.length,a=new Set(r.toLowerCase().match(/[a-z0-9']+/gi)||[]),o=new Set(e.toLowerCase().match(/[a-z0-9']+/gi)||[]),u=new Set([...a].filter(l=>o.has(l))),c=new Set([...a,...o]),d=c.size?u.size/c.size:0;return .7*i+.3*d}function Rf(r){let e=r.split(/\s+/).join(" ").trim(),t=e.match(/^\[([^\]]+)\]\s*(.*)$/);return t?t[2].trim():e}function Nf(r,e,t=!1){let n=r.length,s=e.length;if(n===0)return[];let{GAP_PENALTY:i,TAIL_GUARD_SIZE:a,LENGTH_TOLERANCE:o}=Fb,u=Array(n+1).fill(null).map(()=>Array(s+1).fill(-1/0)),c=Array(n+1).fill(null).map(()=>Array(s+1).fill(null));u[0][0]=0;for(let m=1;m<=n;m++)u[m][0]=u[m-1][0]+i,c[m][0]="O";for(let m=1;m<=s;m++)u[0][m]=u[0][m-1]+i,c[0][m]="R";for(let m=1;m<=n;m++){let g=r[m-1].text;for(let y=1;y<=s;y++){let _=e[y-1],w=u[m-1][y-1]+Bb(g,_),A="M",E=u[m-1][y]+i;E>w&&(w=E,A="O");let L=u[m][y-1]+i;L>w&&(w=L,A="R"),u[m][y]=w,c[m][y]=A}}let d=Array(n).fill(null),l=n,f=s;for(;l>0||f>0;){let m=l>=0&&f>=0?c[l][f]:null;if(m==="M"&&l>0&&f>0)d[l-1]=f-1,l--,f--;else if(m==="O"&&l>0)d[l-1]=null,l--;else if(m==="R"&&f>0)f--;else if(l>0)d[l-1]=null,l--;else if(f>0)f--;else break}let p=[],h=t?n-a:n+1;for(let m=0;m<n;m++){let g=r[m],y=d[m],_=y!==null&&y>=0&&y<s?e[y]:g.text;if(m>=h&&_){let w=g.text.length||1;Math.abs(_.length-w)/w>o&&(_=g.text)}_||(_=g.text),p.push({text:_,startMs:g.startMs,endMs:g.endMs,startTimeText:g.startTimeText})}return p}function Ic(r,e){let t=[],n=r.length,s=0;for(;s<n;){let i=Math.min(s+e,n);t.push([s,i]),s=i}return t}function VT(r,e,t,n){let s=r.split(t),i=Ic(e,n);for(;s.length<i.length;)s.push("");let a=[];for(let o=0;o<i.length;o++){let[u,c]=i[o],d=s[o],l=e.slice(u,c),p=d.trim().split(`
`).filter(m=>m.trim()).map(m=>m.split(/\s+/).join(" ")).map(Rf).filter(m=>m);p.length!==l.length&&console.warn(`Parser chunk ${o+1}/${i.length} warning: expected ${l.length} lines, got ${p.length}`);let h=Nf(l,p,!0);a.push(...h)}return a}function KT(r,e){let t=r.trim().split(`
`).map(Rf);return t.length!==e.length&&console.warn(`Parser warning: Expected ${e.length} lines, got ${t.length} lines`),Nf(e,t,!1)}function Cf(r,e,t,n){return r?r.includes(t)?VT(r,e,t,n):KT(r,e):[]}typeof module<"u"&&module.exports&&(module.exports={parseRefinedSegments:Cf,dpAlignSegments:Nf,computeLineSimilarity:Bb,normalizeLineToText:Rf,chunkSegmentsByCount:Ic,SEGMENT_PARSER_CONFIG:Fb});var Cs={MAX_SEGMENTS_PER_CHUNK:50,CHUNK_SENTINEL:"<<<__CHUNK_END__>>>",MODEL:"google/gemini-2.5-flash-lite-preview-09-2025"};async function Zb(r,e,t,n,s=null,i=Cs.MODEL){if(!r||r.length===0)return[];let a=typeof chrome<"u"&&chrome.runtime?chrome.runtime.getURL(""):"https://github.com/better-youtube-caption",o=new fo({model:i,apiKey:n,configuration:{baseURL:"https://openrouter.ai/api/v1",defaultHeaders:{"HTTP-Referer":a,"X-Title":"Better YouTube Caption"}},temperature:0,use_responses_api:!0,reasoning:{effort:"minimal"},extra_body:{include_reasoning:!1,provider:{sort:"throughput"}}}),u=`You are correcting segments of a YouTube video transcript. These segments could be from anywhere in the video (beginning, middle, or end). Use the video title and description for context.

CRITICAL CONSTRAINTS:
- Only fix typos and grammar. Do NOT change meaning or structure.
- PRESERVE ALL NEWLINES: each line is a distinct transcript segment.
- Do NOT add, remove, or merge lines. Keep the same number of lines.
- MAINTAIN SIMILAR LINE LENGTHS: Each output line should be approximately the same character count as its corresponding input line (\xB110% tolerance). Do NOT expand short lines into long paragraphs. Do NOT condense long lines significantly. Keep each line concise.
- If a sentence is broken across lines, keep it broken the same way.
- PRESERVE THE ORIGINAL LANGUAGE: output must be in the same language as the input transcript.
- Focus on minimal corrections: fix typos, correct grammar errors, but keep expansions/additions to an absolute minimum.

EXAMPLES OF CORRECT BEHAVIOR:

Input:
up to 900. From 900 up to 1,100.
If you sold at the reasonable
valuations, when the gains that already
been had, you missed out big time. I

Output:
up to $900. From $900 up to $1,100.
If you sold at the reasonable
valuations, when the gains that already
had been had, you missed out big time. I`;function c(_,w){return[`Video Title: ${_||""}`,`Video Description: ${w||""}`,"","Transcript Chunk:"].join(`
`)}let d=c(e,t),l=Ic(r,Cs.MAX_SEGMENTS_PER_CHUNK),f=[],p=[];for(let _=0;_<l.length;_++){let[w,A]=l[_],E=r.slice(w,A),L=E.length,G=E.map(ee=>(ee.text||"").split(/\s+/).join(" ")).join(`
`),q=[new Zr({content:u}),new it({content:`${d}
${G}`})];f.push(q),p.push({chunkIdx:_+1,startIdx:w,endIdx:A,expectedLineCount:L})}s&&s(0,f.length);let h=await o.batch(f),m=[];for(let _=0;_<h.length;_++){let w=h[_],A=p[_],E=A.chunkIdx,L=A.expectedLineCount,q=(w.content_blocks&&w.content_blocks.length>0?w.content_blocks[w.content_blocks.length-1].text:w.content).trim().split(`
`),ee=q.length;s&&s(E,f.length),ee!==L&&console.warn(`WARNING: Line count mismatch in chunk ${E}! Expected ${L}, got ${ee}`),m.push(...q),m.push(Cs.CHUNK_SENTINEL)}let g=m.join(`
`);return Cf(g,r,Cs.CHUNK_SENTINEL,Cs.MAX_SEGMENTS_PER_CHUNK)}typeof globalThis<"u"&&(globalThis.refineTranscriptWithLLM=Zb,globalThis.REFINER_CONFIG=Cs);return Xb(JT);})();
/*! Bundled license information:

@langchain/core/dist/utils/fast-json-patch/src/helpers.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

@langchain/core/dist/utils/fast-json-patch/src/duplex.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2013-2021 Joachim Wester
   * MIT license
   *)

@langchain/core/dist/utils/js-sha1/hash.js:
  (*
   * [js-sha1]{@link https://github.com/emn178/js-sha1}
   *
   * @version 0.6.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   *)

@langchain/core/dist/utils/js-sha256/hash.js:
  (**
   * [js-sha256]{@link https://github.com/emn178/js-sha256}
   *
   * @version 0.11.1
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2025
   * @license MIT
   *)
*/
//# sourceMappingURL=captionRefiner.bundle.js.map
